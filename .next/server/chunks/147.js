exports.id=147,exports.ids=[147],exports.modules={7749:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addAdminServicesToServer=t.registerAdminService=void 0;let r=[];function n(e,t){r.push({getServiceDefinition:e,getHandlers:t})}function i(e){for(let{getServiceDefinition:t,getHandlers:n}of r)e.addService(t(),n())}t.registerAdminService=n,t.addAdminServicesToServer=i},1742:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BackoffTimeout=void 0;let r=1e3,n=1.6,i=12e4,s=.2;function a(e,t){return Math.random()*(t-e)+e}class o{constructor(e,t){this.callback=e,this.initialDelay=r,this.multiplier=n,this.maxDelay=i,this.jitter=s,this.running=!1,this.hasRef=!0,this.startTime=new Date,this.endTime=new Date,t&&(t.initialDelay&&(this.initialDelay=t.initialDelay),t.multiplier&&(this.multiplier=t.multiplier),t.jitter&&(this.jitter=t.jitter),t.maxDelay&&(this.maxDelay=t.maxDelay)),this.nextDelay=this.initialDelay,this.timerId=setTimeout(()=>{},0),clearTimeout(this.timerId)}runTimer(e){var t,r;this.endTime=this.startTime,this.endTime.setMilliseconds(this.endTime.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),this.timerId=setTimeout(()=>{this.callback(),this.running=!1},e),this.hasRef||null===(r=(t=this.timerId).unref)||void 0===r||r.call(t)}runOnce(){this.running=!0,this.startTime=new Date,this.runTimer(this.nextDelay);let e=Math.min(this.nextDelay*this.multiplier,this.maxDelay),t=e*this.jitter;this.nextDelay=e+a(-t,t)}stop(){clearTimeout(this.timerId),this.running=!1}reset(){if(this.nextDelay=this.initialDelay,this.running){let e=new Date,t=this.startTime;t.setMilliseconds(t.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),e<t?this.runTimer(t.getTime()-e.getTime()):this.running=!1}}isRunning(){return this.running}ref(){var e,t;this.hasRef=!0,null===(t=(e=this.timerId).ref)||void 0===t||t.call(e)}unref(){var e,t;this.hasRef=!1,null===(t=(e=this.timerId).unref)||void 0===t||t.call(e)}getEndTime(){return this.endTime}}t.BackoffTimeout=o},5402:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CallCredentials=void 0;let n=r(6281);function i(e){return"getRequestHeaders"in e&&"function"==typeof e.getRequestHeaders}class s{static createFromMetadataGenerator(e){return new o(e)}static createFromGoogleCredential(e){return s.createFromMetadataGenerator((t,r)=>{let s;(s=i(e)?e.getRequestHeaders(t.service_url):new Promise((r,n)=>{e.getRequestMetadata(t.service_url,(e,t)=>{if(e){n(e);return}if(!t){n(Error("Headers not set by metadata plugin"));return}r(t)})})).then(e=>{let t=new n.Metadata;for(let r of Object.keys(e))t.add(r,e[r]);r(null,t)},e=>{r(e)})})}static createEmpty(){return new l}}t.CallCredentials=s;class a extends s{constructor(e){super(),this.creds=e}async generateMetadata(e){let t=new n.Metadata;for(let r of(await Promise.all(this.creds.map(t=>t.generateMetadata(e)))))t.merge(r);return t}compose(e){return new a(this.creds.concat([e]))}_equals(e){return this===e||e instanceof a&&this.creds.every((t,r)=>t._equals(e.creds[r]))}}class o extends s{constructor(e){super(),this.metadataGenerator=e}generateMetadata(e){return new Promise((t,r)=>{this.metadataGenerator(e,(e,n)=>{void 0!==n?t(n):r(e)})})}compose(e){return new a([this,e])}_equals(e){return this===e||e instanceof o&&this.metadataGenerator===e.metadataGenerator}}class l extends s{generateMetadata(e){return Promise.resolve(new n.Metadata)}compose(e){return e}_equals(e){return e instanceof l}}},1218:(e,t)=>{"use strict";function r(e){return void 0!==e.onReceiveMetadata&&1===e.onReceiveMetadata.length}Object.defineProperty(t,"__esModule",{value:!0}),t.InterceptingListenerImpl=t.isInterceptingListener=void 0,t.isInterceptingListener=r;class n{constructor(e,t){this.listener=e,this.nextListener=t,this.processingMetadata=!1,this.hasPendingMessage=!1,this.processingMessage=!1,this.pendingStatus=null}processPendingMessage(){this.hasPendingMessage&&(this.nextListener.onReceiveMessage(this.pendingMessage),this.pendingMessage=null,this.hasPendingMessage=!1)}processPendingStatus(){this.pendingStatus&&this.nextListener.onReceiveStatus(this.pendingStatus)}onReceiveMetadata(e){this.processingMetadata=!0,this.listener.onReceiveMetadata(e,e=>{this.processingMetadata=!1,this.nextListener.onReceiveMetadata(e),this.processPendingMessage(),this.processPendingStatus()})}onReceiveMessage(e){this.processingMessage=!0,this.listener.onReceiveMessage(e,e=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessage=e,this.hasPendingMessage=!0):(this.nextListener.onReceiveMessage(e),this.processPendingStatus())})}onReceiveStatus(e){this.listener.onReceiveStatus(e,e=>{this.processingMetadata||this.processingMessage?this.pendingStatus=e:this.nextListener.onReceiveStatus(e)})}}t.InterceptingListenerImpl=n},1801:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getNextCallNumber=void 0;let r=0;function n(){return r++}t.getNextCallNumber=n},7639:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ClientDuplexStreamImpl=t.ClientWritableStreamImpl=t.ClientReadableStreamImpl=t.ClientUnaryCallImpl=t.callErrorFromStatus=void 0;let n=r(7702),i=r(6162),s=r(9572);function a(e,t){let r=`${e.code} ${s.Status[e.code]}: ${e.details}`,n=Error(r),i=`${n.stack}
for call at
${t}`;return Object.assign(Error(r),e,{stack:i})}t.callErrorFromStatus=a;class o extends n.EventEmitter{constructor(){super()}cancel(){var e;null===(e=this.call)||void 0===e||e.cancelWithStatus(s.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return null!==(t=null===(e=this.call)||void 0===e?void 0:e.getPeer())&&void 0!==t?t:"unknown"}}t.ClientUnaryCallImpl=o;class l extends i.Readable{constructor(e){super({objectMode:!0}),this.deserialize=e}cancel(){var e;null===(e=this.call)||void 0===e||e.cancelWithStatus(s.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return null!==(t=null===(e=this.call)||void 0===e?void 0:e.getPeer())&&void 0!==t?t:"unknown"}_read(e){var t;null===(t=this.call)||void 0===t||t.startRead()}}t.ClientReadableStreamImpl=l;class u extends i.Writable{constructor(e){super({objectMode:!0}),this.serialize=e}cancel(){var e;null===(e=this.call)||void 0===e||e.cancelWithStatus(s.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return null!==(t=null===(e=this.call)||void 0===e?void 0:e.getPeer())&&void 0!==t?t:"unknown"}_write(e,t,r){var n;let i={callback:r},s=Number(t);Number.isNaN(s)||(i.flags=s),null===(n=this.call)||void 0===n||n.sendMessageWithContext(i,e)}_final(e){var t;null===(t=this.call)||void 0===t||t.halfClose(),e()}}t.ClientWritableStreamImpl=u;class c extends i.Duplex{constructor(e,t){super({objectMode:!0}),this.serialize=e,this.deserialize=t}cancel(){var e;null===(e=this.call)||void 0===e||e.cancelWithStatus(s.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return null!==(t=null===(e=this.call)||void 0===e?void 0:e.getPeer())&&void 0!==t?t:"unknown"}_read(e){var t;null===(t=this.call)||void 0===t||t.startRead()}_write(e,t,r){var n;let i={callback:r},s=Number(t);Number.isNaN(s)||(i.flags=s),null===(n=this.call)||void 0===n||n.sendMessageWithContext(i,e)}_final(e){var t;null===(t=this.call)||void 0===t||t.halfClose(),e()}}t.ClientDuplexStreamImpl=c},499:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChannelCredentials=void 0;let n=r(2452),i=r(5402),s=r(606);function a(e,t){if(e&&!(e instanceof Buffer))throw TypeError(`${t}, if provided, must be a Buffer.`)}class o{constructor(e){this.callCredentials=e||i.CallCredentials.createEmpty()}_getCallCredentials(){return this.callCredentials}static createSsl(e,t,r,i){var o;if(a(e,"Root certificate"),a(t,"Private key"),a(r,"Certificate chain"),t&&!r)throw Error("Private key must be given with accompanying certificate chain");if(!t&&r)throw Error("Certificate chain must be given with accompanying private key");return new u((0,n.createSecureContext)({ca:null!==(o=null!=e?e:(0,s.getDefaultRootsData)())&&void 0!==o?o:void 0,key:null!=t?t:void 0,cert:null!=r?r:void 0,ciphers:s.CIPHER_SUITES}),null!=i?i:{})}static createFromSecureContext(e,t){return new u(e,null!=t?t:{})}static createInsecure(){return new l}}t.ChannelCredentials=o;class l extends o{constructor(e){super(e)}compose(e){throw Error("Cannot compose insecure credentials")}_getConnectionOptions(){return null}_isSecure(){return!1}_equals(e){return e instanceof l}}class u extends o{constructor(e,t){super(),this.secureContext=e,this.verifyOptions=t,this.connectionOptions={secureContext:e},(null==t?void 0:t.checkServerIdentity)&&(this.connectionOptions.checkServerIdentity=t.checkServerIdentity)}compose(e){return new c(this,this.callCredentials.compose(e))}_getConnectionOptions(){return Object.assign({},this.connectionOptions)}_isSecure(){return!0}_equals(e){return this===e||e instanceof u&&this.secureContext===e.secureContext&&this.verifyOptions.checkServerIdentity===e.verifyOptions.checkServerIdentity}}class c extends o{constructor(e,t){super(t),this.channelCredentials=e}compose(e){let t=this.callCredentials.compose(e);return new c(this.channelCredentials,t)}_getConnectionOptions(){return this.channelCredentials._getConnectionOptions()}_isSecure(){return!0}_equals(e){return this===e||e instanceof c&&this.channelCredentials._equals(e.channelCredentials)&&this.callCredentials._equals(e.callCredentials)}}},9455:(e,t)=>{"use strict";function r(e,t){let r=Object.keys(e).sort(),n=Object.keys(t).sort();if(r.length!==n.length)return!1;for(let i=0;i<r.length;i+=1)if(r[i]!==n[i]||e[r[i]]!==t[n[i]])return!1;return!0}Object.defineProperty(t,"__esModule",{value:!0}),t.channelOptionsEqual=t.recognizedOptions=void 0,t.recognizedOptions={"grpc.ssl_target_name_override":!0,"grpc.primary_user_agent":!0,"grpc.secondary_user_agent":!0,"grpc.default_authority":!0,"grpc.keepalive_time_ms":!0,"grpc.keepalive_timeout_ms":!0,"grpc.keepalive_permit_without_calls":!0,"grpc.service_config":!0,"grpc.max_concurrent_streams":!0,"grpc.initial_reconnect_backoff_ms":!0,"grpc.max_reconnect_backoff_ms":!0,"grpc.use_local_subchannel_pool":!0,"grpc.max_send_message_length":!0,"grpc.max_receive_message_length":!0,"grpc.enable_http_proxy":!0,"grpc.enable_channelz":!0,"grpc.dns_min_time_between_resolutions_ms":!0,"grpc.enable_retries":!0,"grpc.per_rpc_retry_buffer_size":!0,"grpc.retry_buffer_size":!0,"grpc.max_connection_age_ms":!0,"grpc.max_connection_age_grace_ms":!0,"grpc-node.max_session_memory":!0,"grpc.service_config_disable_resolution":!0,"grpc.client_idle_timeout_ms":!0,"grpc-node.tls_enable_trace":!0},t.channelOptionsEqual=r},9452:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChannelImplementation=void 0;let n=r(499),i=r(9359);class s{constructor(e,t,r){if("string"!=typeof e)throw TypeError("Channel target must be a string");if(!(t instanceof n.ChannelCredentials))throw TypeError("Channel credentials must be a ChannelCredentials object");if(r&&"object"!=typeof r)throw TypeError("Channel options must be an object");this.internalChannel=new i.InternalChannel(e,t,r)}close(){this.internalChannel.close()}getTarget(){return this.internalChannel.getTarget()}getConnectivityState(e){return this.internalChannel.getConnectivityState(e)}watchConnectivityState(e,t,r){this.internalChannel.watchConnectivityState(e,t,r)}getChannelzRef(){return this.internalChannel.getChannelzRef()}createCall(e,t,r,n,i){if("string"!=typeof e)throw TypeError("Channel#createCall: method must be a string");if(!("number"==typeof t||t instanceof Date))throw TypeError("Channel#createCall: deadline must be a number or Date");return this.internalChannel.createCall(e,t,r,n,i)}}t.ChannelImplementation=s},5962:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setup=t.getChannelzServiceDefinition=t.getChannelzHandlers=t.unregisterChannelzRef=t.registerChannelzSocket=t.registerChannelzServer=t.registerChannelzSubchannel=t.registerChannelzChannel=t.ChannelzCallTracker=t.ChannelzChildrenTracker=t.ChannelzTrace=void 0;let n=r(8216),i=r(2409),s=r(9572),a=r(4955),o=r(7749),l=r(4529);function u(e){return{channel_id:e.id,name:e.name}}function c(e){return{subchannel_id:e.id,name:e.name}}function h(e){return{server_id:e.id}}function d(e){return{socket_id:e.id,name:e.name}}let p=32;class f{constructor(){this.events=[],this.eventsLogged=0,this.creationTimestamp=new Date}addTrace(e,t,r){let n=new Date;this.events.push({description:t,severity:e,timestamp:n,childChannel:(null==r?void 0:r.kind)==="channel"?r:void 0,childSubchannel:(null==r?void 0:r.kind)==="subchannel"?r:void 0}),this.events.length>=2*p&&(this.events=this.events.slice(p)),this.eventsLogged+=1}getTraceMessage(){return{creation_timestamp:O(this.creationTimestamp),num_events_logged:this.eventsLogged,events:this.events.map(e=>({description:e.description,severity:e.severity,timestamp:O(e.timestamp),channel_ref:e.childChannel?u(e.childChannel):null,subchannel_ref:e.childSubchannel?c(e.childSubchannel):null}))}}}t.ChannelzTrace=f;class m{constructor(){this.channelChildren=new Map,this.subchannelChildren=new Map,this.socketChildren=new Map}refChild(e){var t,r,n;switch(e.kind){case"channel":{let r=null!==(t=this.channelChildren.get(e.id))&&void 0!==t?t:{ref:e,count:0};r.count+=1,this.channelChildren.set(e.id,r);break}case"subchannel":{let t=null!==(r=this.subchannelChildren.get(e.id))&&void 0!==r?r:{ref:e,count:0};t.count+=1,this.subchannelChildren.set(e.id,t);break}case"socket":{let t=null!==(n=this.socketChildren.get(e.id))&&void 0!==n?n:{ref:e,count:0};t.count+=1,this.socketChildren.set(e.id,t)}}}unrefChild(e){switch(e.kind){case"channel":{let t=this.channelChildren.get(e.id);void 0!==t&&(t.count-=1,0===t.count?this.channelChildren.delete(e.id):this.channelChildren.set(e.id,t));break}case"subchannel":{let t=this.subchannelChildren.get(e.id);void 0!==t&&(t.count-=1,0===t.count?this.subchannelChildren.delete(e.id):this.subchannelChildren.set(e.id,t));break}case"socket":{let t=this.socketChildren.get(e.id);void 0!==t&&(t.count-=1,0===t.count?this.socketChildren.delete(e.id):this.socketChildren.set(e.id,t))}}}getChildLists(){let e=[];for(let{ref:t}of this.channelChildren.values())e.push(t);let t=[];for(let{ref:e}of this.subchannelChildren.values())t.push(e);let r=[];for(let{ref:e}of this.socketChildren.values())r.push(e);return{channels:e,subchannels:t,sockets:r}}}t.ChannelzChildrenTracker=m;class g{constructor(){this.callsStarted=0,this.callsSucceeded=0,this.callsFailed=0,this.lastCallStartedTimestamp=null}addCallStarted(){this.callsStarted+=1,this.lastCallStartedTimestamp=new Date}addCallSucceeded(){this.callsSucceeded+=1}addCallFailed(){this.callsFailed+=1}}t.ChannelzCallTracker=g;let y=1;function v(){return y++}let b=[],T=[],S=[],E=[];function w(e,t,r){let n=v(),i={id:n,name:e,kind:"channel"};return r&&(b[n]={ref:i,getInfo:t}),i}function C(e,t,r){let n=v(),i={id:n,name:e,kind:"subchannel"};return r&&(T[n]={ref:i,getInfo:t}),i}function _(e,t){let r=v(),n={id:r,kind:"server"};return t&&(S[r]={ref:n,getInfo:e}),n}function I(e,t,r){let n=v(),i={id:n,name:e,kind:"socket"};return r&&(E[n]={ref:i,getInfo:t}),i}function R(e){switch(e.kind){case"channel":delete b[e.id];return;case"subchannel":delete T[e.id];return;case"server":delete S[e.id];return;case"socket":delete E[e.id];return}}function N(e){let t=Number.parseInt(e,16);return[t/256|0,t%256]}function k(e){return""===e?[]:[].concat(...e.split(":").map(e=>N(e)))}function A(e){if((0,n.isIPv4)(e))return Buffer.from(Uint8Array.from(e.split(".").map(e=>Number.parseInt(e))));if(!(0,n.isIPv6)(e))return null;{let t,r;let n=e.indexOf("::");-1===n?(t=e,r=""):(t=e.substring(0,n),r=e.substring(n+2));let i=Buffer.from(k(t)),s=Buffer.from(k(r)),a=Buffer.alloc(16-i.length-s.length,0);return Buffer.concat([i,a,s])}}function D(e){switch(e){case i.ConnectivityState.CONNECTING:return{state:"CONNECTING"};case i.ConnectivityState.IDLE:return{state:"IDLE"};case i.ConnectivityState.READY:return{state:"READY"};case i.ConnectivityState.SHUTDOWN:return{state:"SHUTDOWN"};case i.ConnectivityState.TRANSIENT_FAILURE:return{state:"TRANSIENT_FAILURE"};default:return{state:"UNKNOWN"}}}function O(e){if(!e)return null;let t=e.getTime();return{seconds:t/1e3|0,nanos:t%1e3*1e6}}function x(e){let t=e.getInfo();return{ref:u(e.ref),data:{target:t.target,state:D(t.state),calls_started:t.callTracker.callsStarted,calls_succeeded:t.callTracker.callsSucceeded,calls_failed:t.callTracker.callsFailed,last_call_started_timestamp:O(t.callTracker.lastCallStartedTimestamp),trace:t.trace.getTraceMessage()},channel_ref:t.children.channels.map(e=>u(e)),subchannel_ref:t.children.subchannels.map(e=>c(e))}}function P(e,t){let r=Number.parseInt(e.request.channel_id),n=b[r];if(void 0===n){t({code:s.Status.NOT_FOUND,details:"No channel data found for id "+r});return}t(null,{channel:x(n)})}function M(e,t){let r=Number.parseInt(e.request.max_results),n=[],i=Number.parseInt(e.request.start_channel_id);for(;i<b.length;i++){let e=b[i];if(void 0!==e&&(n.push(x(e)),n.length>=r))break}t(null,{channel:n,end:i>=S.length})}function L(e){let t=e.getInfo();return{ref:h(e.ref),data:{calls_started:t.callTracker.callsStarted,calls_succeeded:t.callTracker.callsSucceeded,calls_failed:t.callTracker.callsFailed,last_call_started_timestamp:O(t.callTracker.lastCallStartedTimestamp),trace:t.trace.getTraceMessage()},listen_socket:t.listenerChildren.sockets.map(e=>d(e))}}function F(e,t){let r=Number.parseInt(e.request.server_id),n=S[r];if(void 0===n){t({code:s.Status.NOT_FOUND,details:"No server data found for id "+r});return}t(null,{server:L(n)})}function B(e,t){let r=Number.parseInt(e.request.max_results),n=[],i=Number.parseInt(e.request.start_server_id);for(;i<S.length;i++){let e=S[i];if(void 0!==e&&(n.push(L(e)),n.length>=r))break}t(null,{server:n,end:i>=S.length})}function U(e,t){let r=Number.parseInt(e.request.subchannel_id),n=T[r];if(void 0===n){t({code:s.Status.NOT_FOUND,details:"No subchannel data found for id "+r});return}let i=n.getInfo();t(null,{subchannel:{ref:c(n.ref),data:{target:i.target,state:D(i.state),calls_started:i.callTracker.callsStarted,calls_succeeded:i.callTracker.callsSucceeded,calls_failed:i.callTracker.callsFailed,last_call_started_timestamp:O(i.callTracker.lastCallStartedTimestamp),trace:i.trace.getTraceMessage()},socket_ref:i.children.sockets.map(e=>d(e))}})}function V(e){var t;return(0,a.isTcpSubchannelAddress)(e)?{address:"tcpip_address",tcpip_address:{ip_address:null!==(t=A(e.host))&&void 0!==t?t:void 0,port:e.port}}:{address:"uds_address",uds_address:{filename:e.path}}}function j(e,t){var r,n,i,a,o;let l=Number.parseInt(e.request.socket_id),u=E[l];if(void 0===u){t({code:s.Status.NOT_FOUND,details:"No socket data found for id "+l});return}let c=u.getInfo(),h=c.security?{model:"tls",tls:{cipher_suite:c.security.cipherSuiteStandardName?"standard_name":"other_name",standard_name:null!==(r=c.security.cipherSuiteStandardName)&&void 0!==r?r:void 0,other_name:null!==(n=c.security.cipherSuiteOtherName)&&void 0!==n?n:void 0,local_certificate:null!==(i=c.security.localCertificate)&&void 0!==i?i:void 0,remote_certificate:null!==(a=c.security.remoteCertificate)&&void 0!==a?a:void 0}}:null;t(null,{socket:{ref:d(u.ref),local:c.localAddress?V(c.localAddress):null,remote:c.remoteAddress?V(c.remoteAddress):null,remote_name:null!==(o=c.remoteName)&&void 0!==o?o:void 0,security:h,data:{keep_alives_sent:c.keepAlivesSent,streams_started:c.streamsStarted,streams_succeeded:c.streamsSucceeded,streams_failed:c.streamsFailed,last_local_stream_created_timestamp:O(c.lastLocalStreamCreatedTimestamp),last_remote_stream_created_timestamp:O(c.lastRemoteStreamCreatedTimestamp),messages_received:c.messagesReceived,messages_sent:c.messagesSent,last_message_received_timestamp:O(c.lastMessageReceivedTimestamp),last_message_sent_timestamp:O(c.lastMessageSentTimestamp),local_flow_control_window:c.localFlowControlWindow?{value:c.localFlowControlWindow}:null,remote_flow_control_window:c.remoteFlowControlWindow?{value:c.remoteFlowControlWindow}:null}}})}function z(e,t){let r=Number.parseInt(e.request.server_id),n=S[r];if(void 0===n){t({code:s.Status.NOT_FOUND,details:"No server data found for id "+r});return}let i=Number.parseInt(e.request.start_socket_id),a=Number.parseInt(e.request.max_results),o=n.getInfo().sessionChildren.sockets.sort((e,t)=>e.id-t.id),l=[],u=0;for(;u<o.length&&(!(o[u].id>=i)||(l.push(d(o[u])),!(l.length>=a)));u++);t(null,{socket_ref:l,end:u>=o.length})}function q(){return{GetChannel:P,GetTopChannels:M,GetServer:F,GetServers:B,GetSubchannel:U,GetSocket:j,GetServerSockets:z}}t.registerChannelzChannel=w,t.registerChannelzSubchannel=C,t.registerChannelzServer=_,t.registerChannelzSocket=I,t.unregisterChannelzRef=R,t.getChannelzHandlers=q;let G=null;function $(){if(G)return G;let e=(0,r(3716).J_)("channelz.proto",{keepCase:!0,longs:String,enums:String,defaults:!0,oneofs:!0,includeDirs:[`${__dirname}/../../proto`]});return G=(0,l.loadPackageDefinition)(e).grpc.channelz.v1.Channelz.service}function K(){(0,o.registerAdminService)($,q)}t.getChannelzServiceDefinition=$,t.setup=K},1809:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getInterceptingCall=t.InterceptingCall=t.RequesterBuilder=t.ListenerBuilder=t.InterceptorConfigurationError=void 0;let n=r(6281),i=r(1218),s=r(9572),a=r(6027);class o extends Error{constructor(e){super(e),this.name="InterceptorConfigurationError",Error.captureStackTrace(this,o)}}t.InterceptorConfigurationError=o;class l{constructor(){this.metadata=void 0,this.message=void 0,this.status=void 0}withOnReceiveMetadata(e){return this.metadata=e,this}withOnReceiveMessage(e){return this.message=e,this}withOnReceiveStatus(e){return this.status=e,this}build(){return{onReceiveMetadata:this.metadata,onReceiveMessage:this.message,onReceiveStatus:this.status}}}t.ListenerBuilder=l;class u{constructor(){this.start=void 0,this.message=void 0,this.halfClose=void 0,this.cancel=void 0}withStart(e){return this.start=e,this}withSendMessage(e){return this.message=e,this}withHalfClose(e){return this.halfClose=e,this}withCancel(e){return this.cancel=e,this}build(){return{start:this.start,sendMessage:this.message,halfClose:this.halfClose,cancel:this.cancel}}}t.RequesterBuilder=u;let c={onReceiveMetadata:(e,t)=>{t(e)},onReceiveMessage:(e,t)=>{t(e)},onReceiveStatus:(e,t)=>{t(e)}},h={start:(e,t,r)=>{r(e,t)},sendMessage:(e,t)=>{t(e)},halfClose:e=>{e()},cancel:e=>{e()}};class d{constructor(e,t){var r,n,i,s;this.nextCall=e,this.processingMetadata=!1,this.pendingMessageContext=null,this.processingMessage=!1,this.pendingHalfClose=!1,t?this.requester={start:null!==(r=t.start)&&void 0!==r?r:h.start,sendMessage:null!==(n=t.sendMessage)&&void 0!==n?n:h.sendMessage,halfClose:null!==(i=t.halfClose)&&void 0!==i?i:h.halfClose,cancel:null!==(s=t.cancel)&&void 0!==s?s:h.cancel}:this.requester=h}cancelWithStatus(e,t){this.requester.cancel(()=>{this.nextCall.cancelWithStatus(e,t)})}getPeer(){return this.nextCall.getPeer()}processPendingMessage(){this.pendingMessageContext&&(this.nextCall.sendMessageWithContext(this.pendingMessageContext,this.pendingMessage),this.pendingMessageContext=null,this.pendingMessage=null)}processPendingHalfClose(){this.pendingHalfClose&&this.nextCall.halfClose()}start(e,t){var r,n,s,a,o,l;let u={onReceiveMetadata:null!==(n=null===(r=null==t?void 0:t.onReceiveMetadata)||void 0===r?void 0:r.bind(t))&&void 0!==n?n:e=>{},onReceiveMessage:null!==(a=null===(s=null==t?void 0:t.onReceiveMessage)||void 0===s?void 0:s.bind(t))&&void 0!==a?a:e=>{},onReceiveStatus:null!==(l=null===(o=null==t?void 0:t.onReceiveStatus)||void 0===o?void 0:o.bind(t))&&void 0!==l?l:e=>{}};this.processingMetadata=!0,this.requester.start(e,u,(e,t)=>{var r,n,s;let a;if(this.processingMetadata=!1,(0,i.isInterceptingListener)(t))a=t;else{let e={onReceiveMetadata:null!==(r=t.onReceiveMetadata)&&void 0!==r?r:c.onReceiveMetadata,onReceiveMessage:null!==(n=t.onReceiveMessage)&&void 0!==n?n:c.onReceiveMessage,onReceiveStatus:null!==(s=t.onReceiveStatus)&&void 0!==s?s:c.onReceiveStatus};a=new i.InterceptingListenerImpl(e,u)}this.nextCall.start(e,a),this.processPendingMessage(),this.processPendingHalfClose()})}sendMessageWithContext(e,t){this.processingMessage=!0,this.requester.sendMessage(t,r=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessageContext=e,this.pendingMessage=t):(this.nextCall.sendMessageWithContext(e,r),this.processPendingHalfClose())})}sendMessage(e){this.sendMessageWithContext({},e)}startRead(){this.nextCall.startRead()}halfClose(){this.requester.halfClose(()=>{this.processingMetadata||this.processingMessage?this.pendingHalfClose=!0:this.nextCall.halfClose()})}}function p(e,t,r){var n,i;let s=null!==(n=r.deadline)&&void 0!==n?n:1/0,a=r.host,o=null!==(i=r.parent)&&void 0!==i?i:null,l=r.propagate_flags,u=r.credentials,c=e.createCall(t,s,a,o,l);return u&&c.setCredentials(u),c}t.InterceptingCall=d;class f{constructor(e,t){this.call=e,this.methodDefinition=t}cancelWithStatus(e,t){this.call.cancelWithStatus(e,t)}getPeer(){return this.call.getPeer()}sendMessageWithContext(e,t){let r;try{r=this.methodDefinition.requestSerialize(t)}catch(e){this.call.cancelWithStatus(s.Status.INTERNAL,`Request message serialization failure: ${(0,a.getErrorMessage)(e)}`);return}this.call.sendMessageWithContext(e,r)}sendMessage(e){this.sendMessageWithContext({},e)}start(e,t){let r=null;this.call.start(e,{onReceiveMetadata:e=>{var r;null===(r=null==t?void 0:t.onReceiveMetadata)||void 0===r||r.call(t,e)},onReceiveMessage:e=>{var i;let o;try{o=this.methodDefinition.responseDeserialize(e)}catch(e){r={code:s.Status.INTERNAL,details:`Response message parsing error: ${(0,a.getErrorMessage)(e)}`,metadata:new n.Metadata},this.call.cancelWithStatus(r.code,r.details);return}null===(i=null==t?void 0:t.onReceiveMessage)||void 0===i||i.call(t,o)},onReceiveStatus:e=>{var n,i;r?null===(n=null==t?void 0:t.onReceiveStatus)||void 0===n||n.call(t,r):null===(i=null==t?void 0:t.onReceiveStatus)||void 0===i||i.call(t,e)}})}startRead(){this.call.startRead()}halfClose(){this.call.halfClose()}}class m extends f{constructor(e,t){super(e,t)}start(e,t){var r,n;let i=!1,s={onReceiveMetadata:null!==(n=null===(r=null==t?void 0:t.onReceiveMetadata)||void 0===r?void 0:r.bind(t))&&void 0!==n?n:e=>{},onReceiveMessage:e=>{var r;i=!0,null===(r=null==t?void 0:t.onReceiveMessage)||void 0===r||r.call(t,e)},onReceiveStatus:e=>{var r,n;i||null===(r=null==t?void 0:t.onReceiveMessage)||void 0===r||r.call(t,null),null===(n=null==t?void 0:t.onReceiveStatus)||void 0===n||n.call(t,e)}};super.start(e,s),this.call.startRead()}}class g extends f{}function y(e,t,r){let n=p(e,r.path,t);return r.responseStream?new g(n,r):new m(n,r)}function v(e,t,r,n){if(e.clientInterceptors.length>0&&e.clientInterceptorProviders.length>0)throw new o("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(e.callInterceptors.length>0&&e.callInterceptorProviders.length>0)throw new o("Both interceptors and interceptor_providers were passed as call options. Only one of these is allowed.");let i=[];i=e.callInterceptors.length>0||e.callInterceptorProviders.length>0?[].concat(e.callInterceptors,e.callInterceptorProviders.map(e=>e(t))).filter(e=>e):[].concat(e.clientInterceptors,e.clientInterceptorProviders.map(e=>e(t))).filter(e=>e);let s=Object.assign({},r,{method_definition:t});return i.reduceRight((e,t)=>r=>t(r,e),e=>y(n,e,t))(s)}t.getInterceptingCall=v},1865:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Client=void 0;let n=r(7639),i=r(9452),s=r(2409),a=r(9572),o=r(6281),l=r(1809),u=Symbol(),c=Symbol(),h=Symbol(),d=Symbol();function p(e){return"function"==typeof e}function f(e){return e.stack.split("\n").slice(1).join("\n")}class m{constructor(e,t,r={}){var n,s;if(r=Object.assign({},r),this[c]=null!==(n=r.interceptors)&&void 0!==n?n:[],delete r.interceptors,this[h]=null!==(s=r.interceptor_providers)&&void 0!==s?s:[],delete r.interceptor_providers,this[c].length>0&&this[h].length>0)throw Error("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(this[d]=r.callInvocationTransformer,delete r.callInvocationTransformer,r.channelOverride)this[u]=r.channelOverride;else if(r.channelFactoryOverride){let n=r.channelFactoryOverride;delete r.channelFactoryOverride,this[u]=n(e,t,r)}else this[u]=new i.ChannelImplementation(e,t,r)}close(){this[u].close()}getChannel(){return this[u]}waitForReady(e,t){let r=n=>{let i;if(n){t(Error("Failed to connect before the deadline"));return}try{i=this[u].getConnectivityState(!0)}catch(e){t(Error("The channel has been closed"));return}if(i===s.ConnectivityState.READY)t();else try{this[u].watchConnectivityState(i,e,r)}catch(e){t(Error("The channel has been closed"))}};setImmediate(r)}checkOptionalUnaryResponseArguments(e,t,r){if(p(e))return{metadata:new o.Metadata,options:{},callback:e};if(p(t))return e instanceof o.Metadata?{metadata:e,options:{},callback:t}:{metadata:new o.Metadata,options:e,callback:t};if(!(e instanceof o.Metadata&&t instanceof Object&&p(r)))throw Error("Incorrect arguments passed");return{metadata:e,options:t,callback:r}}makeUnaryRequest(e,t,r,i,s,o,p){var m,g;let y=this.checkOptionalUnaryResponseArguments(s,o,p),v={path:e,requestStream:!1,responseStream:!1,requestSerialize:t,responseDeserialize:r},b={argument:i,metadata:y.metadata,call:new n.ClientUnaryCallImpl,channel:this[u],methodDefinition:v,callOptions:y.options,callback:y.callback};this[d]&&(b=this[d](b));let T=b.call,S={clientInterceptors:this[c],clientInterceptorProviders:this[h],callInterceptors:null!==(m=b.callOptions.interceptors)&&void 0!==m?m:[],callInterceptorProviders:null!==(g=b.callOptions.interceptor_providers)&&void 0!==g?g:[]},E=(0,l.getInterceptingCall)(S,b.methodDefinition,b.callOptions,b.channel);T.call=E;let w=null,C=!1,_=Error();return E.start(b.metadata,{onReceiveMetadata:e=>{T.emit("metadata",e)},onReceiveMessage(e){null!==w&&E.cancelWithStatus(a.Status.INTERNAL,"Too many responses received"),w=e},onReceiveStatus(e){if(!C){if(C=!0,e.code===a.Status.OK){if(null===w){let t=f(_);b.callback((0,n.callErrorFromStatus)({code:a.Status.INTERNAL,details:"No message received",metadata:e.metadata},t))}else b.callback(null,w)}else{let t=f(_);b.callback((0,n.callErrorFromStatus)(e,t))}_=null,T.emit("status",e)}}}),E.sendMessage(i),E.halfClose(),T}makeClientStreamRequest(e,t,r,i,s,o){var p,m;let g=this.checkOptionalUnaryResponseArguments(i,s,o),y={path:e,requestStream:!0,responseStream:!1,requestSerialize:t,responseDeserialize:r},v={metadata:g.metadata,call:new n.ClientWritableStreamImpl(t),channel:this[u],methodDefinition:y,callOptions:g.options,callback:g.callback};this[d]&&(v=this[d](v));let b=v.call,T={clientInterceptors:this[c],clientInterceptorProviders:this[h],callInterceptors:null!==(p=v.callOptions.interceptors)&&void 0!==p?p:[],callInterceptorProviders:null!==(m=v.callOptions.interceptor_providers)&&void 0!==m?m:[]},S=(0,l.getInterceptingCall)(T,v.methodDefinition,v.callOptions,v.channel);b.call=S;let E=null,w=!1,C=Error();return S.start(v.metadata,{onReceiveMetadata:e=>{b.emit("metadata",e)},onReceiveMessage(e){null!==E&&S.cancelWithStatus(a.Status.INTERNAL,"Too many responses received"),E=e},onReceiveStatus(e){if(!w){if(w=!0,e.code===a.Status.OK){if(null===E){let t=f(C);v.callback((0,n.callErrorFromStatus)({code:a.Status.INTERNAL,details:"No message received",metadata:e.metadata},t))}else v.callback(null,E)}else{let t=f(C);v.callback((0,n.callErrorFromStatus)(e,t))}C=null,b.emit("status",e)}}}),b}checkMetadataAndOptions(e,t){let r,n;return e instanceof o.Metadata?(r=e,n=t||{}):(n=e||{},r=new o.Metadata),{metadata:r,options:n}}makeServerStreamRequest(e,t,r,i,s,o){var p,m;let g=this.checkMetadataAndOptions(s,o),y={path:e,requestStream:!1,responseStream:!0,requestSerialize:t,responseDeserialize:r},v={argument:i,metadata:g.metadata,call:new n.ClientReadableStreamImpl(r),channel:this[u],methodDefinition:y,callOptions:g.options};this[d]&&(v=this[d](v));let b=v.call,T={clientInterceptors:this[c],clientInterceptorProviders:this[h],callInterceptors:null!==(p=v.callOptions.interceptors)&&void 0!==p?p:[],callInterceptorProviders:null!==(m=v.callOptions.interceptor_providers)&&void 0!==m?m:[]},S=(0,l.getInterceptingCall)(T,v.methodDefinition,v.callOptions,v.channel);b.call=S;let E=!1,w=Error();return S.start(v.metadata,{onReceiveMetadata(e){b.emit("metadata",e)},onReceiveMessage(e){b.push(e)},onReceiveStatus(e){if(!E){if(E=!0,b.push(null),e.code!==a.Status.OK){let t=f(w);b.emit("error",(0,n.callErrorFromStatus)(e,t))}w=null,b.emit("status",e)}}}),S.sendMessage(i),S.halfClose(),b}makeBidiStreamRequest(e,t,r,i,s){var o,p;let m=this.checkMetadataAndOptions(i,s),g={path:e,requestStream:!0,responseStream:!0,requestSerialize:t,responseDeserialize:r},y={metadata:m.metadata,call:new n.ClientDuplexStreamImpl(t,r),channel:this[u],methodDefinition:g,callOptions:m.options};this[d]&&(y=this[d](y));let v=y.call,b={clientInterceptors:this[c],clientInterceptorProviders:this[h],callInterceptors:null!==(o=y.callOptions.interceptors)&&void 0!==o?o:[],callInterceptorProviders:null!==(p=y.callOptions.interceptor_providers)&&void 0!==p?p:[]},T=(0,l.getInterceptingCall)(b,y.methodDefinition,y.callOptions,y.channel);v.call=T;let S=!1,E=Error();return T.start(y.metadata,{onReceiveMetadata(e){v.emit("metadata",e)},onReceiveMessage(e){v.push(e)},onReceiveStatus(e){if(!S){if(S=!0,v.push(null),e.code!==a.Status.OK){let t=f(E);v.emit("error",(0,n.callErrorFromStatus)(e,t))}E=null,v.emit("status",e)}}}),v}}t.Client=m},4334:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.CompressionAlgorithms=void 0,function(e){e[e.identity=0]="identity",e[e.deflate=1]="deflate",e[e.gzip=2]="gzip"}(r||(t.CompressionAlgorithms=r={}))},6289:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CompressionFilterFactory=t.CompressionFilter=void 0;let n=r(1568),i=r(4334),s=r(9572),a=r(3223),o=r(5792),l=e=>"number"==typeof e&&"string"==typeof i.CompressionAlgorithms[e];class u{async writeMessage(e,t){let r=e;t&&(r=await this.compressMessage(r));let n=Buffer.allocUnsafe(r.length+5);return n.writeUInt8(t?1:0,0),n.writeUInt32BE(r.length,1),r.copy(n,5),n}async readMessage(e){let t=1===e.readUInt8(0),r=e.slice(5);return t&&(r=await this.decompressMessage(r)),r}}class c extends u{async compressMessage(e){return e}async writeMessage(e,t){let r=Buffer.allocUnsafe(e.length+5);return r.writeUInt8(0,0),r.writeUInt32BE(e.length,1),e.copy(r,5),r}decompressMessage(e){return Promise.reject(Error('Received compressed message but "grpc-encoding" header was identity'))}}class h extends u{constructor(e){super(),this.maxRecvMessageLength=e}compressMessage(e){return new Promise((t,r)=>{n.deflate(e,(e,n)=>{e?r(e):t(n)})})}decompressMessage(e){return new Promise((t,r)=>{let i=0,a=[],o=n.createInflate();o.on("data",e=>{a.push(e),i+=e.byteLength,-1!==this.maxRecvMessageLength&&i>this.maxRecvMessageLength&&(o.destroy(),r({code:s.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxRecvMessageLength}`}))}),o.on("end",()=>{t(Buffer.concat(a))}),o.write(e),o.end()})}}class d extends u{constructor(e){super(),this.maxRecvMessageLength=e}compressMessage(e){return new Promise((t,r)=>{n.gzip(e,(e,n)=>{e?r(e):t(n)})})}decompressMessage(e){return new Promise((t,r)=>{let i=0,a=[],o=n.createGunzip();o.on("data",e=>{a.push(e),i+=e.byteLength,-1!==this.maxRecvMessageLength&&i>this.maxRecvMessageLength&&(o.destroy(),r({code:s.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxRecvMessageLength}`}))}),o.on("end",()=>{t(Buffer.concat(a))}),o.write(e),o.end()})}}class p extends u{constructor(e){super(),this.compressionName=e}compressMessage(e){return Promise.reject(Error(`Received message compressed with unsupported compression method ${this.compressionName}`))}decompressMessage(e){return Promise.reject(Error(`Compression method not supported: ${this.compressionName}`))}}function f(e,t){switch(e){case"identity":return new c;case"deflate":return new h(t);case"gzip":return new d(t);default:return new p(e)}}class m extends a.BaseFilter{constructor(e,t){var r,n;super(),this.sharedFilterConfig=t,this.sendCompression=new c,this.receiveCompression=new c,this.currentCompressionAlgorithm="identity";let a=e["grpc.default_compression_algorithm"];if(this.maxReceiveMessageLength=null!==(r=e["grpc.max_receive_message_length"])&&void 0!==r?r:s.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,void 0!==a){if(l(a)){let e=i.CompressionAlgorithms[a],r=null===(n=t.serverSupportedEncodingHeader)||void 0===n?void 0:n.split(",");(!r||r.includes(e))&&(this.currentCompressionAlgorithm=e,this.sendCompression=f(this.currentCompressionAlgorithm,-1))}else o.log(s.LogVerbosity.ERROR,`Invalid value provided for grpc.default_compression_algorithm option: ${a}`)}}async sendMetadata(e){let t=await e;return t.set("grpc-accept-encoding","identity,deflate,gzip"),t.set("accept-encoding","identity"),"identity"===this.currentCompressionAlgorithm?t.remove("grpc-encoding"):t.set("grpc-encoding",this.currentCompressionAlgorithm),t}receiveMetadata(e){let t=e.get("grpc-encoding");if(t.length>0){let e=t[0];"string"==typeof e&&(this.receiveCompression=f(e,this.maxReceiveMessageLength))}e.remove("grpc-encoding");let r=e.get("grpc-accept-encoding")[0];return r&&(this.sharedFilterConfig.serverSupportedEncodingHeader=r,r.split(",").includes(this.currentCompressionAlgorithm)||(this.sendCompression=new c,this.currentCompressionAlgorithm="identity")),e.remove("grpc-accept-encoding"),e}async sendMessage(e){var t;let r;let n=await e;return r=!(this.sendCompression instanceof c)&&((null!==(t=n.flags)&&void 0!==t?t:0)&2)==0,{message:await this.sendCompression.writeMessage(n.message,r),flags:n.flags}}async receiveMessage(e){return this.receiveCompression.readMessage(await e)}}t.CompressionFilter=m;class g{constructor(e,t){this.options=t,this.sharedFilterConfig={}}createFilter(){return new m(this.options,this.sharedFilterConfig)}}t.CompressionFilterFactory=g},2409:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.ConnectivityState=void 0,function(e){e[e.IDLE=0]="IDLE",e[e.CONNECTING=1]="CONNECTING",e[e.READY=2]="READY",e[e.TRANSIENT_FAILURE=3]="TRANSIENT_FAILURE",e[e.SHUTDOWN=4]="SHUTDOWN"}(r||(t.ConnectivityState=r={}))},9572:(e,t)=>{"use strict";var r,n,i;Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=t.DEFAULT_MAX_SEND_MESSAGE_LENGTH=t.Propagate=t.LogVerbosity=t.Status=void 0,function(e){e[e.OK=0]="OK",e[e.CANCELLED=1]="CANCELLED",e[e.UNKNOWN=2]="UNKNOWN",e[e.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",e[e.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",e[e.NOT_FOUND=5]="NOT_FOUND",e[e.ALREADY_EXISTS=6]="ALREADY_EXISTS",e[e.PERMISSION_DENIED=7]="PERMISSION_DENIED",e[e.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",e[e.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",e[e.ABORTED=10]="ABORTED",e[e.OUT_OF_RANGE=11]="OUT_OF_RANGE",e[e.UNIMPLEMENTED=12]="UNIMPLEMENTED",e[e.INTERNAL=13]="INTERNAL",e[e.UNAVAILABLE=14]="UNAVAILABLE",e[e.DATA_LOSS=15]="DATA_LOSS",e[e.UNAUTHENTICATED=16]="UNAUTHENTICATED"}(r||(t.Status=r={})),function(e){e[e.DEBUG=0]="DEBUG",e[e.INFO=1]="INFO",e[e.ERROR=2]="ERROR",e[e.NONE=3]="NONE"}(n||(t.LogVerbosity=n={})),function(e){e[e.DEADLINE=1]="DEADLINE",e[e.CENSUS_STATS_CONTEXT=2]="CENSUS_STATS_CONTEXT",e[e.CENSUS_TRACING_CONTEXT=4]="CENSUS_TRACING_CONTEXT",e[e.CANCELLATION=8]="CANCELLATION",e[e.DEFAULTS=65535]="DEFAULTS"}(i||(t.Propagate=i={})),t.DEFAULT_MAX_SEND_MESSAGE_LENGTH=-1,t.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=4194304},5607:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.restrictControlPlaneStatusCode=void 0;let n=r(9572),i=[n.Status.OK,n.Status.INVALID_ARGUMENT,n.Status.NOT_FOUND,n.Status.ALREADY_EXISTS,n.Status.FAILED_PRECONDITION,n.Status.ABORTED,n.Status.OUT_OF_RANGE,n.Status.DATA_LOSS];function s(e,t){return i.includes(e)?{code:n.Status.INTERNAL,details:`Invalid status from control plane: ${e} ${n.Status[e]} ${t}`}:{code:e,details:t}}t.restrictControlPlaneStatusCode=s},4771:(e,t)=>{"use strict";function r(...e){let t=1/0;for(let r of e){let e=r instanceof Date?r.getTime():r;e<t&&(t=e)}return t}Object.defineProperty(t,"__esModule",{value:!0}),t.deadlineToString=t.getRelativeTimeout=t.getDeadlineTimeoutString=t.minDeadline=void 0,t.minDeadline=r;let n=[["m",1],["S",1e3],["M",6e4],["H",36e5]];function i(e){let t=new Date().getTime();e instanceof Date&&(e=e.getTime());let r=Math.max(e-t,0);for(let[e,t]of n){let n=r/t;if(n<1e8)return String(Math.ceil(n))+e}throw Error("Deadline is too far in the future")}t.getDeadlineTimeoutString=i;let s=2147483647;function a(e){let t=(e instanceof Date?e.getTime():e)-new Date().getTime();return t<0?0:t>s?1/0:t}function o(e){if(e instanceof Date)return e.toISOString();{let t=new Date(e);return Number.isNaN(t.getTime())?""+e:t.toISOString()}}t.getRelativeTimeout=a,t.deadlineToString=o},7974:(e,t)=>{"use strict";function r(e){return{seconds:e/1e3|0,nanos:e%1e3*1e6|0}}function n(e){return 1e3*e.seconds+e.nanos/1e6|0}function i(e){return"number"==typeof e.seconds&&"number"==typeof e.nanos}Object.defineProperty(t,"__esModule",{value:!0}),t.isDuration=t.durationToMs=t.msToDuration=void 0,t.msToDuration=r,t.durationToMs=n,t.isDuration=i},6027:(e,t)=>{"use strict";function r(e){return e instanceof Error?e.message:String(e)}function n(e){return"object"==typeof e&&null!==e&&"code"in e&&"number"==typeof e.code?e.code:null}Object.defineProperty(t,"__esModule",{value:!0}),t.getErrorCode=t.getErrorMessage=void 0,t.getErrorMessage=r,t.getErrorCode=n},8779:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OutlierDetectionLoadBalancingConfig=t.BaseSubchannelWrapper=t.registerAdminService=t.FilterStackFactory=t.BaseFilter=t.PickResultType=t.QueuePicker=t.UnavailablePicker=t.ChildLoadBalancerHandler=t.subchannelAddressToString=t.validateLoadBalancingConfig=t.getFirstUsableConfig=t.registerLoadBalancerType=t.createChildChannelControlHelper=t.BackoffTimeout=t.durationToMs=t.uriToString=t.createResolver=t.registerResolver=t.log=t.trace=void 0;var n=r(5792);Object.defineProperty(t,"trace",{enumerable:!0,get:function(){return n.trace}}),Object.defineProperty(t,"log",{enumerable:!0,get:function(){return n.log}});var i=r(4063);Object.defineProperty(t,"registerResolver",{enumerable:!0,get:function(){return i.registerResolver}}),Object.defineProperty(t,"createResolver",{enumerable:!0,get:function(){return i.createResolver}});var s=r(5773);Object.defineProperty(t,"uriToString",{enumerable:!0,get:function(){return s.uriToString}});var a=r(7974);Object.defineProperty(t,"durationToMs",{enumerable:!0,get:function(){return a.durationToMs}});var o=r(1742);Object.defineProperty(t,"BackoffTimeout",{enumerable:!0,get:function(){return o.BackoffTimeout}});var l=r(9884);Object.defineProperty(t,"createChildChannelControlHelper",{enumerable:!0,get:function(){return l.createChildChannelControlHelper}}),Object.defineProperty(t,"registerLoadBalancerType",{enumerable:!0,get:function(){return l.registerLoadBalancerType}}),Object.defineProperty(t,"getFirstUsableConfig",{enumerable:!0,get:function(){return l.getFirstUsableConfig}}),Object.defineProperty(t,"validateLoadBalancingConfig",{enumerable:!0,get:function(){return l.validateLoadBalancingConfig}});var u=r(4955);Object.defineProperty(t,"subchannelAddressToString",{enumerable:!0,get:function(){return u.subchannelAddressToString}});var c=r(6372);Object.defineProperty(t,"ChildLoadBalancerHandler",{enumerable:!0,get:function(){return c.ChildLoadBalancerHandler}});var h=r(2352);Object.defineProperty(t,"UnavailablePicker",{enumerable:!0,get:function(){return h.UnavailablePicker}}),Object.defineProperty(t,"QueuePicker",{enumerable:!0,get:function(){return h.QueuePicker}}),Object.defineProperty(t,"PickResultType",{enumerable:!0,get:function(){return h.PickResultType}});var d=r(3223);Object.defineProperty(t,"BaseFilter",{enumerable:!0,get:function(){return d.BaseFilter}});var p=r(9386);Object.defineProperty(t,"FilterStackFactory",{enumerable:!0,get:function(){return p.FilterStackFactory}});var f=r(7749);Object.defineProperty(t,"registerAdminService",{enumerable:!0,get:function(){return f.registerAdminService}});var m=r(487);Object.defineProperty(t,"BaseSubchannelWrapper",{enumerable:!0,get:function(){return m.BaseSubchannelWrapper}});var g=r(5638);Object.defineProperty(t,"OutlierDetectionLoadBalancingConfig",{enumerable:!0,get:function(){return g.OutlierDetectionLoadBalancingConfig}})},9386:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FilterStackFactory=t.FilterStack=void 0;class r{constructor(e){this.filters=e}sendMetadata(e){let t=e;for(let e=0;e<this.filters.length;e++)t=this.filters[e].sendMetadata(t);return t}receiveMetadata(e){let t=e;for(let e=this.filters.length-1;e>=0;e--)t=this.filters[e].receiveMetadata(t);return t}sendMessage(e){let t=e;for(let e=0;e<this.filters.length;e++)t=this.filters[e].sendMessage(t);return t}receiveMessage(e){let t=e;for(let e=this.filters.length-1;e>=0;e--)t=this.filters[e].receiveMessage(t);return t}receiveTrailers(e){let t=e;for(let e=this.filters.length-1;e>=0;e--)t=this.filters[e].receiveTrailers(t);return t}push(e){this.filters.unshift(...e)}getFilters(){return this.filters}}t.FilterStack=r;class n{constructor(e){this.factories=e}push(e){this.factories.unshift(...e)}clone(){return new n([...this.factories])}createFilter(){return new r(this.factories.map(e=>e.createFilter()))}}t.FilterStackFactory=n},3223:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseFilter=void 0;class r{async sendMetadata(e){return e}receiveMetadata(e){return e}async sendMessage(e){return e}async receiveMessage(e){return e}receiveTrailers(e){return e}}t.BaseFilter=r},5242:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getProxiedConnection=t.mapProxyName=void 0;let n=r(5792),i=r(9572),s=r(4063),a=r(2615),o=r(2452),l=r(5792),u=r(4955),c=r(5773),h=r(7360),d=r(8501),p="proxy";function f(e){l.trace(i.LogVerbosity.DEBUG,p,e)}function m(){let e,t="",r="";if(process.env.grpc_proxy)r="grpc_proxy",t=process.env.grpc_proxy;else if(process.env.https_proxy)r="https_proxy",t=process.env.https_proxy;else{if(!process.env.http_proxy)return{};r="http_proxy",t=process.env.http_proxy}try{e=new h.URL(t)}catch(e){return(0,n.log)(i.LogVerbosity.ERROR,`cannot parse value of "${r}" env var`),{}}if("http:"!==e.protocol)return(0,n.log)(i.LogVerbosity.ERROR,`"${e.protocol}" scheme not supported in proxy URI`),{};let s=null;e.username&&(e.password?((0,n.log)(i.LogVerbosity.INFO,"userinfo found in proxy URI"),s=`${e.username}:${e.password}`):s=e.username);let a=e.hostname,o=e.port;""===o&&(o="80");let l={address:`${a}:${o}`};return s&&(l.creds=s),f("Proxy server "+l.address+" set by environment variable "+r),l}function g(){let e=process.env.no_grpc_proxy,t="no_grpc_proxy";return(e||(e=process.env.no_proxy,t="no_proxy"),e)?(f("No proxy server list set by environment variable "+t),e.split(",")):[]}function y(e,t){var r;let n={target:e,extraOptions:{}};if((null!==(r=t["grpc.enable_http_proxy"])&&void 0!==r?r:1)===0||"unix"===e.scheme)return n;let i=m();if(!i.address)return n;let s=(0,c.splitHostPort)(e.path);if(!s)return n;let a=s.host;for(let t of g())if(t===a)return f("Not using proxy for target in no_proxy list: "+(0,c.uriToString)(e)),n;let o={"grpc.http_connect_target":(0,c.uriToString)(e)};return i.creds&&(o["grpc.http_connect_creds"]=i.creds),{target:{scheme:"dns",path:i.address},extraOptions:o}}function v(e,t,r){var l;if(!("grpc.http_connect_target"in t))return Promise.resolve({});let h=t["grpc.http_connect_target"],p=(0,c.parseUri)(h);if(null===p)return Promise.resolve({});let m=(0,c.splitHostPort)(p.path);if(null===m)return Promise.resolve({});let g=`${m.host}:${null!==(l=m.port)&&void 0!==l?l:d.DEFAULT_PORT}`,y={method:"CONNECT",path:g},v={Host:g};(0,u.isTcpSubchannelAddress)(e)?(y.host=e.host,y.port=e.port):y.socketPath=e.path,"grpc.http_connect_creds"in t&&(v["Proxy-Authorization"]="Basic "+Buffer.from(t["grpc.http_connect_creds"]).toString("base64")),y.headers=v;let b=(0,u.subchannelAddressToString)(e);return f("Using proxy "+b+" to connect to "+y.path),new Promise((e,t)=>{let l=a.request(y);l.once("connect",(a,u,h)=>{var d;if(l.removeAllListeners(),u.removeAllListeners(),200===a.statusCode){if(f("Successfully connected to "+y.path+" through proxy "+b),"secureContext"in r){let n=(0,s.getDefaultAuthority)(p),i=(0,c.splitHostPort)(n),a=null!==(d=null==i?void 0:i.host)&&void 0!==d?d:n,l=o.connect(Object.assign({host:a,servername:a,socket:u},r),()=>{f("Successfully established a TLS connection to "+y.path+" through proxy "+b),e({socket:l,realTarget:p})});l.on("error",e=>{f("Failed to establish a TLS connection to "+y.path+" through proxy "+b+" with error "+e.message),t()})}else f("Successfully established a plaintext connection to "+y.path+" through proxy "+b),e({socket:u,realTarget:p})}else(0,n.log)(i.LogVerbosity.ERROR,"Failed to connect to "+y.path+" through proxy "+b+" with status "+a.statusCode),t()}),l.once("error",e=>{l.removeAllListeners(),(0,n.log)(i.LogVerbosity.ERROR,"Failed to connect to proxy "+b+" with error "+e.message),t()}),l.end()})}t.mapProxyName=y,t.getProxiedConnection=v},1968:(e,t,r)=>{"use strict";g={value:!0},g=g=g=g=g=g=g=g=g=g=g=g=g=g=g=g=g=g=g=g=g=g=g=t.Rz=g=g=g=g=g=g=t.SF=t.K9=void 0;let n=r(5402);g={enumerable:!0,get:function(){return n.CallCredentials}};let i=r(9452);g={enumerable:!0,get:function(){return i.ChannelImplementation}};let s=r(4334);g={enumerable:!0,get:function(){return s.CompressionAlgorithms}};let a=r(2409);g={enumerable:!0,get:function(){return a.ConnectivityState}};let o=r(499);g={enumerable:!0,get:function(){return o.ChannelCredentials}};let l=r(1865);g={enumerable:!0,get:function(){return l.Client}};let u=r(9572);g={enumerable:!0,get:function(){return u.LogVerbosity}},g={enumerable:!0,get:function(){return u.Status}},g={enumerable:!0,get:function(){return u.Propagate}};let c=r(5792),h=r(4529);Object.defineProperty(t,"Rz",{enumerable:!0,get:function(){return h.loadPackageDefinition}}),g={enumerable:!0,get:function(){return h.makeClientConstructor}},g={enumerable:!0,get:function(){return h.makeClientConstructor}};let d=r(6281);Object.defineProperty(t,"SF",{enumerable:!0,get:function(){return d.Metadata}});let p=r(6418);g={enumerable:!0,get:function(){return p.Server}};let f=r(3783);g={enumerable:!0,get:function(){return f.ServerCredentials}};let m=r(4339);g={enumerable:!0,get:function(){return m.StatusBuilder}},t.K9={combineChannelCredentials:(e,...t)=>t.reduce((e,t)=>e.compose(t),e),combineCallCredentials:(e,...t)=>t.reduce((e,t)=>e.compose(t),e),createInsecure:o.ChannelCredentials.createInsecure,createSsl:o.ChannelCredentials.createSsl,createFromSecureContext:o.ChannelCredentials.createFromSecureContext,createFromMetadataGenerator:n.CallCredentials.createFromMetadataGenerator,createFromGoogleCredential:n.CallCredentials.createFromGoogleCredential,createEmpty:n.CallCredentials.createEmpty},g=e=>e.close(),g=(e,t,r)=>e.waitForReady(t,r),g=(e,t)=>{throw Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")},g=(e,t,r)=>{throw Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")},g=e=>{c.setLogger(e)},g=e=>{c.setLoggerVerbosity(e)},g=e=>l.Client.prototype.getChannel.call(e);var g,y=r(1809);g={enumerable:!0,get:function(){return y.ListenerBuilder}},g={enumerable:!0,get:function(){return y.RequesterBuilder}},g={enumerable:!0,get:function(){return y.InterceptingCall}},g={enumerable:!0,get:function(){return y.InterceptorConfigurationError}};var v=r(5962);g={enumerable:!0,get:function(){return v.getChannelzServiceDefinition}},g={enumerable:!0,get:function(){return v.getChannelzHandlers}};var b=r(7749);g={enumerable:!0,get:function(){return b.addAdminServicesToServer}},g=r(8779);let T=r(8501),S=r(7255),E=r(3988),w=r(5102),C=r(4556),_=r(5638),I=r(5962);(()=>{T.setup(),S.setup(),E.setup(),w.setup(),C.setup(),_.setup(),I.setup()})()},9359:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InternalChannel=void 0;let n=r(499),i=r(7661),s=r(7328),a=r(2352),o=r(9572),l=r(9386),u=r(6289),c=r(4063),h=r(5792),d=r(5242),p=r(5773),f=r(2409),m=r(5962),g=r(1690),y=r(4771),v=r(80),b=r(1801),T=r(5607),S=r(5627),E=r(487),w=2147483647,C=1e3,_=18e5,I=new Map,R=16777216,N=1048576;class k extends E.BaseSubchannelWrapper{constructor(e,t){super(e),this.channel=t,this.refCount=0,this.subchannelStateListener=(e,r,n,i)=>{t.throttleKeepalive(i)},e.addConnectivityStateListener(this.subchannelStateListener)}ref(){this.child.ref(),this.refCount+=1}unref(){this.child.unref(),this.refCount-=1,this.refCount<=0&&(this.child.removeConnectivityStateListener(this.subchannelStateListener),this.channel.removeWrappedSubchannel(this))}}class A{constructor(e,t,r){var g,y,v,b,E,A,D,O;if(this.credentials=t,this.options=r,this.connectivityState=f.ConnectivityState.IDLE,this.currentPicker=new a.UnavailablePicker,this.configSelectionQueue=[],this.pickQueue=[],this.connectivityStateWatchers=[],this.configSelector=null,this.currentResolutionError=null,this.wrappedSubchannels=new Set,this.callCount=0,this.idleTimer=null,this.channelzEnabled=!0,this.callTracker=new m.ChannelzCallTracker,this.childrenTracker=new m.ChannelzChildrenTracker,"string"!=typeof e)throw TypeError("Channel target must be a string");if(!(t instanceof n.ChannelCredentials))throw TypeError("Channel credentials must be a ChannelCredentials object");if(r&&"object"!=typeof r)throw TypeError("Channel options must be an object");this.originalTarget=e;let x=(0,p.parseUri)(e);if(null===x)throw Error(`Could not parse target name "${e}"`);let P=(0,c.mapUriDefaultScheme)(x);if(null===P)throw Error(`Could not find a default scheme for target name "${e}"`);this.callRefTimer=setInterval(()=>{},w),null===(y=(g=this.callRefTimer).unref)||void 0===y||y.call(g),0===this.options["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzTrace=new m.ChannelzTrace,this.channelzRef=(0,m.registerChannelzChannel)(e,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Channel created"),this.options["grpc.default_authority"]?this.defaultAuthority=this.options["grpc.default_authority"]:this.defaultAuthority=(0,c.getDefaultAuthority)(P);let M=(0,d.mapProxyName)(P,r);this.target=M.target,this.options=Object.assign({},this.options,M.extraOptions),this.subchannelPool=(0,s.getSubchannelPool)((null!==(v=r["grpc.use_local_subchannel_pool"])&&void 0!==v?v:0)===0),this.retryBufferTracker=new S.MessageBufferTracker(null!==(b=r["grpc.retry_buffer_size"])&&void 0!==b?b:R,null!==(E=r["grpc.per_rpc_retry_buffer_size"])&&void 0!==E?E:N),this.keepaliveTime=null!==(A=r["grpc.keepalive_time_ms"])&&void 0!==A?A:-1,this.idleTimeoutMs=Math.max(null!==(D=r["grpc.client_idle_timeout_ms"])&&void 0!==D?D:_,C);let L={createSubchannel:(e,t)=>{let r=this.subchannelPool.getOrCreateSubchannel(this.target,e,Object.assign({},this.options,t),this.credentials);r.throttleKeepalive(this.keepaliveTime),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Created subchannel or used existing subchannel",r.getChannelzRef());let n=new k(r,this);return this.wrappedSubchannels.add(n),n},updateState:(e,t)=>{this.currentPicker=t;let r=this.pickQueue.slice();for(let e of(this.pickQueue=[],r.length>0&&this.callRefTimerUnref(),r))e.doPick();this.updateState(e)},requestReresolution:()=>{throw Error("Resolving load balancer should never call requestReresolution")},addChannelzChild:e=>{this.channelzEnabled&&this.childrenTracker.refChild(e)},removeChannelzChild:e=>{this.channelzEnabled&&this.childrenTracker.unrefChild(e)}};this.resolvingLoadBalancer=new i.ResolvingLoadBalancer(this.target,L,r,(e,t)=>{e.retryThrottling?I.set(this.getTarget(),new S.RetryThrottler(e.retryThrottling.maxTokens,e.retryThrottling.tokenRatio,I.get(this.getTarget()))):I.delete(this.getTarget()),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Address resolution succeeded"),this.configSelector=t,this.currentResolutionError=null,process.nextTick(()=>{let e=this.configSelectionQueue;for(let t of(this.configSelectionQueue=[],e.length>0&&this.callRefTimerUnref(),e))t.getConfig()})},e=>{this.channelzEnabled&&this.channelzTrace.addTrace("CT_WARNING","Address resolution failed with code "+e.code+' and details "'+e.details+'"'),this.configSelectionQueue.length>0&&this.trace("Name resolution failed with calls queued for config selection"),null===this.configSelector&&(this.currentResolutionError=Object.assign(Object.assign({},(0,T.restrictControlPlaneStatusCode)(e.code,e.details)),{metadata:e.metadata}));let t=this.configSelectionQueue;for(let r of(this.configSelectionQueue=[],t.length>0&&this.callRefTimerUnref(),t))r.reportResolverError(e)}),this.filterStackFactory=new l.FilterStackFactory([new u.CompressionFilterFactory(this,this.options)]),this.trace("Channel constructed with options "+JSON.stringify(r,void 0,2));let F=Error();(0,h.trace)(o.LogVerbosity.DEBUG,"channel_stacktrace","("+this.channelzRef.id+") Channel constructed \n"+(null===(O=F.stack)||void 0===O?void 0:O.substring(F.stack.indexOf("\n")+1))),this.lastActivityTimestamp=new Date}getChannelzInfo(){return{target:this.originalTarget,state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists()}}trace(e,t){(0,h.trace)(null!=t?t:o.LogVerbosity.DEBUG,"channel","("+this.channelzRef.id+") "+(0,p.uriToString)(this.target)+" "+e)}callRefTimerRef(){var e,t,r,n;(null===(t=(e=this.callRefTimer).hasRef)||void 0===t?void 0:t.call(e))||(this.trace("callRefTimer.ref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),null===(n=(r=this.callRefTimer).ref)||void 0===n||n.call(r))}callRefTimerUnref(){var e,t;(!this.callRefTimer.hasRef||this.callRefTimer.hasRef())&&(this.trace("callRefTimer.unref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),null===(t=(e=this.callRefTimer).unref)||void 0===t||t.call(e))}removeConnectivityStateWatcher(e){let t=this.connectivityStateWatchers.findIndex(t=>t===e);t>=0&&this.connectivityStateWatchers.splice(t,1)}updateState(e){for(let t of((0,h.trace)(o.LogVerbosity.DEBUG,"connectivity_state","("+this.channelzRef.id+") "+(0,p.uriToString)(this.target)+" "+f.ConnectivityState[this.connectivityState]+" -> "+f.ConnectivityState[e]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+f.ConnectivityState[e]),this.connectivityState=e,this.connectivityStateWatchers.slice()))e!==t.currentState&&(t.timer&&clearTimeout(t.timer),this.removeConnectivityStateWatcher(t),t.callback());e!==f.ConnectivityState.TRANSIENT_FAILURE&&(this.currentResolutionError=null)}throttleKeepalive(e){if(e>this.keepaliveTime)for(let t of(this.keepaliveTime=e,this.wrappedSubchannels))t.throttleKeepalive(e)}removeWrappedSubchannel(e){this.wrappedSubchannels.delete(e)}doPick(e,t){return this.currentPicker.pick({metadata:e,extraPickInfo:t})}queueCallForPick(e){this.pickQueue.push(e),this.callRefTimerRef()}getConfig(e,t){return(this.resolvingLoadBalancer.exitIdle(),this.configSelector)?{type:"SUCCESS",config:this.configSelector(e,t)}:this.currentResolutionError?{type:"ERROR",error:this.currentResolutionError}:{type:"NONE"}}queueCallForConfig(e){this.configSelectionQueue.push(e),this.callRefTimerRef()}enterIdle(){this.resolvingLoadBalancer.destroy(),this.updateState(f.ConnectivityState.IDLE),this.currentPicker=new a.QueuePicker(this.resolvingLoadBalancer),this.idleTimer&&(clearTimeout(this.idleTimer),this.idleTimer=null)}startIdleTimeout(e){var t,r;this.idleTimer=setTimeout(()=>{if(this.callCount>0){this.startIdleTimeout(this.idleTimeoutMs);return}let e=new Date().valueOf()-this.lastActivityTimestamp.valueOf();e>=this.idleTimeoutMs?(this.trace("Idle timer triggered after "+this.idleTimeoutMs+"ms of inactivity"),this.enterIdle()):this.startIdleTimeout(this.idleTimeoutMs-e)},e),null===(r=(t=this.idleTimer).unref)||void 0===r||r.call(t)}maybeStartIdleTimer(){this.connectivityState===f.ConnectivityState.SHUTDOWN||this.idleTimer||this.startIdleTimeout(this.idleTimeoutMs)}onCallStart(){this.channelzEnabled&&this.callTracker.addCallStarted(),this.callCount+=1}onCallEnd(e){this.channelzEnabled&&(e.code===o.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()),this.callCount-=1,this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()}createLoadBalancingCall(e,t,r,n,i){let s=(0,b.getNextCallNumber)();return this.trace("createLoadBalancingCall ["+s+'] method="'+t+'"'),new g.LoadBalancingCall(this,e,t,r,n,i,s)}createRetryingCall(e,t,r,n,i){let s=(0,b.getNextCallNumber)();return this.trace("createRetryingCall ["+s+'] method="'+t+'"'),new S.RetryingCall(this,e,t,r,n,i,s,this.retryBufferTracker,I.get(this.getTarget()))}createInnerCall(e,t,r,n,i){return 0===this.options["grpc.enable_retries"]?this.createLoadBalancingCall(e,t,r,n,i):this.createRetryingCall(e,t,r,n,i)}createResolvingCall(e,t,r,n,i){let s=(0,b.getNextCallNumber)();this.trace("createResolvingCall ["+s+'] method="'+e+'", deadline='+(0,y.deadlineToString)(t));let a={deadline:t,flags:null!=i?i:o.Propagate.DEFAULTS,host:null!=r?r:this.defaultAuthority,parentCall:n},l=new v.ResolvingCall(this,e,a,this.filterStackFactory.clone(),this.credentials._getCallCredentials(),s);return this.onCallStart(),l.addStatusWatcher(e=>{this.onCallEnd(e)}),l}close(){this.resolvingLoadBalancer.destroy(),this.updateState(f.ConnectivityState.SHUTDOWN),clearInterval(this.callRefTimer),this.idleTimer&&clearTimeout(this.idleTimer),this.channelzEnabled&&(0,m.unregisterChannelzRef)(this.channelzRef),this.subchannelPool.unrefUnusedSubchannels()}getTarget(){return(0,p.uriToString)(this.target)}getConnectivityState(e){let t=this.connectivityState;return e&&(this.resolvingLoadBalancer.exitIdle(),this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()),t}watchConnectivityState(e,t,r){if(this.connectivityState===f.ConnectivityState.SHUTDOWN)throw Error("Channel has been shut down");let n=null;if(t!==1/0){let e=t instanceof Date?t:new Date(t),s=new Date;if(t===-1/0||e<=s){process.nextTick(r,Error("Deadline passed without connectivity state change"));return}n=setTimeout(()=>{this.removeConnectivityStateWatcher(i),r(Error("Deadline passed without connectivity state change"))},e.getTime()-s.getTime())}let i={currentState:e,callback:r,timer:n};this.connectivityStateWatchers.push(i)}getChannelzRef(){return this.channelzRef}createCall(e,t,r,n,i){if("string"!=typeof e)throw TypeError("Channel#createCall: method must be a string");if(!("number"==typeof t||t instanceof Date))throw TypeError("Channel#createCall: deadline must be a number or Date");if(this.connectivityState===f.ConnectivityState.SHUTDOWN)throw Error("Channel has been shut down");return this.createResolvingCall(e,t,r,n,i)}}t.InternalChannel=A},6372:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChildLoadBalancerHandler=void 0;let n=r(9884),i=r(2409),s="child_load_balancer_helper";class a{constructor(e){this.channelControlHelper=e,this.currentChild=null,this.pendingChild=null,this.latestConfig=null,this.ChildPolicyHelper=class{constructor(e){this.parent=e,this.child=null}createSubchannel(e,t){return this.parent.channelControlHelper.createSubchannel(e,t)}updateState(e,t){var r;if(this.calledByPendingChild()){if(e===i.ConnectivityState.CONNECTING)return;null===(r=this.parent.currentChild)||void 0===r||r.destroy(),this.parent.currentChild=this.parent.pendingChild,this.parent.pendingChild=null}else if(!this.calledByCurrentChild())return;this.parent.channelControlHelper.updateState(e,t)}requestReresolution(){var e;let t=null!==(e=this.parent.pendingChild)&&void 0!==e?e:this.parent.currentChild;this.child===t&&this.parent.channelControlHelper.requestReresolution()}setChild(e){this.child=e}addChannelzChild(e){this.parent.channelControlHelper.addChannelzChild(e)}removeChannelzChild(e){this.parent.channelControlHelper.removeChannelzChild(e)}calledByPendingChild(){return this.child===this.parent.pendingChild}calledByCurrentChild(){return this.child===this.parent.currentChild}}}configUpdateRequiresNewPolicyInstance(e,t){return e.getLoadBalancerName()!==t.getLoadBalancerName()}updateAddressList(e,t,r){let i;if(null===this.currentChild||null===this.latestConfig||this.configUpdateRequiresNewPolicyInstance(this.latestConfig,t)){let e=new this.ChildPolicyHelper(this),r=(0,n.createLoadBalancer)(t,e);e.setChild(r),null===this.currentChild?(this.currentChild=r,i=this.currentChild):(this.pendingChild&&this.pendingChild.destroy(),this.pendingChild=r,i=this.pendingChild)}else i=null===this.pendingChild?this.currentChild:this.pendingChild;this.latestConfig=t,i.updateAddressList(e,t,r)}exitIdle(){this.currentChild&&(this.currentChild.exitIdle(),this.pendingChild&&this.pendingChild.exitIdle())}resetBackoff(){this.currentChild&&(this.currentChild.resetBackoff(),this.pendingChild&&this.pendingChild.resetBackoff())}destroy(){this.currentChild&&(this.currentChild.destroy(),this.currentChild=null),this.pendingChild&&(this.pendingChild.destroy(),this.pendingChild=null)}getTypeName(){return s}}t.ChildLoadBalancerHandler=a},5638:(e,t,r)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.setup=t.OutlierDetectionLoadBalancer=t.OutlierDetectionLoadBalancingConfig=void 0;let i=r(2409),s=r(9572),a=r(7974),o=r(8779),l=r(9884),u=r(6372),c=r(2352),h=r(4955),d=r(487),p=r(5792),f="outlier_detection";function m(e){p.trace(s.LogVerbosity.DEBUG,f,e)}let g="outlier_detection",y=(null!==(n=process.env.GRPC_EXPERIMENTAL_ENABLE_OUTLIER_DETECTION)&&void 0!==n?n:"true")==="true",v={stdev_factor:1900,enforcement_percentage:100,minimum_hosts:5,request_volume:100},b={threshold:85,enforcement_percentage:100,minimum_hosts:5,request_volume:50};function T(e,t,r,n){if(t in e&&typeof e[t]!==r){let i=n?`${n}.${t}`:t;throw Error(`outlier detection config ${i} parse error: expected ${r}, got ${typeof e[t]}`)}}function S(e,t,r){let n=r?`${r}.${t}`:t;if(t in e){if(!(0,a.isDuration)(e[t]))throw Error(`outlier detection config ${n} parse error: expected Duration, got ${typeof e[t]}`);if(!(e[t].seconds>=0&&e[t].seconds<=315576e6&&e[t].nanos>=0&&e[t].nanos<=999999999))throw Error(`outlier detection config ${n} parse error: values out of range for non-negative Duaration`)}}function E(e,t,r){let n=r?`${r}.${t}`:t;if(T(e,t,"number",r),t in e&&!(e[t]>=0&&e[t]<=100))throw Error(`outlier detection config ${n} parse error: value out of range for percentage (0-100)`)}class w{constructor(e,t,r,n,i,s,a){if(this.childPolicy=a,a.length>0&&"pick_first"===a[0].getLoadBalancerName())throw Error("outlier_detection LB policy cannot have a pick_first child policy");this.intervalMs=null!=e?e:1e4,this.baseEjectionTimeMs=null!=t?t:3e4,this.maxEjectionTimeMs=null!=r?r:3e5,this.maxEjectionPercent=null!=n?n:10,this.successRateEjection=i?Object.assign(Object.assign({},v),i):null,this.failurePercentageEjection=s?Object.assign(Object.assign({},b),s):null}getLoadBalancerName(){return g}toJsonObject(){return{interval:(0,a.msToDuration)(this.intervalMs),base_ejection_time:(0,a.msToDuration)(this.baseEjectionTimeMs),max_ejection_time:(0,a.msToDuration)(this.maxEjectionTimeMs),max_ejection_percent:this.maxEjectionPercent,success_rate_ejection:this.successRateEjection,failure_percentage_ejection:this.failurePercentageEjection,child_policy:this.childPolicy.map(e=>e.toJsonObject())}}getIntervalMs(){return this.intervalMs}getBaseEjectionTimeMs(){return this.baseEjectionTimeMs}getMaxEjectionTimeMs(){return this.maxEjectionTimeMs}getMaxEjectionPercent(){return this.maxEjectionPercent}getSuccessRateEjectionConfig(){return this.successRateEjection}getFailurePercentageEjectionConfig(){return this.failurePercentageEjection}getChildPolicy(){return this.childPolicy}copyWithChildPolicy(e){return new w(this.intervalMs,this.baseEjectionTimeMs,this.maxEjectionTimeMs,this.maxEjectionPercent,this.successRateEjection,this.failurePercentageEjection,e)}static createFromJson(e){var t;if(S(e,"interval"),S(e,"base_ejection_time"),S(e,"max_ejection_time"),E(e,"max_ejection_percent"),"success_rate_ejection"in e){if("object"!=typeof e.success_rate_ejection)throw Error("outlier detection config success_rate_ejection must be an object");T(e.success_rate_ejection,"stdev_factor","number","success_rate_ejection"),E(e.success_rate_ejection,"enforcement_percentage","success_rate_ejection"),T(e.success_rate_ejection,"minimum_hosts","number","success_rate_ejection"),T(e.success_rate_ejection,"request_volume","number","success_rate_ejection")}if("failure_percentage_ejection"in e){if("object"!=typeof e.failure_percentage_ejection)throw Error("outlier detection config failure_percentage_ejection must be an object");E(e.failure_percentage_ejection,"threshold","failure_percentage_ejection"),E(e.failure_percentage_ejection,"enforcement_percentage","failure_percentage_ejection"),T(e.failure_percentage_ejection,"minimum_hosts","number","failure_percentage_ejection"),T(e.failure_percentage_ejection,"request_volume","number","failure_percentage_ejection")}return new w(e.interval?(0,a.durationToMs)(e.interval):null,e.base_ejection_time?(0,a.durationToMs)(e.base_ejection_time):null,e.max_ejection_time?(0,a.durationToMs)(e.max_ejection_time):null,null!==(t=e.max_ejection_percent)&&void 0!==t?t:null,e.success_rate_ejection,e.failure_percentage_ejection,e.child_policy.map(l.validateLoadBalancingConfig))}}t.OutlierDetectionLoadBalancingConfig=w;class C extends d.BaseSubchannelWrapper{constructor(e,t){super(e),this.mapEntry=t,this.stateListeners=[],this.ejected=!1,this.refCount=0,this.childSubchannelState=e.getConnectivityState(),e.addConnectivityStateListener((e,t,r,n)=>{if(this.childSubchannelState=r,!this.ejected)for(let e of this.stateListeners)e(this,t,r,n)})}getConnectivityState(){return this.ejected?i.ConnectivityState.TRANSIENT_FAILURE:this.childSubchannelState}addConnectivityStateListener(e){this.stateListeners.push(e)}removeConnectivityStateListener(e){let t=this.stateListeners.indexOf(e);t>-1&&this.stateListeners.splice(t,1)}ref(){this.child.ref(),this.refCount+=1}unref(){if(this.child.unref(),this.refCount-=1,this.refCount<=0&&this.mapEntry){let e=this.mapEntry.subchannelWrappers.indexOf(this);e>=0&&this.mapEntry.subchannelWrappers.splice(e,1)}}eject(){for(let e of(this.ejected=!0,this.stateListeners))e(this,this.childSubchannelState,i.ConnectivityState.TRANSIENT_FAILURE,-1)}uneject(){for(let e of(this.ejected=!1,this.stateListeners))e(this,i.ConnectivityState.TRANSIENT_FAILURE,this.childSubchannelState,-1)}getMapEntry(){return this.mapEntry}getWrappedSubchannel(){return this.child}}function _(){return{success:0,failure:0}}class I{constructor(){this.activeBucket=_(),this.inactiveBucket=_()}addSuccess(){this.activeBucket.success+=1}addFailure(){this.activeBucket.failure+=1}switchBuckets(){this.inactiveBucket=this.activeBucket,this.activeBucket=_()}getLastSuccesses(){return this.inactiveBucket.success}getLastFailures(){return this.inactiveBucket.failure}}class R{constructor(e,t){this.wrappedPicker=e,this.countCalls=t}pick(e){let t=this.wrappedPicker.pick(e);if(t.pickResultType!==c.PickResultType.COMPLETE)return t;{let e=t.subchannel,r=e.getMapEntry();if(!r)return Object.assign(Object.assign({},t),{subchannel:e.getWrappedSubchannel()});{let n=t.onCallEnded;return this.countCalls&&(n=e=>{var n;e===s.Status.OK?r.counter.addSuccess():r.counter.addFailure(),null===(n=t.onCallEnded)||void 0===n||n.call(t,e)}),Object.assign(Object.assign({},t),{subchannel:e.getWrappedSubchannel(),onCallEnded:n})}}}}class N{constructor(e){this.addressMap=new Map,this.latestConfig=null,this.timerStartTime=null,this.childBalancer=new u.ChildLoadBalancerHandler((0,o.createChildChannelControlHelper)(e,{createSubchannel:(t,r)=>{let n=e.createSubchannel(t,r),i=this.addressMap.get((0,h.subchannelAddressToString)(t)),s=new C(n,i);return(null==i?void 0:i.currentEjectionTimestamp)!==null&&s.eject(),null==i||i.subchannelWrappers.push(s),s},updateState:(t,r)=>{t===i.ConnectivityState.READY?e.updateState(t,new R(r,this.isCountingEnabled())):e.updateState(t,r)}})),this.ejectionTimer=setInterval(()=>{},0),clearInterval(this.ejectionTimer)}isCountingEnabled(){return null!==this.latestConfig&&(null!==this.latestConfig.getSuccessRateEjectionConfig()||null!==this.latestConfig.getFailurePercentageEjectionConfig())}getCurrentEjectionPercent(){let e=0;for(let t of this.addressMap.values())null!==t.currentEjectionTimestamp&&(e+=1);return 100*e/this.addressMap.size}runSuccessRateCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getSuccessRateEjectionConfig();if(!t)return;m("Running success rate check");let r=t.request_volume,n=0,i=[];for(let[e,t]of this.addressMap){let s=t.counter.getLastSuccesses(),a=t.counter.getLastFailures();m("Stats for "+e+": successes="+s+" failures="+a+" targetRequestVolume="+r),s+a>=r&&(n+=1,i.push(s/(s+a)))}if(m("Found "+n+" success rate candidates; currentEjectionPercent="+this.getCurrentEjectionPercent()+" successRates=["+i+"]"),n<t.minimum_hosts)return;let s=i.reduce((e,t)=>e+t)/i.length,a=0;for(let e of i){let t=e-s;a+=t*t}let o=Math.sqrt(a/i.length),l=s-t.stdev_factor/1e3*o;for(let[n,i]of(m("stdev="+o+" ejectionThreshold="+l),this.addressMap.entries())){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let s=i.counter.getLastSuccesses(),a=i.counter.getLastFailures();if(s+a<r)continue;let o=s/(s+a);if(m("Checking candidate "+n+" successRate="+o),o<l){let r=100*Math.random();m("Candidate "+n+" randomNumber="+r+" enforcement_percentage="+t.enforcement_percentage),r<t.enforcement_percentage&&(m("Ejecting candidate "+n),this.eject(i,e))}}}runFailurePercentageCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getFailurePercentageEjectionConfig();if(!t)return;m("Running failure percentage check. threshold="+t.threshold+" request volume threshold="+t.request_volume);let r=0;for(let e of this.addressMap.values())e.counter.getLastSuccesses()+e.counter.getLastFailures()>=t.request_volume&&(r+=1);if(!(r<t.minimum_hosts))for(let[r,n]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let i=n.counter.getLastSuccesses(),s=n.counter.getLastFailures();if(m("Candidate successes="+i+" failures="+s),!(i+s<t.request_volume)&&100*s/(s+i)>t.threshold){let i=100*Math.random();m("Candidate "+r+" randomNumber="+i+" enforcement_percentage="+t.enforcement_percentage),i<t.enforcement_percentage&&(m("Ejecting candidate "+r),this.eject(n,e))}}}eject(e,t){for(let t of(e.currentEjectionTimestamp=new Date,e.ejectionTimeMultiplier+=1,e.subchannelWrappers))t.eject()}uneject(e){for(let t of(e.currentEjectionTimestamp=null,e.subchannelWrappers))t.uneject()}switchAllBuckets(){for(let e of this.addressMap.values())e.counter.switchBuckets()}startTimer(e){var t,r;this.ejectionTimer=setTimeout(()=>this.runChecks(),e),null===(r=(t=this.ejectionTimer).unref)||void 0===r||r.call(t)}runChecks(){let e=new Date;if(m("Ejection timer running"),this.switchAllBuckets(),this.latestConfig)for(let[t,r]of(this.timerStartTime=e,this.startTimer(this.latestConfig.getIntervalMs()),this.runSuccessRateCheck(e),this.runFailurePercentageCheck(e),this.addressMap.entries()))if(null===r.currentEjectionTimestamp)r.ejectionTimeMultiplier>0&&(r.ejectionTimeMultiplier-=1);else{let e=this.latestConfig.getBaseEjectionTimeMs(),n=this.latestConfig.getMaxEjectionTimeMs(),i=new Date(r.currentEjectionTimestamp.getTime());i.setMilliseconds(i.getMilliseconds()+Math.min(e*r.ejectionTimeMultiplier,Math.max(e,n))),i<new Date&&(m("Unejecting "+t),this.uneject(r))}}updateAddressList(e,t,r){if(!(t instanceof w))return;let n=new Set;for(let t of e)n.add((0,h.subchannelAddressToString)(t));for(let e of n)this.addressMap.has(e)||(m("Adding map entry for "+e),this.addressMap.set(e,{counter:new I,currentEjectionTimestamp:null,ejectionTimeMultiplier:0,subchannelWrappers:[]}));for(let e of this.addressMap.keys())n.has(e)||(m("Removing map entry for "+e),this.addressMap.delete(e));let i=(0,l.getFirstUsableConfig)(t.getChildPolicy(),!0);if(this.childBalancer.updateAddressList(e,i,r),t.getSuccessRateEjectionConfig()||t.getFailurePercentageEjectionConfig()){if(this.timerStartTime){m("Previous timer existed. Replacing timer"),clearTimeout(this.ejectionTimer);let e=t.getIntervalMs()-(new Date().getTime()-this.timerStartTime.getTime());this.startTimer(e)}else m("Starting new timer"),this.timerStartTime=new Date,this.startTimer(t.getIntervalMs()),this.switchAllBuckets()}else for(let e of(m("Counting disabled. Cancelling timer."),this.timerStartTime=null,clearTimeout(this.ejectionTimer),this.addressMap.values()))this.uneject(e),e.ejectionTimeMultiplier=0;this.latestConfig=t}exitIdle(){this.childBalancer.exitIdle()}resetBackoff(){this.childBalancer.resetBackoff()}destroy(){clearTimeout(this.ejectionTimer),this.childBalancer.destroy()}getTypeName(){return g}}function k(){y&&(0,o.registerLoadBalancerType)(g,N,w)}t.OutlierDetectionLoadBalancer=N,t.setup=k},5102:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setup=t.PickFirstLoadBalancer=t.shuffled=t.PickFirstLoadBalancingConfig=void 0;let n=r(9884),i=r(2409),s=r(2352),a=r(5792),o=r(9572),l="pick_first";function u(e){a.trace(o.LogVerbosity.DEBUG,l,e)}let c="pick_first",h=250;class d{constructor(e){this.shuffleAddressList=e}getLoadBalancerName(){return c}toJsonObject(){return{[c]:{shuffleAddressList:this.shuffleAddressList}}}getShuffleAddressList(){return this.shuffleAddressList}static createFromJson(e){if("shuffleAddressList"in e&&"boolean"!=typeof e.shuffleAddressList)throw Error("pick_first config field shuffleAddressList must be a boolean if provided");return new d(!0===e.shuffleAddressList)}}t.PickFirstLoadBalancingConfig=d;class p{constructor(e){this.subchannel=e}pick(e){return{pickResultType:s.PickResultType.COMPLETE,subchannel:this.subchannel,status:null,onCallStarted:null,onCallEnded:null}}}function f(e){let t=e.slice();for(let e=t.length-1;e>1;e--){let r=Math.floor(Math.random()*(e+1)),n=t[e];t[e]=t[r],t[r]=n}return t}t.shuffled=f;class m{constructor(e){this.channelControlHelper=e,this.children=[],this.currentState=i.ConnectivityState.IDLE,this.currentSubchannelIndex=0,this.currentPick=null,this.subchannelStateListener=(e,t,r,n,i)=>{this.onSubchannelStateUpdate(e,t,r,i)},this.triedAllSubchannels=!1,this.stickyTransientFailureMode=!1,this.requestedResolutionSinceLastUpdate=!1,this.lastError=null,this.latestAddressList=null,this.connectionDelayTimeout=setTimeout(()=>{},0),clearTimeout(this.connectionDelayTimeout)}allChildrenHaveReportedTF(){return this.children.every(e=>e.hasReportedTransientFailure)}calculateAndReportNewState(){this.currentPick?this.updateState(i.ConnectivityState.READY,new p(this.currentPick)):0===this.children.length?this.updateState(i.ConnectivityState.IDLE,new s.QueuePicker(this)):this.stickyTransientFailureMode?this.updateState(i.ConnectivityState.TRANSIENT_FAILURE,new s.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(i.ConnectivityState.CONNECTING,new s.QueuePicker(this))}requestReresolution(){this.requestedResolutionSinceLastUpdate=!0,this.channelControlHelper.requestReresolution()}maybeEnterStickyTransientFailureMode(){if(this.allChildrenHaveReportedTF()&&(this.requestedResolutionSinceLastUpdate||this.requestReresolution(),!this.stickyTransientFailureMode)){for(let{subchannel:e}of(this.stickyTransientFailureMode=!0,this.children))e.startConnecting();this.calculateAndReportNewState()}}removeCurrentPick(){if(null!==this.currentPick){let e=this.currentPick;this.currentPick=null,e.unref(),e.removeConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.removeChannelzChild(e.getChannelzRef())}}onSubchannelStateUpdate(e,t,r,n){var s;if(null===(s=this.currentPick)||void 0===s?void 0:s.realSubchannelEquals(e)){r!==i.ConnectivityState.READY&&(this.removeCurrentPick(),this.calculateAndReportNewState(),this.requestReresolution());return}for(let[t,s]of this.children.entries())if(e.realSubchannelEquals(s.subchannel)){r===i.ConnectivityState.READY&&this.pickSubchannel(s.subchannel),r===i.ConnectivityState.TRANSIENT_FAILURE&&(s.hasReportedTransientFailure=!0,n&&(this.lastError=n),this.maybeEnterStickyTransientFailureMode(),t===this.currentSubchannelIndex&&this.startNextSubchannelConnecting(t+1)),s.subchannel.startConnecting();return}}startNextSubchannelConnecting(e){if(clearTimeout(this.connectionDelayTimeout),!this.triedAllSubchannels){for(let[t,r]of this.children.entries())if(t>=e){let e=r.subchannel.getConnectivityState();if(e===i.ConnectivityState.IDLE||e===i.ConnectivityState.CONNECTING){this.startConnecting(t);return}}this.triedAllSubchannels=!0,this.maybeEnterStickyTransientFailureMode()}}startConnecting(e){var t,r;clearTimeout(this.connectionDelayTimeout),this.currentSubchannelIndex=e,this.children[e].subchannel.getConnectivityState()===i.ConnectivityState.IDLE&&(u("Start connecting to subchannel with address "+this.children[e].subchannel.getAddress()),process.nextTick(()=>{var t;null===(t=this.children[e])||void 0===t||t.subchannel.startConnecting()})),this.connectionDelayTimeout=null===(r=(t=setTimeout(()=>{this.startNextSubchannelConnecting(e+1)},h)).unref)||void 0===r?void 0:r.call(t)}pickSubchannel(e){this.currentPick&&e.realSubchannelEquals(this.currentPick)||(u("Pick subchannel with address "+e.getAddress()),this.stickyTransientFailureMode=!1,null!==this.currentPick&&(this.currentPick.unref(),this.channelControlHelper.removeChannelzChild(this.currentPick.getChannelzRef()),this.currentPick.removeConnectivityStateListener(this.subchannelStateListener)),this.currentPick=e,e.ref(),this.channelControlHelper.addChannelzChild(e.getChannelzRef()),this.resetSubchannelList(),clearTimeout(this.connectionDelayTimeout),this.calculateAndReportNewState())}updateState(e,t){u(i.ConnectivityState[this.currentState]+" -> "+i.ConnectivityState[e]),this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.children)this.currentPick&&e.subchannel.realSubchannelEquals(this.currentPick)||e.subchannel.removeConnectivityStateListener(this.subchannelStateListener),e.subchannel.unref(),this.channelControlHelper.removeChannelzChild(e.subchannel.getChannelzRef());this.currentSubchannelIndex=0,this.children=[],this.triedAllSubchannels=!1,this.requestedResolutionSinceLastUpdate=!1}connectToAddressList(e){let t=e.map(e=>({subchannel:this.channelControlHelper.createSubchannel(e,{}),hasReportedTransientFailure:!1}));for(let{subchannel:e}of t)e.ref(),this.channelControlHelper.addChannelzChild(e.getChannelzRef());for(let{subchannel:e}of(this.resetSubchannelList(),this.children=t,this.children))if(e.addConnectivityStateListener(this.subchannelStateListener),e.getConnectivityState()===i.ConnectivityState.READY){this.pickSubchannel(e);return}for(let e of this.children)e.subchannel.getConnectivityState()===i.ConnectivityState.TRANSIENT_FAILURE&&(e.hasReportedTransientFailure=!0);this.startNextSubchannelConnecting(0),this.calculateAndReportNewState()}updateAddressList(e,t){t instanceof d&&(t.getShuffleAddressList()&&(e=f(e)),this.latestAddressList=e,this.connectToAddressList(e))}exitIdle(){this.currentState===i.ConnectivityState.IDLE&&this.latestAddressList&&this.connectToAddressList(this.latestAddressList)}resetBackoff(){}destroy(){this.resetSubchannelList(),this.removeCurrentPick()}getTypeName(){return c}}function g(){(0,n.registerLoadBalancerType)(c,m,d),(0,n.registerDefaultLoadBalancerType)(c)}t.PickFirstLoadBalancer=m,t.setup=g},4556:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setup=t.RoundRobinLoadBalancer=void 0;let n=r(9884),i=r(2409),s=r(2352),a=r(4955),o=r(5792),l=r(9572),u="round_robin";function c(e){o.trace(l.LogVerbosity.DEBUG,u,e)}let h="round_robin";class d{getLoadBalancerName(){return h}constructor(){}toJsonObject(){return{[h]:{}}}static createFromJson(e){return new d}}class p{constructor(e,t=0){this.subchannelList=e,this.nextIndex=t}pick(e){let t=this.subchannelList[this.nextIndex];return this.nextIndex=(this.nextIndex+1)%this.subchannelList.length,{pickResultType:s.PickResultType.COMPLETE,subchannel:t,status:null,onCallStarted:null,onCallEnded:null}}peekNextSubchannel(){return this.subchannelList[this.nextIndex]}}class f{constructor(e){this.channelControlHelper=e,this.subchannels=[],this.currentState=i.ConnectivityState.IDLE,this.currentReadyPicker=null,this.lastError=null,this.subchannelStateListener=(e,t,r,n,s)=>{this.calculateAndUpdateState(),(r===i.ConnectivityState.TRANSIENT_FAILURE||r===i.ConnectivityState.IDLE)&&(s&&(this.lastError=s),this.channelControlHelper.requestReresolution(),e.startConnecting())}}countSubchannelsWithState(e){return this.subchannels.filter(t=>t.getConnectivityState()===e).length}calculateAndUpdateState(){if(this.countSubchannelsWithState(i.ConnectivityState.READY)>0){let e=this.subchannels.filter(e=>e.getConnectivityState()===i.ConnectivityState.READY),t=0;null!==this.currentReadyPicker&&(t=e.indexOf(this.currentReadyPicker.peekNextSubchannel()))<0&&(t=0),this.updateState(i.ConnectivityState.READY,new p(e,t))}else this.countSubchannelsWithState(i.ConnectivityState.CONNECTING)>0?this.updateState(i.ConnectivityState.CONNECTING,new s.QueuePicker(this)):this.countSubchannelsWithState(i.ConnectivityState.TRANSIENT_FAILURE)>0?this.updateState(i.ConnectivityState.TRANSIENT_FAILURE,new s.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(i.ConnectivityState.IDLE,new s.QueuePicker(this))}updateState(e,t){c(i.ConnectivityState[this.currentState]+" -> "+i.ConnectivityState[e]),e===i.ConnectivityState.READY?this.currentReadyPicker=t:this.currentReadyPicker=null,this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.subchannels)e.removeConnectivityStateListener(this.subchannelStateListener),e.unref(),this.channelControlHelper.removeChannelzChild(e.getChannelzRef());this.subchannels=[]}updateAddressList(e,t){for(let t of(this.resetSubchannelList(),c("Connect to address list "+e.map(e=>(0,a.subchannelAddressToString)(e))),this.subchannels=e.map(e=>this.channelControlHelper.createSubchannel(e,{})),this.subchannels)){t.ref(),t.addConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.addChannelzChild(t.getChannelzRef());let e=t.getConnectivityState();(e===i.ConnectivityState.IDLE||e===i.ConnectivityState.TRANSIENT_FAILURE)&&t.startConnecting()}this.calculateAndUpdateState()}exitIdle(){for(let e of this.subchannels)e.startConnecting()}resetBackoff(){}destroy(){this.resetSubchannelList()}getTypeName(){return h}}function m(){(0,n.registerLoadBalancerType)(h,f,d)}t.RoundRobinLoadBalancer=f,t.setup=m},9884:(e,t)=>{"use strict";function r(e,t){var r,n,i,s,a,o,l,u,c,h;return{createSubchannel:null!==(n=null===(r=t.createSubchannel)||void 0===r?void 0:r.bind(t))&&void 0!==n?n:e.createSubchannel.bind(e),updateState:null!==(s=null===(i=t.updateState)||void 0===i?void 0:i.bind(t))&&void 0!==s?s:e.updateState.bind(e),requestReresolution:null!==(o=null===(a=t.requestReresolution)||void 0===a?void 0:a.bind(t))&&void 0!==o?o:e.requestReresolution.bind(e),addChannelzChild:null!==(u=null===(l=t.addChannelzChild)||void 0===l?void 0:l.bind(t))&&void 0!==u?u:e.addChannelzChild.bind(e),removeChannelzChild:null!==(h=null===(c=t.removeChannelzChild)||void 0===c?void 0:c.bind(t))&&void 0!==h?h:e.removeChannelzChild.bind(e)}}Object.defineProperty(t,"__esModule",{value:!0}),t.validateLoadBalancingConfig=t.getFirstUsableConfig=t.isLoadBalancerNameRegistered=t.createLoadBalancer=t.registerDefaultLoadBalancerType=t.registerLoadBalancerType=t.createChildChannelControlHelper=void 0,t.createChildChannelControlHelper=r;let n={},i=null;function s(e,t,r){n[e]={LoadBalancer:t,LoadBalancingConfig:r}}function a(e){i=e}function o(e,t){let r=e.getLoadBalancerName();return r in n?new n[r].LoadBalancer(t):null}function l(e){return e in n}function u(e,t=!1){for(let t of e)if(t.getLoadBalancerName() in n)return t;return t&&i?new n[i].LoadBalancingConfig:null}function c(e){if(!(null!==e&&"object"==typeof e))throw Error("Load balancing config must be an object");let t=Object.keys(e);if(1!==t.length)throw Error("Provided load balancing config has multiple conflicting entries");let r=t[0];if(r in n)return n[r].LoadBalancingConfig.createFromJson(e[r]);throw Error(`Unrecognized load balancing config name ${r}`)}t.registerLoadBalancerType=s,t.registerDefaultLoadBalancerType=a,t.createLoadBalancer=o,t.isLoadBalancerNameRegistered=l,t.getFirstUsableConfig=u,t.validateLoadBalancingConfig=c},1690:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoadBalancingCall=void 0;let n=r(2409),i=r(9572),s=r(4771),a=r(6281),o=r(2352),l=r(5773),u=r(5792),c=r(5607),h=r(2694),d="load_balancing_call";class p{constructor(e,t,r,n,i,s,a){var o,u;this.channel=e,this.callConfig=t,this.methodName=r,this.host=n,this.credentials=i,this.deadline=s,this.callNumber=a,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.metadata=null,this.listener=null,this.onCallEnded=null;let c=this.methodName.split("/"),h="";c.length>=2&&(h=c[1]);let d=null!==(u=null===(o=(0,l.splitHostPort)(this.host))||void 0===o?void 0:o.host)&&void 0!==u?u:"localhost";this.serviceUrl=`https://${d}/${h}`}trace(e){u.trace(i.LogVerbosity.DEBUG,d,"["+this.callNumber+"] "+e)}outputStatus(e,t){var r,n;if(!this.ended){this.ended=!0,this.trace("ended with status: code="+e.code+' details="'+e.details+'"');let i=Object.assign(Object.assign({},e),{progress:t});null===(r=this.listener)||void 0===r||r.onReceiveStatus(i),null===(n=this.onCallEnded)||void 0===n||n.call(this,i.code)}}doPick(){var e,t;if(this.ended)return;if(!this.metadata)throw Error("doPick called before start");this.trace("Pick called");let r=this.channel.doPick(this.metadata,this.callConfig.pickInformation),l=r.subchannel?"("+r.subchannel.getChannelzRef().id+") "+r.subchannel.getAddress():""+r.subchannel;switch(this.trace("Pick result: "+o.PickResultType[r.pickResultType]+" subchannel: "+l+" status: "+(null===(e=r.status)||void 0===e?void 0:e.code)+" "+(null===(t=r.status)||void 0===t?void 0:t.details)),r.pickResultType){case o.PickResultType.COMPLETE:this.credentials.generateMetadata({service_url:this.serviceUrl}).then(e=>{var t,o,u;if(this.ended){this.trace("Credentials metadata generation finished after call ended");return}let c=this.metadata.clone();if(c.merge(e),c.get("authorization").length>1&&this.outputStatus({code:i.Status.INTERNAL,details:'"authorization" metadata cannot have multiple values',metadata:new a.Metadata},"PROCESSED"),r.subchannel.getConnectivityState()!==n.ConnectivityState.READY){this.trace("Picked subchannel "+l+" has state "+n.ConnectivityState[r.subchannel.getConnectivityState()]+" after getting credentials metadata. Retrying pick"),this.doPick();return}this.deadline!==1/0&&c.set("grpc-timeout",(0,s.getDeadlineTimeoutString)(this.deadline));try{this.child=r.subchannel.getRealSubchannel().createCall(c,this.host,this.methodName,{onReceiveMetadata:e=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(e)},onReceiveMessage:e=>{this.trace("Received message"),this.listener.onReceiveMessage(e)},onReceiveStatus:e=>{this.trace("Received status"),e.rstCode===h.constants.NGHTTP2_REFUSED_STREAM?this.outputStatus(e,"REFUSED"):this.outputStatus(e,"PROCESSED")}})}catch(e){this.trace("Failed to start call on picked subchannel "+l+" with error "+e.message),this.outputStatus({code:i.Status.INTERNAL,details:"Failed to start HTTP/2 stream with error "+e.message,metadata:new a.Metadata},"NOT_STARTED");return}null===(o=(t=this.callConfig).onCommitted)||void 0===o||o.call(t),null===(u=r.onCallStarted)||void 0===u||u.call(r),this.onCallEnded=r.onCallEnded,this.trace("Created child call ["+this.child.getCallNumber()+"]"),this.readPending&&this.child.startRead(),this.pendingMessage&&this.child.sendMessageWithContext(this.pendingMessage.context,this.pendingMessage.message),this.pendingHalfClose&&this.child.halfClose()},e=>{let{code:t,details:r}=(0,c.restrictControlPlaneStatusCode)("number"==typeof e.code?e.code:i.Status.UNKNOWN,`Getting metadata from plugin failed with error: ${e.message}`);this.outputStatus({code:t,details:r,metadata:new a.Metadata},"PROCESSED")});break;case o.PickResultType.DROP:let{code:u,details:d}=(0,c.restrictControlPlaneStatusCode)(r.status.code,r.status.details);setImmediate(()=>{this.outputStatus({code:u,details:d,metadata:r.status.metadata},"DROP")});break;case o.PickResultType.TRANSIENT_FAILURE:if(this.metadata.getOptions().waitForReady)this.channel.queueCallForPick(this);else{let{code:e,details:t}=(0,c.restrictControlPlaneStatusCode)(r.status.code,r.status.details);setImmediate(()=>{this.outputStatus({code:e,details:t,metadata:r.status.metadata},"PROCESSED")})}break;case o.PickResultType.QUEUE:this.channel.queueCallForPick(this)}}cancelWithStatus(e,t){var r;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),null===(r=this.child)||void 0===r||r.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new a.Metadata},"PROCESSED")}getPeer(){var e,t;return null!==(t=null===(e=this.child)||void 0===e?void 0:e.getPeer())&&void 0!==t?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.listener=t,this.metadata=e,this.doPick()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.child.sendMessageWithContext(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){throw Error("Method not implemented.")}getCallNumber(){return this.callNumber}}t.LoadBalancingCall=p},5792:(e,t,r)=>{"use strict";var n,i,s,a;Object.defineProperty(t,"__esModule",{value:!0}),t.isTracerEnabled=t.trace=t.log=t.setLoggerVerbosity=t.setLogger=t.getLogger=void 0;let o=r(9572),l=r(5816),u=r(1513).i8,c={error:(e,...t)=>{console.error("E "+e,...t)},info:(e,...t)=>{console.error("I "+e,...t)},debug:(e,...t)=>{console.error("D "+e,...t)}},h=o.LogVerbosity.ERROR;switch((null!==(i=null!==(n=process.env.GRPC_NODE_VERBOSITY)&&void 0!==n?n:process.env.GRPC_VERBOSITY)&&void 0!==i?i:"").toUpperCase()){case"DEBUG":h=o.LogVerbosity.DEBUG;break;case"INFO":h=o.LogVerbosity.INFO;break;case"ERROR":h=o.LogVerbosity.ERROR;break;case"NONE":h=o.LogVerbosity.NONE}let d=()=>c;t.getLogger=d;let p=e=>{c=e};t.setLogger=p;let f=e=>{h=e};t.setLoggerVerbosity=f;let m=(e,...t)=>{let r;if(e>=h){switch(e){case o.LogVerbosity.DEBUG:r=c.debug;break;case o.LogVerbosity.INFO:r=c.info;break;case o.LogVerbosity.ERROR:r=c.error}r||(r=c.error),r&&r.bind(c)(...t)}};t.log=m;let g=null!==(a=null!==(s=process.env.GRPC_NODE_TRACE)&&void 0!==s?s:process.env.GRPC_TRACE)&&void 0!==a?a:"",y=new Set,v=new Set;for(let e of g.split(","))e.startsWith("-")?v.add(e.substring(1)):y.add(e);let b=y.has("all");function T(e,r,n){S(r)&&(0,t.log)(e,new Date().toISOString()+" | v"+u+" "+l.pid+" | "+r+" | "+n)}function S(e){return!v.has(e)&&(b||y.has(e))}t.trace=T,t.isTracerEnabled=S},4529:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.loadPackageDefinition=t.makeClientConstructor=void 0;let n=r(1865),i={unary:n.Client.prototype.makeUnaryRequest,server_stream:n.Client.prototype.makeServerStreamRequest,client_stream:n.Client.prototype.makeClientStreamRequest,bidi:n.Client.prototype.makeBidiStreamRequest};function s(e){return["__proto__","prototype","constructor"].includes(e)}function a(e,t,r){r||(r={});class a extends n.Client{}return Object.keys(e).forEach(t=>{let r;if(s(t))return;let n=e[t];if("string"==typeof t&&"$"===t.charAt(0))throw Error("Method names cannot start with $");r=n.requestStream?n.responseStream?"bidi":"client_stream":n.responseStream?"server_stream":"unary";let l=n.requestSerialize,u=n.responseDeserialize,c=o(i[r],n.path,l,u);a.prototype[t]=c,Object.assign(a.prototype[t],n),n.originalName&&!s(n.originalName)&&(a.prototype[n.originalName]=a.prototype[t])}),a.service=e,a.serviceName=t,a}function o(e,t,r,n){return function(...i){return e.call(this,t,r,n,...i)}}function l(e){return"format"in e}function u(e){let t={};for(let r in e)if(Object.prototype.hasOwnProperty.call(e,r)){let n=e[r],i=r.split(".");if(i.some(e=>s(e)))continue;let o=i[i.length-1],u=t;for(let e of i.slice(0,-1))u[e]||(u[e]={}),u=u[e];l(n)?u[o]=n:u[o]=a(n,o,{})}return t}t.makeClientConstructor=a,t.loadPackageDefinition=u},6281:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Metadata=void 0;let n=r(5792),i=r(9572),s=r(6027),a=/^[0-9a-z_.-]+$/,o=/^[ -~]*$/;function l(e){return a.test(e)}function u(e){return o.test(e)}function c(e){return e.endsWith("-bin")}function h(e){return!e.startsWith("grpc-")}function d(e){return e.toLowerCase()}function p(e,t){if(!l(e))throw Error('Metadata key "'+e+'" contains illegal characters');if(null!=t){if(c(e)){if(!Buffer.isBuffer(t))throw Error("keys that end with '-bin' must have Buffer values")}else{if(Buffer.isBuffer(t))throw Error("keys that don't end with '-bin' must have String values");if(!u(t))throw Error('Metadata string value "'+t+'" contains illegal characters')}}}class f{constructor(e={}){this.internalRepr=new Map,this.options=e}set(e,t){p(e=d(e),t),this.internalRepr.set(e,[t])}add(e,t){p(e=d(e),t);let r=this.internalRepr.get(e);void 0===r?this.internalRepr.set(e,[t]):r.push(t)}remove(e){e=d(e),this.internalRepr.delete(e)}get(e){return e=d(e),this.internalRepr.get(e)||[]}getMap(){let e={};for(let[t,r]of this.internalRepr)if(r.length>0){let n=r[0];e[t]=Buffer.isBuffer(n)?Buffer.from(n):n}return e}clone(){let e=new f(this.options),t=e.internalRepr;for(let[e,r]of this.internalRepr){let n=r.map(e=>Buffer.isBuffer(e)?Buffer.from(e):e);t.set(e,n)}return e}merge(e){for(let[t,r]of e.internalRepr){let e=(this.internalRepr.get(t)||[]).concat(r);this.internalRepr.set(t,e)}}setOptions(e){this.options=e}getOptions(){return this.options}toHttp2Headers(){let e={};for(let[t,r]of this.internalRepr)e[t]=r.map(m);return e}toJSON(){let e={};for(let[t,r]of this.internalRepr)e[t]=r;return e}static fromHttp2Headers(e){let t=new f;for(let r of Object.keys(e)){if(":"===r.charAt(0))continue;let a=e[r];try{c(r)?Array.isArray(a)?a.forEach(e=>{t.add(r,Buffer.from(e,"base64"))}):void 0!==a&&(h(r)?a.split(",").forEach(e=>{t.add(r,Buffer.from(e.trim(),"base64"))}):t.add(r,Buffer.from(a,"base64"))):Array.isArray(a)?a.forEach(e=>{t.add(r,e)}):void 0!==a&&t.add(r,a)}catch(t){let e=`Failed to add metadata entry ${r}: ${a}. ${(0,s.getErrorMessage)(t)}. For more information see https://github.com/grpc/grpc-node/issues/1173`;(0,n.log)(i.LogVerbosity.ERROR,e)}}return t}}t.Metadata=f;let m=e=>Buffer.isBuffer(e)?e.toString("base64"):e},2352:(e,t,r)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.QueuePicker=t.UnavailablePicker=t.PickResultType=void 0;let i=r(6281),s=r(9572);!function(e){e[e.COMPLETE=0]="COMPLETE",e[e.QUEUE=1]="QUEUE",e[e.TRANSIENT_FAILURE=2]="TRANSIENT_FAILURE",e[e.DROP=3]="DROP"}(n||(t.PickResultType=n={}));class a{constructor(e){this.status=Object.assign({code:s.Status.UNAVAILABLE,details:"No connection established",metadata:new i.Metadata},e)}pick(e){return{pickResultType:n.TRANSIENT_FAILURE,subchannel:null,status:this.status,onCallStarted:null,onCallEnded:null}}}t.UnavailablePicker=a;class o{constructor(e){this.loadBalancer=e,this.calledExitIdle=!1}pick(e){return this.calledExitIdle||(process.nextTick(()=>{this.loadBalancer.exitIdle()}),this.calledExitIdle=!0),{pickResultType:n.QUEUE,subchannel:null,status:null,onCallStarted:null,onCallEnded:null}}}t.QueuePicker=o},8501:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setup=t.DEFAULT_PORT=void 0;let n=r(4063),i=r(665),s=r(1764),a=r(4298),o=r(9572),l=r(6281),u=r(5792),c=r(9572),h=r(5773),d=r(8216),p=r(1742),f="dns_resolver";function m(e){u.trace(c.LogVerbosity.DEBUG,f,e)}t.DEFAULT_PORT=443;let g=3e4,y=s.promisify(i.resolveTxt),v=s.promisify(i.lookup);function b(...e){let t=[];for(let r=0;r<Math.max.apply(null,e.map(e=>e.length));r++)for(let n of e)r<n.length&&t.push(n[r]);return t}class T{constructor(e,r,n){var i,s,a;this.target=e,this.listener=r,this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.continueResolving=!1,this.isNextResolutionTimerRunning=!1,this.isServiceConfigEnabled=!0,this.returnedIpResult=!1,m("Resolver constructed for target "+(0,h.uriToString)(e));let u=(0,h.splitHostPort)(e.path);null===u?(this.ipResult=null,this.dnsHostname=null,this.port=null):(0,d.isIPv4)(u.host)||(0,d.isIPv6)(u.host)?(this.ipResult=[{host:u.host,port:null!==(i=u.port)&&void 0!==i?i:t.DEFAULT_PORT}],this.dnsHostname=null,this.port=null):(this.ipResult=null,this.dnsHostname=u.host,this.port=null!==(s=u.port)&&void 0!==s?s:t.DEFAULT_PORT),this.percentage=100*Math.random(),1===n["grpc.service_config_disable_resolution"]&&(this.isServiceConfigEnabled=!1),this.defaultResolutionError={code:o.Status.UNAVAILABLE,details:`Name resolution failed for target ${(0,h.uriToString)(this.target)}`,metadata:new l.Metadata};let c={initialDelay:n["grpc.initial_reconnect_backoff_ms"],maxDelay:n["grpc.max_reconnect_backoff_ms"]};this.backoff=new p.BackoffTimeout(()=>{this.continueResolving&&this.startResolutionWithBackoff()},c),this.backoff.unref(),this.minTimeBetweenResolutionsMs=null!==(a=n["grpc.dns_min_time_between_resolutions_ms"])&&void 0!==a?a:g,this.nextResolutionTimer=setTimeout(()=>{},0),clearTimeout(this.nextResolutionTimer)}startResolution(){if(null!==this.ipResult){this.returnedIpResult||(m("Returning IP address for target "+(0,h.uriToString)(this.target)),setImmediate(()=>{this.listener.onSuccessfulResolution(this.ipResult,null,null,null,{})}),this.returnedIpResult=!0),this.backoff.stop(),this.backoff.reset(),this.stopNextResolutionTimer();return}if(null===this.dnsHostname)m("Failed to parse DNS address "+(0,h.uriToString)(this.target)),setImmediate(()=>{this.listener.onError({code:o.Status.UNAVAILABLE,details:`Failed to parse DNS address ${(0,h.uriToString)(this.target)}`,metadata:new l.Metadata})}),this.stopNextResolutionTimer();else{if(null!==this.pendingLookupPromise)return;m("Looking up DNS hostname "+this.dnsHostname),this.latestLookupResult=null;let e=this.dnsHostname;this.pendingLookupPromise=v(e,{all:!0}),this.pendingLookupPromise.then(e=>{if(null===this.pendingLookupPromise)return;this.pendingLookupPromise=null,this.backoff.reset(),this.backoff.stop();let t=e.filter(e=>4===e.family),r=e.filter(e=>6===e.family);this.latestLookupResult=b(r,t).map(e=>({host:e.address,port:+this.port}));let n="["+this.latestLookupResult.map(e=>e.host+":"+e.port).join(",")+"]";if(m("Resolved addresses for target "+(0,h.uriToString)(this.target)+": "+n),0===this.latestLookupResult.length){this.listener.onError(this.defaultResolutionError);return}this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})},e=>{null!==this.pendingLookupPromise&&(m("Resolution error for target "+(0,h.uriToString)(this.target)+": "+e.message),this.pendingLookupPromise=null,this.stopNextResolutionTimer(),this.listener.onError(this.defaultResolutionError))}),this.isServiceConfigEnabled&&null===this.pendingTxtPromise&&(this.pendingTxtPromise=y(e),this.pendingTxtPromise.then(e=>{if(null!==this.pendingTxtPromise){this.pendingTxtPromise=null;try{this.latestServiceConfig=(0,a.extractAndSelectServiceConfig)(e,this.percentage)}catch(e){this.latestServiceConfigError={code:o.Status.UNAVAILABLE,details:`Parsing service config failed with error ${e.message}`,metadata:new l.Metadata}}null!==this.latestLookupResult&&this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})}},e=>{}))}}startNextResolutionTimer(){var e,t;clearTimeout(this.nextResolutionTimer),this.nextResolutionTimer=null===(t=(e=setTimeout(()=>{this.stopNextResolutionTimer(),this.continueResolving&&this.startResolutionWithBackoff()},this.minTimeBetweenResolutionsMs)).unref)||void 0===t?void 0:t.call(e),this.isNextResolutionTimerRunning=!0}stopNextResolutionTimer(){clearTimeout(this.nextResolutionTimer),this.isNextResolutionTimerRunning=!1}startResolutionWithBackoff(){null===this.pendingLookupPromise&&(this.continueResolving=!1,this.backoff.runOnce(),this.startNextResolutionTimer(),this.startResolution())}updateResolution(){null===this.pendingLookupPromise&&(this.isNextResolutionTimerRunning||this.backoff.isRunning()?(this.isNextResolutionTimerRunning?m('resolution update delayed by "min time between resolutions" rate limit'):m("resolution update delayed by backoff timer until "+this.backoff.getEndTime().toISOString()),this.continueResolving=!0):this.startResolutionWithBackoff())}destroy(){this.continueResolving=!1,this.backoff.reset(),this.backoff.stop(),this.stopNextResolutionTimer(),this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.returnedIpResult=!1}static getDefaultAuthority(e){return e.path}}function S(){(0,n.registerResolver)("dns",T),(0,n.registerDefaultScheme)("dns")}t.setup=S},3988:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setup=void 0;let n=r(8216),i=r(9572),s=r(6281),a=r(4063),o=r(5773),l=r(5792),u="ip_resolver";function c(e){l.trace(i.LogVerbosity.DEBUG,u,e)}let h="ipv4",d="ipv6",p=443;class f{constructor(e,t,r){var a;this.listener=t,this.addresses=[],this.error=null,this.hasReturnedResult=!1,c("Resolver constructed for target "+(0,o.uriToString)(e));let l=[];if(!(e.scheme===h||e.scheme===d)){this.error={code:i.Status.UNAVAILABLE,details:`Unrecognized scheme ${e.scheme} in IP resolver`,metadata:new s.Metadata};return}for(let t of e.path.split(",")){let r=(0,o.splitHostPort)(t);if(null===r||e.scheme===h&&!(0,n.isIPv4)(r.host)||e.scheme===d&&!(0,n.isIPv6)(r.host)){this.error={code:i.Status.UNAVAILABLE,details:`Failed to parse ${e.scheme} address ${t}`,metadata:new s.Metadata};return}l.push({host:r.host,port:null!==(a=r.port)&&void 0!==a?a:p})}this.addresses=l,c("Parsed "+e.scheme+" address list "+this.addresses)}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(()=>{this.error?this.listener.onError(this.error):this.listener.onSuccessfulResolution(this.addresses,null,null,null,{})}))}destroy(){this.hasReturnedResult=!1}static getDefaultAuthority(e){return e.path.split(",")[0]}}function m(){(0,a.registerResolver)(h,f),(0,a.registerResolver)(d,f)}t.setup=m},7255:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setup=void 0;let n=r(4063);class i{constructor(e,t,r){let n;this.listener=t,this.addresses=[],this.hasReturnedResult=!1,n=""===e.authority?"/"+e.path:e.path,this.addresses=[{path:n}]}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(this.listener.onSuccessfulResolution,this.addresses,null,null,null,{}))}destroy(){}static getDefaultAuthority(e){return"localhost"}}function s(){(0,n.registerResolver)("unix",i)}t.setup=s},4063:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mapUriDefaultScheme=t.getDefaultAuthority=t.createResolver=t.registerDefaultScheme=t.registerResolver=void 0;let n=r(5773),i={},s=null;function a(e,t){i[e]=t}function o(e){s=e}function l(e,t,r){if(void 0!==e.scheme&&e.scheme in i)return new i[e.scheme](e,t,r);throw Error(`No resolver could be created for target ${(0,n.uriToString)(e)}`)}function u(e){if(void 0!==e.scheme&&e.scheme in i)return i[e.scheme].getDefaultAuthority(e);throw Error(`Invalid target ${(0,n.uriToString)(e)}`)}function c(e){return void 0!==e.scheme&&e.scheme in i?e:null!==s?{scheme:s,authority:void 0,path:(0,n.uriToString)(e)}:null}t.registerResolver=a,t.registerDefaultScheme=o,t.createResolver=l,t.getDefaultAuthority=u,t.mapUriDefaultScheme=c},80:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ResolvingCall=void 0;let n=r(9572),i=r(4771),s=r(6281),a=r(5792),o=r(5607),l="resolving_call";class u{constructor(e,t,r,s,a,o){this.channel=e,this.method=t,this.filterStackFactory=s,this.credentials=a,this.callNumber=o,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.readFilterPending=!1,this.writeFilterPending=!1,this.pendingChildStatus=null,this.metadata=null,this.listener=null,this.statusWatchers=[],this.deadlineTimer=setTimeout(()=>{},0),this.filterStack=null,this.deadline=r.deadline,this.host=r.host,r.parentCall&&(r.flags&n.Propagate.CANCELLATION&&r.parentCall.on("cancelled",()=>{this.cancelWithStatus(n.Status.CANCELLED,"Cancelled by parent call")}),r.flags&n.Propagate.DEADLINE&&(this.trace("Propagating deadline from parent: "+r.parentCall.getDeadline()),this.deadline=(0,i.minDeadline)(this.deadline,r.parentCall.getDeadline()))),this.trace("Created"),this.runDeadlineTimer()}trace(e){a.trace(n.LogVerbosity.DEBUG,l,"["+this.callNumber+"] "+e)}runDeadlineTimer(){clearTimeout(this.deadlineTimer),this.trace("Deadline: "+(0,i.deadlineToString)(this.deadline));let e=(0,i.getRelativeTimeout)(this.deadline);if(e!==1/0){this.trace("Deadline will be reached in "+e+"ms");let t=()=>{this.cancelWithStatus(n.Status.DEADLINE_EXCEEDED,"Deadline exceeded")};e<=0?process.nextTick(t):this.deadlineTimer=setTimeout(t,e)}}outputStatus(e){if(!this.ended){this.ended=!0,this.filterStack||(this.filterStack=this.filterStackFactory.createFilter()),clearTimeout(this.deadlineTimer);let t=this.filterStack.receiveTrailers(e);this.trace("ended with status: code="+t.code+' details="'+t.details+'"'),this.statusWatchers.forEach(e=>e(t)),process.nextTick(()=>{var e;null===(e=this.listener)||void 0===e||e.onReceiveStatus(t)})}}sendMessageOnChild(e,t){if(!this.child)throw Error("sendMessageonChild called with child not populated");let r=this.child;this.writeFilterPending=!0,this.filterStack.sendMessage(Promise.resolve({message:t,flags:e.flags})).then(t=>{this.writeFilterPending=!1,r.sendMessageWithContext(e,t.message),this.pendingHalfClose&&r.halfClose()},e=>{this.cancelWithStatus(e.code,e.details)})}getConfig(){if(this.ended)return;if(!this.metadata||!this.listener)throw Error("getConfig called before start");let e=this.channel.getConfig(this.method,this.metadata);if("NONE"===e.type){this.channel.queueCallForConfig(this);return}if("ERROR"===e.type){this.metadata.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(e.error);return}let t=e.config;if(t.status!==n.Status.OK){let{code:e,details:r}=(0,o.restrictControlPlaneStatusCode)(t.status,"Failed to route call to method "+this.method);this.outputStatus({code:e,details:r,metadata:new s.Metadata});return}if(t.methodConfig.timeout){let e=new Date;e.setSeconds(e.getSeconds()+t.methodConfig.timeout.seconds),e.setMilliseconds(e.getMilliseconds()+t.methodConfig.timeout.nanos/1e6),this.deadline=(0,i.minDeadline)(this.deadline,e),this.runDeadlineTimer()}this.filterStackFactory.push(t.dynamicFilterFactories),this.filterStack=this.filterStackFactory.createFilter(),this.filterStack.sendMetadata(Promise.resolve(this.metadata)).then(e=>{this.child=this.channel.createInnerCall(t,this.method,this.host,this.credentials,this.deadline),this.trace("Created child ["+this.child.getCallNumber()+"]"),this.child.start(e,{onReceiveMetadata:e=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(this.filterStack.receiveMetadata(e))},onReceiveMessage:e=>{this.trace("Received message"),this.readFilterPending=!0,this.filterStack.receiveMessage(e).then(e=>{this.trace("Finished filtering received message"),this.readFilterPending=!1,this.listener.onReceiveMessage(e),this.pendingChildStatus&&this.outputStatus(this.pendingChildStatus)},e=>{this.cancelWithStatus(e.code,e.details)})},onReceiveStatus:e=>{this.trace("Received status"),this.readFilterPending?this.pendingChildStatus=e:this.outputStatus(e)}}),this.readPending&&this.child.startRead(),this.pendingMessage?this.sendMessageOnChild(this.pendingMessage.context,this.pendingMessage.message):this.pendingHalfClose&&this.child.halfClose()},e=>{this.outputStatus(e)})}reportResolverError(e){var t;(null===(t=this.metadata)||void 0===t?void 0:t.getOptions().waitForReady)?this.channel.queueCallForConfig(this):this.outputStatus(e)}cancelWithStatus(e,t){var r;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),null===(r=this.child)||void 0===r||r.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new s.Metadata})}getPeer(){var e,t;return null!==(t=null===(e=this.child)||void 0===e?void 0:e.getPeer())&&void 0!==t?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.metadata=e.clone(),this.listener=t,this.getConfig()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.sendMessageOnChild(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child&&!this.writeFilterPending?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){this.credentials=this.credentials.compose(e)}addStatusWatcher(e){this.statusWatchers.push(e)}getCallNumber(){return this.callNumber}}t.ResolvingCall=u},7661:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ResolvingLoadBalancer=void 0;let n=r(9884),i=r(4298),s=r(2409),a=r(4063),o=r(2352),l=r(1742),u=r(9572),c=r(6281),h=r(5792),d=r(9572),p=r(5773),f=r(6372),m="resolving_load_balancer";function g(e){h.trace(d.LogVerbosity.DEBUG,m,e)}let y=["SERVICE_AND_METHOD","SERVICE","EMPTY"];function v(e,t,r,n){for(let i of r.name)switch(n){case"EMPTY":if(!i.service&&!i.method)return!0;break;case"SERVICE":if(i.service===e&&!i.method)return!0;break;case"SERVICE_AND_METHOD":if(i.service===e&&i.method===t)return!0}return!1}function b(e,t,r,n){for(let i of r)if(v(e,t,i,n))return i;return null}function T(e){return function(t,r){var n,i;let s=t.split("/").filter(e=>e.length>0),a=null!==(n=s[0])&&void 0!==n?n:"",o=null!==(i=s[1])&&void 0!==i?i:"";if(e&&e.methodConfig)for(let t of y){let r=b(a,o,e.methodConfig,t);if(r)return{methodConfig:r,pickInformation:{},status:u.Status.OK,dynamicFilterFactories:[]}}return{methodConfig:{name:[]},pickInformation:{},status:u.Status.OK,dynamicFilterFactories:[]}}}class S{constructor(e,t,r,h,d){this.target=e,this.channelControlHelper=t,this.onSuccessfulResolution=h,this.onFailedResolution=d,this.latestChildState=s.ConnectivityState.IDLE,this.latestChildPicker=new o.QueuePicker(this),this.currentState=s.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1,r["grpc.service_config"]?this.defaultServiceConfig=(0,i.validateServiceConfig)(JSON.parse(r["grpc.service_config"])):this.defaultServiceConfig={loadBalancingConfig:[],methodConfig:[]},this.updateState(s.ConnectivityState.IDLE,new o.QueuePicker(this)),this.childLoadBalancer=new f.ChildLoadBalancerHandler({createSubchannel:t.createSubchannel.bind(t),requestReresolution:()=>{this.backoffTimeout.isRunning()?(g("requestReresolution delayed by backoff timer until "+this.backoffTimeout.getEndTime().toISOString()),this.continueResolving=!0):this.updateResolution()},updateState:(e,t)=>{this.latestChildState=e,this.latestChildPicker=t,this.updateState(e,t)},addChannelzChild:t.addChannelzChild.bind(t),removeChannelzChild:t.removeChannelzChild.bind(t)}),this.innerResolver=(0,a.createResolver)(e,{onSuccessfulResolution:(e,t,r,i,s)=>{var a;this.backoffTimeout.stop(),this.backoffTimeout.reset();let o=null;null===t?null===r?(this.previousServiceConfig=null,o=this.defaultServiceConfig):null===this.previousServiceConfig?this.handleResolutionFailure(r):o=this.previousServiceConfig:(o=t,this.previousServiceConfig=t);let l=null!==(a=null==o?void 0:o.loadBalancingConfig)&&void 0!==a?a:[],h=(0,n.getFirstUsableConfig)(l,!0);if(null===h){this.handleResolutionFailure({code:u.Status.UNAVAILABLE,details:"All load balancer options in service config are not compatible",metadata:new c.Metadata});return}this.childLoadBalancer.updateAddressList(e,h,s);let d=null!=o?o:this.defaultServiceConfig;this.onSuccessfulResolution(d,null!=i?i:T(d))},onError:e=>{this.handleResolutionFailure(e)}},r);let p={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new l.BackoffTimeout(()=>{this.continueResolving?(this.updateResolution(),this.continueResolving=!1):this.updateState(this.latestChildState,this.latestChildPicker)},p),this.backoffTimeout.unref()}updateResolution(){this.innerResolver.updateResolution(),this.currentState===s.ConnectivityState.IDLE&&this.updateState(s.ConnectivityState.CONNECTING,new o.QueuePicker(this)),this.backoffTimeout.runOnce()}updateState(e,t){g((0,p.uriToString)(this.target)+" "+s.ConnectivityState[this.currentState]+" -> "+s.ConnectivityState[e]),e===s.ConnectivityState.IDLE&&(t=new o.QueuePicker(this)),this.currentState=e,this.channelControlHelper.updateState(e,t)}handleResolutionFailure(e){this.latestChildState===s.ConnectivityState.IDLE&&(this.updateState(s.ConnectivityState.TRANSIENT_FAILURE,new o.UnavailablePicker(e)),this.onFailedResolution(e))}exitIdle(){(this.currentState===s.ConnectivityState.IDLE||this.currentState===s.ConnectivityState.TRANSIENT_FAILURE)&&(this.backoffTimeout.isRunning()?this.continueResolving=!0:this.updateResolution()),this.childLoadBalancer.exitIdle()}updateAddressList(e,t){throw Error("updateAddressList not supported on ResolvingLoadBalancer")}resetBackoff(){this.backoffTimeout.reset(),this.childLoadBalancer.resetBackoff()}destroy(){this.childLoadBalancer.destroy(),this.innerResolver.destroy(),this.backoffTimeout.reset(),this.backoffTimeout.stop(),this.latestChildState=s.ConnectivityState.IDLE,this.latestChildPicker=new o.QueuePicker(this),this.currentState=s.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1}getTypeName(){return"resolving_load_balancer"}}t.ResolvingLoadBalancer=S},5627:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RetryingCall=t.MessageBufferTracker=t.RetryThrottler=void 0;let n=r(9572),i=r(6281),s=r(5792),a="retrying_call";class o{constructor(e,t,r){this.maxTokens=e,this.tokenRatio=t,r?this.tokens=r.tokens*(e/r.maxTokens):this.tokens=e}addCallSucceeded(){this.tokens=Math.max(this.tokens+this.tokenRatio,this.maxTokens)}addCallFailed(){this.tokens=Math.min(this.tokens-1,0)}canRetryCall(){return this.tokens>this.maxTokens/2}}t.RetryThrottler=o;class l{constructor(e,t){this.totalLimit=e,this.limitPerCall=t,this.totalAllocated=0,this.allocatedPerCall=new Map}allocate(e,t){var r;let n=null!==(r=this.allocatedPerCall.get(t))&&void 0!==r?r:0;return!(this.limitPerCall-n<e)&&!(this.totalLimit-this.totalAllocated<e)&&(this.allocatedPerCall.set(t,n+e),this.totalAllocated+=e,!0)}free(e,t){var r;if(this.totalAllocated<e)throw Error(`Invalid buffer allocation state: call ${t} freed ${e} > total allocated ${this.totalAllocated}`);this.totalAllocated-=e;let n=null!==(r=this.allocatedPerCall.get(t))&&void 0!==r?r:0;if(n<e)throw Error(`Invalid buffer allocation state: call ${t} freed ${e} > allocated for call ${n}`);this.allocatedPerCall.set(t,n-e)}freeAll(e){var t;let r=null!==(t=this.allocatedPerCall.get(e))&&void 0!==t?t:0;if(this.totalAllocated<r)throw Error(`Invalid buffer allocation state: call ${e} allocated ${r} > total allocated ${this.totalAllocated}`);this.totalAllocated-=r,this.allocatedPerCall.delete(e)}}t.MessageBufferTracker=l;let u="grpc-previous-rpc-attempts";class c{constructor(e,t,r,n,i,s,a,o,l){if(this.channel=e,this.callConfig=t,this.methodName=r,this.host=n,this.credentials=i,this.deadline=s,this.callNumber=a,this.bufferTracker=o,this.retryThrottler=l,this.listener=null,this.initialMetadata=null,this.underlyingCalls=[],this.writeBuffer=[],this.writeBufferOffset=0,this.readStarted=!1,this.transparentRetryUsed=!1,this.attempts=0,this.hedgingTimer=null,this.committedCallIndex=null,this.initialRetryBackoffSec=0,this.nextRetryBackoffSec=0,t.methodConfig.retryPolicy){this.state="RETRY";let e=t.methodConfig.retryPolicy;this.nextRetryBackoffSec=this.initialRetryBackoffSec=Number(e.initialBackoff.substring(0,e.initialBackoff.length-1))}else t.methodConfig.hedgingPolicy?this.state="HEDGING":this.state="TRANSPARENT_ONLY"}getCallNumber(){return this.callNumber}trace(e){s.trace(n.LogVerbosity.DEBUG,a,"["+this.callNumber+"] "+e)}reportStatus(e){this.trace("ended with status: code="+e.code+' details="'+e.details+'"'),this.bufferTracker.freeAll(this.callNumber),this.writeBufferOffset=this.writeBufferOffset+this.writeBuffer.length,this.writeBuffer=[],process.nextTick(()=>{var t;null===(t=this.listener)||void 0===t||t.onReceiveStatus({code:e.code,details:e.details,metadata:e.metadata})})}cancelWithStatus(e,t){for(let{call:r}of(this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.reportStatus({code:e,details:t,metadata:new i.Metadata}),this.underlyingCalls))r.cancelWithStatus(e,t)}getPeer(){return null!==this.committedCallIndex?this.underlyingCalls[this.committedCallIndex].call.getPeer():"unknown"}getBufferEntry(e){var t;return null!==(t=this.writeBuffer[e-this.writeBufferOffset])&&void 0!==t?t:{entryType:"FREED",allocated:!1}}getNextBufferIndex(){return this.writeBufferOffset+this.writeBuffer.length}clearSentMessages(){if("COMMITTED"!==this.state)return;let e=this.underlyingCalls[this.committedCallIndex].nextMessageToSend;for(let t=this.writeBufferOffset;t<e;t++){let e=this.getBufferEntry(t);e.allocated&&this.bufferTracker.free(e.message.message.length,this.callNumber)}this.writeBuffer=this.writeBuffer.slice(e-this.writeBufferOffset),this.writeBufferOffset=e}commitCall(e){if("COMMITTED"!==this.state&&"COMPLETED"!==this.underlyingCalls[e].state){this.trace("Committing call ["+this.underlyingCalls[e].call.getCallNumber()+"] at index "+e),this.state="COMMITTED",this.committedCallIndex=e;for(let t=0;t<this.underlyingCalls.length;t++)t!==e&&"COMPLETED"!==this.underlyingCalls[t].state&&(this.underlyingCalls[t].state="COMPLETED",this.underlyingCalls[t].call.cancelWithStatus(n.Status.CANCELLED,"Discarded in favor of other hedged attempt"));this.clearSentMessages()}}commitCallWithMostMessages(){if("COMMITTED"===this.state)return;let e=-1,t=-1;for(let[r,n]of this.underlyingCalls.entries())"ACTIVE"===n.state&&n.nextMessageToSend>e&&(e=n.nextMessageToSend,t=r);-1===t?this.state="TRANSPARENT_ONLY":this.commitCall(t)}isStatusCodeInList(e,t){return e.some(e=>e===t||e.toString().toLowerCase()===n.Status[t].toLowerCase())}getNextRetryBackoffMs(){var e;let t=null===(e=this.callConfig)||void 0===e?void 0:e.methodConfig.retryPolicy;if(!t)return 0;let r=Math.random()*this.nextRetryBackoffSec*1e3,n=Number(t.maxBackoff.substring(0,t.maxBackoff.length-1));return this.nextRetryBackoffSec=Math.min(this.nextRetryBackoffSec*t.backoffMultiplier,n),r}maybeRetryCall(e,t){let r;if("RETRY"!==this.state){t(!1);return}let n=this.callConfig.methodConfig.retryPolicy;if(this.attempts>=Math.min(n.maxAttempts,5)){t(!1);return}if(null===e)r=this.getNextRetryBackoffMs();else if(e<0){this.state="TRANSPARENT_ONLY",t(!1);return}else r=e,this.nextRetryBackoffSec=this.initialRetryBackoffSec;setTimeout(()=>{var e,r;if("RETRY"!==this.state){t(!1);return}(null===(r=null===(e=this.retryThrottler)||void 0===e?void 0:e.canRetryCall())||void 0===r||r)&&(t(!0),this.attempts+=1,this.startNewAttempt())},r)}countActiveCalls(){let e=0;for(let t of this.underlyingCalls)(null==t?void 0:t.state)==="ACTIVE"&&(e+=1);return e}handleProcessedStatus(e,t,r){var n,i,s;switch(this.state){case"COMMITTED":case"TRANSPARENT_ONLY":this.commitCall(t),this.reportStatus(e);break;case"HEDGING":if(this.isStatusCodeInList(null!==(n=this.callConfig.methodConfig.hedgingPolicy.nonFatalStatusCodes)&&void 0!==n?n:[],e.code)){let n;if(null===(i=this.retryThrottler)||void 0===i||i.addCallFailed(),null===r)n=0;else if(r<0){this.state="TRANSPARENT_ONLY",this.commitCall(t),this.reportStatus(e);return}else n=r;setTimeout(()=>{this.maybeStartHedgingAttempt(),0===this.countActiveCalls()&&(this.commitCall(t),this.reportStatus(e))},n)}else this.commitCall(t),this.reportStatus(e);break;case"RETRY":this.isStatusCodeInList(this.callConfig.methodConfig.retryPolicy.retryableStatusCodes,e.code)?(null===(s=this.retryThrottler)||void 0===s||s.addCallFailed(),this.maybeRetryCall(r,r=>{r||(this.commitCall(t),this.reportStatus(e))})):(this.commitCall(t),this.reportStatus(e))}}getPushback(e){let t=e.get("grpc-retry-pushback-ms");if(0===t.length)return null;try{return parseInt(t[0])}catch(e){return -1}}handleChildStatus(e,t){var r;if("COMPLETED"===this.underlyingCalls[t].state)return;if(this.trace("state="+this.state+" handling status with progress "+e.progress+" from child ["+this.underlyingCalls[t].call.getCallNumber()+"] in state "+this.underlyingCalls[t].state),this.underlyingCalls[t].state="COMPLETED",e.code===n.Status.OK){null===(r=this.retryThrottler)||void 0===r||r.addCallSucceeded(),this.commitCall(t),this.reportStatus(e);return}if("COMMITTED"===this.state){this.reportStatus(e);return}let i=this.getPushback(e.metadata);switch(e.progress){case"NOT_STARTED":this.startNewAttempt();break;case"REFUSED":this.transparentRetryUsed?this.handleProcessedStatus(e,t,i):(this.transparentRetryUsed=!0,this.startNewAttempt());break;case"DROP":this.commitCall(t),this.reportStatus(e);break;case"PROCESSED":this.handleProcessedStatus(e,t,i)}}maybeStartHedgingAttempt(){if("HEDGING"!==this.state||!this.callConfig.methodConfig.hedgingPolicy)return;let e=this.callConfig.methodConfig.hedgingPolicy;this.attempts>=Math.min(e.maxAttempts,5)||(this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer())}maybeStartHedgingTimer(){var e,t,r;if(this.hedgingTimer&&clearTimeout(this.hedgingTimer),"HEDGING"!==this.state||!this.callConfig.methodConfig.hedgingPolicy)return;let n=this.callConfig.methodConfig.hedgingPolicy;if(this.attempts>=Math.min(n.maxAttempts,5))return;let i=null!==(e=n.hedgingDelay)&&void 0!==e?e:"0s",s=Number(i.substring(0,i.length-1));this.hedgingTimer=setTimeout(()=>{this.maybeStartHedgingAttempt()},1e3*s),null===(r=(t=this.hedgingTimer).unref)||void 0===r||r.call(t)}startNewAttempt(){let e=this.channel.createLoadBalancingCall(this.callConfig,this.methodName,this.host,this.credentials,this.deadline);this.trace("Created child call ["+e.getCallNumber()+"] for attempt "+this.attempts);let t=this.underlyingCalls.length;this.underlyingCalls.push({state:"ACTIVE",call:e,nextMessageToSend:0});let r=this.attempts-1,n=this.initialMetadata.clone();r>0&&n.set(u,`${r}`);let i=!1;e.start(n,{onReceiveMetadata:n=>{this.trace("Received metadata from child ["+e.getCallNumber()+"]"),this.commitCall(t),i=!0,r>0&&n.set(u,`${r}`),"ACTIVE"===this.underlyingCalls[t].state&&this.listener.onReceiveMetadata(n)},onReceiveMessage:r=>{this.trace("Received message from child ["+e.getCallNumber()+"]"),this.commitCall(t),"ACTIVE"===this.underlyingCalls[t].state&&this.listener.onReceiveMessage(r)},onReceiveStatus:n=>{this.trace("Received status from child ["+e.getCallNumber()+"]"),!i&&r>0&&n.metadata.set(u,`${r}`),this.handleChildStatus(n,t)}}),this.sendNextChildMessage(t),this.readStarted&&e.startRead()}start(e,t){this.trace("start called"),this.listener=t,this.initialMetadata=e,this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer()}handleChildWriteCompleted(e){var t,r;let n=this.underlyingCalls[e],i=n.nextMessageToSend;null===(r=(t=this.getBufferEntry(i)).callback)||void 0===r||r.call(t),this.clearSentMessages(),n.nextMessageToSend+=1,this.sendNextChildMessage(e)}sendNextChildMessage(e){let t=this.underlyingCalls[e];if("COMPLETED"!==t.state&&this.getBufferEntry(t.nextMessageToSend)){let r=this.getBufferEntry(t.nextMessageToSend);switch(r.entryType){case"MESSAGE":t.call.sendMessageWithContext({callback:t=>{this.handleChildWriteCompleted(e)}},r.message.message);break;case"HALF_CLOSE":t.nextMessageToSend+=1,t.call.halfClose()}}}sendMessageWithContext(e,t){var r;this.trace("write() called with message of length "+t.length);let n={message:t,flags:e.flags},i=this.getNextBufferIndex(),s={entryType:"MESSAGE",message:n,allocated:this.bufferTracker.allocate(t.length,this.callNumber)};if(this.writeBuffer.push(s),s.allocated)for(let[n,s]of(null===(r=e.callback)||void 0===r||r.call(e),this.underlyingCalls.entries()))"ACTIVE"===s.state&&s.nextMessageToSend===i&&s.call.sendMessageWithContext({callback:e=>{this.handleChildWriteCompleted(n)}},t);else{if(this.commitCallWithMostMessages(),null===this.committedCallIndex)return;let r=this.underlyingCalls[this.committedCallIndex];s.callback=e.callback,"ACTIVE"===r.state&&r.nextMessageToSend===i&&r.call.sendMessageWithContext({callback:e=>{this.handleChildWriteCompleted(this.committedCallIndex)}},t)}}startRead(){for(let e of(this.trace("startRead called"),this.readStarted=!0,this.underlyingCalls))(null==e?void 0:e.state)==="ACTIVE"&&e.call.startRead()}halfClose(){this.trace("halfClose called");let e=this.getNextBufferIndex();for(let t of(this.writeBuffer.push({entryType:"HALF_CLOSE",allocated:!1}),this.underlyingCalls))(null==t?void 0:t.state)==="ACTIVE"&&t.nextMessageToSend===e&&(t.nextMessageToSend+=1,t.call.halfClose())}setCredentials(e){throw Error("Method not implemented.")}getMethod(){return this.methodName}getHost(){return this.host}}t.RetryingCall=c},2025:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Http2ServerCallStream=t.ServerDuplexStreamImpl=t.ServerWritableStreamImpl=t.ServerReadableStreamImpl=t.ServerUnaryCallImpl=void 0;let n=r(7702),i=r(2694),s=r(6162),a=r(1568),o=r(9572),l=r(6281),u=r(615),c=r(5792),h=r(6027),d="server_call";function p(e){c.trace(o.LogVerbosity.DEBUG,d,e)}let f="grpc-message",m="grpc-status",g="grpc-timeout",y=/(\d{1,8})\s*([HMSmun])/,v={H:36e5,M:6e4,S:1e3,m:1,u:.001,n:1e-6},b={"grpc-accept-encoding":"identity,deflate,gzip","grpc-encoding":"identity"},T={[i.constants.HTTP2_HEADER_STATUS]:i.constants.HTTP_STATUS_OK,[i.constants.HTTP2_HEADER_CONTENT_TYPE]:"application/grpc+proto"},S={waitForTrailers:!0};class E extends n.EventEmitter{constructor(e,t,r){super(),this.call=e,this.metadata=t,this.request=r,this.cancelled=!1,this.call.setupSurfaceCall(this)}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}}t.ServerUnaryCallImpl=E;class w extends s.Readable{constructor(e,t,r,n){super({objectMode:!0}),this.call=e,this.metadata=t,this.deserialize=r,this.cancelled=!1,this.call.setupSurfaceCall(this),this.call.setupReadable(this,n)}_read(e){this.call.consumeUnpushedMessages(this)&&this.call.resume()}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}}t.ServerReadableStreamImpl=w;class C extends s.Writable{constructor(e,t,r,n){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=r,this.request=n,this.cancelled=!1,this.trailingMetadata=new l.Metadata,this.call.setupSurfaceCall(this),this.on("error",e=>{this.call.sendError(e),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}_write(e,t,r){try{let t=this.call.serializeMessage(e);if(!this.call.write(t)){this.call.once("drain",r);return}}catch(e){this.emit("error",{details:(0,h.getErrorMessage)(e),code:o.Status.INTERNAL})}r()}_final(e){this.call.sendStatus({code:o.Status.OK,details:"OK",metadata:this.trailingMetadata}),e(null)}end(e){return e&&(this.trailingMetadata=e),super.end()}}t.ServerWritableStreamImpl=C;class _ extends s.Duplex{constructor(e,t,r,n,i){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=r,this.deserialize=n,this.cancelled=!1,this.trailingMetadata=new l.Metadata,this.call.setupSurfaceCall(this),this.call.setupReadable(this,i),this.on("error",e=>{this.call.sendError(e),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}end(e){return e&&(this.trailingMetadata=e),super.end()}}t.ServerDuplexStreamImpl=_,_.prototype._read=w.prototype._read,_.prototype._write=C.prototype._write,_.prototype._final=C.prototype._final;class I extends n.EventEmitter{constructor(e,t,r){super(),this.stream=e,this.handler=t,this.cancelled=!1,this.deadlineTimer=null,this.statusSent=!1,this.deadline=1/0,this.wantTrailers=!1,this.metadataSent=!1,this.canPush=!1,this.isPushPending=!1,this.bufferedMessages=[],this.messagesToPush=[],this.maxSendMessageSize=o.DEFAULT_MAX_SEND_MESSAGE_LENGTH,this.maxReceiveMessageSize=o.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,this.stream.once("error",e=>{}),this.stream.once("close",()=>{var e;p("Request to method "+(null===(e=this.handler)||void 0===e?void 0:e.path)+" stream closed with rstCode "+this.stream.rstCode),!this.statusSent&&(this.cancelled=!0,this.emit("cancelled","cancelled"),this.emit("streamEnd",!1),this.sendStatus({code:o.Status.CANCELLED,details:"Cancelled by client",metadata:null}),this.deadlineTimer&&clearTimeout(this.deadlineTimer))}),this.stream.on("drain",()=>{this.emit("drain")}),"grpc.max_send_message_length"in r&&(this.maxSendMessageSize=r["grpc.max_send_message_length"]),"grpc.max_receive_message_length"in r&&(this.maxReceiveMessageSize=r["grpc.max_receive_message_length"])}checkCancelled(){return(this.stream.destroyed||this.stream.closed)&&(this.cancelled=!0),this.cancelled}getDecompressedMessage(e,t){let r=e.subarray(5);if("identity"===t)return r;if("deflate"!==t&&"gzip"!==t)return Promise.reject({code:o.Status.UNIMPLEMENTED,details:`Received message compressed with unsupported encoding "${t}"`});{let e;return e="deflate"===t?a.createInflate():a.createGunzip(),new Promise((t,n)=>{let i=0,s=[];e.on("data",t=>{s.push(t),i+=t.byteLength,-1!==this.maxReceiveMessageSize&&i>this.maxReceiveMessageSize&&(e.destroy(),n({code:o.Status.RESOURCE_EXHAUSTED,details:`Received message that decompresses to a size larger than ${this.maxReceiveMessageSize}`}))}),e.on("end",()=>{t(Buffer.concat(s))}),e.write(r),e.end()})}}sendMetadata(e){if(this.checkCancelled()||this.metadataSent)return;this.metadataSent=!0;let t=e?e.toHttp2Headers():null,r=Object.assign(Object.assign(Object.assign({},T),b),t);this.stream.respond(r,S)}receiveMetadata(e){let t=l.Metadata.fromHttp2Headers(e);c.isTracerEnabled(d)&&p("Request to "+this.handler.path+" received headers "+JSON.stringify(t.toJSON()));let r=t.get(g);if(r.length>0){let e=r[0].toString().match(y);if(null===e){let e=Error("Invalid deadline");return e.code=o.Status.OUT_OF_RANGE,this.sendError(e),t}let n=+e[1]*v[e[2]]|0,i=new Date;this.deadline=i.setMilliseconds(i.getMilliseconds()+n),this.deadlineTimer=setTimeout(R,n,this),t.remove(g)}return t.remove(i.constants.HTTP2_HEADER_ACCEPT_ENCODING),t.remove(i.constants.HTTP2_HEADER_TE),t.remove(i.constants.HTTP2_HEADER_CONTENT_TYPE),t.remove("grpc-accept-encoding"),t}receiveUnaryMessage(e){return new Promise((t,r)=>{let{stream:n}=this,i=0,s=this,a=[],l=this.maxReceiveMessageSize;function u(e){if(i+=e.byteLength,-1!==l&&i>l){n.removeListener("data",u),n.removeListener("end",c),n.removeListener("error",c),r({code:o.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${i} vs. ${l})`});return}a.push(e)}function c(l){if(n.removeListener("data",u),n.removeListener("end",c),n.removeListener("error",c),void 0!==l){r({code:o.Status.INTERNAL,details:l.message});return}if(0===i){r({code:o.Status.INTERNAL,details:"received empty unary message"});return}s.emit("receiveMessage");let h=Buffer.concat(a,i),d=1===h.readUInt8(0)?e:"identity",p=s.getDecompressedMessage(h,d);if(Buffer.isBuffer(p)){t(s.deserializeMessageWithInternalError(p));return}p.then(e=>t(s.deserializeMessageWithInternalError(e)),t=>r(t.code?t:{code:o.Status.INTERNAL,details:`Received "grpc-encoding" header "${e}" but ${e} decompression failed`}))}this.stream.on("data",u),this.stream.on("end",c),this.stream.on("error",c)})}async deserializeMessageWithInternalError(e){try{return this.deserializeMessage(e)}catch(e){throw{details:(0,h.getErrorMessage)(e),code:o.Status.INTERNAL}}}serializeMessage(e){let t=this.handler.serialize(e),r=t.byteLength,n=Buffer.allocUnsafe(r+5);return n.writeUInt8(0,0),n.writeUInt32BE(r,1),t.copy(n,5),n}deserializeMessage(e){return this.handler.deserialize(e)}async sendUnaryMessage(e,t,r,n){if(!this.checkCancelled()){if(void 0===r&&(r=null),e){!Object.prototype.hasOwnProperty.call(e,"metadata")&&r&&(e.metadata=r),this.sendError(e);return}try{let e=this.serializeMessage(t);this.write(e),this.sendStatus({code:o.Status.OK,details:"OK",metadata:r})}catch(e){this.sendError({details:(0,h.getErrorMessage)(e),code:o.Status.INTERNAL})}}}sendStatus(e){var t,r;if(this.emit("callEnd",e.code),this.emit("streamEnd",e.code===o.Status.OK),!this.checkCancelled()){if(p("Request to method "+(null===(t=this.handler)||void 0===t?void 0:t.path)+" ended with status code: "+o.Status[e.code]+" details: "+e.details),this.deadlineTimer&&clearTimeout(this.deadlineTimer),this.stream.headersSent)this.wantTrailers||(this.wantTrailers=!0,this.stream.once("wantTrailers",()=>{var t;let r=Object.assign({[m]:e.code,[f]:encodeURI(e.details)},null===(t=e.metadata)||void 0===t?void 0:t.toHttp2Headers());this.stream.sendTrailers(r),this.statusSent=!0}),this.stream.end());else{let t=Object.assign(Object.assign({[m]:e.code,[f]:encodeURI(e.details)},T),null===(r=e.metadata)||void 0===r?void 0:r.toHttp2Headers());this.stream.respond(t,{endStream:!0}),this.statusSent=!0}}}sendError(e){let t={code:o.Status.UNKNOWN,details:"message"in e?e.message:"Unknown Error",metadata:"metadata"in e&&void 0!==e.metadata?e.metadata:null};"code"in e&&"number"==typeof e.code&&Number.isInteger(e.code)&&(t.code=e.code,"details"in e&&"string"==typeof e.details&&(t.details=e.details)),this.sendStatus(t)}write(e){if(!this.checkCancelled()){if(-1!==this.maxSendMessageSize&&e.length>this.maxSendMessageSize){this.sendError({code:o.Status.RESOURCE_EXHAUSTED,details:`Sent message larger than max (${e.length} vs. ${this.maxSendMessageSize})`});return}return this.sendMetadata(),this.emit("sendMessage"),this.stream.write(e)}}resume(){this.stream.resume()}setupSurfaceCall(e){this.once("cancelled",t=>{e.cancelled=!0,e.emit("cancelled",t)}),this.once("callEnd",t=>e.emit("callEnd",t))}setupReadable(e,t){let r=new u.StreamDecoder(this.maxReceiveMessageSize),n=!1,i=!1,s=!1,a=async()=>{s||!n||i||(s=!0,await this.pushOrBufferMessage(e,null))};this.stream.on("data",async n=>{let s;try{s=r.write(n)}catch(e){this.sendError({code:o.Status.RESOURCE_EXHAUSTED,details:e.message});return}for(let r of(i=!0,this.stream.pause(),s)){let n;this.emit("receiveMessage");let i=1===r.readUInt8(0)?t:"identity";try{n=await this.getDecompressedMessage(r,i)}catch(e){this.sendError(e);return}if(!n)return;await this.pushOrBufferMessage(e,n)}i=!1,this.stream.resume(),await a()}),this.stream.once("end",async()=>{n=!0,await a()})}consumeUnpushedMessages(e){for(this.canPush=!0;this.messagesToPush.length>0;){let t=this.messagesToPush.shift(),r=e.push(t);if(null===t||!1===r){this.canPush=!1;break}}return this.canPush}async pushOrBufferMessage(e,t){this.isPushPending?this.bufferedMessages.push(t):await this.pushMessage(e,t)}async pushMessage(e,t){if(null===t){p("Received end of stream"),this.canPush?e.push(null):this.messagesToPush.push(null);return}p("Received message of length "+t.length),this.isPushPending=!0;try{let r=await this.deserializeMessage(t);this.canPush?e.push(r)||(this.canPush=!1,this.stream.pause()):this.messagesToPush.push(r)}catch(r){this.bufferedMessages.length=0;let t=(0,h.getErrorCode)(r);(null===t||t<o.Status.OK||t>o.Status.UNAUTHENTICATED)&&(t=o.Status.INTERNAL),e.emit("error",{details:(0,h.getErrorMessage)(r),code:t})}this.isPushPending=!1,this.bufferedMessages.length>0&&await this.pushMessage(e,this.bufferedMessages.shift())}getPeer(){var e;let t=null===(e=this.stream.session)||void 0===e?void 0:e.socket;return null!=t&&t.remoteAddress?t.remotePort?`${t.remoteAddress}:${t.remotePort}`:t.remoteAddress:"unknown"}getDeadline(){return this.deadline}getPath(){return this.handler.path}}function R(e){let t=Error("Deadline exceeded");t.code=o.Status.DEADLINE_EXCEEDED,e.sendError(t),e.cancelled=!0,e.emit("cancelled","deadline")}t.Http2ServerCallStream=I},3783:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ServerCredentials=void 0;let n=r(606);class i{static createInsecure(){return new s}static createSsl(e,t,r=!1){if(null!==e&&!Buffer.isBuffer(e))throw TypeError("rootCerts must be null or a Buffer");if(!Array.isArray(t))throw TypeError("keyCertPairs must be an array");if("boolean"!=typeof r)throw TypeError("checkClientCertificate must be a boolean");let i=[],s=[];for(let e=0;e<t.length;e++){let r=t[e];if(null===r||"object"!=typeof r)throw TypeError(`keyCertPair[${e}] must be an object`);if(!Buffer.isBuffer(r.private_key))throw TypeError(`keyCertPair[${e}].private_key must be a Buffer`);if(!Buffer.isBuffer(r.cert_chain))throw TypeError(`keyCertPair[${e}].cert_chain must be a Buffer`);i.push(r.cert_chain),s.push(r.private_key)}return new a({ca:e||(0,n.getDefaultRootsData)()||void 0,cert:i,key:s,requestCert:r,ciphers:n.CIPHER_SUITES})}}t.ServerCredentials=i;class s extends i{_isSecure(){return!1}_getSettings(){return null}}class a extends i{constructor(e){super(),this.options=e}_isSecure(){return!0}_getSettings(){return this.options}}},6418:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Server=void 0;let n=r(2694),i=r(9572),s=r(2025),a=r(3783),o=r(4063),l=r(5792),u=r(4955),c=r(5773),h=r(5962),d=2147483647,p=2147483647,f=2e4,{HTTP2_HEADER_PATH:m}=n.constants,g="server";function y(){}function v(e){return{code:i.Status.UNIMPLEMENTED,details:`The server does not implement the method ${e}`}}function b(e,t){let r=v(t);switch(e){case"unary":return(e,t)=>{t(r,null)};case"clientStream":return(e,t)=>{t(r,null)};case"serverStream":return e=>{e.emit("error",r)};case"bidi":return e=>{e.emit("error",r)};default:throw Error(`Invalid handlerType ${e}`)}}class T{constructor(e){var t,r,n,i;this.http2ServerList=[],this.handlers=new Map,this.sessions=new Map,this.started=!1,this.shutdown=!1,this.serverAddressString="null",this.channelzEnabled=!0,this.channelzTrace=new h.ChannelzTrace,this.callTracker=new h.ChannelzCallTracker,this.listenerChildrenTracker=new h.ChannelzChildrenTracker,this.sessionChildrenTracker=new h.ChannelzChildrenTracker,this.options=null!=e?e:{},0===this.options["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzRef=(0,h.registerChannelzServer)(()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Server created"),this.maxConnectionAgeMs=null!==(t=this.options["grpc.max_connection_age_ms"])&&void 0!==t?t:d,this.maxConnectionAgeGraceMs=null!==(r=this.options["grpc.max_connection_age_grace_ms"])&&void 0!==r?r:d,this.keepaliveTimeMs=null!==(n=this.options["grpc.keepalive_time_ms"])&&void 0!==n?n:p,this.keepaliveTimeoutMs=null!==(i=this.options["grpc.keepalive_timeout_ms"])&&void 0!==i?i:f,this.trace("Server constructed")}getChannelzInfo(){return{trace:this.channelzTrace,callTracker:this.callTracker,listenerChildren:this.listenerChildrenTracker.getChildLists(),sessionChildren:this.sessionChildrenTracker.getChildLists()}}getChannelzSessionInfoGetter(e){return()=>{var t,r,n;let i;let s=this.sessions.get(e),a=e.socket,o=a.remoteAddress?(0,u.stringToSubchannelAddress)(a.remoteAddress,a.remotePort):null,l=a.localAddress?(0,u.stringToSubchannelAddress)(a.localAddress,a.localPort):null;if(e.encrypted){let e=a,r=e.getCipher(),n=e.getCertificate(),s=e.getPeerCertificate();i={cipherSuiteStandardName:null!==(t=r.standardName)&&void 0!==t?t:null,cipherSuiteOtherName:r.standardName?null:r.name,localCertificate:n&&"raw"in n?n.raw:null,remoteCertificate:s&&"raw"in s?s.raw:null}}else i=null;return{remoteAddress:o,localAddress:l,security:i,remoteName:null,streamsStarted:s.streamTracker.callsStarted,streamsSucceeded:s.streamTracker.callsSucceeded,streamsFailed:s.streamTracker.callsFailed,messagesSent:s.messagesSent,messagesReceived:s.messagesReceived,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:s.streamTracker.lastCallStartedTimestamp,lastMessageSentTimestamp:s.lastMessageSentTimestamp,lastMessageReceivedTimestamp:s.lastMessageReceivedTimestamp,localFlowControlWindow:null!==(r=e.state.localWindowSize)&&void 0!==r?r:null,remoteFlowControlWindow:null!==(n=e.state.remoteWindowSize)&&void 0!==n?n:null}}}trace(e){l.trace(i.LogVerbosity.DEBUG,g,"("+this.channelzRef.id+") "+e)}addProtoService(){throw Error("Not implemented. Use addService() instead")}addService(e,t){if(null===e||"object"!=typeof e||null===t||"object"!=typeof t)throw Error("addService() requires two objects as arguments");let r=Object.keys(e);if(0===r.length)throw Error("Cannot add an empty service to a server");r.forEach(r=>{let n,i;let s=e[r];n=s.requestStream?s.responseStream?"bidi":"clientStream":s.responseStream?"serverStream":"unary";let a=t[r];if(void 0===a&&"string"==typeof s.originalName&&(a=t[s.originalName]),i=void 0!==a?a.bind(t):b(n,r),!1===this.register(s.path,i,s.responseSerialize,s.requestDeserialize,n))throw Error(`Method handler for ${s.path} already provided.`)})}removeService(e){if(null===e||"object"!=typeof e)throw Error("removeService() requires object as argument");Object.keys(e).forEach(t=>{let r=e[t];this.unregister(r.path)})}bind(e,t){throw Error("Not implemented. Use bindAsync() instead")}bindAsync(e,t,r){if(!0===this.started)throw Error("server is already started");if(this.shutdown)throw Error("bindAsync called after shutdown");if("string"!=typeof e)throw TypeError("port must be a string");if(null===t||!(t instanceof a.ServerCredentials))throw TypeError("creds must be a ServerCredentials object");if("function"!=typeof r)throw TypeError("callback must be a function");let s=(0,c.parseUri)(e);if(null===s)throw Error(`Could not parse port "${e}"`);let d=(0,o.mapUriDefaultScheme)(s);if(null===d)throw Error(`Could not get a default scheme for port "${e}"`);let p={maxSendHeaderBlockLength:Number.MAX_SAFE_INTEGER};"grpc-node.max_session_memory"in this.options?p.maxSessionMemory=this.options["grpc-node.max_session_memory"]:p.maxSessionMemory=Number.MAX_SAFE_INTEGER,"grpc.max_concurrent_streams"in this.options&&(p.settings={maxConcurrentStreams:this.options["grpc.max_concurrent_streams"]});let f=(e,t)=>{process.nextTick(()=>r(e,t))},m=()=>{let e;if(t._isSecure()){let r=Object.assign(p,t._getSettings());r.enableTrace=1===this.options["grpc-node.tls_enable_trace"],(e=n.createSecureServer(r)).on("secureConnection",e=>{e.on("error",e=>{this.trace("An incoming TLS connection closed with error: "+e.message)})})}else e=n.createServer(p);return e.setTimeout(0,y),this._setupHandlers(e),e},g=(e,t,r)=>0===e.length?Promise.resolve({port:t,count:r}):Promise.all(e.map(e=>{let r;this.trace("Attempting to bind "+(0,u.subchannelAddressToString)(e)),r=(0,u.isTcpSubchannelAddress)(e)?{host:e.host,port:t}:e;let n=m();return new Promise((i,s)=>{let a=t=>{this.trace("Failed to bind "+(0,u.subchannelAddressToString)(e)+" with error "+t.message),i(t)};n.once("error",a),n.listen(r,()=>{let e;if(this.shutdown){n.close(),i(Error("bindAsync failed because server is shutdown"));return}let r=n.address();e="string"==typeof r?{path:r}:{host:r.address,port:r.port};let s=(0,h.registerChannelzSocket)((0,u.subchannelAddressToString)(e),()=>({localAddress:e,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(s),this.http2ServerList.push({server:n,channelzRef:s}),this.trace("Successfully bound "+(0,u.subchannelAddressToString)(e)),i("port"in e?e.port:t),n.removeListener("error",a)})})})).then(e=>{let n=0;for(let r of e)if("number"==typeof r&&(n+=1,r!==t))throw Error("Invalid state: multiple port numbers added from single address");return{port:t,count:n+r}}),v=e=>{if(0===e.length)return Promise.resolve({port:0,count:0});let t=e[0],r=m();return new Promise((n,i)=>{let s=r=>{this.trace("Failed to bind "+(0,u.subchannelAddressToString)(t)+" with error "+r.message),n(v(e.slice(1)))};r.once("error",s),r.listen(t,()=>{if(this.shutdown){r.close(),n({port:0,count:0});return}let t=r.address(),i={host:t.address,port:t.port},a=(0,h.registerChannelzSocket)((0,u.subchannelAddressToString)(i),()=>({localAddress:i,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(a),this.http2ServerList.push({server:r,channelzRef:a}),this.trace("Successfully bound "+(0,u.subchannelAddressToString)(i)),n(g(e.slice(1),t.port,1)),r.removeListener("error",s)})})},b={onSuccessfulResolution:(t,r,n)=>{let s;if(b.onSuccessfulResolution=()=>{},this.shutdown&&f(Error("bindAsync failed because server is shutdown"),0),0===t.length){f(Error(`No addresses resolved for port ${e}`),0);return}(s=(0,u.isTcpSubchannelAddress)(t[0])?0===t[0].port?v(t):g(t,t[0].port,0):g(t,1,0)).then(e=>{if(0===e.count){let e=`No address added out of total ${t.length} resolved`;l.log(i.LogVerbosity.ERROR,e),f(Error(e),0)}else e.count<t.length&&l.log(i.LogVerbosity.INFO,`WARNING Only ${e.count} addresses added out of total ${t.length} resolved`),f(null,e.port)},e=>{let r=`No address added out of total ${t.length} resolved`;l.log(i.LogVerbosity.ERROR,r),f(Error(r),0)})},onError:e=>{f(Error(e.details),0)}};(0,o.createResolver)(d,b,this.options).updateResolution()}forceShutdown(){for(let{server:e,channelzRef:t}of this.http2ServerList)e.listening&&e.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(t),(0,h.unregisterChannelzRef)(t))});this.started=!1,this.shutdown=!0,this.sessions.forEach((e,t)=>{t.destroy(n.constants.NGHTTP2_CANCEL)}),this.sessions.clear(),this.channelzEnabled&&(0,h.unregisterChannelzRef)(this.channelzRef)}register(e,t,r,n,i){return!this.handlers.has(e)&&(this.handlers.set(e,{func:t,serialize:r,deserialize:n,type:i,path:e}),!0)}unregister(e){return this.handlers.delete(e)}start(){if(0===this.http2ServerList.length||this.http2ServerList.every(({server:e})=>!0!==e.listening))throw Error("server must be bound in order to start");if(!0===this.started)throw Error("server is already started");this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Starting"),this.started=!0}tryShutdown(e){let t=t=>{this.channelzEnabled&&(0,h.unregisterChannelzRef)(this.channelzRef),e(t)},r=0;function n(){0==--r&&t()}for(let{server:e,channelzRef:t}of(this.started=!1,this.shutdown=!0,this.http2ServerList))e.listening&&(r++,e.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(t),(0,h.unregisterChannelzRef)(t)),n()}));this.sessions.forEach((e,t)=>{t.closed||(r+=1,t.close(n))}),0===r&&t()}addHttp2Port(){throw Error("Not yet implemented")}getChannelzRef(){return this.channelzRef}_verifyContentType(e,t){let r=t[n.constants.HTTP2_HEADER_CONTENT_TYPE];return!!("string"==typeof r&&r.startsWith("application/grpc"))||(e.respond({[n.constants.HTTP2_HEADER_STATUS]:n.constants.HTTP_STATUS_UNSUPPORTED_MEDIA_TYPE},{endStream:!0}),!1)}_retrieveHandler(e){this.trace("Received call to method "+e+" at address "+this.serverAddressString);let t=this.handlers.get(e);return void 0===t?(this.trace("No handler registered for method "+e+". Sending UNIMPLEMENTED status."),null):t}_respondWithError(e,t,r=null){let n=new s.Http2ServerCallStream(t,null,this.options);void 0===e.code&&(e.code=i.Status.INTERNAL),this.channelzEnabled&&(this.callTracker.addCallFailed(),null==r||r.streamTracker.addCallFailed()),n.sendError(e)}_channelzHandler(e,t){let r=this.sessions.get(e.session);if(this.callTracker.addCallStarted(),null==r||r.streamTracker.addCallStarted(),!this._verifyContentType(e,t)){this.callTracker.addCallFailed(),null==r||r.streamTracker.addCallFailed();return}let n=t[m],a=this._retrieveHandler(n);if(!a){this._respondWithError(v(n),e,r);return}let o=new s.Http2ServerCallStream(e,a,this.options);o.once("callEnd",e=>{e===i.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}),r&&(o.once("streamEnd",e=>{e?r.streamTracker.addCallSucceeded():r.streamTracker.addCallFailed()}),o.on("sendMessage",()=>{r.messagesSent+=1,r.lastMessageSentTimestamp=new Date}),o.on("receiveMessage",()=>{r.messagesReceived+=1,r.lastMessageReceivedTimestamp=new Date})),this._runHandlerForCall(o,a,t)||(this.callTracker.addCallFailed(),null==r||r.streamTracker.addCallFailed(),o.sendError({code:i.Status.INTERNAL,details:`Unknown handler type: ${a.type}`}))}_streamHandler(e,t){if(!0!==this._verifyContentType(e,t))return;let r=t[m],n=this._retrieveHandler(r);if(!n){this._respondWithError(v(r),e,null);return}let a=new s.Http2ServerCallStream(e,n,this.options);this._runHandlerForCall(a,n,t)||a.sendError({code:i.Status.INTERNAL,details:`Unknown handler type: ${n.type}`})}_runHandlerForCall(e,t,r){var n;let i=e.receiveMetadata(r),s=null!==(n=i.get("grpc-encoding")[0])&&void 0!==n?n:"identity";i.remove("grpc-encoding");let{type:a}=t;if("unary"===a)S(e,t,i,s);else if("clientStream"===a)E(e,t,i,s);else if("serverStream"===a)w(e,t,i,s);else{if("bidi"!==a)return!1;C(e,t,i,s)}return!0}_setupHandlers(e){if(null===e)return;let t=e.address(),r="null";t&&(r="string"==typeof t?t:t.address+":"+t.port),this.serverAddressString=r;let i=this.channelzEnabled?this._channelzHandler:this._streamHandler;e.on("stream",i.bind(this)),e.on("session",e=>{var t,r,i,s,a;if(!this.started){e.destroy();return}let o=(0,h.registerChannelzSocket)(null!==(t=e.socket.remoteAddress)&&void 0!==t?t:"unknown",this.getChannelzSessionInfoGetter(e),this.channelzEnabled),l={ref:o,streamTracker:new h.ChannelzCallTracker,messagesSent:0,messagesReceived:0,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null};this.sessions.set(e,l);let u=e.socket.remoteAddress;this.channelzEnabled&&(this.channelzTrace.addTrace("CT_INFO","Connection established by client "+u),this.sessionChildrenTracker.refChild(o));let c=null,p=null,f=!1;if(this.maxConnectionAgeMs!==d){let t=this.maxConnectionAgeMs/10,s=Math.random()*t*2-t;c=null===(i=(r=setTimeout(()=>{var t,r;f=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by max connection age from "+u);try{e.goaway(n.constants.NGHTTP2_NO_ERROR,2147483647,Buffer.from("max_age"))}catch(t){e.destroy();return}e.close(),this.maxConnectionAgeGraceMs!==d&&(p=null===(r=(t=setTimeout(()=>{e.destroy()},this.maxConnectionAgeGraceMs)).unref)||void 0===r?void 0:r.call(t))},this.maxConnectionAgeMs+s)).unref)||void 0===i?void 0:i.call(r)}let m=null===(a=(s=setInterval(()=>{var t,r;let n=null===(r=(t=setTimeout(()=>{f=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by keepalive timeout from "+u),e.close()},this.keepaliveTimeoutMs)).unref)||void 0===r?void 0:r.call(t);try{e.ping((e,t,r)=>{clearTimeout(n)})}catch(t){e.destroy()}},this.keepaliveTimeMs)).unref)||void 0===a?void 0:a.call(s);e.on("close",()=>{this.channelzEnabled&&(f||this.channelzTrace.addTrace("CT_INFO","Connection dropped by client "+u),this.sessionChildrenTracker.unrefChild(o),(0,h.unregisterChannelzRef)(o)),c&&clearTimeout(c),p&&clearTimeout(p),m&&clearTimeout(m),this.sessions.delete(e)})})}}async function S(e,t,r,n){try{let i=await e.receiveUnaryMessage(n);if(void 0===i||e.cancelled)return;let a=new s.ServerUnaryCallImpl(e,r,i);t.func(a,(t,r,n,i)=>{e.sendUnaryMessage(t,r,n,i)})}catch(t){e.sendError(t)}}function E(e,t,r,n){let i=new s.ServerReadableStreamImpl(e,r,t.deserialize,n);function a(t,r,n,s){i.destroy(),e.sendUnaryMessage(t,r,n,s)}e.cancelled||(i.on("error",a),t.func(i,a))}async function w(e,t,r,n){try{let i=await e.receiveUnaryMessage(n);if(void 0===i||e.cancelled)return;let a=new s.ServerWritableStreamImpl(e,r,t.serialize,i);t.func(a)}catch(t){e.sendError(t)}}function C(e,t,r,n){let i=new s.ServerDuplexStreamImpl(e,r,t.serialize,t.deserialize,n);e.cancelled||t.func(i)}t.Server=T},4298:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.extractAndSelectServiceConfig=t.validateServiceConfig=t.validateRetryThrottling=void 0;let n=r(9801),i=r(9572),s=r(9884),a=/^\d+(\.\d{1,9})?s$/,o="node";function l(e){if("service"in e&&""!==e.service){if("string"!=typeof e.service)throw Error(`Invalid method config name: invalid service: expected type string, got ${typeof e.service}`);if(!("method"in e)||""===e.method)return{service:e.service};if("string"!=typeof e.method)throw Error(`Invalid method config name: invalid method: expected type string, got ${typeof e.service}`);return{service:e.service,method:e.method}}if("method"in e&&void 0!==e.method)throw Error("Invalid method config name: method set with empty or unset service");return{}}function u(e){if(!("maxAttempts"in e)||!Number.isInteger(e.maxAttempts)||e.maxAttempts<2)throw Error("Invalid method config retry policy: maxAttempts must be an integer at least 2");if(!("initialBackoff"in e)||"string"!=typeof e.initialBackoff||!a.test(e.initialBackoff))throw Error("Invalid method config retry policy: initialBackoff must be a string consisting of a positive integer followed by s");if(!("maxBackoff"in e)||"string"!=typeof e.maxBackoff||!a.test(e.maxBackoff))throw Error("Invalid method config retry policy: maxBackoff must be a string consisting of a positive integer followed by s");if(!("backoffMultiplier"in e)||"number"!=typeof e.backoffMultiplier||e.backoffMultiplier<=0)throw Error("Invalid method config retry policy: backoffMultiplier must be a number greater than 0");if(!("retryableStatusCodes"in e&&Array.isArray(e.retryableStatusCodes)))throw Error("Invalid method config retry policy: retryableStatusCodes is required");if(0===e.retryableStatusCodes.length)throw Error("Invalid method config retry policy: retryableStatusCodes must be non-empty");for(let t of e.retryableStatusCodes)if("number"==typeof t){if(!Object.values(i.Status).includes(t))throw Error("Invalid method config retry policy: retryableStatusCodes value not in status code range")}else if("string"==typeof t){if(!Object.values(i.Status).includes(t.toUpperCase()))throw Error("Invalid method config retry policy: retryableStatusCodes value not a status code name")}else throw Error("Invalid method config retry policy: retryableStatusCodes value must be a string or number");return{maxAttempts:e.maxAttempts,initialBackoff:e.initialBackoff,maxBackoff:e.maxBackoff,backoffMultiplier:e.backoffMultiplier,retryableStatusCodes:e.retryableStatusCodes}}function c(e){if(!("maxAttempts"in e)||!Number.isInteger(e.maxAttempts)||e.maxAttempts<2)throw Error("Invalid method config hedging policy: maxAttempts must be an integer at least 2");if("hedgingDelay"in e&&("string"!=typeof e.hedgingDelay||!a.test(e.hedgingDelay)))throw Error("Invalid method config hedging policy: hedgingDelay must be a string consisting of a positive integer followed by s");if("nonFatalStatusCodes"in e&&Array.isArray(e.nonFatalStatusCodes))for(let t of e.nonFatalStatusCodes)if("number"==typeof t){if(!Object.values(i.Status).includes(t))throw Error("Invlid method config hedging policy: nonFatalStatusCodes value not in status code range")}else if("string"==typeof t){if(!Object.values(i.Status).includes(t.toUpperCase()))throw Error("Invlid method config hedging policy: nonFatalStatusCodes value not a status code name")}else throw Error("Invlid method config hedging policy: nonFatalStatusCodes value must be a string or number");let t={maxAttempts:e.maxAttempts};return e.hedgingDelay&&(t.hedgingDelay=e.hedgingDelay),e.nonFatalStatusCodes&&(t.nonFatalStatusCodes=e.nonFatalStatusCodes),t}function h(e){var t;let r={name:[]};if(!("name"in e)||!Array.isArray(e.name))throw Error("Invalid method config: invalid name array");for(let t of e.name)r.name.push(l(t));if("waitForReady"in e){if("boolean"!=typeof e.waitForReady)throw Error("Invalid method config: invalid waitForReady");r.waitForReady=e.waitForReady}if("timeout"in e){if("object"==typeof e.timeout){if(!("seconds"in e.timeout)||"number"!=typeof e.timeout.seconds)throw Error("Invalid method config: invalid timeout.seconds");if(!("nanos"in e.timeout)||"number"!=typeof e.timeout.nanos)throw Error("Invalid method config: invalid timeout.nanos");r.timeout=e.timeout}else if("string"==typeof e.timeout&&a.test(e.timeout)){let n=e.timeout.substring(0,e.timeout.length-1).split(".");r.timeout={seconds:0|n[0],nanos:(null!==(t=n[1])&&void 0!==t?t:0)|0}}else throw Error("Invalid method config: invalid timeout")}if("maxRequestBytes"in e){if("number"!=typeof e.maxRequestBytes)throw Error("Invalid method config: invalid maxRequestBytes");r.maxRequestBytes=e.maxRequestBytes}if("maxResponseBytes"in e){if("number"!=typeof e.maxResponseBytes)throw Error("Invalid method config: invalid maxRequestBytes");r.maxResponseBytes=e.maxResponseBytes}if("retryPolicy"in e){if("hedgingPolicy"in e)throw Error("Invalid method config: retryPolicy and hedgingPolicy cannot both be specified");r.retryPolicy=u(e.retryPolicy)}else"hedgingPolicy"in e&&(r.hedgingPolicy=c(e.hedgingPolicy));return r}function d(e){if(!("maxTokens"in e)||"number"!=typeof e.maxTokens||e.maxTokens<=0||e.maxTokens>1e3)throw Error("Invalid retryThrottling: maxTokens must be a number in (0, 1000]");if(!("tokenRatio"in e)||"number"!=typeof e.tokenRatio||e.tokenRatio<=0)throw Error("Invalid retryThrottling: tokenRatio must be a number greater than 0");return{maxTokens:+e.maxTokens.toFixed(3),tokenRatio:+e.tokenRatio.toFixed(3)}}function p(e){let t={loadBalancingConfig:[],methodConfig:[]};if("loadBalancingPolicy"in e){if("string"==typeof e.loadBalancingPolicy)t.loadBalancingPolicy=e.loadBalancingPolicy;else throw Error("Invalid service config: invalid loadBalancingPolicy")}if("loadBalancingConfig"in e){if(Array.isArray(e.loadBalancingConfig))for(let r of e.loadBalancingConfig)t.loadBalancingConfig.push((0,s.validateLoadBalancingConfig)(r));else throw Error("Invalid service config: invalid loadBalancingConfig")}if("methodConfig"in e&&Array.isArray(e.methodConfig))for(let r of e.methodConfig)t.methodConfig.push(h(r));"retryThrottling"in e&&(t.retryThrottling=d(e.retryThrottling));let r=[];for(let e of t.methodConfig)for(let t of e.name){for(let e of r)if(t.service===e.service&&t.method===e.method)throw Error(`Invalid service config: duplicate name ${t.service}/${t.method}`);r.push(t)}return t}function f(e){if(!("serviceConfig"in e))throw Error("Invalid service config choice: missing service config");let t={serviceConfig:p(e.serviceConfig)};if("clientLanguage"in e){if(Array.isArray(e.clientLanguage))for(let r of(t.clientLanguage=[],e.clientLanguage))if("string"==typeof r)t.clientLanguage.push(r);else throw Error("Invalid service config choice: invalid clientLanguage");else throw Error("Invalid service config choice: invalid clientLanguage")}if("clientHostname"in e){if(Array.isArray(e.clientHostname))for(let r of(t.clientHostname=[],e.clientHostname))if("string"==typeof r)t.clientHostname.push(r);else throw Error("Invalid service config choice: invalid clientHostname");else throw Error("Invalid service config choice: invalid clientHostname")}if("percentage"in e){if("number"==typeof e.percentage&&0<=e.percentage&&e.percentage<=100)t.percentage=e.percentage;else throw Error("Invalid service config choice: invalid percentage")}let r=["clientLanguage","percentage","clientHostname","serviceConfig"];for(let t in e)if(!r.includes(t))throw Error(`Invalid service config choice: unexpected field ${t}`);return t}function m(e,t){if(!Array.isArray(e))throw Error("Invalid service config list");for(let r of e){let e=f(r);if("number"!=typeof e.percentage||!(t>e.percentage)){if(Array.isArray(e.clientHostname)){let t=!1;for(let r of e.clientHostname)r===n.hostname()&&(t=!0);if(!t)continue}if(Array.isArray(e.clientLanguage)){let t=!1;for(let r of e.clientLanguage)r===o&&(t=!0);if(!t)continue}return e.serviceConfig}}throw Error("No matching service config found")}function g(e,t){for(let r of e)if(r.length>0&&r[0].startsWith("grpc_config="))return m(JSON.parse(r.join("").substring(12)),t);return null}t.validateRetryThrottling=d,t.validateServiceConfig=p,t.extractAndSelectServiceConfig=g},4339:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StatusBuilder=void 0;class r{constructor(){this.code=null,this.details=null,this.metadata=null}withCode(e){return this.code=e,this}withDetails(e){return this.details=e,this}withMetadata(e){return this.metadata=e,this}build(){let e={};return null!==this.code&&(e.code=this.code),null!==this.details&&(e.details=this.details),null!==this.metadata&&(e.metadata=this.metadata),e}}t.StatusBuilder=r},615:(e,t)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.StreamDecoder=void 0,function(e){e[e.NO_DATA=0]="NO_DATA",e[e.READING_SIZE=1]="READING_SIZE",e[e.READING_MESSAGE=2]="READING_MESSAGE"}(r||(r={}));class n{constructor(e){this.maxReadMessageLength=e,this.readState=r.NO_DATA,this.readCompressFlag=Buffer.alloc(1),this.readPartialSize=Buffer.alloc(4),this.readSizeRemaining=4,this.readMessageSize=0,this.readPartialMessage=[],this.readMessageRemaining=0}write(e){let t,n=0,i=[];for(;n<e.length;)switch(this.readState){case r.NO_DATA:this.readCompressFlag=e.slice(n,n+1),n+=1,this.readState=r.READING_SIZE,this.readPartialSize.fill(0),this.readSizeRemaining=4,this.readMessageSize=0,this.readMessageRemaining=0,this.readPartialMessage=[];break;case r.READING_SIZE:if(t=Math.min(e.length-n,this.readSizeRemaining),e.copy(this.readPartialSize,4-this.readSizeRemaining,n,n+t),this.readSizeRemaining-=t,n+=t,0===this.readSizeRemaining){if(this.readMessageSize=this.readPartialSize.readUInt32BE(0),-1!==this.maxReadMessageLength&&this.readMessageSize>this.maxReadMessageLength)throw Error(`Received message larger than max (${this.readMessageSize} vs ${this.maxReadMessageLength})`);if(this.readMessageRemaining=this.readMessageSize,this.readMessageRemaining>0)this.readState=r.READING_MESSAGE;else{let e=Buffer.concat([this.readCompressFlag,this.readPartialSize],5);this.readState=r.NO_DATA,i.push(e)}}break;case r.READING_MESSAGE:if(t=Math.min(e.length-n,this.readMessageRemaining),this.readPartialMessage.push(e.slice(n,n+t)),this.readMessageRemaining-=t,n+=t,0===this.readMessageRemaining){let e=[this.readCompressFlag,this.readPartialSize].concat(this.readPartialMessage),t=Buffer.concat(e,this.readMessageSize+5);this.readState=r.NO_DATA,i.push(t)}break;default:throw Error("Unexpected read state")}return i}}t.StreamDecoder=n},4955:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.stringToSubchannelAddress=t.subchannelAddressToString=t.subchannelAddressEqual=t.isTcpSubchannelAddress=void 0;let n=r(8216);function i(e){return"port"in e}function s(e,t){return!e&&!t||!!e&&!!t&&(i(e)?i(t)&&e.host===t.host&&e.port===t.port:!i(t)&&e.path===t.path)}function a(e){return i(e)?e.host+":"+e.port:e.path}t.isTcpSubchannelAddress=i,t.subchannelAddressEqual=s,t.subchannelAddressToString=a;let o=443;function l(e,t){return(0,n.isIP)(e)?{host:e,port:null!=t?t:o}:{path:e}}t.stringToSubchannelAddress=l},4354:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Http2SubchannelCall=void 0;let n=r(2694),i=r(9801),s=r(9572),a=r(6281),o=r(615),l=r(5792),u=r(9572),c="subchannel_call";function h(e){for(let[t,r]of Object.entries(i.constants.errno))if(r===e)return t;return"Unknown system error "+e}class d{constructor(e,t,r,i,l){var u;this.http2Stream=e,this.callEventTracker=t,this.listener=r,this.transport=i,this.callId=l,this.isReadFilterPending=!1,this.isPushPending=!1,this.canPush=!1,this.readsClosed=!1,this.statusOutput=!1,this.unpushedReadMessages=[],this.mappedStatusCode=s.Status.UNKNOWN,this.finalStatus=null,this.internalError=null;let c=null!==(u=i.getOptions()["grpc.max_receive_message_length"])&&void 0!==u?u:s.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH;this.decoder=new o.StreamDecoder(c),e.on("response",(e,t)=>{let r="";for(let t of Object.keys(e))r+="		"+t+": "+e[t]+"\n";switch(this.trace("Received server headers:\n"+r),e[":status"]){case 400:this.mappedStatusCode=s.Status.INTERNAL;break;case 401:this.mappedStatusCode=s.Status.UNAUTHENTICATED;break;case 403:this.mappedStatusCode=s.Status.PERMISSION_DENIED;break;case 404:this.mappedStatusCode=s.Status.UNIMPLEMENTED;break;case 429:case 502:case 503:case 504:this.mappedStatusCode=s.Status.UNAVAILABLE;break;default:this.mappedStatusCode=s.Status.UNKNOWN}if(t&n.constants.NGHTTP2_FLAG_END_STREAM)this.handleTrailers(e);else{let t;try{t=a.Metadata.fromHttp2Headers(e)}catch(e){this.endCall({code:s.Status.UNKNOWN,details:e.message,metadata:new a.Metadata});return}this.listener.onReceiveMetadata(t)}}),e.on("trailers",e=>{this.handleTrailers(e)}),e.on("data",e=>{let t;if(!this.statusOutput){this.trace("receive HTTP/2 data frame of length "+e.length);try{t=this.decoder.write(e)}catch(e){this.cancelWithStatus(s.Status.RESOURCE_EXHAUSTED,e.message);return}for(let e of t)this.trace("parsed message of length "+e.length),this.callEventTracker.addMessageReceived(),this.tryPush(e)}}),e.on("end",()=>{this.readsClosed=!0,this.maybeOutputStatus()}),e.on("close",()=>{process.nextTick(()=>{var t;let r;if(this.trace("HTTP/2 stream closed with code "+e.rstCode),(null===(t=this.finalStatus)||void 0===t?void 0:t.code)===s.Status.OK)return;let i="";switch(e.rstCode){case n.constants.NGHTTP2_NO_ERROR:if(null!==this.finalStatus)return;r=s.Status.INTERNAL,i=`Received RST_STREAM with code ${e.rstCode}`;break;case n.constants.NGHTTP2_REFUSED_STREAM:r=s.Status.UNAVAILABLE,i="Stream refused by server";break;case n.constants.NGHTTP2_CANCEL:r=s.Status.CANCELLED,i="Call cancelled";break;case n.constants.NGHTTP2_ENHANCE_YOUR_CALM:r=s.Status.RESOURCE_EXHAUSTED,i="Bandwidth exhausted or memory limit exceeded";break;case n.constants.NGHTTP2_INADEQUATE_SECURITY:r=s.Status.PERMISSION_DENIED,i="Protocol not secure enough";break;case n.constants.NGHTTP2_INTERNAL_ERROR:r=s.Status.INTERNAL,null===this.internalError?i=`Received RST_STREAM with code ${e.rstCode} (Internal server error)`:"ECONNRESET"===this.internalError.code||"ETIMEDOUT"===this.internalError.code?(r=s.Status.UNAVAILABLE,i=this.internalError.message):i=`Received RST_STREAM with code ${e.rstCode} triggered by internal client error: ${this.internalError.message}`;break;default:r=s.Status.INTERNAL,i=`Received RST_STREAM with code ${e.rstCode}`}this.endCall({code:r,details:i,metadata:new a.Metadata,rstCode:e.rstCode})})}),e.on("error",e=>{"ERR_HTTP2_STREAM_ERROR"!==e.code&&(this.trace("Node error event: message="+e.message+" code="+e.code+" errno="+h(e.errno)+" syscall="+e.syscall),this.internalError=e),this.callEventTracker.onStreamEnd(!1)})}onDisconnect(){this.endCall({code:s.Status.UNAVAILABLE,details:"Connection dropped",metadata:new a.Metadata})}outputStatus(){this.statusOutput||(this.statusOutput=!0,this.trace("ended with status: code="+this.finalStatus.code+' details="'+this.finalStatus.details+'"'),this.callEventTracker.onCallEnd(this.finalStatus),process.nextTick(()=>{this.listener.onReceiveStatus(this.finalStatus)}),this.http2Stream.resume())}trace(e){l.trace(u.LogVerbosity.DEBUG,c,"["+this.callId+"] "+e)}endCall(e){(null===this.finalStatus||this.finalStatus.code===s.Status.OK)&&(this.finalStatus=e,this.maybeOutputStatus()),this.destroyHttp2Stream()}maybeOutputStatus(){null===this.finalStatus||this.finalStatus.code===s.Status.OK&&(!this.readsClosed||0!==this.unpushedReadMessages.length||this.isReadFilterPending||this.isPushPending)||this.outputStatus()}push(e){this.trace("pushing to reader message of length "+(e instanceof Buffer?e.length:null)),this.canPush=!1,this.isPushPending=!0,process.nextTick(()=>{this.isPushPending=!1,this.statusOutput||(this.listener.onReceiveMessage(e),this.maybeOutputStatus())})}tryPush(e){this.canPush?(this.http2Stream.pause(),this.push(e)):(this.trace("unpushedReadMessages.push message of length "+e.length),this.unpushedReadMessages.push(e))}handleTrailers(e){let t;this.callEventTracker.onStreamEnd(!0);let r="";for(let t of Object.keys(e))r+="		"+t+": "+e[t]+"\n";this.trace("Received server trailers:\n"+r);try{t=a.Metadata.fromHttp2Headers(e)}catch(e){t=new a.Metadata}let n=t.getMap(),i=this.mappedStatusCode;if(i===s.Status.UNKNOWN&&"string"==typeof n["grpc-status"]){let e=Number(n["grpc-status"]);e in s.Status&&(i=e,this.trace("received status code "+e+" from server")),t.remove("grpc-status")}let o="";if("string"==typeof n["grpc-message"]){try{o=decodeURI(n["grpc-message"])}catch(e){o=n["grpc-message"]}t.remove("grpc-message"),this.trace('received status details string "'+o+'" from server')}let l={code:i,details:o,metadata:t};this.endCall(l)}destroyHttp2Stream(){var e;if(!this.http2Stream.destroyed){let t;t=(null===(e=this.finalStatus)||void 0===e?void 0:e.code)===s.Status.OK?n.constants.NGHTTP2_NO_ERROR:n.constants.NGHTTP2_CANCEL,this.trace("close http2 stream with code "+t),this.http2Stream.close(t)}}cancelWithStatus(e,t){this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.endCall({code:e,details:t,metadata:new a.Metadata})}getStatus(){return this.finalStatus}getPeer(){return this.transport.getPeerName()}getCallNumber(){return this.callId}startRead(){if(null!==this.finalStatus&&this.finalStatus.code!==s.Status.OK){this.readsClosed=!0,this.maybeOutputStatus();return}if(this.canPush=!0,this.unpushedReadMessages.length>0){let e=this.unpushedReadMessages.shift();this.push(e);return}this.http2Stream.resume()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length);let r=t=>{process.nextTick(()=>{var r;let n=s.Status.UNAVAILABLE;(null==t?void 0:t.code)==="ERR_STREAM_WRITE_AFTER_END"&&(n=s.Status.INTERNAL),t&&this.cancelWithStatus(n,`Write error: ${t.message}`),null===(r=e.callback)||void 0===r||r.call(e)})};this.trace("sending data chunk of length "+t.length),this.callEventTracker.addMessageSent();try{this.http2Stream.write(t,r)}catch(e){this.endCall({code:s.Status.UNAVAILABLE,details:`Write failed with error ${e.message}`,metadata:new a.Metadata})}}halfClose(){this.trace("end() called"),this.trace("calling end() on HTTP/2 stream"),this.http2Stream.end()}}t.Http2SubchannelCall=d},487:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseSubchannelWrapper=void 0;class r{constructor(e){this.child=e}getConnectivityState(){return this.child.getConnectivityState()}addConnectivityStateListener(e){this.child.addConnectivityStateListener(e)}removeConnectivityStateListener(e){this.child.removeConnectivityStateListener(e)}startConnecting(){this.child.startConnecting()}getAddress(){return this.child.getAddress()}throttleKeepalive(e){this.child.throttleKeepalive(e)}ref(){this.child.ref()}unref(){this.child.unref()}getChannelzRef(){return this.child.getChannelzRef()}getRealSubchannel(){return this.child.getRealSubchannel()}realSubchannelEquals(e){return this.getRealSubchannel()===e.getRealSubchannel()}}t.BaseSubchannelWrapper=r},7328:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getSubchannelPool=t.SubchannelPool=void 0;let n=r(9455),i=r(389),s=r(4955),a=r(5773),o=r(6983),l=1e4;class u{constructor(){this.pool=Object.create(null),this.cleanupTimer=null}unrefUnusedSubchannels(){let e=!0;for(let t in this.pool){let r=this.pool[t].filter(e=>!e.subchannel.unrefIfOneRef());r.length>0&&(e=!1),this.pool[t]=r}e&&null!==this.cleanupTimer&&(clearInterval(this.cleanupTimer),this.cleanupTimer=null)}ensureCleanupTask(){var e,t;null===this.cleanupTimer&&(this.cleanupTimer=setInterval(()=>{this.unrefUnusedSubchannels()},l),null===(t=(e=this.cleanupTimer).unref)||void 0===t||t.call(e))}getOrCreateSubchannel(e,t,r,l){this.ensureCleanupTask();let u=(0,a.uriToString)(e);if(u in this.pool){for(let e of this.pool[u])if((0,s.subchannelAddressEqual)(t,e.subchannelAddress)&&(0,n.channelOptionsEqual)(r,e.channelArguments)&&l._equals(e.channelCredentials))return e.subchannel}let c=new i.Subchannel(e,t,r,l,new o.Http2SubchannelConnector(e));return u in this.pool||(this.pool[u]=[]),this.pool[u].push({subchannelAddress:t,channelArguments:r,channelCredentials:l,subchannel:c}),c.ref(),c}}t.SubchannelPool=u;let c=new u;function h(e){return e?c:new u}t.getSubchannelPool=h},389:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Subchannel=void 0;let n=r(2409),i=r(1742),s=r(5792),a=r(9572),o=r(5773),l=r(4955),u=r(5962),c="subchannel",h=2147483647;class d{constructor(e,t,r,s,a){var o;this.channelTarget=e,this.subchannelAddress=t,this.options=r,this.credentials=s,this.connector=a,this.connectivityState=n.ConnectivityState.IDLE,this.transport=null,this.continueConnecting=!1,this.stateListeners=new Set,this.refcount=0,this.channelzEnabled=!0,this.callTracker=new u.ChannelzCallTracker,this.childrenTracker=new u.ChannelzChildrenTracker,this.streamTracker=new u.ChannelzCallTracker;let c={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new i.BackoffTimeout(()=>{this.handleBackoffTimer()},c),this.backoffTimeout.unref(),this.subchannelAddressString=(0,l.subchannelAddressToString)(t),this.keepaliveTime=null!==(o=r["grpc.keepalive_time_ms"])&&void 0!==o?o:-1,0===r["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzTrace=new u.ChannelzTrace,this.channelzRef=(0,u.registerChannelzSubchannel)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Subchannel created"),this.trace("Subchannel constructed with options "+JSON.stringify(r,void 0,2))}getChannelzInfo(){return{state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists(),target:this.subchannelAddressString}}trace(e){s.trace(a.LogVerbosity.DEBUG,c,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}refTrace(e){s.trace(a.LogVerbosity.DEBUG,"subchannel_refcount","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}handleBackoffTimer(){this.continueConnecting?this.transitionToState([n.ConnectivityState.TRANSIENT_FAILURE],n.ConnectivityState.CONNECTING):this.transitionToState([n.ConnectivityState.TRANSIENT_FAILURE],n.ConnectivityState.IDLE)}startBackoff(){this.backoffTimeout.runOnce()}stopBackoff(){this.backoffTimeout.stop(),this.backoffTimeout.reset()}startConnectingInternal(){let e=this.options;if(e["grpc.keepalive_time_ms"]){let t=Math.min(this.keepaliveTime,h);e=Object.assign(Object.assign({},e),{"grpc.keepalive_time_ms":t})}this.connector.connect(this.subchannelAddress,this.credentials,e).then(e=>{this.transitionToState([n.ConnectivityState.CONNECTING],n.ConnectivityState.READY)?(this.transport=e,this.channelzEnabled&&this.childrenTracker.refChild(e.getChannelzRef()),e.addDisconnectListener(e=>{this.transitionToState([n.ConnectivityState.READY],n.ConnectivityState.IDLE),e&&this.keepaliveTime>0&&(this.keepaliveTime*=2,s.log(a.LogVerbosity.ERROR,`Connection to ${(0,o.uriToString)(this.channelTarget)} at ${this.subchannelAddressString} rejected by server because of excess pings. Increasing ping interval to ${this.keepaliveTime} ms`))})):e.shutdown()},e=>{this.transitionToState([n.ConnectivityState.CONNECTING],n.ConnectivityState.TRANSIENT_FAILURE,`${e}`)})}transitionToState(e,t,r){var i,s;if(-1===e.indexOf(this.connectivityState))return!1;this.trace(n.ConnectivityState[this.connectivityState]+" -> "+n.ConnectivityState[t]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+n.ConnectivityState[t]);let a=this.connectivityState;switch(this.connectivityState=t,t){case n.ConnectivityState.READY:this.stopBackoff();break;case n.ConnectivityState.CONNECTING:this.startBackoff(),this.startConnectingInternal(),this.continueConnecting=!1;break;case n.ConnectivityState.TRANSIENT_FAILURE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),null===(i=this.transport)||void 0===i||i.shutdown(),this.transport=null,this.backoffTimeout.isRunning()||process.nextTick(()=>{this.handleBackoffTimer()});break;case n.ConnectivityState.IDLE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),null===(s=this.transport)||void 0===s||s.shutdown(),this.transport=null;break;default:throw Error(`Invalid state: unknown ConnectivityState ${t}`)}for(let e of this.stateListeners)e(this,a,t,this.keepaliveTime,r);return!0}ref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount+1)),this.refcount+=1}unref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount-1)),this.refcount-=1,0===this.refcount&&(this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Shutting down"),this.channelzEnabled&&(0,u.unregisterChannelzRef)(this.channelzRef),process.nextTick(()=>{this.transitionToState([n.ConnectivityState.CONNECTING,n.ConnectivityState.READY],n.ConnectivityState.IDLE)}))}unrefIfOneRef(){return 1===this.refcount&&(this.unref(),!0)}createCall(e,t,r,n){let i;if(!this.transport)throw Error("Cannot create call, subchannel not READY");return this.channelzEnabled?(this.callTracker.addCallStarted(),this.streamTracker.addCallStarted(),i={onCallEnd:e=>{e.code===a.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}}):i={},this.transport.createCall(e,t,r,n,i)}startConnecting(){process.nextTick(()=>{this.transitionToState([n.ConnectivityState.IDLE],n.ConnectivityState.CONNECTING)||this.connectivityState!==n.ConnectivityState.TRANSIENT_FAILURE||(this.continueConnecting=!0)})}getConnectivityState(){return this.connectivityState}addConnectivityStateListener(e){this.stateListeners.add(e)}removeConnectivityStateListener(e){this.stateListeners.delete(e)}resetBackoff(){process.nextTick(()=>{this.backoffTimeout.reset(),this.transitionToState([n.ConnectivityState.TRANSIENT_FAILURE],n.ConnectivityState.CONNECTING)})}getAddress(){return this.subchannelAddressString}getChannelzRef(){return this.channelzRef}getRealSubchannel(){return this}realSubchannelEquals(e){return e.getRealSubchannel()===this}throttleKeepalive(e){e>this.keepaliveTime&&(this.keepaliveTime=e)}}t.Subchannel=d},606:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getDefaultRootsData=t.CIPHER_SUITES=void 0;let n=r(2048);t.CIPHER_SUITES=process.env.GRPC_SSL_CIPHER_SUITES;let i=process.env.GRPC_DEFAULT_SSL_ROOTS_FILE_PATH,s=null;function a(){return i?(null===s&&(s=n.readFileSync(i)),s):null}t.getDefaultRootsData=a},6983:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Http2SubchannelConnector=void 0;let n=r(2694),i=r(2452),s=r(5962),a=r(9572),o=r(5242),l=r(5792),u=r(4063),c=r(4955),h=r(5773),d=r(8216),p=r(4354),f=r(1801),m="transport",g="transport_flowctrl",y=r(1513).i8,{HTTP2_HEADER_AUTHORITY:v,HTTP2_HEADER_CONTENT_TYPE:b,HTTP2_HEADER_METHOD:T,HTTP2_HEADER_PATH:S,HTTP2_HEADER_TE:E,HTTP2_HEADER_USER_AGENT:w}=n.constants,C=2e4,_=Buffer.from("too_many_pings","ascii");class I{constructor(e,t,r,i){this.session=e,this.options=r,this.remoteName=i,this.keepaliveTimeMs=-1,this.keepaliveTimeoutMs=C,this.keepaliveTimerId=null,this.pendingSendKeepalivePing=!1,this.keepaliveTimeoutId=null,this.keepaliveWithoutCalls=!1,this.activeCalls=new Set,this.disconnectListeners=[],this.disconnectHandled=!1,this.channelzEnabled=!0,this.streamTracker=new s.ChannelzCallTracker,this.keepalivesSent=0,this.messagesSent=0,this.messagesReceived=0,this.lastMessageSentTimestamp=null,this.lastMessageReceivedTimestamp=null,this.subchannelAddressString=(0,c.subchannelAddressToString)(t),0===r["grpc.enable_channelz"]&&(this.channelzEnabled=!1),this.channelzRef=(0,s.registerChannelzSocket)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.userAgent=[r["grpc.primary_user_agent"],`grpc-node-js/${y}`,r["grpc.secondary_user_agent"]].filter(e=>e).join(" "),"grpc.keepalive_time_ms"in r&&(this.keepaliveTimeMs=r["grpc.keepalive_time_ms"]),"grpc.keepalive_timeout_ms"in r&&(this.keepaliveTimeoutMs=r["grpc.keepalive_timeout_ms"]),"grpc.keepalive_permit_without_calls"in r?this.keepaliveWithoutCalls=1===r["grpc.keepalive_permit_without_calls"]:this.keepaliveWithoutCalls=!1,e.once("close",()=>{this.trace("session closed"),this.stopKeepalivePings(),this.handleDisconnect()}),e.once("goaway",(e,t,r)=>{let i=!1;e===n.constants.NGHTTP2_ENHANCE_YOUR_CALM&&r&&r.equals(_)&&(i=!0),this.trace("connection closed by GOAWAY with code "+e+" and data "+(null==r?void 0:r.toString())),this.reportDisconnectToOwner(i)}),e.once("error",e=>{this.trace("connection closed with error "+e.message)}),l.isTracerEnabled(m)&&(e.on("remoteSettings",t=>{this.trace("new settings received"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(t))}),e.on("localSettings",t=>{this.trace("local settings acknowledged by remote"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(t))})),this.keepaliveWithoutCalls&&this.maybeStartKeepalivePingTimer()}getChannelzInfo(){var e,t,r;let n;let i=this.session.socket,s=i.remoteAddress?(0,c.stringToSubchannelAddress)(i.remoteAddress,i.remotePort):null,a=i.localAddress?(0,c.stringToSubchannelAddress)(i.localAddress,i.localPort):null;if(this.session.encrypted){let t=i,r=t.getCipher(),s=t.getCertificate(),a=t.getPeerCertificate();n={cipherSuiteStandardName:null!==(e=r.standardName)&&void 0!==e?e:null,cipherSuiteOtherName:r.standardName?null:r.name,localCertificate:s&&"raw"in s?s.raw:null,remoteCertificate:a&&"raw"in a?a.raw:null}}else n=null;return{remoteAddress:s,localAddress:a,security:n,remoteName:this.remoteName,streamsStarted:this.streamTracker.callsStarted,streamsSucceeded:this.streamTracker.callsSucceeded,streamsFailed:this.streamTracker.callsFailed,messagesSent:this.messagesSent,messagesReceived:this.messagesReceived,keepAlivesSent:this.keepalivesSent,lastLocalStreamCreatedTimestamp:this.streamTracker.lastCallStartedTimestamp,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:this.lastMessageSentTimestamp,lastMessageReceivedTimestamp:this.lastMessageReceivedTimestamp,localFlowControlWindow:null!==(t=this.session.state.localWindowSize)&&void 0!==t?t:null,remoteFlowControlWindow:null!==(r=this.session.state.remoteWindowSize)&&void 0!==r?r:null}}trace(e){l.trace(a.LogVerbosity.DEBUG,m,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}keepaliveTrace(e){l.trace(a.LogVerbosity.DEBUG,"keepalive","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}flowControlTrace(e){l.trace(a.LogVerbosity.DEBUG,g,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}internalsTrace(e){l.trace(a.LogVerbosity.DEBUG,"transport_internals","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}reportDisconnectToOwner(e){this.disconnectHandled||(this.disconnectHandled=!0,this.disconnectListeners.forEach(t=>t(e)))}handleDisconnect(){this.reportDisconnectToOwner(!1),setImmediate(()=>{for(let e of this.activeCalls)e.onDisconnect()})}addDisconnectListener(e){this.disconnectListeners.push(e)}clearKeepaliveTimer(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null)}clearKeepaliveTimeout(){this.keepaliveTimeoutId&&(clearTimeout(this.keepaliveTimeoutId),this.keepaliveTimeoutId=null)}canSendPing(){return this.keepaliveTimeMs>0&&(this.keepaliveWithoutCalls||this.activeCalls.size>0)}maybeSendPing(){var e,t;if(this.clearKeepaliveTimer(),!this.canSendPing()){this.pendingSendKeepalivePing=!0;return}this.channelzEnabled&&(this.keepalivesSent+=1),this.keepaliveTrace("Sending ping with timeout "+this.keepaliveTimeoutMs+"ms"),this.keepaliveTimeoutId||(this.keepaliveTimeoutId=setTimeout(()=>{this.keepaliveTrace("Ping timeout passed without response"),this.handleDisconnect()},this.keepaliveTimeoutMs),null===(t=(e=this.keepaliveTimeoutId).unref)||void 0===t||t.call(e));try{this.session.ping((e,t,r)=>{e&&(this.keepaliveTrace("Ping failed with error "+e.message),this.handleDisconnect()),this.keepaliveTrace("Received ping response"),this.clearKeepaliveTimeout(),this.maybeStartKeepalivePingTimer()})}catch(e){this.handleDisconnect()}}maybeStartKeepalivePingTimer(){var e,t;this.canSendPing()&&(this.pendingSendKeepalivePing?(this.pendingSendKeepalivePing=!1,this.maybeSendPing()):this.keepaliveTimerId||this.keepaliveTimeoutId||(this.keepaliveTrace("Starting keepalive timer for "+this.keepaliveTimeMs+"ms"),this.keepaliveTimerId=null===(t=(e=setTimeout(()=>{this.maybeSendPing()},this.keepaliveTimeMs)).unref)||void 0===t?void 0:t.call(e)))}stopKeepalivePings(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null),this.clearKeepaliveTimeout()}removeActiveCall(e){this.activeCalls.delete(e),0===this.activeCalls.size&&this.session.unref()}addActiveCall(e){this.activeCalls.add(e),1!==this.activeCalls.size||(this.session.ref(),this.keepaliveWithoutCalls||this.maybeStartKeepalivePingTimer())}createCall(e,t,r,n,i){let s,a,o;let l=e.toHttp2Headers();l[v]=t,l[w]=this.userAgent,l[b]="application/grpc",l[T]="POST",l[S]=r,l[E]="trailers";try{s=this.session.request(l)}catch(e){throw this.handleDisconnect(),e}return this.flowControlTrace("local window size: "+this.session.state.localWindowSize+" remote window size: "+this.session.state.remoteWindowSize),this.internalsTrace("session.closed="+this.session.closed+" session.destroyed="+this.session.destroyed+" session.socket.destroyed="+this.session.socket.destroyed),this.channelzEnabled?(this.streamTracker.addCallStarted(),a={addMessageSent:()=>{var e;this.messagesSent+=1,this.lastMessageSentTimestamp=new Date,null===(e=i.addMessageSent)||void 0===e||e.call(i)},addMessageReceived:()=>{var e;this.messagesReceived+=1,this.lastMessageReceivedTimestamp=new Date,null===(e=i.addMessageReceived)||void 0===e||e.call(i)},onCallEnd:e=>{var t;null===(t=i.onCallEnd)||void 0===t||t.call(i,e),this.removeActiveCall(o)},onStreamEnd:e=>{var t;e?this.streamTracker.addCallSucceeded():this.streamTracker.addCallFailed(),null===(t=i.onStreamEnd)||void 0===t||t.call(i,e)}}):a={addMessageSent:()=>{var e;null===(e=i.addMessageSent)||void 0===e||e.call(i)},addMessageReceived:()=>{var e;null===(e=i.addMessageReceived)||void 0===e||e.call(i)},onCallEnd:e=>{var t;null===(t=i.onCallEnd)||void 0===t||t.call(i,e),this.removeActiveCall(o)},onStreamEnd:e=>{var t;null===(t=i.onStreamEnd)||void 0===t||t.call(i,e)}},o=new p.Http2SubchannelCall(s,a,n,this,(0,f.getNextCallNumber)()),this.addActiveCall(o),o}getChannelzRef(){return this.channelzRef}getPeerName(){return this.subchannelAddressString}getOptions(){return this.options}shutdown(){this.session.close(),(0,s.unregisterChannelzRef)(this.channelzRef)}}class R{constructor(e){this.channelTarget=e,this.session=null,this.isShutdown=!1}trace(e){l.trace(a.LogVerbosity.DEBUG,m,(0,h.uriToString)(this.channelTarget)+" "+e)}createSession(e,t,r,s){return this.isShutdown?Promise.reject():new Promise((a,o)=>{var l,p,f;let m;s.realTarget?(m=(0,h.uriToString)(s.realTarget),this.trace("creating HTTP/2 session through proxy to "+(0,h.uriToString)(s.realTarget))):(m=null,this.trace("creating HTTP/2 session to "+(0,c.subchannelAddressToString)(e)));let g=(0,u.getDefaultAuthority)(null!==(l=s.realTarget)&&void 0!==l?l:this.channelTarget),y=t._getConnectionOptions()||{};y.maxSendHeaderBlockLength=Number.MAX_SAFE_INTEGER,"grpc-node.max_session_memory"in r?y.maxSessionMemory=r["grpc-node.max_session_memory"]:y.maxSessionMemory=Number.MAX_SAFE_INTEGER;let v="http://";if("secureContext"in y){if(v="https://",r["grpc.ssl_target_name_override"]){let e=r["grpc.ssl_target_name_override"];y.checkServerIdentity=(t,r)=>(0,i.checkServerIdentity)(e,r),y.servername=e}else{let e=null!==(f=null===(p=(0,h.splitHostPort)(g))||void 0===p?void 0:p.host)&&void 0!==f?f:"localhost";y.servername=e}s.socket&&(y.createConnection=(e,t)=>s.socket)}else y.createConnection=(t,r)=>s.socket?s.socket:d.connect(e);y=Object.assign(Object.assign(Object.assign({},y),e),{enableTrace:1===r["grpc-node.tls_enable_trace"]});let b=n.connect(v+g,y);this.session=b;let T="Failed to connect";b.unref(),b.once("connect",()=>{b.removeAllListeners(),a(new I(b,e,r,m)),this.session=null}),b.once("close",()=>{this.session=null,setImmediate(()=>{o(`${T} (${new Date().toISOString()})`)})}),b.once("error",e=>{T=e.message,this.trace("connection failed with error "+T)})})}connect(e,t,r){var n,s;if(this.isShutdown)return Promise.reject();let a=t._getConnectionOptions()||{};if("secureContext"in a){if(a.ALPNProtocols=["h2"],r["grpc.ssl_target_name_override"]){let e=r["grpc.ssl_target_name_override"];a.checkServerIdentity=(t,r)=>(0,i.checkServerIdentity)(e,r),a.servername=e}else if("grpc.http_connect_target"in r){let e=(0,u.getDefaultAuthority)(null!==(n=(0,h.parseUri)(r["grpc.http_connect_target"]))&&void 0!==n?n:{path:"localhost"}),t=(0,h.splitHostPort)(e);a.servername=null!==(s=null==t?void 0:t.host)&&void 0!==s?s:e}r["grpc-node.tls_enable_trace"]&&(a.enableTrace=!0)}return(0,o.getProxiedConnection)(e,r,a).then(n=>this.createSession(e,t,r,n))}shutdown(){var e;this.isShutdown=!0,null===(e=this.session)||void 0===e||e.close(),this.session=null}}t.Http2SubchannelConnector=R},5773:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.uriToString=t.splitHostPort=t.parseUri=void 0;let r=/^(?:([A-Za-z0-9+.-]+):)?(?:\/\/([^/]*)\/)?(.+)$/;function n(e){let t=r.exec(e);return null===t?null:{scheme:t[1],authority:t[2],path:t[3]}}t.parseUri=n;let i=/^\d+$/;function s(e){if(e.startsWith("[")){let t=e.indexOf("]");if(-1===t)return null;let r=e.substring(1,t);if(-1===r.indexOf(":"))return null;if(!(e.length>t+1))return{host:r};if(":"!==e[t+1])return null;{let n=e.substring(t+2);return i.test(n)?{host:r,port:+n}:null}}{let t=e.split(":");return 2!==t.length?{host:e}:i.test(t[1])?{host:t[0],port:+t[1]}:null}}function a(e){let t="";return void 0!==e.scheme&&(t+=e.scheme+":"),void 0!==e.authority&&(t+="//"+e.authority+"/"),t+=e.path}t.splitHostPort=s,t.uriToString=a},3716:(e,t,r)=>{"use strict";var n,i;n={value:!0},n=n=t.im=t.J_=n=t.Cp=n=n=void 0;let s=r(9739),a=r(1101),o=r(2607),l=r(8720);n=r(29),n=function(e){return"@type"in e&&"string"==typeof e["@type"]},function(e){e.IDEMPOTENCY_UNKNOWN="IDEMPOTENCY_UNKNOWN",e.NO_SIDE_EFFECTS="NO_SIDE_EFFECTS",e.IDEMPOTENT="IDEMPOTENT"}(i=t.Cp||(t.Cp={}));let u={longs:String,enums:String,bytes:String,defaults:!0,oneofs:!0,json:!0};function c(e,t){return""===e?t:e+"."+t}function h(e){return e instanceof a.Service||e instanceof a.Type||e instanceof a.Enum}function d(e){return e instanceof a.Namespace||e instanceof a.Root}function p(e,t){let r=c(t,e.name);return h(e)?[[r,e]]:d(e)&&void 0!==e.nested?Object.keys(e.nested).map(t=>p(e.nested[t],r)).reduce((e,t)=>e.concat(t),[]):[]}function f(e,t){return function(r){return e.toObject(e.decode(r),t)}}function m(e){return function(t){if(Array.isArray(t))throw Error(`Failed to serialize message: expected object with ${e.name} structure, got array instead`);let r=e.fromObject(t);return e.encode(r).finish()}}function g(e){return(e||[]).reduce((e,t)=>{for(let[r,n]of Object.entries(t))"uninterpreted_option"===r?e.uninterpreted_option.push(t.uninterpreted_option):e[r]=n;return e},{deprecated:!1,idempotency_level:i.IDEMPOTENCY_UNKNOWN,uninterpreted_option:[]})}function y(e,t,r,n){let i=e.resolvedRequestType,a=e.resolvedResponseType;return{path:"/"+t+"/"+e.name,requestStream:!!e.requestStream,responseStream:!!e.responseStream,requestSerialize:m(i),requestDeserialize:f(i,r),responseSerialize:m(a),responseDeserialize:f(a,r),originalName:s(e.name),requestType:b(i,n),responseType:b(a,n),options:g(e.parsedOptions)}}function v(e,t,r,n){let i={};for(let s of e.methodsArray)i[s.name]=y(s,t,r,n);return i}function b(e,t){let r=e.toDescriptor("proto3");return{format:"Protocol Buffer 3 DescriptorProto",type:r.$type.toObject(r,u),fileDescriptorProtos:t}}function T(e,t){let r=e.toDescriptor("proto3");return{format:"Protocol Buffer 3 EnumDescriptorProto",type:r.$type.toObject(r,u),fileDescriptorProtos:t}}function S(e,t,r,n){if(e instanceof a.Service)return v(e,t,r,n);if(e instanceof a.Type)return b(e,n);if(e instanceof a.Enum)return T(e,n);throw Error("Type mismatch in reflection object handling")}function E(e,t){let r={};e.resolveAll();let n=e.toDescriptor("proto3").file.map(e=>Buffer.from(o.FileDescriptorProto.encode(e).finish()));for(let[i,s]of p(e,""))r[i]=S(s,i,t,n);return r}function w(e,t){t=t||{};let r=a.Root.fromDescriptor(e);return r.resolveAll(),E(r,t)}function C(e,t){return E((0,l.loadProtosWithOptionsSync)(e,t),t)}function _(e,t){t=t||{};let r=a.Root.fromJSON(e);return r.resolveAll(),E(r,t)}n=function(e,t){return(0,l.loadProtosWithOptions)(e,t).then(e=>E(e,t))},t.J_=C,t.im=_,n=function(e,t){return w(o.FileDescriptorSet.decode(e),t)},n=function(e,t){return w(o.FileDescriptorSet.fromObject(e),t)},(0,l.addCommonProtos)()},8720:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addCommonProtos=t.loadProtosWithOptionsSync=t.loadProtosWithOptions=void 0;let n=r(2048),i=r(5315),s=r(1101);function a(e,t){let r=e.resolvePath;e.resolvePath=(e,s)=>{if(i.isAbsolute(s))return s;for(let e of t){let t=i.join(e,s);try{return n.accessSync(t,n.constants.R_OK),t}catch(e){continue}}return process.emitWarning(`${s} not found in any of the include paths ${t}`),r(e,s)}}async function o(e,t){let r=new s.Root;if((t=t||{}).includeDirs){if(!Array.isArray(t.includeDirs))return Promise.reject(Error("The includeDirs option must be an array"));a(r,t.includeDirs)}let n=await r.load(e,t);return n.resolveAll(),n}function l(e,t){let r=new s.Root;if((t=t||{}).includeDirs){if(!Array.isArray(t.includeDirs))throw Error("The includeDirs option must be an array");a(r,t.includeDirs)}let n=r.loadSync(e,t);return n.resolveAll(),n}function u(){let e=r(6541),t=r(9987),n=r(7674),i=r(3795);s.common("api",e.nested.google.nested.protobuf.nested),s.common("descriptor",t.nested.google.nested.protobuf.nested),s.common("source_context",n.nested.google.nested.protobuf.nested),s.common("type",i.nested.google.nested.protobuf.nested)}t.loadProtosWithOptions=o,t.loadProtosWithOptionsSync=l,t.addCommonProtos=u},1417:e=>{"use strict";function t(e,t){for(var r=Array(arguments.length-1),n=0,i=2,s=!0;i<arguments.length;)r[n++]=arguments[i++];return new Promise(function(i,a){r[n]=function(e){if(s){if(s=!1,e)a(e);else{for(var t=Array(arguments.length-1),r=0;r<t.length;)t[r++]=arguments[r];i.apply(null,t)}}};try{e.apply(t||null,r)}catch(e){s&&(s=!1,a(e))}})}e.exports=t},5386:(e,t)=>{"use strict";var r=t;r.length=function(e){var t=e.length;if(!t)return 0;for(var r=0;--t%4>1&&"="===e.charAt(t);)++r;return Math.ceil(3*e.length)/4-r};for(var n=Array(64),i=Array(123),s=0;s<64;)i[n[s]=s<26?s+65:s<52?s+71:s<62?s-4:s-59|43]=s++;r.encode=function(e,t,r){for(var i,s=null,a=[],o=0,l=0;t<r;){var u=e[t++];switch(l){case 0:a[o++]=n[u>>2],i=(3&u)<<4,l=1;break;case 1:a[o++]=n[i|u>>4],i=(15&u)<<2,l=2;break;case 2:a[o++]=n[i|u>>6],a[o++]=n[63&u],l=0}o>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,a)),o=0)}return(l&&(a[o++]=n[i],a[o++]=61,1===l&&(a[o++]=61)),s)?(o&&s.push(String.fromCharCode.apply(String,a.slice(0,o))),s.join("")):String.fromCharCode.apply(String,a.slice(0,o))};var a="invalid encoding";r.decode=function(e,t,r){for(var n,s=r,o=0,l=0;l<e.length;){var u=e.charCodeAt(l++);if(61===u&&o>1)break;if(void 0===(u=i[u]))throw Error(a);switch(o){case 0:n=u,o=1;break;case 1:t[r++]=n<<2|(48&u)>>4,n=u,o=2;break;case 2:t[r++]=(15&n)<<4|(60&u)>>2,n=u,o=3;break;case 3:t[r++]=(3&n)<<6|u,o=0}}if(1===o)throw Error(a);return r-s},r.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}},696:e=>{"use strict";function t(e,r){"string"==typeof e&&(r=e,e=void 0);var n=[];function i(e){if("string"!=typeof e){var r=s();if(t.verbose&&console.log("codegen: "+r),r="return "+r,e){for(var a=Object.keys(e),o=Array(a.length+1),l=Array(a.length),u=0;u<a.length;)o[u]=a[u],l[u]=e[a[u++]];return o[u]=r,Function.apply(null,o).apply(null,l)}return Function(r)()}for(var c=Array(arguments.length-1),h=0;h<c.length;)c[h]=arguments[++h];if(h=0,e=e.replace(/%([%dfijs])/g,function(e,t){var r=c[h++];switch(t){case"d":case"f":return String(Number(r));case"i":return String(Math.floor(r));case"j":return JSON.stringify(r);case"s":return String(r)}return"%"}),h!==c.length)throw Error("parameter count mismatch");return n.push(e),i}function s(t){return"function "+(t||r||"")+"("+(e&&e.join(",")||"")+"){\n  "+n.join("\n  ")+"\n}"}return i.toString=s,i}e.exports=t,t.verbose=!1},3478:e=>{"use strict";function t(){this._listeners={}}e.exports=t,t.prototype.on=function(e,t,r){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:r||this}),this},t.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else for(var r=this._listeners[e],n=0;n<r.length;)r[n].fn===t?r.splice(n,1):++n;return this},t.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var r=[],n=1;n<arguments.length;)r.push(arguments[n++]);for(n=0;n<t.length;)t[n].fn.apply(t[n++].ctx,r)}return this}},7828:(e,t,r)=>{"use strict";e.exports=s;var n=r(1417),i=r(1374)("fs");function s(e,t,r){return("function"==typeof t?(r=t,t={}):t||(t={}),r)?!t.xhr&&i&&i.readFile?i.readFile(e,function(n,i){return n&&"undefined"!=typeof XMLHttpRequest?s.xhr(e,t,r):n?r(n):r(null,t.binary?i:i.toString("utf8"))}):s.xhr(e,t,r):n(s,this,e,t)}s.xhr=function(e,t,r){var n=new XMLHttpRequest;n.onreadystatechange=function(){if(4===n.readyState){if(0!==n.status&&200!==n.status)return r(Error("status "+n.status));if(t.binary){var e=n.response;if(!e){e=[];for(var i=0;i<n.responseText.length;++i)e.push(255&n.responseText.charCodeAt(i))}return r(null,"undefined"!=typeof Uint8Array?new Uint8Array(e):e)}return r(null,n.responseText)}},t.binary&&("overrideMimeType"in n&&n.overrideMimeType("text/plain; charset=x-user-defined"),n.responseType="arraybuffer"),n.open("GET",e),n.send()}},5256:e=>{"use strict";function t(e){return"undefined"!=typeof Float32Array?function(){var t=new Float32Array([-0]),r=new Uint8Array(t.buffer),n=128===r[3];function i(e,n,i){t[0]=e,n[i]=r[0],n[i+1]=r[1],n[i+2]=r[2],n[i+3]=r[3]}function s(e,n,i){t[0]=e,n[i]=r[3],n[i+1]=r[2],n[i+2]=r[1],n[i+3]=r[0]}function a(e,n){return r[0]=e[n],r[1]=e[n+1],r[2]=e[n+2],r[3]=e[n+3],t[0]}function o(e,n){return r[3]=e[n],r[2]=e[n+1],r[1]=e[n+2],r[0]=e[n+3],t[0]}e.writeFloatLE=n?i:s,e.writeFloatBE=n?s:i,e.readFloatLE=n?a:o,e.readFloatBE=n?o:a}():function(){function t(e,t,r,n){var i=t<0?1:0;if(i&&(t=-t),0===t)e(1/t>0?0:2147483648,r,n);else if(isNaN(t))e(2143289344,r,n);else if(t>34028234663852886e22)e((i<<31|2139095040)>>>0,r,n);else if(t<11754943508222875e-54)e((i<<31|Math.round(t/1401298464324817e-60))>>>0,r,n);else{var s=Math.floor(Math.log(t)/Math.LN2),a=8388607&Math.round(t*Math.pow(2,-s)*8388608);e((i<<31|s+127<<23|a)>>>0,r,n)}}function a(e,t,r){var n=e(t,r),i=(n>>31)*2+1,s=n>>>23&255,a=8388607&n;return 255===s?a?NaN:1/0*i:0===s?1401298464324817e-60*i*a:i*Math.pow(2,s-150)*(a+8388608)}e.writeFloatLE=t.bind(null,r),e.writeFloatBE=t.bind(null,n),e.readFloatLE=a.bind(null,i),e.readFloatBE=a.bind(null,s)}(),"undefined"!=typeof Float64Array?function(){var t=new Float64Array([-0]),r=new Uint8Array(t.buffer),n=128===r[7];function i(e,n,i){t[0]=e,n[i]=r[0],n[i+1]=r[1],n[i+2]=r[2],n[i+3]=r[3],n[i+4]=r[4],n[i+5]=r[5],n[i+6]=r[6],n[i+7]=r[7]}function s(e,n,i){t[0]=e,n[i]=r[7],n[i+1]=r[6],n[i+2]=r[5],n[i+3]=r[4],n[i+4]=r[3],n[i+5]=r[2],n[i+6]=r[1],n[i+7]=r[0]}function a(e,n){return r[0]=e[n],r[1]=e[n+1],r[2]=e[n+2],r[3]=e[n+3],r[4]=e[n+4],r[5]=e[n+5],r[6]=e[n+6],r[7]=e[n+7],t[0]}function o(e,n){return r[7]=e[n],r[6]=e[n+1],r[5]=e[n+2],r[4]=e[n+3],r[3]=e[n+4],r[2]=e[n+5],r[1]=e[n+6],r[0]=e[n+7],t[0]}e.writeDoubleLE=n?i:s,e.writeDoubleBE=n?s:i,e.readDoubleLE=n?a:o,e.readDoubleBE=n?o:a}():function(){function t(e,t,r,n,i,s){var a,o=n<0?1:0;if(o&&(n=-n),0===n)e(0,i,s+t),e(1/n>0?0:2147483648,i,s+r);else if(isNaN(n))e(0,i,s+t),e(2146959360,i,s+r);else if(n>17976931348623157e292)e(0,i,s+t),e((o<<31|2146435072)>>>0,i,s+r);else if(n<22250738585072014e-324)e((a=n/5e-324)>>>0,i,s+t),e((o<<31|a/4294967296)>>>0,i,s+r);else{var l=Math.floor(Math.log(n)/Math.LN2);1024===l&&(l=1023),e(4503599627370496*(a=n*Math.pow(2,-l))>>>0,i,s+t),e((o<<31|l+1023<<20|1048576*a&1048575)>>>0,i,s+r)}}function a(e,t,r,n,i){var s=e(n,i+t),a=e(n,i+r),o=(a>>31)*2+1,l=a>>>20&2047,u=4294967296*(1048575&a)+s;return 2047===l?u?NaN:1/0*o:0===l?5e-324*o*u:o*Math.pow(2,l-1075)*(u+4503599627370496)}e.writeDoubleLE=t.bind(null,r,0,4),e.writeDoubleBE=t.bind(null,n,4,0),e.readDoubleLE=a.bind(null,i,0,4),e.readDoubleBE=a.bind(null,s,4,0)}(),e}function r(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}function n(e,t,r){t[r]=e>>>24,t[r+1]=e>>>16&255,t[r+2]=e>>>8&255,t[r+3]=255&e}function i(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function s(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}e.exports=t(t)},1374:module=>{"use strict";function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}module.exports=inquire},2727:(e,t)=>{"use strict";var r=t,n=r.isAbsolute=function(e){return/^(?:\/|\w+:)/.test(e)},i=r.normalize=function(e){var t=(e=e.replace(/\\/g,"/").replace(/\/{2,}/g,"/")).split("/"),r=n(e),i="";r&&(i=t.shift()+"/");for(var s=0;s<t.length;)".."===t[s]?s>0&&".."!==t[s-1]?t.splice(--s,2):r?t.splice(s,1):++s:"."===t[s]?t.splice(s,1):++s;return i+t.join("/")};r.resolve=function(e,t,r){return(r||(t=i(t)),n(t))?t:(r||(e=i(e)),(e=e.replace(/(?:\/|^)[^/]+$/,"")).length?i(e+"/"+t):t)}},6733:e=>{"use strict";function t(e,t,r){var n=r||8192,i=n>>>1,s=null,a=n;return function(r){if(r<1||r>i)return e(r);a+r>n&&(s=e(n),a=0);var o=t.call(s,a,a+=r);return 7&a&&(a=(7|a)+1),o}}e.exports=t},3670:(e,t)=>{"use strict";var r=t;r.length=function(e){for(var t=0,r=0,n=0;n<e.length;++n)(r=e.charCodeAt(n))<128?t+=1:r<2048?t+=2:(64512&r)==55296&&(64512&e.charCodeAt(n+1))==56320?(++n,t+=4):t+=3;return t},r.read=function(e,t,r){if(r-t<1)return"";for(var n,i=null,s=[],a=0;t<r;)(n=e[t++])<128?s[a++]=n:n>191&&n<224?s[a++]=(31&n)<<6|63&e[t++]:n>239&&n<365?(n=((7&n)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,s[a++]=55296+(n>>10),s[a++]=56320+(1023&n)):s[a++]=(15&n)<<12|(63&e[t++])<<6|63&e[t++],a>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,s)),a=0);return i?(a&&i.push(String.fromCharCode.apply(String,s.slice(0,a))),i.join("")):String.fromCharCode.apply(String,s.slice(0,a))},r.write=function(e,t,r){for(var n,i,s=r,a=0;a<e.length;++a)(n=e.charCodeAt(a))<128?t[r++]=n:(n<2048?t[r++]=n>>6|192:((64512&n)==55296&&(64512&(i=e.charCodeAt(a+1)))==56320?(n=65536+((1023&n)<<10)+(1023&i),++a,t[r++]=n>>18|240,t[r++]=n>>12&63|128):t[r++]=n>>12|224,t[r++]=n>>6&63|128),t[r++]=63&n|128);return r-s}},9739:e=>{var t=1/0,r="[object Symbol]",n=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,i=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,s="\ud800-\udfff",a="\\u0300-\\u036f\\ufe20-\\ufe23",o="\\u20d0-\\u20f0",l="\\u2700-\\u27bf",u="a-z\\xdf-\\xf6\\xf8-\\xff",c="A-Z\\xc0-\\xd6\\xd8-\\xde",h="\\ufe0e\\ufe0f",d="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",p="[']",f="["+s+"]",m="["+d+"]",g="["+a+o+"]",y="\\d+",v="["+l+"]",b="["+u+"]",T="[^"+s+d+y+l+u+c+"]",S="\ud83c[\udffb-\udfff]",E="[^"+s+"]",w="(?:\ud83c[\udde6-\uddff]){2}",C="[\ud800-\udbff][\udc00-\udfff]",_="["+c+"]",I="\\u200d",R="(?:"+b+"|"+T+")",N="(?:"+_+"|"+T+")",k="(?:"+p+"(?:d|ll|m|re|s|t|ve))?",A="(?:"+p+"(?:D|LL|M|RE|S|T|VE))?",D="(?:"+g+"|"+S+")?",O="["+h+"]?",x="(?:"+I+"(?:"+[E,w,C].join("|")+")"+O+D+")*",P=O+D+x,M="(?:"+[v,w,C].join("|")+")"+P,L="(?:"+[E+g+"?",g,w,C,f].join("|")+")",F=RegExp(p,"g"),B=RegExp(g,"g"),U=RegExp(S+"(?="+S+")|"+L+P,"g"),V=RegExp([_+"?"+b+"+"+k+"(?="+[m,_,"$"].join("|")+")",N+"+"+A+"(?="+[m,_+R,"$"].join("|")+")",_+"?"+R+"+"+k,_+"+"+A,y,M].join("|"),"g"),j=RegExp("["+I+s+a+o+h+"]"),z=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,q={:"A",:"A",:"A",:"A",:"A",:"A",:"a",:"a",:"a",:"a",:"a",:"a",:"C",:"c",:"D",:"d",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"N",:"n",:"O",:"O",:"O",:"O",:"O",:"O",:"o",:"o",:"o",:"o",:"o",:"o",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"Y",:"y",:"y",:"Ae",:"ae",:"Th",:"th",:"ss",:"A",:"A",:"A",:"a",:"a",:"a",:"C",:"C",:"C",:"C",:"c",:"c",:"c",:"c",:"D",:"D",:"d",:"d",:"E",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"e",:"G",:"G",:"G",:"G",:"g",:"g",:"g",:"g",:"H",:"H",:"h",:"h",:"I",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"i",:"J",:"j",:"K",:"k",:"k",:"L",:"L",:"L",:"L",:"L",:"l",:"l",:"l",:"l",:"l",:"N",:"N",:"N",:"N",:"n",:"n",:"n",:"n",:"O",:"O",:"O",:"o",:"o",:"o",:"R",:"R",:"R",:"r",:"r",:"r",:"S",:"S",:"S",:"S",:"s",:"s",:"s",:"s",:"T",:"T",:"T",:"t",:"t",:"t",:"U",:"U",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"u",:"u",:"W",:"w",:"Y",:"y",:"Y",:"Z",:"Z",:"Z",:"z",:"z",:"z",:"IJ",:"ij",:"Oe",:"oe",:"'n",:"ss"},G="object"==typeof global&&global&&global.Object===Object&&global,$="object"==typeof self&&self&&self.Object===Object&&self,K=G||$||Function("return this")();function W(e,t,r,n){var i=-1,s=e?e.length:0;for(n&&s&&(r=e[++i]);++i<s;)r=t(r,e[i],i,e);return r}function H(e){return e.split("")}function Q(e){return e.match(n)||[]}var Y=function(e){return function(t){return null==e?void 0:e[t]}}(q);function J(e){return j.test(e)}function X(e){return z.test(e)}function Z(e){return J(e)?ee(e):H(e)}function ee(e){return e.match(U)||[]}function et(e){return e.match(V)||[]}var er=Object.prototype.toString,en=K.Symbol,ei=en?en.prototype:void 0,es=ei?ei.toString:void 0;function ea(e,t,r){var n=-1,i=e.length;t<0&&(t=-t>i?0:i+t),(r=r>i?i:r)<0&&(r+=i),i=t>r?0:r-t>>>0,t>>>=0;for(var s=Array(i);++n<i;)s[n]=e[n+t];return s}function eo(e){if("string"==typeof e)return e;if(eh(e))return es?es.call(e):"";var r=e+"";return"0"==r&&1/e==-t?"-0":r}function el(e,t,r){var n=e.length;return r=void 0===r?n:r,!t&&r>=n?e:ea(e,t,r)}function eu(e){return function(t){var r=J(t=ed(t))?Z(t):void 0,n=r?r[0]:t.charAt(0),i=r?el(r,1).join(""):t.slice(1);return n[e]()+i}}function ec(e){return!!e&&"object"==typeof e}function eh(e){return"symbol"==typeof e||ec(e)&&er.call(e)==r}function ed(e){return null==e?"":eo(e)}var ep=function(e){return function(t){return W(ey(em(t).replace(F,"")),e,"")}}(function(e,t,r){return t=t.toLowerCase(),e+(r?ef(t):t)});function ef(e){return eg(ed(e).toLowerCase())}function em(e){return(e=ed(e))&&e.replace(i,Y).replace(B,"")}var eg=eu("toUpperCase");function ey(e,t,r){return(e=ed(e),void 0===(t=r?void 0:t))?X(e)?et(e):Q(e):e.match(t)||[]}e.exports=ep},434:(e,t,r)=>{"use strict";r.d(t,{default:()=>i.a});var n=r(9404),i=r.n(n)},5047:(e,t,r)=>{"use strict";var n=r(7389);r.o(n,"usePathname")&&r.d(t,{usePathname:function(){return n.usePathname}}),r.o(n,"useRouter")&&r.d(t,{useRouter:function(){return n.useRouter}})},2607:(e,t,r)=>{"use strict";var n=r(1101);e.exports=t=n.descriptor=n.Root.fromJSON(r(9987)).lookup(".google.protobuf");var i=n.Namespace,s=n.Root,a=n.Enum,o=n.Type,l=n.Field,u=n.MapField,c=n.OneOf,h=n.Service,d=n.Method;function p(e,r,n){var u=t.FileDescriptorProto.create({name:e.filename||(e.fullName.substring(1).replace(/\./g,"_")||"root")+".proto"});A(n,u),e instanceof s||(u.package=e.fullName.substring(1));for(var c,d=0;d<e.nestedArray.length;++d)(c=e._nestedArray[d])instanceof o?u.messageType.push(c.toDescriptor(n)):c instanceof a?u.enumType.push(c.toDescriptor()):c instanceof l?u.extension.push(c.toDescriptor(n)):c instanceof h?u.service.push(c.toDescriptor()):c instanceof i&&p(c,r,n);u.options=I(e.options,t.FileOptions),u.messageType.length+u.enumType.length+u.extension.length+u.service.length&&r.push(u)}s.fromDescriptor=function(e){"number"==typeof e.length&&(e=t.FileDescriptorSet.decode(e));var r=new s;if(e.file)for(var n,i,u,c=0;c<e.file.length;++c){i=r,(n=e.file[c]).package&&n.package.length&&(i=r.define(n.package));var d=k(n);if(n.name&&n.name.length&&r.files.push(i.filename=n.name),n.messageType)for(u=0;u<n.messageType.length;++u)i.add(o.fromDescriptor(n.messageType[u],d));if(n.enumType)for(u=0;u<n.enumType.length;++u)i.add(a.fromDescriptor(n.enumType[u],d));if(n.extension)for(u=0;u<n.extension.length;++u)i.add(l.fromDescriptor(n.extension[u],d));if(n.service)for(u=0;u<n.service.length;++u)i.add(h.fromDescriptor(n.service[u],d));var p=C(n.options,t.FileOptions);if(p){var f=Object.keys(p);for(u=0;u<f.length;++u)i.setOption(f[u],p[f[u]])}}return r.resolveAll()},s.prototype.toDescriptor=function(e){var r=t.FileDescriptorSet.create();return p(this,r.file,e),r};var f=0;o.fromDescriptor=function(e,r,n){"number"==typeof e.length&&(e=t.DescriptorProto.decode(e));var i,s=new o(e.name.length?e.name:"Type"+f++,C(e.options,t.MessageOptions));if(n||(s._edition=r),e.oneofDecl)for(i=0;i<e.oneofDecl.length;++i)s.add(c.fromDescriptor(e.oneofDecl[i]));if(e.field)for(i=0;i<e.field.length;++i){var u=l.fromDescriptor(e.field[i],r,!0);s.add(u),e.field[i].hasOwnProperty("oneofIndex")&&s.oneofsArray[e.field[i].oneofIndex].add(u)}if(e.extension)for(i=0;i<e.extension.length;++i)s.add(l.fromDescriptor(e.extension[i],r,!0));if(e.nestedType)for(i=0;i<e.nestedType.length;++i)s.add(o.fromDescriptor(e.nestedType[i],r,!0)),e.nestedType[i].options&&e.nestedType[i].options.mapEntry&&s.setOption("map_entry",!0);if(e.enumType)for(i=0;i<e.enumType.length;++i)s.add(a.fromDescriptor(e.enumType[i],r,!0));if(e.extensionRange&&e.extensionRange.length)for(i=0,s.extensions=[];i<e.extensionRange.length;++i)s.extensions.push([e.extensionRange[i].start,e.extensionRange[i].end]);if(e.reservedRange&&e.reservedRange.length||e.reservedName&&e.reservedName.length){if(s.reserved=[],e.reservedRange)for(i=0;i<e.reservedRange.length;++i)s.reserved.push([e.reservedRange[i].start,e.reservedRange[i].end]);if(e.reservedName)for(i=0;i<e.reservedName.length;++i)s.reserved.push(e.reservedName[i])}return s},o.prototype.toDescriptor=function(e){var r,n,i=t.DescriptorProto.create({name:this.name});for(n=0;n<this.fieldsArray.length;++n)if(i.field.push(r=this._fieldsArray[n].toDescriptor(e)),this._fieldsArray[n]instanceof u){var s=E(this._fieldsArray[n].keyType,this._fieldsArray[n].resolvedKeyType,!1),c=E(this._fieldsArray[n].type,this._fieldsArray[n].resolvedType,!1),h=11===c||14===c?this._fieldsArray[n].resolvedType&&R(this.parent,this._fieldsArray[n].resolvedType)||this._fieldsArray[n].type:void 0;i.nestedType.push(t.DescriptorProto.create({name:r.typeName,field:[t.FieldDescriptorProto.create({name:"key",number:1,label:1,type:s}),t.FieldDescriptorProto.create({name:"value",number:2,label:1,type:c,typeName:h})],options:t.MessageOptions.create({mapEntry:!0})}))}for(n=0;n<this.oneofsArray.length;++n)i.oneofDecl.push(this._oneofsArray[n].toDescriptor());for(n=0;n<this.nestedArray.length;++n)this._nestedArray[n]instanceof l?i.field.push(this._nestedArray[n].toDescriptor(e)):this._nestedArray[n]instanceof o?i.nestedType.push(this._nestedArray[n].toDescriptor(e)):this._nestedArray[n]instanceof a&&i.enumType.push(this._nestedArray[n].toDescriptor());if(this.extensions)for(n=0;n<this.extensions.length;++n)i.extensionRange.push(t.DescriptorProto.ExtensionRange.create({start:this.extensions[n][0],end:this.extensions[n][1]}));if(this.reserved)for(n=0;n<this.reserved.length;++n)"string"==typeof this.reserved[n]?i.reservedName.push(this.reserved[n]):i.reservedRange.push(t.DescriptorProto.ReservedRange.create({start:this.reserved[n][0],end:this.reserved[n][1]}));return i.options=I(this.options,t.MessageOptions),i};var m=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/;l.fromDescriptor=function(e,r,n){if("number"==typeof e.length&&(e=t.DescriptorProto.decode(e)),"number"!=typeof e.number)throw Error("missing field id");switch(i=e.typeName&&e.typeName.length?e.typeName:T(e.type),e.label){case 1:s=void 0;break;case 2:s="required";break;case 3:s="repeated";break;default:throw Error("illegal label: "+e.label)}var i,s,a=e.extendee;void 0!==e.extendee&&(a=a.length?a:void 0);var o=new l(e.name.length?e.name:"field"+e.number,e.number,i,s,a);if(n||(o._edition=r),o.options=C(e.options,t.FieldOptions),e.proto3_optional&&(o.options.proto3_optional=!0),e.defaultValue&&e.defaultValue.length){var u=e.defaultValue;switch(u){case"true":case"TRUE":u=!0;break;case"false":case"FALSE":u=!1;break;default:m.exec(u)&&(u=parseInt(u))}o.setOption("default",u)}return S(e.type)&&("proto3"===r?e.options&&!e.options.packed&&o.setOption("packed",!1):(!r||"proto2"===r)&&e.options&&e.options.packed&&o.setOption("packed",!0)),o},l.prototype.toDescriptor=function(e){var r=t.FieldDescriptorProto.create({name:this.name,number:this.id});if(this.map)r.type=11,r.typeName=n.util.ucFirst(this.name),r.label=3;else{switch(r.type=E(this.type,this.resolve().resolvedType,this.delimited)){case 10:case 11:case 14:r.typeName=this.resolvedType?R(this.parent,this.resolvedType):this.type}"repeated"===this.rule?r.label=3:this.required&&"proto2"===e?r.label=2:r.label=1}if(r.extendee=this.extensionField?this.extensionField.parent.fullName:this.extend,this.partOf&&(r.oneofIndex=this.parent.oneofsArray.indexOf(this.partOf))<0)throw Error("missing oneof");return this.options&&(r.options=I(this.options,t.FieldOptions),null!=this.options.default&&(r.defaultValue=String(this.options.default)),this.options.proto3_optional&&(r.proto3_optional=!0)),"proto3"===e?this.packed||((r.options||(r.options=t.FieldOptions.create())).packed=!1):(!e||"proto2"===e)&&this.packed&&((r.options||(r.options=t.FieldOptions.create())).packed=!0),r};var g=0;a.fromDescriptor=function(e,r,n){"number"==typeof e.length&&(e=t.EnumDescriptorProto.decode(e));var i={};if(e.value)for(var s=0;s<e.value.length;++s){var o=e.value[s].name,l=e.value[s].number||0;i[o&&o.length?o:"NAME"+l]=l}var u=new a(e.name&&e.name.length?e.name:"Enum"+g++,i,C(e.options,t.EnumOptions));return n||(u._edition=r),u},a.prototype.toDescriptor=function(){for(var e=[],r=0,n=Object.keys(this.values);r<n.length;++r)e.push(t.EnumValueDescriptorProto.create({name:n[r],number:this.values[n[r]]}));return t.EnumDescriptorProto.create({name:this.name,value:e,options:I(this.options,t.EnumOptions)})};var y=0;c.fromDescriptor=function(e){return"number"==typeof e.length&&(e=t.OneofDescriptorProto.decode(e)),new c(e.name&&e.name.length?e.name:"oneof"+y++)},c.prototype.toDescriptor=function(){return t.OneofDescriptorProto.create({name:this.name})};var v=0;h.fromDescriptor=function(e,r,n){"number"==typeof e.length&&(e=t.ServiceDescriptorProto.decode(e));var i=new h(e.name&&e.name.length?e.name:"Service"+v++,C(e.options,t.ServiceOptions));if(n||(i._edition=r),e.method)for(var s=0;s<e.method.length;++s)i.add(d.fromDescriptor(e.method[s]));return i},h.prototype.toDescriptor=function(){for(var e=[],r=0;r<this.methodsArray.length;++r)e.push(this._methodsArray[r].toDescriptor());return t.ServiceDescriptorProto.create({name:this.name,method:e,options:I(this.options,t.ServiceOptions)})};var b=0;function T(e){switch(e){case 1:return"double";case 2:return"float";case 3:return"int64";case 4:return"uint64";case 5:return"int32";case 6:return"fixed64";case 7:return"fixed32";case 8:return"bool";case 9:return"string";case 12:return"bytes";case 13:return"uint32";case 15:return"sfixed32";case 16:return"sfixed64";case 17:return"sint32";case 18:return"sint64"}throw Error("illegal type: "+e)}function S(e){switch(e){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 13:case 14:case 15:case 16:case 17:case 18:return!0}return!1}function E(e,t,r){switch(e){case"double":return 1;case"float":return 2;case"int64":return 3;case"uint64":return 4;case"int32":return 5;case"fixed64":return 6;case"fixed32":return 7;case"bool":return 8;case"string":return 9;case"bytes":return 12;case"uint32":return 13;case"sfixed32":return 15;case"sfixed64":return 16;case"sint32":return 17;case"sint64":return 18}if(t instanceof a)return 14;if(t instanceof o)return r?10:11;throw Error("illegal type: "+e)}function w(e,t){for(var r,n,i={},s=0;s<t.fieldsArray.length;++s)if("uninterpretedOption"!==(n=(r=t._fieldsArray[s]).name)&&Object.prototype.hasOwnProperty.call(e,n)){var l=N(n);r.resolvedType instanceof o?i[l]=w(e[n],r.resolvedType):r.resolvedType instanceof a?i[l]=r.resolvedType.valuesById[e[n]]:i[l]=e[n]}return i}function C(e,t){if(e)return w(t.toObject(e),t)}function _(e,t){for(var r={},i=Object.keys(e),s=0;s<i.length;++s){var a=i[s],l=n.util.camelCase(a);if(Object.prototype.hasOwnProperty.call(t.fields,l)){var u=t.fields[l];u.resolvedType instanceof o?r[l]=_(e[a],u.resolvedType):r[l]=e[a],u.repeated&&!Array.isArray(r[l])&&(r[l]=[r[l]])}}return r}function I(e,t){if(e)return t.fromObject(_(e,t))}function R(e,t){var r=e.fullName.split("."),n=t.fullName.split("."),a=0,o=0,l=n.length-1;if(!(e instanceof s)&&t instanceof i)for(;a<r.length&&o<l&&r[a]===n[o];){var u=t.lookup(r[a++],!0);if(null!==u&&u!==t)break;++o}else for(;a<r.length&&o<l&&r[a]===n[o];++a,++o);return n.slice(o).join(".")}function N(e){return e.substring(0,1)+e.substring(1).replace(/([A-Z])(?=[a-z]|$)/g,function(e,t){return"_"+t.toLowerCase()})}function k(e){if("editions"===e.syntax){if(e.edition===t.Edition.EDITION_2023)return"2023";throw Error("Unsupported edition "+e.edition)}return"proto3"===e.syntax?"proto3":"proto2"}function A(e,r){if(e){if("proto2"===e||"proto3"===e)r.syntax=e;else if(r.syntax="editions","2023"===e)r.edition=t.Edition.EDITION_2023;else throw Error("Unsupported edition "+e)}}d.fromDescriptor=function(e){return"number"==typeof e.length&&(e=t.MethodDescriptorProto.decode(e)),new d(e.name&&e.name.length?e.name:"Method"+b++,"rpc",e.inputType,e.outputType,!!e.clientStreaming,!!e.serverStreaming,C(e.options,t.MethodOptions))},d.prototype.toDescriptor=function(){return t.MethodDescriptorProto.create({name:this.name,inputType:this.resolvedRequestType?this.resolvedRequestType.fullName:this.requestType,outputType:this.resolvedResponseType?this.resolvedResponseType.fullName:this.responseType,clientStreaming:this.requestStream,serverStreaming:this.responseStream,options:I(this.options,t.MethodOptions)})}},1101:(e,t,r)=>{"use strict";e.exports=r(8582)},3980:e=>{"use strict";e.exports=n;var t,r=/\/|\./;function n(e,t){r.test(e)||(e="google/protobuf/"+e+".proto",t={nested:{google:{nested:{protobuf:{nested:t}}}}}),n[e]=t}n("any",{Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}}}),n("duration",{Duration:t={fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}}),n("timestamp",{Timestamp:t}),n("empty",{Empty:{fields:{}}}),n("struct",{Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}}}),n("wrappers",{DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}}}),n("field_mask",{FieldMask:{fields:{paths:{rule:"repeated",type:"string",id:1}}}}),n.get=function(e){return n[e]||null}},5711:(e,t,r)=>{"use strict";var n=t,i=r(1114),s=r(4615);function a(e,t,r,n){var s=!1;if(t.resolvedType){if(t.resolvedType instanceof i){e("switch(d%s){",n);for(var a=t.resolvedType.values,o=Object.keys(a),l=0;l<o.length;++l)a[o[l]]!==t.typeDefault||s||(e("default:")('if(typeof(d%s)==="number"){m%s=d%s;break}',n,n,n),t.repeated||e("break"),s=!0),e("case%j:",o[l])("case %i:",a[o[l]])("m%s=%j",n,a[o[l]])("break");e("}")}else e('if(typeof d%s!=="object")',n)("throw TypeError(%j)",t.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",n,r,n)}else{var u=!1;switch(t.type){case"double":case"float":e("m%s=Number(d%s)",n,n);break;case"uint32":case"fixed32":e("m%s=d%s>>>0",n,n);break;case"int32":case"sint32":case"sfixed32":e("m%s=d%s|0",n,n);break;case"uint64":u=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":e("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",n,n,u)('else if(typeof d%s==="string")',n)("m%s=parseInt(d%s,10)",n,n)('else if(typeof d%s==="number")',n)("m%s=d%s",n,n)('else if(typeof d%s==="object")',n)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",n,n,n,u?"true":"");break;case"bytes":e('if(typeof d%s==="string")',n)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",n,n,n)("else if(d%s.length >= 0)",n)("m%s=d%s",n,n);break;case"string":e("m%s=String(d%s)",n,n);break;case"bool":e("m%s=Boolean(d%s)",n,n)}}return e}function o(e,t,r,n){if(t.resolvedType)t.resolvedType instanceof i?e("d%s=o.enums===String?(types[%i].values[m%s]===undefined?m%s:types[%i].values[m%s]):m%s",n,r,n,n,r,n,n):e("d%s=types[%i].toObject(m%s,o)",n,r,n);else{var s=!1;switch(t.type){case"double":case"float":e("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",n,n,n,n);break;case"uint64":s=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":e('if(typeof m%s==="number")',n)("d%s=o.longs===String?String(m%s):m%s",n,n,n)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",n,n,n,n,s?"true":"",n);break;case"bytes":e("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",n,n,n,n,n);break;default:e("d%s=m%s",n,n)}}return e}n.fromObject=function(e){var t=e.fieldsArray,r=s.codegen(["d"],e.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!t.length)return r("return new this.ctor");r("var m=new this.ctor");for(var n=0;n<t.length;++n){var o=t[n].resolve(),l=s.safeProp(o.name);o.map?(r("if(d%s){",l)('if(typeof d%s!=="object")',l)("throw TypeError(%j)",o.fullName+": object expected")("m%s={}",l)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",l),a(r,o,n,l+"[ks[i]]")("}")("}")):o.repeated?(r("if(d%s){",l)("if(!Array.isArray(d%s))",l)("throw TypeError(%j)",o.fullName+": array expected")("m%s=[]",l)("for(var i=0;i<d%s.length;++i){",l),a(r,o,n,l+"[i]")("}")("}")):(o.resolvedType instanceof i||r("if(d%s!=null){",l),a(r,o,n,l),o.resolvedType instanceof i||r("}"))}return r("return m")},n.toObject=function(e){var t=e.fieldsArray.slice().sort(s.compareFieldsById);if(!t.length)return s.codegen()("return {}");for(var r=s.codegen(["m","o"],e.name+"$toObject")("if(!o)")("o={}")("var d={}"),n=[],a=[],l=[],u=0;u<t.length;++u)t[u].partOf||(t[u].resolve().repeated?n:t[u].map?a:l).push(t[u]);if(n.length){for(r("if(o.arrays||o.defaults){"),u=0;u<n.length;++u)r("d%s=[]",s.safeProp(n[u].name));r("}")}if(a.length){for(r("if(o.objects||o.defaults){"),u=0;u<a.length;++u)r("d%s={}",s.safeProp(a[u].name));r("}")}if(l.length){for(r("if(o.defaults){"),u=0;u<l.length;++u){var c=l[u],h=s.safeProp(c.name);if(c.resolvedType instanceof i)r("d%s=o.enums===String?%j:%j",h,c.resolvedType.valuesById[c.typeDefault],c.typeDefault);else if(c.long)r("if(util.Long){")("var n=new util.Long(%i,%i,%j)",c.typeDefault.low,c.typeDefault.high,c.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",h)("}else")("d%s=o.longs===String?%j:%i",h,c.typeDefault.toString(),c.typeDefault.toNumber());else if(c.bytes){var d="["+Array.prototype.slice.call(c.typeDefault).join(",")+"]";r("if(o.bytes===String)d%s=%j",h,String.fromCharCode.apply(String,c.typeDefault))("else{")("d%s=%s",h,d)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",h,h)("}")}else r("d%s=%j",h,c.typeDefault)}r("}")}var p=!1;for(u=0;u<t.length;++u){var c=t[u],f=e._fieldsArray.indexOf(c),h=s.safeProp(c.name);c.map?(p||(p=!0,r("var ks2")),r("if(m%s&&(ks2=Object.keys(m%s)).length){",h,h)("d%s={}",h)("for(var j=0;j<ks2.length;++j){"),o(r,c,f,h+"[ks2[j]]")("}")):c.repeated?(r("if(m%s&&m%s.length){",h,h)("d%s=[]",h)("for(var j=0;j<m%s.length;++j){",h),o(r,c,f,h+"[j]")("}")):(r("if(m%s!=null&&m.hasOwnProperty(%j)){",h,c.name),o(r,c,f,h),c.partOf&&r("if(o.oneofs)")("d%s=%j",s.safeProp(c.partOf.name),c.name)),r("}")}return r("return d")}},1526:(e,t,r)=>{"use strict";e.exports=o;var n=r(1114),i=r(6160),s=r(4615);function a(e){return"missing required '"+e.name+"'"}function o(e){for(var t=s.codegen(["r","l","e"],e.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(e.fieldsArray.filter(function(e){return e.map}).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()")("if(t===e)")("break")("switch(t>>>3){"),r=0;r<e.fieldsArray.length;++r){var o=e._fieldsArray[r].resolve(),l=o.resolvedType instanceof n?"int32":o.type,u="m"+s.safeProp(o.name);t("case %i: {",o.id),o.map?(t("if(%s===util.emptyObject)",u)("%s={}",u)("var c2 = r.uint32()+r.pos"),void 0!==i.defaults[o.keyType]?t("k=%j",i.defaults[o.keyType]):t("k=null"),void 0!==i.defaults[l]?t("value=%j",i.defaults[l]):t("value=null"),t("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",o.keyType)("case 2:"),void 0===i.basic[l]?t("value=types[%i].decode(r,r.uint32())",r):t("value=r.%s()",l),t("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),t(void 0!==i.long[o.keyType]?'%s[typeof k==="object"?util.longToHash(k):k]=value':"%s[k]=value",u)):o.repeated?(t("if(!(%s&&%s.length))",u,u)("%s=[]",u),void 0!==i.packed[l]&&t("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",u,l)("}else"),void 0===i.basic[l]?t(o.delimited?"%s.push(types[%i].decode(r,undefined,((t&~7)|4)))":"%s.push(types[%i].decode(r,r.uint32()))",u,r):t("%s.push(r.%s())",u,l)):void 0===i.basic[l]?t(o.delimited?"%s=types[%i].decode(r,undefined,((t&~7)|4))":"%s=types[%i].decode(r,r.uint32())",u,r):t("%s=r.%s()",u,l),t("break")("}")}for(t("default:")("r.skipType(t&7)")("break")("}")("}"),r=0;r<e._fieldsArray.length;++r){var c=e._fieldsArray[r];c.required&&t("if(!m.hasOwnProperty(%j))",c.name)("throw util.ProtocolError(%j,{instance:m})",a(c))}return t("return m")}},8455:(e,t,r)=>{"use strict";e.exports=o;var n=r(1114),i=r(6160),s=r(4615);function a(e,t,r,n){return t.delimited?e("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",r,n,(t.id<<3|3)>>>0,(t.id<<3|4)>>>0):e("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",r,n,(t.id<<3|2)>>>0)}function o(e){for(var t,r,o=s.codegen(["m","w"],e.name+"$encode")("if(!w)")("w=Writer.create()"),l=e.fieldsArray.slice().sort(s.compareFieldsById),t=0;t<l.length;++t){var u=l[t].resolve(),c=e._fieldsArray.indexOf(u),h=u.resolvedType instanceof n?"int32":u.type,d=i.basic[h];r="m"+s.safeProp(u.name),u.map?(o("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",r,u.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",r)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(u.id<<3|2)>>>0,8|i.mapKey[u.keyType],u.keyType),void 0===d?o("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",c,r):o(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|d,h,r),o("}")("}")):u.repeated?(o("if(%s!=null&&%s.length){",r,r),u.packed&&void 0!==i.packed[h]?o("w.uint32(%i).fork()",(u.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",r)("w.%s(%s[i])",h,r)("w.ldelim()"):(o("for(var i=0;i<%s.length;++i)",r),void 0===d?a(o,u,c,r+"[i]"):o("w.uint32(%i).%s(%s[i])",(u.id<<3|d)>>>0,h,r)),o("}")):(u.optional&&o("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",r,u.name),void 0===d?a(o,u,c,r):o("w.uint32(%i).%s(%s)",(u.id<<3|d)>>>0,h,r))}return o("return w")}},1114:(e,t,r)=>{"use strict";e.exports=a;var n=r(3514);((a.prototype=Object.create(n.prototype)).constructor=a).className="Enum";var i=r(4943),s=r(4615);function a(e,t,r,i,s,a){if(n.call(this,e,r),t&&"object"!=typeof t)throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=i,this.comments=s||{},this.valuesOptions=a,this._valuesFeatures={},this.reserved=void 0,t)for(var o=Object.keys(t),l=0;l<o.length;++l)"number"==typeof t[o[l]]&&(this.valuesById[this.values[o[l]]=t[o[l]]]=o[l])}a.prototype._resolveFeatures=function(e){return e=this._edition||e,n.prototype._resolveFeatures.call(this,e),Object.keys(this.values).forEach(e=>{var t=Object.assign({},this._features);this._valuesFeatures[e]=Object.assign(t,this.valuesOptions&&this.valuesOptions[e]&&this.valuesOptions[e].features)}),this},a.fromJSON=function(e,t){var r=new a(e,t.values,t.options,t.comment,t.comments);return r.reserved=t.reserved,t.edition&&(r._edition=t.edition),r._defaultEdition="proto3",r},a.prototype.toJSON=function(e){var t=!!e&&!!e.keepComments;return s.toObject(["edition",this._editionToJSON(),"options",this.options,"valuesOptions",this.valuesOptions,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"comment",t?this.comment:void 0,"comments",t?this.comments:void 0])},a.prototype.add=function(e,t,r,n){if(!s.isString(e))throw TypeError("name must be a string");if(!s.isInteger(t))throw TypeError("id must be an integer");if(void 0!==this.values[e])throw Error("duplicate name '"+e+"' in "+this);if(this.isReservedId(t))throw Error("id "+t+" is reserved in "+this);if(this.isReservedName(e))throw Error("name '"+e+"' is reserved in "+this);if(void 0!==this.valuesById[t]){if(!(this.options&&this.options.allow_alias))throw Error("duplicate id "+t+" in "+this);this.values[e]=t}else this.valuesById[this.values[e]=t]=e;return n&&(void 0===this.valuesOptions&&(this.valuesOptions={}),this.valuesOptions[e]=n||null),this.comments[e]=r||null,this},a.prototype.remove=function(e){if(!s.isString(e))throw TypeError("name must be a string");var t=this.values[e];if(null==t)throw Error("name '"+e+"' does not exist in "+this);return delete this.valuesById[t],delete this.values[e],delete this.comments[e],this.valuesOptions&&delete this.valuesOptions[e],this},a.prototype.isReservedId=function(e){return i.isReservedId(this.reserved,e)},a.prototype.isReservedName=function(e){return i.isReservedName(this.reserved,e)}},7510:(e,t,r)=>{"use strict";e.exports=u;var n,i=r(3514);((u.prototype=Object.create(i.prototype)).constructor=u).className="Field";var s=r(1114),a=r(6160),o=r(4615),l=/^required|optional|repeated$/;function u(e,t,r,n,s,u,c){if(o.isObject(n)?(c=s,u=n,n=s=void 0):o.isObject(s)&&(c=u,u=s,s=void 0),i.call(this,e,u),!o.isInteger(t)||t<0)throw TypeError("id must be a non-negative integer");if(!o.isString(r))throw TypeError("type must be a string");if(void 0!==n&&!l.test(n=n.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(void 0!==s&&!o.isString(s))throw TypeError("extend must be a string");"proto3_optional"===n&&(n="optional"),this.rule=n&&"optional"!==n?n:void 0,this.type=r,this.id=t,this.extend=s||void 0,this.repeated="repeated"===n,this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=!!o.Long&&void 0!==a.long[r],this.bytes="bytes"===r,this.resolvedType=null,this.extensionField=null,this.declaringField=null,this.comment=c}u.fromJSON=function(e,t){var r=new u(e,t.id,t.type,t.rule,t.extend,t.options,t.comment);return t.edition&&(r._edition=t.edition),r._defaultEdition="proto3",r},Object.defineProperty(u.prototype,"required",{get:function(){return"LEGACY_REQUIRED"===this._features.field_presence}}),Object.defineProperty(u.prototype,"optional",{get:function(){return!this.required}}),Object.defineProperty(u.prototype,"delimited",{get:function(){return this.resolvedType instanceof n&&"DELIMITED"===this._features.message_encoding}}),Object.defineProperty(u.prototype,"packed",{get:function(){return"PACKED"===this._features.repeated_field_encoding}}),Object.defineProperty(u.prototype,"hasPresence",{get:function(){return!this.repeated&&!this.map&&(this.partOf||this.declaringField||this.extensionField||"IMPLICIT"!==this._features.field_presence)}}),u.prototype.setOption=function(e,t,r){return i.prototype.setOption.call(this,e,t,r)},u.prototype.toJSON=function(e){var t=!!e&&!!e.keepComments;return o.toObject(["edition",this._editionToJSON(),"rule","optional"!==this.rule&&this.rule||void 0,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])},u.prototype.resolve=function(){if(this.resolved)return this;if(void 0===(this.typeDefault=a.defaults[this.type])?(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof n?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]):this.options&&this.options.proto3_optional&&(this.typeDefault=null),this.options&&null!=this.options.default&&(this.typeDefault=this.options.default,this.resolvedType instanceof s&&"string"==typeof this.typeDefault&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&(void 0===this.options.packed||!this.resolvedType||this.resolvedType instanceof s||delete this.options.packed,Object.keys(this.options).length||(this.options=void 0)),this.long)this.typeDefault=o.Long.fromNumber(this.typeDefault,"u"===this.type.charAt(0)),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&"string"==typeof this.typeDefault){var e;o.base64.test(this.typeDefault)?o.base64.decode(this.typeDefault,e=o.newBuffer(o.base64.length(this.typeDefault)),0):o.utf8.write(this.typeDefault,e=o.newBuffer(o.utf8.length(this.typeDefault)),0),this.typeDefault=e}return this.map?this.defaultValue=o.emptyObject:this.repeated?this.defaultValue=o.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof n&&(this.parent.ctor.prototype[this.name]=this.defaultValue),i.prototype.resolve.call(this)},u.prototype._inferLegacyProtoFeatures=function(e){if("proto2"!==e&&"proto3"!==e)return{};var t={};if("required"===this.rule&&(t.field_presence="LEGACY_REQUIRED"),this.parent&&void 0===a.defaults[this.type]){var r=this.parent.get(this.type.split(".").pop());r&&r instanceof n&&r.group&&(t.message_encoding="DELIMITED")}return!0===this.getOption("packed")?t.repeated_field_encoding="PACKED":!1===this.getOption("packed")&&(t.repeated_field_encoding="EXPANDED"),t},u.prototype._resolveFeatures=function(e){return i.prototype._resolveFeatures.call(this,this._edition||e)},u.d=function(e,t,r,n){return"function"==typeof t?t=o.decorateType(t).name:t&&"object"==typeof t&&(t=o.decorateEnum(t).name),function(i,s){o.decorateType(i.constructor).add(new u(s,e,t,r,{default:n}))}},u._configure=function(e){n=e}},4630:(e,t,r)=>{"use strict";var n=e.exports=r(8690);function i(e,t,r){return"function"==typeof t?(r=t,t=new n.Root):t||(t=new n.Root),t.load(e,r)}function s(e,t){return t||(t=new n.Root),t.loadSync(e)}n.build="light",n.load=i,n.loadSync=s,n.encoder=r(8455),n.decoder=r(1526),n.verifier=r(1506),n.converter=r(5711),n.ReflectionObject=r(3514),n.Namespace=r(4943),n.Root=r(4343),n.Enum=r(1114),n.Type=r(3839),n.Field=r(7510),n.OneOf=r(2695),n.MapField=r(9538),n.Service=r(1631),n.Method=r(6539),n.Message=r(2936),n.wrappers=r(9579),n.types=r(6160),n.util=r(4615),n.ReflectionObject._configure(n.Root),n.Namespace._configure(n.Type,n.Service,n.Enum),n.Root._configure(n.Type),n.Field._configure(n.Type)},8690:(e,t,r)=>{"use strict";var n=t;function i(){n.util._configure(),n.Writer._configure(n.BufferWriter),n.Reader._configure(n.BufferReader)}n.build="minimal",n.Writer=r(8458),n.BufferWriter=r(8386),n.Reader=r(2279),n.BufferReader=r(424),n.util=r(745),n.rpc=r(4774),n.roots=r(9694),n.configure=i,i()},8582:(e,t,r)=>{"use strict";var n=e.exports=r(4630);n.build="full",n.tokenize=r(9867),n.parse=r(6614),n.common=r(3980),n.Root._configure(n.Type,n.parse,n.common)},9538:(e,t,r)=>{"use strict";e.exports=a;var n=r(7510);((a.prototype=Object.create(n.prototype)).constructor=a).className="MapField";var i=r(6160),s=r(4615);function a(e,t,r,i,a,o){if(n.call(this,e,t,i,void 0,void 0,a,o),!s.isString(r))throw TypeError("keyType must be a string");this.keyType=r,this.resolvedKeyType=null,this.map=!0}a.fromJSON=function(e,t){return new a(e,t.id,t.keyType,t.type,t.options,t.comment)},a.prototype.toJSON=function(e){var t=!!e&&!!e.keepComments;return s.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])},a.prototype.resolve=function(){if(this.resolved)return this;if(void 0===i.mapKey[this.keyType])throw Error("invalid key type: "+this.keyType);return n.prototype.resolve.call(this)},a.d=function(e,t,r){return"function"==typeof r?r=s.decorateType(r).name:r&&"object"==typeof r&&(r=s.decorateEnum(r).name),function(n,i){s.decorateType(n.constructor).add(new a(i,e,t,r))}}},2936:(e,t,r)=>{"use strict";e.exports=i;var n=r(745);function i(e){if(e)for(var t=Object.keys(e),r=0;r<t.length;++r)this[t[r]]=e[t[r]]}i.create=function(e){return this.$type.create(e)},i.encode=function(e,t){return this.$type.encode(e,t)},i.encodeDelimited=function(e,t){return this.$type.encodeDelimited(e,t)},i.decode=function(e){return this.$type.decode(e)},i.decodeDelimited=function(e){return this.$type.decodeDelimited(e)},i.verify=function(e){return this.$type.verify(e)},i.fromObject=function(e){return this.$type.fromObject(e)},i.toObject=function(e,t){return this.$type.toObject(e,t)},i.prototype.toJSON=function(){return this.$type.toObject(this,n.toJSONOptions)}},6539:(e,t,r)=>{"use strict";e.exports=s;var n=r(3514);((s.prototype=Object.create(n.prototype)).constructor=s).className="Method";var i=r(4615);function s(e,t,r,s,a,o,l,u,c){if(i.isObject(a)?(l=a,a=o=void 0):i.isObject(o)&&(l=o,o=void 0),!(void 0===t||i.isString(t)))throw TypeError("type must be a string");if(!i.isString(r))throw TypeError("requestType must be a string");if(!i.isString(s))throw TypeError("responseType must be a string");n.call(this,e,l),this.type=t||"rpc",this.requestType=r,this.requestStream=!!a||void 0,this.responseType=s,this.responseStream=!!o||void 0,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=u,this.parsedOptions=c}s.fromJSON=function(e,t){return new s(e,t.type,t.requestType,t.responseType,t.requestStream,t.responseStream,t.options,t.comment,t.parsedOptions)},s.prototype.toJSON=function(e){var t=!!e&&!!e.keepComments;return i.toObject(["type","rpc"!==this.type&&this.type||void 0,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",t?this.comment:void 0,"parsedOptions",this.parsedOptions])},s.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),n.prototype.resolve.call(this))}},4943:(e,t,r)=>{"use strict";e.exports=h;var n,i,s,a=r(3514);((h.prototype=Object.create(a.prototype)).constructor=h).className="Namespace";var o=r(7510),l=r(4615),u=r(2695);function c(e,t){if(e&&e.length){for(var r={},n=0;n<e.length;++n)r[e[n].name]=e[n].toJSON(t);return r}}function h(e,t){a.call(this,e,t),this.nested=void 0,this._nestedArray=null,this._lookupCache={},this._needsRecursiveFeatureResolution=!0,this._needsRecursiveResolve=!0}function d(e){e._nestedArray=null,e._lookupCache={};for(var t=e;t=t.parent;)t._lookupCache={};return e}h.fromJSON=function(e,t){return new h(e,t.options).addJSON(t.nested)},h.arrayToJSON=c,h.isReservedId=function(e,t){if(e){for(var r=0;r<e.length;++r)if("string"!=typeof e[r]&&e[r][0]<=t&&e[r][1]>t)return!0}return!1},h.isReservedName=function(e,t){if(e){for(var r=0;r<e.length;++r)if(e[r]===t)return!0}return!1},Object.defineProperty(h.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=l.toArray(this.nested))}}),h.prototype.toJSON=function(e){return l.toObject(["options",this.options,"nested",c(this.nestedArray,e)])},h.prototype.addJSON=function(e){var t=this;if(e)for(var r,a=Object.keys(e),l=0;l<a.length;++l)r=e[a[l]],t.add((void 0!==r.fields?n.fromJSON:void 0!==r.values?s.fromJSON:void 0!==r.methods?i.fromJSON:void 0!==r.id?o.fromJSON:h.fromJSON)(a[l],r));return this},h.prototype.get=function(e){return this.nested&&this.nested[e]||null},h.prototype.getEnum=function(e){if(this.nested&&this.nested[e]instanceof s)return this.nested[e].values;throw Error("no such enum: "+e)},h.prototype.add=function(e){if(!(e instanceof o&&void 0!==e.extend||e instanceof n||e instanceof u||e instanceof s||e instanceof i||e instanceof h))throw TypeError("object must be a valid nested object");if(this.nested){var t=this.get(e.name);if(t){if(t instanceof h&&e instanceof h&&!(t instanceof n||t instanceof i)){for(var r=t.nestedArray,a=0;a<r.length;++a)e.add(r[a]);this.remove(t),this.nested||(this.nested={}),e.setOptions(t.options,!0)}else throw Error("duplicate name '"+e.name+"' in "+this)}}else this.nested={};this.nested[e.name]=e,this instanceof n||this instanceof i||this instanceof s||this instanceof o||e._edition||(e._edition=e._defaultEdition),this._needsRecursiveFeatureResolution=!0,this._needsRecursiveResolve=!0;for(var l=this;l=l.parent;)l._needsRecursiveFeatureResolution=!0,l._needsRecursiveResolve=!0;return e.onAdd(this),d(this)},h.prototype.remove=function(e){if(!(e instanceof a))throw TypeError("object must be a ReflectionObject");if(e.parent!==this)throw Error(e+" is not a member of "+this);return delete this.nested[e.name],Object.keys(this.nested).length||(this.nested=void 0),e.onRemove(this),d(this)},h.prototype.define=function(e,t){if(l.isString(e))e=e.split(".");else if(!Array.isArray(e))throw TypeError("illegal path");if(e&&e.length&&""===e[0])throw Error("path must be relative");for(var r=this;e.length>0;){var n=e.shift();if(r.nested&&r.nested[n]){if(!((r=r.nested[n])instanceof h))throw Error("path conflicts with non-namespace objects")}else r.add(r=new h(n))}return t&&r.addJSON(t),r},h.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;this._resolveFeaturesRecursive(this._edition);var e=this.nestedArray,t=0;for(this.resolve();t<e.length;)e[t]instanceof h?e[t++].resolveAll():e[t++].resolve();return this._needsRecursiveResolve=!1,this},h.prototype._resolveFeaturesRecursive=function(e){return this._needsRecursiveFeatureResolution&&(this._needsRecursiveFeatureResolution=!1,e=this._edition||e,a.prototype._resolveFeaturesRecursive.call(this,e),this.nestedArray.forEach(t=>{t._resolveFeaturesRecursive(e)})),this},h.prototype.lookup=function(e,t,r){if("boolean"==typeof t?(r=t,t=void 0):t&&!Array.isArray(t)&&(t=[t]),l.isString(e)&&e.length){if("."===e)return this.root;e=e.split(".")}else if(!e.length)return this;var n=e.join(".");if(""===e[0])return this.root.lookup(e.slice(1),t);var i=this.root._fullyQualifiedObjects&&this.root._fullyQualifiedObjects["."+n];if(i&&(!t||t.indexOf(i.constructor)>-1)||(i=this._lookupImpl(e,n))&&(!t||t.indexOf(i.constructor)>-1))return i;if(r)return null;for(var s=this;s.parent;){if((i=s.parent._lookupImpl(e,n))&&(!t||t.indexOf(i.constructor)>-1))return i;s=s.parent}return null},h.prototype._lookupImpl=function(e,t){if(Object.prototype.hasOwnProperty.call(this._lookupCache,t))return this._lookupCache[t];var r=this.get(e[0]),n=null;if(r)1===e.length?n=r:r instanceof h&&(e=e.slice(1),n=r._lookupImpl(e,e.join(".")));else for(var i=0;i<this.nestedArray.length;++i)this._nestedArray[i]instanceof h&&(r=this._nestedArray[i]._lookupImpl(e,t))&&(n=r);return this._lookupCache[t]=n,n},h.prototype.lookupType=function(e){var t=this.lookup(e,[n]);if(!t)throw Error("no such type: "+e);return t},h.prototype.lookupEnum=function(e){var t=this.lookup(e,[s]);if(!t)throw Error("no such Enum '"+e+"' in "+this);return t},h.prototype.lookupTypeOrEnum=function(e){var t=this.lookup(e,[n,s]);if(!t)throw Error("no such Type or Enum '"+e+"' in "+this);return t},h.prototype.lookupService=function(e){var t=this.lookup(e,[i]);if(!t)throw Error("no such Service '"+e+"' in "+this);return t},h._configure=function(e,t,r){n=e,i=t,s=r}},3514:(e,t,r)=>{"use strict";e.exports=u,u.className="ReflectionObject";let n=r(2695);var i,s=r(4615),a={enum_type:"OPEN",field_presence:"EXPLICIT",json_format:"ALLOW",message_encoding:"LENGTH_PREFIXED",repeated_field_encoding:"PACKED",utf8_validation:"VERIFY"},o={enum_type:"CLOSED",field_presence:"EXPLICIT",json_format:"LEGACY_BEST_EFFORT",message_encoding:"LENGTH_PREFIXED",repeated_field_encoding:"EXPANDED",utf8_validation:"NONE"},l={enum_type:"OPEN",field_presence:"IMPLICIT",json_format:"ALLOW",message_encoding:"LENGTH_PREFIXED",repeated_field_encoding:"PACKED",utf8_validation:"VERIFY"};function u(e,t){if(!s.isString(e))throw TypeError("name must be a string");if(t&&!s.isObject(t))throw TypeError("options must be an object");this.options=t,this.parsedOptions=null,this.name=e,this._edition=null,this._defaultEdition="proto2",this._features={},this._featuresResolved=!1,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}Object.defineProperties(u.prototype,{root:{get:function(){for(var e=this;null!==e.parent;)e=e.parent;return e}},fullName:{get:function(){for(var e=[this.name],t=this.parent;t;)e.unshift(t.name),t=t.parent;return e.join(".")}}}),u.prototype.toJSON=function(){throw Error()},u.prototype.onAdd=function(e){this.parent&&this.parent!==e&&this.parent.remove(this),this.parent=e,this.resolved=!1;var t=e.root;t instanceof i&&t._handleAdd(this)},u.prototype.onRemove=function(e){var t=e.root;t instanceof i&&t._handleRemove(this),this.parent=null,this.resolved=!1},u.prototype.resolve=function(){return this.resolved||this.root instanceof i&&(this.resolved=!0),this},u.prototype._resolveFeaturesRecursive=function(e){return this._resolveFeatures(this._edition||e)},u.prototype._resolveFeatures=function(e){if(!this._featuresResolved){var t={};if(!e)throw Error("Unknown edition for "+this.fullName);var r=Object.assign(this.options?Object.assign({},this.options.features):{},this._inferLegacyProtoFeatures(e));if(this._edition){if("proto2"===e)t=Object.assign({},o);else if("proto3"===e)t=Object.assign({},l);else if("2023"===e)t=Object.assign({},a);else throw Error("Unknown edition: "+e);this._features=Object.assign(t,r||{}),this._featuresResolved=!0;return}if(this.partOf instanceof n){var i=Object.assign({},this.partOf._features);this._features=Object.assign(i,r||{})}else if(this.declaringField);else if(this.parent){var s=Object.assign({},this.parent._features);this._features=Object.assign(s,r||{})}else throw Error("Unable to find a parent for "+this.fullName);this.extensionField&&(this.extensionField._features=this._features),this._featuresResolved=!0}},u.prototype._inferLegacyProtoFeatures=function(){return{}},u.prototype.getOption=function(e){if(this.options)return this.options[e]},u.prototype.setOption=function(e,t,r){return this.options||(this.options={}),/^features\./.test(e)?s.setProperty(this.options,e,t,r):r&&void 0!==this.options[e]||(this.getOption(e)!==t&&(this.resolved=!1),this.options[e]=t),this},u.prototype.setParsedOption=function(e,t,r){this.parsedOptions||(this.parsedOptions=[]);var n=this.parsedOptions;if(r){var i=n.find(function(t){return Object.prototype.hasOwnProperty.call(t,e)});if(i){var a=i[e];s.setProperty(a,r,t)}else(i={})[e]=s.setProperty({},r,t),n.push(i)}else{var o={};o[e]=t,n.push(o)}return this},u.prototype.setOptions=function(e,t){if(e)for(var r=Object.keys(e),n=0;n<r.length;++n)this.setOption(r[n],e[r[n]],t);return this},u.prototype.toString=function(){var e=this.constructor.className,t=this.fullName;return t.length?e+" "+t:e},u.prototype._editionToJSON=function(){if(this._edition&&"proto3"!==this._edition)return this._edition},u._configure=function(e){i=e}},2695:(e,t,r)=>{"use strict";e.exports=a;var n=r(3514);((a.prototype=Object.create(n.prototype)).constructor=a).className="OneOf";var i=r(7510),s=r(4615);function a(e,t,r,i){if(Array.isArray(t)||(r=t,t=void 0),n.call(this,e,r),!(void 0===t||Array.isArray(t)))throw TypeError("fieldNames must be an Array");this.oneof=t||[],this.fieldsArray=[],this.comment=i}function o(e){if(e.parent)for(var t=0;t<e.fieldsArray.length;++t)e.fieldsArray[t].parent||e.parent.add(e.fieldsArray[t])}a.fromJSON=function(e,t){return new a(e,t.oneof,t.options,t.comment)},a.prototype.toJSON=function(e){var t=!!e&&!!e.keepComments;return s.toObject(["options",this.options,"oneof",this.oneof,"comment",t?this.comment:void 0])},a.prototype.add=function(e){if(!(e instanceof i))throw TypeError("field must be a Field");return e.parent&&e.parent!==this.parent&&e.parent.remove(e),this.oneof.push(e.name),this.fieldsArray.push(e),e.partOf=this,o(this),this},a.prototype.remove=function(e){if(!(e instanceof i))throw TypeError("field must be a Field");var t=this.fieldsArray.indexOf(e);if(t<0)throw Error(e+" is not a member of "+this);return this.fieldsArray.splice(t,1),(t=this.oneof.indexOf(e.name))>-1&&this.oneof.splice(t,1),e.partOf=null,this},a.prototype.onAdd=function(e){n.prototype.onAdd.call(this,e);for(var t=this,r=0;r<this.oneof.length;++r){var i=e.get(this.oneof[r]);i&&!i.partOf&&(i.partOf=t,t.fieldsArray.push(i))}o(this)},a.prototype.onRemove=function(e){for(var t,r=0;r<this.fieldsArray.length;++r)(t=this.fieldsArray[r]).parent&&t.parent.remove(t);n.prototype.onRemove.call(this,e)},Object.defineProperty(a.prototype,"isProto3Optional",{get:function(){if(null==this.fieldsArray||1!==this.fieldsArray.length)return!1;var e=this.fieldsArray[0];return null!=e.options&&!0===e.options.proto3_optional}}),a.d=function(){for(var e=Array(arguments.length),t=0;t<arguments.length;)e[t]=arguments[t++];return function(t,r){s.decorateType(t.constructor).add(new a(r,e)),Object.defineProperty(t,r,{get:s.oneOfGetter(e),set:s.oneOfSetter(e)})}}},6614:(e,t,r)=>{"use strict";e.exports=C,C.filename=null,C.defaults={keepCase:!1};var n=r(9867),i=r(4343),s=r(3839),a=r(7510),o=r(9538),l=r(2695),u=r(1114),c=r(1631),h=r(6539),d=r(3514),p=r(6160),f=r(4615),m=/^[1-9][0-9]*$/,g=/^-?[1-9][0-9]*$/,y=/^0[x][0-9a-fA-F]+$/,v=/^-?0[x][0-9a-fA-F]+$/,b=/^0[0-7]+$/,T=/^-?0[0-7]+$/,S=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/,E=/^[a-zA-Z_][a-zA-Z_0-9]*$/,w=/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)(?:\.[a-zA-Z_][a-zA-Z_0-9]*)*$/;function C(e,t,r){t instanceof i||(r=t,t=new i),r||(r=C.defaults);var _,I,R,N,k=r.preferTrailingComment||!1,A=n(e,r.alternateCommentMode||!1),D=A.next,O=A.push,x=A.peek,P=A.skip,M=A.cmnt,L=!0,F="proto2",B=t,U=[],V={},j=r.keepCase?function(e){return e}:f.camelCase;function z(){U.forEach(e=>{e._edition=F,Object.keys(V).forEach(t=>{void 0===e.getOption(t)&&e.setOption(t,V[t],!0)})})}function q(e,t,r){var n=C.filename;return r||(C.filename=null),Error("illegal "+(t||"token")+" '"+e+"' ("+(n?n+", ":"")+"line "+A.line+")")}function G(){var e,t=[];do{if('"'!==(e=D())&&"'"!==e)throw q(e);t.push(D()),P(e),e=x()}while('"'===e||"'"===e);return t.join("")}function $(e){var t=D();switch(t){case"'":case'"':return O(t),G();case"true":case"TRUE":return!0;case"false":case"FALSE":return!1}try{return W(t,!0)}catch(r){if(e&&w.test(t))return t;throw q(t,"value")}}function K(e,t){do if(t&&('"'===(r=x())||"'"===r)){var r,n,i=G();if(e.push(i),F>=2023)throw q(i,"id")}else try{e.push([n=H(D()),P("to",!0)?H(D()):n])}catch(n){if(t&&w.test(r)&&F>=2023)e.push(r);else throw n}while(P(",",!0));var s={options:void 0};s.setOption=function(e,t){void 0===this.options&&(this.options={}),this.options[e]=t},ee(s,function(e){if("option"===e)el(s,e),P(";");else throw q(e)},function(){ed(s)})}function W(e,t){var r=1;switch("-"===e.charAt(0)&&(r=-1,e=e.substring(1)),e){case"inf":case"INF":case"Inf":return 1/0*r;case"nan":case"NAN":case"Nan":case"NaN":return NaN;case"0":return 0}if(m.test(e))return r*parseInt(e,10);if(y.test(e))return r*parseInt(e,16);if(b.test(e))return r*parseInt(e,8);if(S.test(e))return r*parseFloat(e);throw q(e,"number",t)}function H(e,t){switch(e){case"max":case"MAX":case"Max":return 536870911;case"0":return 0}if(!t&&"-"===e.charAt(0))throw q(e,"id");if(g.test(e))return parseInt(e,10);if(v.test(e))return parseInt(e,16);if(T.test(e))return parseInt(e,8);throw q(e,"id")}function Q(){if(void 0!==I)throw q("package");if(I=D(),!w.test(I))throw q(I,"name");B=B.define(I),P(";")}function Y(){var e,t=x();switch(t){case"weak":e=N||(N=[]),D();break;case"public":D();default:e=R||(R=[])}t=G(),P(";"),e.push(t)}function J(){if(P("="),(F=G())<2023)throw q(F,"syntax");P(";")}function X(){if(P("="),!["2023"].includes(F=G()))throw q(F,"edition");P(";")}function Z(e,t){switch(t){case"option":return el(e,t),P(";"),!0;case"message":return et(e,t),!0;case"enum":return ea(e,t),!0;case"service":return ep(e,t),!0;case"extend":return em(e,t),!0}return!1}function ee(e,t,r){var n,i=A.line;if(e&&("string"!=typeof e.comment&&(e.comment=M()),e.filename=C.filename),P("{",!0)){for(;"}"!==(n=D());)t(n);P(";",!0)}else r&&r(),P(";"),e&&("string"!=typeof e.comment||k)&&(e.comment=M(i)||e.comment)}function et(e,t){if(!E.test(t=D()))throw q(t,"type name");var r=new s(t);ee(r,function(e){if(!Z(r,e))switch(e){case"map":ei(r,e);break;case"required":if("proto2"!==F)throw q(e);case"repeated":er(r,e);break;case"optional":if("proto3"===F)er(r,"proto3_optional");else if("proto2"!==F)throw q(e);else er(r,"optional");break;case"oneof":es(r,e);break;case"extensions":K(r.extensions||(r.extensions=[]));break;case"reserved":K(r.reserved||(r.reserved=[]),!0);break;default:if("proto2"===F||!w.test(e))throw q(e);O(e),er(r,"optional")}}),e.add(r),e===B&&U.push(r)}function er(e,t,r){var n=D();if("group"===n){en(e,t);return}for(;n.endsWith(".")||x().startsWith(".");)n+=D();if(!w.test(n))throw q(n,"type");var i=D();if(!E.test(i))throw q(i,"name");i=j(i),P("=");var s=new a(i,H(D()),n,t,r);if(ee(s,function(e){if("option"===e)el(s,e),P(";");else throw q(e)},function(){ed(s)}),"proto3_optional"===t){var o=new l("_"+i);s.setOption("proto3_optional",!0),o.add(s),e.add(o)}else e.add(s);e===B&&U.push(s)}function en(e,t){if(F>=2023)throw q("group");var r=D();if(!E.test(r))throw q(r,"name");var n=f.lcFirst(r);r===n&&(r=f.ucFirst(r)),P("=");var i=H(D()),o=new s(r);o.group=!0;var l=new a(n,i,r,t);l.filename=C.filename,ee(o,function(e){switch(e){case"option":el(o,e),P(";");break;case"required":case"repeated":er(o,e);break;case"optional":"proto3"===F?er(o,"proto3_optional"):er(o,"optional");break;case"message":et(o,e);break;case"enum":ea(o,e);break;case"reserved":K(o.reserved||(o.reserved=[]),!0);break;default:throw q(e)}}),e.add(o).add(l)}function ei(e){P("<");var t=D();if(void 0===p.mapKey[t])throw q(t,"type");P(",");var r=D();if(!w.test(r))throw q(r,"type");P(">");var n=D();if(!E.test(n))throw q(n,"name");P("=");var i=new o(j(n),H(D()),t,r);ee(i,function(e){if("option"===e)el(i,e),P(";");else throw q(e)},function(){ed(i)}),e.add(i)}function es(e,t){if(!E.test(t=D()))throw q(t,"name");var r=new l(j(t));ee(r,function(e){"option"===e?(el(r,e),P(";")):(O(e),er(r,"optional"))}),e.add(r)}function ea(e,t){if(!E.test(t=D()))throw q(t,"name");var r=new u(t);ee(r,function(e){switch(e){case"option":el(r,e),P(";");break;case"reserved":K(r.reserved||(r.reserved=[]),!0),void 0===r.reserved&&(r.reserved=[]);break;default:eo(r,e)}}),e.add(r),e===B&&U.push(r)}function eo(e,t){if(!E.test(t))throw q(t,"name");P("=");var r=H(D(),!0),n={options:void 0};n.getOption=function(e){return this.options[e]},n.setOption=function(e,t){d.prototype.setOption.call(n,e,t)},n.setParsedOption=function(){},ee(n,function(e){if("option"===e)el(n,e),P(";");else throw q(e)},function(){ed(n)}),e.add(t,r,n.comment,n.parsedOptions||n.options)}function el(e,t){var r,n,i=!0;for("option"===t&&(t=D());"="!==t;){if("("===t){var s=D();P(")"),t="("+s+")"}if(i){if(i=!1,t.includes(".")&&!t.includes("(")){var a=t.split(".");r=a[0]+".",t=a[1];continue}r=t}else n=n?n+=t:t;t=D()}var o=eu(e,n?r.concat(n):r);n=n&&"."===n[0]?n.slice(1):n,eh(e,r=r&&"."===r[r.length-1]?r.slice(0,-1):r,o,n)}function eu(e,t){if(P("{",!0)){for(var r={};!P("}",!0);){if(!E.test(_=D()))throw q(_,"name");if(null===_)throw q(_,"end of input");var n,i,s=_;if(P(":",!0),"{"===x())n=eu(e,t+"."+_);else if("["===x()){if(n=[],P("[",!0)){do i=$(!0),n.push(i);while(P(",",!0));P("]"),void 0!==i&&ec(e,t+"."+_,i)}}else n=$(!0),ec(e,t+"."+_,n);var a=r[s];a&&(n=[].concat(a).concat(n)),r[s]=n,P(",",!0),P(";",!0)}return r}var o=$(!0);return ec(e,t,o),o}function ec(e,t,r){if(B===e&&/^features\./.test(t)){V[t]=r;return}e.setOption&&e.setOption(t,r)}function eh(e,t,r,n){e.setParsedOption&&e.setParsedOption(t,r,n)}function ed(e){if(P("[",!0)){do el(e,"option");while(P(",",!0));P("]")}return e}function ep(e,t){if(!E.test(t=D()))throw q(t,"service name");var r=new c(t);ee(r,function(e){if(!Z(r,e)){if("rpc"===e)ef(r,e);else throw q(e)}}),e.add(r),e===B&&U.push(r)}function ef(e,t){var r=M(),n=t;if(!E.test(t=D()))throw q(t,"name");var i,s,a,o,l=t;if(P("("),P("stream",!0)&&(s=!0),!w.test(t=D())||(i=t,P(")"),P("returns"),P("("),P("stream",!0)&&(o=!0),!w.test(t=D())))throw q(t);a=t,P(")");var u=new h(l,n,i,a,s,o);u.comment=r,ee(u,function(e){if("option"===e)el(u,e),P(";");else throw q(e)}),e.add(u)}function em(e,t){if(!w.test(t=D()))throw q(t,"reference");var r=t;ee(null,function(t){switch(t){case"required":case"repeated":er(e,t,r);break;case"optional":"proto3"===F?er(e,"proto3_optional",r):er(e,"optional",r);break;default:if("proto2"===F||!w.test(t))throw q(t);O(t),er(e,"optional",r)}})}for(;null!==(_=D());)switch(_){case"package":if(!L)throw q(_);Q();break;case"import":if(!L)throw q(_);Y();break;case"syntax":if(!L)throw q(_);J();break;case"edition":if(!L)throw q(_);X();break;case"option":el(B,_),P(";",!0);break;default:if(Z(B,_)){L=!1;continue}throw q(_)}return z(),C.filename=null,{package:I,imports:R,weakImports:N,root:t}}},2279:(e,t,r)=>{"use strict";e.exports=l;var n,i=r(745),s=i.LongBits,a=i.utf8;function o(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function l(e){this.buf=e,this.pos=0,this.len=e.length}var u="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new l(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new l(e);throw Error("illegal buffer")},c=function(){return i.Buffer?function(e){return(l.create=function(e){return i.Buffer.isBuffer(e)?new n(e):u(e)})(e)}:u};function h(){var e=new s(0,0),t=0;if(this.len-this.pos>4){for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;t=0}else{for(;t<3;++t){if(this.pos>=this.len)throw o(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}if(this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw o(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function d(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function p(){if(this.pos+8>this.len)throw o(this,8);return new s(d(this.buf,this.pos+=4),d(this.buf,this.pos+=4))}l.create=c(),l.prototype._slice=i.Array.prototype.subarray||i.Array.prototype.slice,l.prototype.uint32=function(){var e=4294967295;return function(){if(e=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128||(e=(e|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,o(this,10);return e}}(),l.prototype.int32=function(){return 0|this.uint32()},l.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},l.prototype.bool=function(){return 0!==this.uint32()},l.prototype.fixed32=function(){if(this.pos+4>this.len)throw o(this,4);return d(this.buf,this.pos+=4)},l.prototype.sfixed32=function(){if(this.pos+4>this.len)throw o(this,4);return 0|d(this.buf,this.pos+=4)},l.prototype.float=function(){if(this.pos+4>this.len)throw o(this,4);var e=i.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},l.prototype.double=function(){if(this.pos+8>this.len)throw o(this,4);var e=i.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},l.prototype.bytes=function(){var e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw o(this,e);if(this.pos+=e,Array.isArray(this.buf))return this.buf.slice(t,r);if(t===r){var n=i.Buffer;return n?n.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,t,r)},l.prototype.string=function(){var e=this.bytes();return a.read(e,0,e.length)},l.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw o(this,e);this.pos+=e}else do if(this.pos>=this.len)throw o(this);while(128&this.buf[this.pos++]);return this},l.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},l._configure=function(e){n=e,l.create=c(),n._configure();var t=i.Long?"toLong":"toNumber";i.merge(l.prototype,{int64:function(){return h.call(this)[t](!1)},uint64:function(){return h.call(this)[t](!0)},sint64:function(){return h.call(this).zzDecode()[t](!1)},fixed64:function(){return p.call(this)[t](!0)},sfixed64:function(){return p.call(this)[t](!1)}})}},424:(e,t,r)=>{"use strict";e.exports=s;var n=r(2279);(s.prototype=Object.create(n.prototype)).constructor=s;var i=r(745);function s(e){n.call(this,e)}s._configure=function(){i.Buffer&&(s.prototype._slice=i.Buffer.prototype.slice)},s.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},s._configure()},4343:(e,t,r)=>{"use strict";e.exports=h;var n,i,s,a=r(4943);((h.prototype=Object.create(a.prototype)).constructor=h).className="Root";var o=r(7510),l=r(1114),u=r(2695),c=r(4615);function h(e){a.call(this,"",e),this.deferred=[],this.files=[],this._edition="proto2",this._fullyQualifiedObjects={}}function d(){}h.fromJSON=function(e,t){return t||(t=new h),e.options&&t.setOptions(e.options),t.addJSON(e.nested).resolveAll()},h.prototype.resolvePath=c.path.resolve,h.prototype.fetch=c.fetch,h.prototype.load=function e(t,r,n){"function"==typeof r&&(n=r,r=void 0);var a=this;if(!n)return c.asPromise(e,a,t,r);var o=n===d;function l(e,t){if(n){if(o)throw e;t&&t.resolveAll();var r=n;n=null,r(e,t)}}function u(e){var t=e.lastIndexOf("google/protobuf/");if(t>-1){var r=e.substring(t);if(r in s)return r}return null}function h(e,t){try{if(c.isString(t)&&"{"===t.charAt(0)&&(t=JSON.parse(t)),c.isString(t)){i.filename=e;var n,s=i(t,a,r),h=0;if(s.imports)for(;h<s.imports.length;++h)(n=u(s.imports[h])||a.resolvePath(e,s.imports[h]))&&p(n);if(s.weakImports)for(h=0;h<s.weakImports.length;++h)(n=u(s.weakImports[h])||a.resolvePath(e,s.weakImports[h]))&&p(n,!0)}else a.setOptions(t.options).addJSON(t.nested)}catch(e){l(e)}o||f||l(null,a)}function p(e,t){if(e=u(e)||e,!(a.files.indexOf(e)>-1)){if(a.files.push(e),e in s){o?h(e,s[e]):(++f,setTimeout(function(){--f,h(e,s[e])}));return}if(o){var r;try{r=c.fs.readFileSync(e).toString("utf8")}catch(e){t||l(e);return}h(e,r)}else++f,a.fetch(e,function(r,i){if(--f,n){if(r){t?f||l(null,a):l(r);return}h(e,i)}})}}var f=0;c.isString(t)&&(t=[t]);for(var m,g=0;g<t.length;++g)(m=a.resolvePath("",t[g]))&&p(m);return o?a.resolveAll():f||l(null,a),a},h.prototype.loadSync=function(e,t){if(!c.isNode)throw Error("not supported");return this.load(e,t,d)},h.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map(function(e){return"'extend "+e.extend+"' in "+e.parent.fullName}).join(", "));return a.prototype.resolveAll.call(this)};var p=/^[A-Z]/;function f(e,t){var r=t.parent.lookup(t.extend);if(r){var n=new o(t.fullName,t.id,t.type,t.rule,void 0,t.options);return!!r.get(n.name)||(n.declaringField=t,t.extensionField=n,r.add(n),!0)}return!1}h.prototype._handleAdd=function(e){if(e instanceof o)void 0===e.extend||e.extensionField||f(this,e)||this.deferred.push(e);else if(e instanceof l)p.test(e.name)&&(e.parent[e.name]=e.values);else if(!(e instanceof u)){if(e instanceof n)for(var t=0;t<this.deferred.length;)f(this,this.deferred[t])?this.deferred.splice(t,1):++t;for(var r=0;r<e.nestedArray.length;++r)this._handleAdd(e._nestedArray[r]);p.test(e.name)&&(e.parent[e.name]=e)}(e instanceof n||e instanceof l||e instanceof o)&&(this._fullyQualifiedObjects[e.fullName]=e)},h.prototype._handleRemove=function(e){if(e instanceof o){if(void 0!==e.extend){if(e.extensionField)e.extensionField.parent.remove(e.extensionField),e.extensionField=null;else{var t=this.deferred.indexOf(e);t>-1&&this.deferred.splice(t,1)}}}else if(e instanceof l)p.test(e.name)&&delete e.parent[e.name];else if(e instanceof a){for(var r=0;r<e.nestedArray.length;++r)this._handleRemove(e._nestedArray[r]);p.test(e.name)&&delete e.parent[e.name]}delete this._fullyQualifiedObjects[e.fullName]},h._configure=function(e,t,r){n=e,i=t,s=r}},9694:e=>{"use strict";e.exports={}},4774:(e,t,r)=>{"use strict";t.Service=r(3829)},3829:(e,t,r)=>{"use strict";e.exports=i;var n=r(745);function i(e,t,r){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");n.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=!!t,this.responseDelimited=!!r}(i.prototype=Object.create(n.EventEmitter.prototype)).constructor=i,i.prototype.rpcCall=function e(t,r,i,s,a){if(!s)throw TypeError("request must be specified");var o=this;if(!a)return n.asPromise(e,o,t,r,i,s);if(!o.rpcImpl){setTimeout(function(){a(Error("already ended"))},0);return}try{return o.rpcImpl(t,r[o.requestDelimited?"encodeDelimited":"encode"](s).finish(),function(e,r){if(e)return o.emit("error",e,t),a(e);if(null===r){o.end(!0);return}if(!(r instanceof i))try{r=i[o.responseDelimited?"decodeDelimited":"decode"](r)}catch(e){return o.emit("error",e,t),a(e)}return o.emit("data",r,t),a(null,r)})}catch(e){o.emit("error",e,t),setTimeout(function(){a(e)},0);return}},i.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},1631:(e,t,r)=>{"use strict";e.exports=o;var n=r(4943);((o.prototype=Object.create(n.prototype)).constructor=o).className="Service";var i=r(6539),s=r(4615),a=r(4774);function o(e,t){n.call(this,e,t),this.methods={},this._methodsArray=null}function l(e){return e._methodsArray=null,e}o.fromJSON=function(e,t){var r=new o(e,t.options);if(t.methods)for(var n=Object.keys(t.methods),s=0;s<n.length;++s)r.add(i.fromJSON(n[s],t.methods[n[s]]));return t.nested&&r.addJSON(t.nested),t.edition&&(r._edition=t.edition),r.comment=t.comment,r._defaultEdition="proto3",r},o.prototype.toJSON=function(e){var t=n.prototype.toJSON.call(this,e),r=!!e&&!!e.keepComments;return s.toObject(["edition",this._editionToJSON(),"options",t&&t.options||void 0,"methods",n.arrayToJSON(this.methodsArray,e)||{},"nested",t&&t.nested||void 0,"comment",r?this.comment:void 0])},Object.defineProperty(o.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=s.toArray(this.methods))}}),o.prototype.get=function(e){return this.methods[e]||n.prototype.get.call(this,e)},o.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;n.prototype.resolve.call(this);for(var e=this.methodsArray,t=0;t<e.length;++t)e[t].resolve();return this},o.prototype._resolveFeaturesRecursive=function(e){return this._needsRecursiveFeatureResolution&&(e=this._edition||e,n.prototype._resolveFeaturesRecursive.call(this,e),this.methodsArray.forEach(t=>{t._resolveFeaturesRecursive(e)})),this},o.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);return e instanceof i?(this.methods[e.name]=e,e.parent=this,l(this)):n.prototype.add.call(this,e)},o.prototype.remove=function(e){if(e instanceof i){if(this.methods[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.methods[e.name],e.parent=null,l(this)}return n.prototype.remove.call(this,e)},o.prototype.create=function(e,t,r){for(var n,i=new a.Service(e,t,r),o=0;o<this.methodsArray.length;++o){var l=s.lcFirst((n=this._methodsArray[o]).resolve().name).replace(/[^$\w_]/g,"");i[l]=s.codegen(["r","c"],s.isReserved(l)?l+"_":l)("return this.rpcCall(m,q,s,r,c)")({m:n,q:n.resolvedRequestType.ctor,s:n.resolvedResponseType.ctor})}return i}},9867:e=>{"use strict";e.exports=h;var t=/[\s{}=;:[\],'"()<>]/g,r=/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,n=/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,i=/^ *[*/]+ */,s=/^\s*\*?\/*/,a=/\n/g,o=/\s/,l=/\\(.?)/g,u={0:"\0",r:"\r",n:"\n",t:"	"};function c(e){return e.replace(l,function(e,t){switch(t){case"\\":case"":return t;default:return u[t]||""}})}function h(e,l){e=e.toString();var u=0,h=e.length,d=1,p=0,f={},m=[],g=null;function y(e){return Error("illegal "+e+" (line "+d+")")}function v(){var t="'"===g?n:r;t.lastIndex=u-1;var i=t.exec(e);if(!i)throw y("string");return u=t.lastIndex,C(g),g=null,c(i[1])}function b(t){return e.charAt(t)}function T(t,r,n){var o,u,c={type:e.charAt(t++),lineEmpty:!1,leading:n},h=t-(o=l?2:3);do if(--h<0||"\n"===(u=e.charAt(h))){c.lineEmpty=!0;break}while(" "===u||"	"===u);for(var m=e.substring(t,r).split(a),g=0;g<m.length;++g)m[g]=m[g].replace(l?s:i,"").trim();c.text=m.join("\n").trim(),f[d]=c,p=d}function S(t){var r=E(t),n=e.substring(t,r);return/^\s*\/\//.test(n)}function E(e){for(var t=e;t<h&&"\n"!==b(t);)t++;return t}function w(){if(m.length>0)return m.shift();if(g)return v();var r,n,i,s,a,c=0===u;do{if(u===h)return null;for(r=!1;o.test(i=b(u));)if("\n"===i&&(c=!0,++d),++u===h)return null;if("/"===b(u)){if(++u===h)throw y("comment");if("/"===b(u)){if(l){if(s=u,a=!1,S(u-1)){a=!0;do if((u=E(u))===h||(u++,!c))break;while(S(u))}else u=Math.min(h,E(u)+1);a&&(T(s,u,c),c=!0),d++,r=!0}else{for(a="/"===b(s=u+1);"\n"!==b(++u);)if(u===h)return null;++u,a&&(T(s,u-1,c),c=!0),++d,r=!0}}else{if("*"!==(i=b(u)))return"/";s=u+1,a=l||"*"===b(s);do{if("\n"===i&&++d,++u===h)throw y("comment");n=i,i=b(u)}while("*"!==n||"/"!==i);++u,a&&(T(s,u-2,c),c=!0),r=!0}}}while(r);var p=u;if(t.lastIndex=0,!t.test(b(p++)))for(;p<h&&!t.test(b(p));)++p;var f=e.substring(u,u=p);return('"'===f||"'"===f)&&(g=f),f}function C(e){m.push(e)}function _(){if(!m.length){var e=w();if(null===e)return null;C(e)}return m[0]}function I(e,t){var r=_();if(r===e)return w(),!0;if(!t)throw y("token '"+r+"', '"+e+"' expected");return!1}function R(e){var t,r=null;return void 0===e?(t=f[d-1],delete f[d-1],t&&(l||"*"===t.type||t.lineEmpty)&&(r=t.leading?t.text:null)):(p<e&&_(),t=f[e],delete f[e],t&&!t.lineEmpty&&(l||"/"===t.type)&&(r=t.leading?null:t.text)),r}return Object.defineProperty({next:w,peek:_,push:C,skip:I,cmnt:R},"line",{get:function(){return d}})}h.unescape=c},3839:(e,t,r)=>{"use strict";e.exports=v;var n=r(4943);((v.prototype=Object.create(n.prototype)).constructor=v).className="Type";var i=r(1114),s=r(2695),a=r(7510),o=r(9538),l=r(1631),u=r(2936),c=r(2279),h=r(8458),d=r(4615),p=r(8455),f=r(1526),m=r(1506),g=r(5711),y=r(9579);function v(e,t){n.call(this,e,t),this.fields={},this.oneofs=void 0,this.extensions=void 0,this.reserved=void 0,this.group=void 0,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}function b(e){return e._fieldsById=e._fieldsArray=e._oneofsArray=null,delete e.encode,delete e.decode,delete e.verify,e}Object.defineProperties(v.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var e=Object.keys(this.fields),t=0;t<e.length;++t){var r=this.fields[e[t]],n=r.id;if(this._fieldsById[n])throw Error("duplicate id "+n+" in "+this);this._fieldsById[n]=r}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=d.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=d.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=v.generateConstructor(this)())},set:function(e){var t=e.prototype;t instanceof u||((e.prototype=new u).constructor=e,d.merge(e.prototype,t)),e.$type=e.prototype.$type=this,d.merge(e,u,!0),this._ctor=e;for(var r=0;r<this.fieldsArray.length;++r)this._fieldsArray[r].resolve();var n={};for(r=0;r<this.oneofsArray.length;++r)n[this._oneofsArray[r].resolve().name]={get:d.oneOfGetter(this._oneofsArray[r].oneof),set:d.oneOfSetter(this._oneofsArray[r].oneof)};r&&Object.defineProperties(e.prototype,n)}}}),v.generateConstructor=function(e){for(var t,r=d.codegen(["p"],e.name),n=0;n<e.fieldsArray.length;++n)(t=e._fieldsArray[n]).map?r("this%s={}",d.safeProp(t.name)):t.repeated&&r("this%s=[]",d.safeProp(t.name));return r("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")},v.fromJSON=function(e,t){var r=new v(e,t.options);r.extensions=t.extensions,r.reserved=t.reserved;for(var u=Object.keys(t.fields),c=0;c<u.length;++c)r.add((void 0!==t.fields[u[c]].keyType?o.fromJSON:a.fromJSON)(u[c],t.fields[u[c]]));if(t.oneofs)for(u=Object.keys(t.oneofs),c=0;c<u.length;++c)r.add(s.fromJSON(u[c],t.oneofs[u[c]]));if(t.nested)for(u=Object.keys(t.nested),c=0;c<u.length;++c){var h=t.nested[u[c]];r.add((void 0!==h.id?a.fromJSON:void 0!==h.fields?v.fromJSON:void 0!==h.values?i.fromJSON:void 0!==h.methods?l.fromJSON:n.fromJSON)(u[c],h))}return t.extensions&&t.extensions.length&&(r.extensions=t.extensions),t.reserved&&t.reserved.length&&(r.reserved=t.reserved),t.group&&(r.group=!0),t.comment&&(r.comment=t.comment),t.edition&&(r._edition=t.edition),r._defaultEdition="proto3",r},v.prototype.toJSON=function(e){var t=n.prototype.toJSON.call(this,e),r=!!e&&!!e.keepComments;return d.toObject(["edition",this._editionToJSON(),"options",t&&t.options||void 0,"oneofs",n.arrayToJSON(this.oneofsArray,e),"fields",n.arrayToJSON(this.fieldsArray.filter(function(e){return!e.declaringField}),e)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:void 0,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"group",this.group||void 0,"nested",t&&t.nested||void 0,"comment",r?this.comment:void 0])},v.prototype.resolveAll=function(){if(!this._needsRecursiveResolve)return this;n.prototype.resolveAll.call(this);var e=this.oneofsArray;for(r=0;r<e.length;)e[r++].resolve();for(var t=this.fieldsArray,r=0;r<t.length;)t[r++].resolve();return this},v.prototype._resolveFeaturesRecursive=function(e){return this._needsRecursiveFeatureResolution&&(e=this._edition||e,n.prototype._resolveFeaturesRecursive.call(this,e),this.oneofsArray.forEach(t=>{t._resolveFeatures(e)}),this.fieldsArray.forEach(t=>{t._resolveFeatures(e)})),this},v.prototype.get=function(e){return this.fields[e]||this.oneofs&&this.oneofs[e]||this.nested&&this.nested[e]||null},v.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);if(e instanceof a&&void 0===e.extend){if(this._fieldsById?this._fieldsById[e.id]:this.fieldsById[e.id])throw Error("duplicate id "+e.id+" in "+this);if(this.isReservedId(e.id))throw Error("id "+e.id+" is reserved in "+this);if(this.isReservedName(e.name))throw Error("name '"+e.name+"' is reserved in "+this);return e.parent&&e.parent.remove(e),this.fields[e.name]=e,e.message=this,e.onAdd(this),b(this)}return e instanceof s?(this.oneofs||(this.oneofs={}),this.oneofs[e.name]=e,e.onAdd(this),b(this)):n.prototype.add.call(this,e)},v.prototype.remove=function(e){if(e instanceof a&&void 0===e.extend){if(!this.fields||this.fields[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.fields[e.name],e.parent=null,e.onRemove(this),b(this)}if(e instanceof s){if(!this.oneofs||this.oneofs[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.oneofs[e.name],e.parent=null,e.onRemove(this),b(this)}return n.prototype.remove.call(this,e)},v.prototype.isReservedId=function(e){return n.isReservedId(this.reserved,e)},v.prototype.isReservedName=function(e){return n.isReservedName(this.reserved,e)},v.prototype.create=function(e){return new this.ctor(e)},v.prototype.setup=function(){for(var e=this.fullName,t=[],r=0;r<this.fieldsArray.length;++r)t.push(this._fieldsArray[r].resolve().resolvedType);this.encode=p(this)({Writer:h,types:t,util:d}),this.decode=f(this)({Reader:c,types:t,util:d}),this.verify=m(this)({types:t,util:d}),this.fromObject=g.fromObject(this)({types:t,util:d}),this.toObject=g.toObject(this)({types:t,util:d});var n=y[e];if(n){var i=Object.create(this);i.fromObject=this.fromObject,this.fromObject=n.fromObject.bind(i),i.toObject=this.toObject,this.toObject=n.toObject.bind(i)}return this},v.prototype.encode=function(e,t){return this.setup().encode(e,t)},v.prototype.encodeDelimited=function(e,t){return this.encode(e,t&&t.len?t.fork():t).ldelim()},v.prototype.decode=function(e,t){return this.setup().decode(e,t)},v.prototype.decodeDelimited=function(e){return e instanceof c||(e=c.create(e)),this.decode(e,e.uint32())},v.prototype.verify=function(e){return this.setup().verify(e)},v.prototype.fromObject=function(e){return this.setup().fromObject(e)},v.prototype.toObject=function(e,t){return this.setup().toObject(e,t)},v.d=function(e){return function(t){d.decorateType(t,e)}}},6160:(e,t,r)=>{"use strict";var n=t,i=r(4615),s=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function a(e,t){var r=0,n={};for(t|=0;r<e.length;)n[s[r+t]]=e[r++];return n}n.basic=a([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]),n.defaults=a([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",i.emptyArray,null]),n.long=a([0,0,0,1,1],7),n.mapKey=a([0,0,0,5,5,0,0,0,1,1,0,2],2),n.packed=a([1,5,0,0,0,5,5,0,0,0,1,1,0])},4615:(e,t,r)=>{"use strict";var n,i,s=e.exports=r(745),a=r(9694);s.codegen=r(696),s.fetch=r(7828),s.path=r(2727),s.fs=s.inquire("fs"),s.toArray=function(e){if(e){for(var t=Object.keys(e),r=Array(t.length),n=0;n<t.length;)r[n]=e[t[n++]];return r}return[]},s.toObject=function(e){for(var t={},r=0;r<e.length;){var n=e[r++],i=e[r++];void 0!==i&&(t[n]=i)}return t};var o=/\\/g,l=/"/g;s.isReserved=function(e){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(e)},s.safeProp=function(e){return!/^[$\w_]+$/.test(e)||s.isReserved(e)?'["'+e.replace(o,"\\\\").replace(l,'\\"')+'"]':"."+e},s.ucFirst=function(e){return e.charAt(0).toUpperCase()+e.substring(1)};var u=/_([a-z])/g;s.camelCase=function(e){return e.substring(0,1)+e.substring(1).replace(u,function(e,t){return t.toUpperCase()})},s.compareFieldsById=function(e,t){return e.id-t.id},s.decorateType=function(e,t){if(e.$type)return t&&e.$type.name!==t&&(s.decorateRoot.remove(e.$type),e.$type.name=t,s.decorateRoot.add(e.$type)),e.$type;n||(n=r(3839));var i=new n(t||e.name);return s.decorateRoot.add(i),i.ctor=e,Object.defineProperty(e,"$type",{value:i,enumerable:!1}),Object.defineProperty(e.prototype,"$type",{value:i,enumerable:!1}),i};var c=0;s.decorateEnum=function(e){if(e.$type)return e.$type;i||(i=r(1114));var t=new i("Enum"+c++,e);return s.decorateRoot.add(t),Object.defineProperty(e,"$type",{value:t,enumerable:!1}),t},s.setProperty=function(e,t,r,n){function i(e,t,r){var s=t.shift();if("__proto__"===s||"prototype"===s)return e;if(t.length>0)e[s]=i(e[s]||{},t,r);else{var a=e[s];if(a&&n)return e;a&&(r=[].concat(a).concat(r)),e[s]=r}return e}if("object"!=typeof e)throw TypeError("dst must be an object");if(!t)throw TypeError("path must be specified");return i(e,t=t.split("."),r)},Object.defineProperty(s,"decorateRoot",{get:function(){return a.decorated||(a.decorated=new(r(4343)))}})},3674:(e,t,r)=>{"use strict";e.exports=i;var n=r(745);function i(e,t){this.lo=e>>>0,this.hi=t>>>0}var s=i.zero=new i(0,0);s.toNumber=function(){return 0},s.zzEncode=s.zzDecode=function(){return this},s.length=function(){return 1};var a=i.zeroHash="\0\0\0\0\0\0\0\0";i.fromNumber=function(e){if(0===e)return s;var t=e<0;t&&(e=-e);var r=e>>>0,n=(e-r)/4294967296>>>0;return t&&(n=~n>>>0,r=~r>>>0,++r>4294967295&&(r=0,++n>4294967295&&(n=0))),new i(r,n)},i.from=function(e){if("number"==typeof e)return i.fromNumber(e);if(n.isString(e)){if(!n.Long)return i.fromNumber(parseInt(e,10));e=n.Long.fromString(e)}return e.low||e.high?new i(e.low>>>0,e.high>>>0):s},i.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=~this.lo+1>>>0,r=~this.hi>>>0;return t||(r=r+1>>>0),-(t+4294967296*r)}return this.lo+4294967296*this.hi},i.prototype.toLong=function(e){return n.Long?new n.Long(0|this.lo,0|this.hi,!!e):{low:0|this.lo,high:0|this.hi,unsigned:!!e}};var o=String.prototype.charCodeAt;i.fromHash=function(e){return e===a?s:new i((o.call(e,0)|o.call(e,1)<<8|o.call(e,2)<<16|o.call(e,3)<<24)>>>0,(o.call(e,4)|o.call(e,5)<<8|o.call(e,6)<<16|o.call(e,7)<<24)>>>0)},i.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},i.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},i.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},i.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return 0===r?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10}},745:function(e,t,r){"use strict";var n=t;function i(e,t,r){for(var n=Object.keys(t),i=0;i<n.length;++i)void 0!==e[n[i]]&&r||(e[n[i]]=t[n[i]]);return e}function s(e){function t(e,r){if(!(this instanceof t))return new t(e,r);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:Error().stack||""}),r&&i(this,r)}return t.prototype=Object.create(Error.prototype,{constructor:{value:t,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return e},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),t}n.asPromise=r(1417),n.base64=r(5386),n.EventEmitter=r(3478),n.float=r(5256),n.inquire=r(1374),n.utf8=r(3670),n.pool=r(6733),n.LongBits=r(3674),n.isNode=!!("undefined"!=typeof global&&global&&global.process&&global.process.versions&&global.process.versions.node),n.global=n.isNode&&global||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||this,n.emptyArray=Object.freeze?Object.freeze([]):[],n.emptyObject=Object.freeze?Object.freeze({}):{},n.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},n.isString=function(e){return"string"==typeof e||e instanceof String},n.isObject=function(e){return e&&"object"==typeof e},n.isset=n.isSet=function(e,t){var r=e[t];return!!(null!=r&&e.hasOwnProperty(t))&&("object"!=typeof r||(Array.isArray(r)?r.length:Object.keys(r).length)>0)},n.Buffer=function(){try{var e=n.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),n._Buffer_from=null,n._Buffer_allocUnsafe=null,n.newBuffer=function(e){return"number"==typeof e?n.Buffer?n._Buffer_allocUnsafe(e):new n.Array(e):n.Buffer?n._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},n.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,n.Long=n.global.dcodeIO&&n.global.dcodeIO.Long||n.global.Long||n.inquire("long"),n.key2Re=/^true|false|0|1$/,n.key32Re=/^-?(?:0|[1-9][0-9]*)$/,n.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,n.longToHash=function(e){return e?n.LongBits.from(e).toHash():n.LongBits.zeroHash},n.longFromHash=function(e,t){var r=n.LongBits.fromHash(e);return n.Long?n.Long.fromBits(r.lo,r.hi,t):r.toNumber(!!t)},n.merge=i,n.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},n.newError=s,n.ProtocolError=s("ProtocolError"),n.oneOfGetter=function(e){for(var t={},r=0;r<e.length;++r)t[e[r]]=1;return function(){for(var e=Object.keys(this),r=e.length-1;r>-1;--r)if(1===t[e[r]]&&void 0!==this[e[r]]&&null!==this[e[r]])return e[r]}},n.oneOfSetter=function(e){return function(t){for(var r=0;r<e.length;++r)e[r]!==t&&delete this[e[r]]}},n.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},n._configure=function(){var e=n.Buffer;if(!e){n._Buffer_from=n._Buffer_allocUnsafe=null;return}n._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,r){return new e(t,r)},n._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}}},1506:(e,t,r)=>{"use strict";e.exports=l;var n=r(1114),i=r(4615);function s(e,t){return e.name+": "+t+(e.repeated&&"array"!==t?"[]":e.map&&"object"!==t?"{k:"+e.keyType+"}":"")+" expected"}function a(e,t,r,i){if(t.resolvedType){if(t.resolvedType instanceof n){e("switch(%s){",i)("default:")("return%j",s(t,"enum value"));for(var a=Object.keys(t.resolvedType.values),o=0;o<a.length;++o)e("case %i:",t.resolvedType.values[a[o]]);e("break")("}")}else e("{")("var e=types[%i].verify(%s);",r,i)("if(e)")("return%j+e",t.name+".")("}")}else switch(t.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":e("if(!util.isInteger(%s))",i)("return%j",s(t,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":e("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",i,i,i,i)("return%j",s(t,"integer|Long"));break;case"float":case"double":e('if(typeof %s!=="number")',i)("return%j",s(t,"number"));break;case"bool":e('if(typeof %s!=="boolean")',i)("return%j",s(t,"boolean"));break;case"string":e("if(!util.isString(%s))",i)("return%j",s(t,"string"));break;case"bytes":e('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',i,i,i)("return%j",s(t,"buffer"))}return e}function o(e,t,r){switch(t.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":e("if(!util.key32Re.test(%s))",r)("return%j",s(t,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":e("if(!util.key64Re.test(%s))",r)("return%j",s(t,"integer|Long key"));break;case"bool":e("if(!util.key2Re.test(%s))",r)("return%j",s(t,"boolean key"))}return e}function l(e){var t=i.codegen(["m"],e.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),r=e.oneofsArray,n={};r.length&&t("var p={}");for(var l=0;l<e.fieldsArray.length;++l){var u=e._fieldsArray[l].resolve(),c="m"+i.safeProp(u.name);if(u.optional&&t("if(%s!=null&&m.hasOwnProperty(%j)){",c,u.name),u.map)t("if(!util.isObject(%s))",c)("return%j",s(u,"object"))("var k=Object.keys(%s)",c)("for(var i=0;i<k.length;++i){"),o(t,u,"k[i]"),a(t,u,l,c+"[k[i]]")("}");else if(u.repeated)t("if(!Array.isArray(%s))",c)("return%j",s(u,"array"))("for(var i=0;i<%s.length;++i){",c),a(t,u,l,c+"[i]")("}");else{if(u.partOf){var h=i.safeProp(u.partOf.name);1===n[u.partOf.name]&&t("if(p%s===1)",h)("return%j",u.partOf.name+": multiple values"),n[u.partOf.name]=1,t("p%s=1",h)}a(t,u,l,c)}u.optional&&t("}")}return t("return null")}},9579:(e,t,r)=>{"use strict";var n=t,i=r(2936);n[".google.protobuf.Any"]={fromObject:function(e){if(e&&e["@type"]){var t=e["@type"].substring(e["@type"].lastIndexOf("/")+1),r=this.lookup(t);if(r){var n="."===e["@type"].charAt(0)?e["@type"].slice(1):e["@type"];return -1===n.indexOf("/")&&(n="/"+n),this.create({type_url:n,value:r.encode(r.fromObject(e)).finish()})}}return this.fromObject(e)},toObject:function(e,t){var r="type.googleapis.com/",n="",s="";if(t&&t.json&&e.type_url&&e.value){s=e.type_url.substring(e.type_url.lastIndexOf("/")+1),n=e.type_url.substring(0,e.type_url.lastIndexOf("/")+1);var a=this.lookup(s);a&&(e=a.decode(e.value))}if(!(e instanceof this.ctor)&&e instanceof i){var o=e.$type.toObject(e,t),l="."===e.$type.fullName[0]?e.$type.fullName.slice(1):e.$type.fullName;return""===n&&(n=r),s=n+l,o["@type"]=s,o}return this.toObject(e,t)}}},8458:(e,t,r)=>{"use strict";e.exports=h;var n,i=r(745),s=i.LongBits,a=i.base64,o=i.utf8;function l(e,t,r){this.fn=e,this.len=t,this.next=void 0,this.val=r}function u(){}function c(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function h(){this.len=0,this.head=new l(u,0,0),this.tail=this.head,this.states=null}var d=function(){return i.Buffer?function(){return(h.create=function(){return new n})()}:function(){return new h}};function p(e,t,r){t[r]=255&e}function f(e,t,r){for(;e>127;)t[r++]=127&e|128,e>>>=7;t[r]=e}function m(e,t){this.len=e,this.next=void 0,this.val=t}function g(e,t,r){for(;e.hi;)t[r++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[r++]=127&e.lo|128,e.lo=e.lo>>>7;t[r++]=e.lo}function y(e,t,r){t[r]=255&e,t[r+1]=e>>>8&255,t[r+2]=e>>>16&255,t[r+3]=e>>>24}h.create=d(),h.alloc=function(e){return new i.Array(e)},i.Array!==Array&&(h.alloc=i.pool(h.alloc,i.Array.prototype.subarray)),h.prototype._push=function(e,t,r){return this.tail=this.tail.next=new l(e,t,r),this.len+=t,this},m.prototype=Object.create(l.prototype),m.prototype.fn=f,h.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new m((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},h.prototype.int32=function(e){return e<0?this._push(g,10,s.fromNumber(e)):this.uint32(e)},h.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},h.prototype.uint64=function(e){var t=s.from(e);return this._push(g,t.length(),t)},h.prototype.int64=h.prototype.uint64,h.prototype.sint64=function(e){var t=s.from(e).zzEncode();return this._push(g,t.length(),t)},h.prototype.bool=function(e){return this._push(p,1,e?1:0)},h.prototype.fixed32=function(e){return this._push(y,4,e>>>0)},h.prototype.sfixed32=h.prototype.fixed32,h.prototype.fixed64=function(e){var t=s.from(e);return this._push(y,4,t.lo)._push(y,4,t.hi)},h.prototype.sfixed64=h.prototype.fixed64,h.prototype.float=function(e){return this._push(i.float.writeFloatLE,4,e)},h.prototype.double=function(e){return this._push(i.float.writeDoubleLE,8,e)};var v=i.Array.prototype.set?function(e,t,r){t.set(e,r)}:function(e,t,r){for(var n=0;n<e.length;++n)t[r+n]=e[n]};h.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(p,1,0);if(i.isString(e)){var r=h.alloc(t=a.length(e));a.decode(e,r,0),e=r}return this.uint32(t)._push(v,t,e)},h.prototype.string=function(e){var t=o.length(e);return t?this.uint32(t)._push(o.write,t,e):this._push(p,1,0)},h.prototype.fork=function(){return this.states=new c(this),this.head=this.tail=new l(u,0,0),this.len=0,this},h.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new l(u,0,0),this.len=0),this},h.prototype.ldelim=function(){var e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=e.next,this.tail=t,this.len+=r),this},h.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),r=0;e;)e.fn(e.val,t,r),r+=e.len,e=e.next;return t},h._configure=function(e){n=e,h.create=d(),n._configure()}},8386:(e,t,r)=>{"use strict";e.exports=s;var n=r(8458);(s.prototype=Object.create(n.prototype)).constructor=s;var i=r(745);function s(){n.call(this)}function a(e,t,r){e.length<40?i.utf8.write(e,t,r):t.utf8Write?t.utf8Write(e,r):t.write(e,r)}s._configure=function(){s.alloc=i._Buffer_allocUnsafe,s.writeBytesBuffer=i.Buffer&&i.Buffer.prototype instanceof Uint8Array&&"set"===i.Buffer.prototype.set.name?function(e,t,r){t.set(e,r)}:function(e,t,r){if(e.copy)e.copy(t,r,0,e.length);else for(var n=0;n<e.length;)t[r++]=e[n++]}},s.prototype.bytes=function(e){i.isString(e)&&(e=i._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(s.writeBytesBuffer,t,e),this},s.prototype.string=function(e){var t=i.Buffer.byteLength(e);return this.uint32(t),t&&this._push(a,t,e),this},s._configure()},29:function(e,t){var r;!function(n,i){function s(e){return e.default||e}void 0!==(r=(function(){var e={};return i(e),s(e)}).apply(t,[]))&&(e.exports=r)}("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self&&self,function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var t=null;try{t=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function r(e,t,r){this.low=0|e,this.high=0|t,this.unsigned=!!r}function n(e){return!0===(e&&e.__isLong__)}function i(e){var t=Math.clz32(e&-e);return e?31-t:t}r.prototype.__isLong__,Object.defineProperty(r.prototype,"__isLong__",{value:!0}),r.isLong=n;var s={},a={};function o(e,t){var r,n,i;return t?(e>>>=0,(i=0<=e&&e<256)&&(n=a[e]))?n:(r=u(e,0,!0),i&&(a[e]=r),r):(e|=0,(i=-128<=e&&e<128)&&(n=s[e]))?n:(r=u(e,e<0?-1:0,!1),i&&(s[e]=r),r)}function l(e,t){if(isNaN(e))return t?v:y;if(t){if(e<0)return v;if(e>=f)return w}else{if(e<=-m)return C;if(e+1>=m)return E}return e<0?l(-e,t).neg():u(e%p|0,e/p|0,t)}function u(e,t,n){return new r(e,t,n)}r.fromInt=o,r.fromNumber=l,r.fromBits=u;var c=Math.pow;function h(e,t,r){if(0===e.length)throw Error("empty string");if("number"==typeof t?(r=t,t=!1):t=!!t,"NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return t?v:y;if((r=r||10)<2||36<r)throw RangeError("radix");if((n=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===n)return h(e.substring(1),t,r).neg();for(var n,i=l(c(r,8)),s=y,a=0;a<e.length;a+=8){var o=Math.min(8,e.length-a),u=parseInt(e.substring(a,a+o),r);if(o<8){var d=l(c(r,o));s=s.mul(d).add(l(u))}else s=(s=s.mul(i)).add(l(u))}return s.unsigned=t,s}function d(e,t){return"number"==typeof e?l(e,t):"string"==typeof e?h(e,t):u(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}r.fromString=h,r.fromValue=d;var p=4294967296,f=18446744073709552e3,m=0x7fffffffffffffff,g=o(16777216),y=o(0);r.ZERO=y;var v=o(0,!0);r.UZERO=v;var b=o(1);r.ONE=b;var T=o(1,!0);r.UONE=T;var S=o(-1);r.NEG_ONE=S;var E=u(-1,2147483647,!1);r.MAX_VALUE=E;var w=u(-1,-1,!0);r.MAX_UNSIGNED_VALUE=w;var C=u(0,-2147483648,!1);r.MIN_VALUE=C;var _=r.prototype;_.toInt=function(){return this.unsigned?this.low>>>0:this.low},_.toNumber=function(){return this.unsigned?(this.high>>>0)*p+(this.low>>>0):this.high*p+(this.low>>>0)},_.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(!this.eq(C))return"-"+this.neg().toString(e);var t=l(e),r=this.div(t),n=r.mul(t).sub(this);return r.toString(e)+n.toInt().toString(e)}for(var i=l(c(e,6),this.unsigned),s=this,a="";;){var o=s.div(i),u=(s.sub(o.mul(i)).toInt()>>>0).toString(e);if((s=o).isZero())return u+a;for(;u.length<6;)u="0"+u;a=""+u+a}},_.getHighBits=function(){return this.high},_.getHighBitsUnsigned=function(){return this.high>>>0},_.getLowBits=function(){return this.low},_.getLowBitsUnsigned=function(){return this.low>>>0},_.getNumBitsAbs=function(){if(this.isNegative())return this.eq(C)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&(e&1<<t)==0;t--);return 0!=this.high?t+33:t+1},_.isSafeInteger=function(){var e=this.high>>21;return!e||!this.unsigned&&-1===e&&!(0===this.low&&-2097152===this.high)},_.isZero=function(){return 0===this.high&&0===this.low},_.eqz=_.isZero,_.isNegative=function(){return!this.unsigned&&this.high<0},_.isPositive=function(){return this.unsigned||this.high>=0},_.isOdd=function(){return(1&this.low)==1},_.isEven=function(){return(1&this.low)==0},_.equals=function(e){return n(e)||(e=d(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&this.high===e.high&&this.low===e.low},_.eq=_.equals,_.notEquals=function(e){return!this.eq(e)},_.neq=_.notEquals,_.ne=_.notEquals,_.lessThan=function(e){return 0>this.comp(e)},_.lt=_.lessThan,_.lessThanOrEqual=function(e){return 0>=this.comp(e)},_.lte=_.lessThanOrEqual,_.le=_.lessThanOrEqual,_.greaterThan=function(e){return this.comp(e)>0},_.gt=_.greaterThan,_.greaterThanOrEqual=function(e){return this.comp(e)>=0},_.gte=_.greaterThanOrEqual,_.ge=_.greaterThanOrEqual,_.compare=function(e){if(n(e)||(e=d(e)),this.eq(e))return 0;var t=this.isNegative(),r=e.isNegative();return t&&!r?-1:!t&&r?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},_.comp=_.compare,_.negate=function(){return!this.unsigned&&this.eq(C)?C:this.not().add(b)},_.neg=_.negate,_.add=function(e){n(e)||(e=d(e));var t,r,i=this.high>>>16,s=65535&this.high,a=this.low>>>16,o=65535&this.low,l=e.high>>>16,c=65535&e.high,h=e.low>>>16,p=65535&e.low,f=0,m=0;return t=0+((r=0+(o+p))>>>16),r&=65535,t+=a+h,m+=t>>>16,t&=65535,m+=s+c,f+=m>>>16,m&=65535,f+=i+l,u(t<<16|r,(f&=65535)<<16|m,this.unsigned)},_.subtract=function(e){return n(e)||(e=d(e)),this.add(e.neg())},_.sub=_.subtract,_.multiply=function(e){if(this.isZero())return this;if(n(e)||(e=d(e)),t)return u(t.mul(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned);if(e.isZero())return this.unsigned?v:y;if(this.eq(C))return e.isOdd()?C:y;if(e.eq(C))return this.isOdd()?C:y;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(g)&&e.lt(g))return l(this.toNumber()*e.toNumber(),this.unsigned);var r,i,s=this.high>>>16,a=65535&this.high,o=this.low>>>16,c=65535&this.low,h=e.high>>>16,p=65535&e.high,f=e.low>>>16,m=65535&e.low,b=0,T=0;return r=0+((i=0+c*m)>>>16),i&=65535,r+=o*m,T+=r>>>16,r&=65535,r+=c*f,T+=r>>>16,r&=65535,T+=a*m,b+=T>>>16,T&=65535,T+=o*f,b+=T>>>16,T&=65535,T+=c*p,b+=T>>>16,T&=65535,b+=s*m+a*f+o*p+c*h,u(r<<16|i,(b&=65535)<<16|T,this.unsigned)},_.mul=_.multiply,_.divide=function(e){if(n(e)||(e=d(e)),e.isZero())throw Error("division by zero");if(t){var r,i,s;return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?u((this.unsigned?t.div_u:t.div_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this}if(this.isZero())return this.unsigned?v:y;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return v;if(e.gt(this.shru(1)))return T;s=v}else{if(this.eq(C))return e.eq(b)||e.eq(S)?C:e.eq(C)?b:(r=this.shr(1).div(e).shl(1)).eq(y)?e.isNegative()?b:S:(i=this.sub(e.mul(r)),s=r.add(i.div(e)));if(e.eq(C))return this.unsigned?v:y;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();s=y}for(i=this;i.gte(e);){for(var a=Math.ceil(Math.log(r=Math.max(1,Math.floor(i.toNumber()/e.toNumber())))/Math.LN2),o=a<=48?1:c(2,a-48),h=l(r),p=h.mul(e);p.isNegative()||p.gt(i);)r-=o,p=(h=l(r,this.unsigned)).mul(e);h.isZero()&&(h=b),s=s.add(h),i=i.sub(p)}return s},_.div=_.divide,_.modulo=function(e){return(n(e)||(e=d(e)),t)?u((this.unsigned?t.rem_u:t.rem_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},_.mod=_.modulo,_.rem=_.modulo,_.not=function(){return u(~this.low,~this.high,this.unsigned)},_.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},_.clz=_.countLeadingZeros,_.countTrailingZeros=function(){return this.low?i(this.low):i(this.high)+32},_.ctz=_.countTrailingZeros,_.and=function(e){return n(e)||(e=d(e)),u(this.low&e.low,this.high&e.high,this.unsigned)},_.or=function(e){return n(e)||(e=d(e)),u(this.low|e.low,this.high|e.high,this.unsigned)},_.xor=function(e){return n(e)||(e=d(e)),u(this.low^e.low,this.high^e.high,this.unsigned)},_.shiftLeft=function(e){return(n(e)&&(e=e.toInt()),0==(e&=63))?this:e<32?u(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):u(0,this.low<<e-32,this.unsigned)},_.shl=_.shiftLeft,_.shiftRight=function(e){return(n(e)&&(e=e.toInt()),0==(e&=63))?this:e<32?u(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):u(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},_.shr=_.shiftRight,_.shiftRightUnsigned=function(e){return(n(e)&&(e=e.toInt()),0==(e&=63))?this:e<32?u(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):32===e?u(this.high,0,this.unsigned):u(this.high>>>e-32,0,this.unsigned)},_.shru=_.shiftRightUnsigned,_.shr_u=_.shiftRightUnsigned,_.rotateLeft=function(e){var t;return(n(e)&&(e=e.toInt()),0==(e&=63))?this:32===e?u(this.high,this.low,this.unsigned):e<32?(t=32-e,u(this.low<<e|this.high>>>t,this.high<<e|this.low>>>t,this.unsigned)):(e-=32,t=32-e,u(this.high<<e|this.low>>>t,this.low<<e|this.high>>>t,this.unsigned))},_.rotl=_.rotateLeft,_.rotateRight=function(e){var t;return(n(e)&&(e=e.toInt()),0==(e&=63))?this:32===e?u(this.high,this.low,this.unsigned):e<32?(t=32-e,u(this.high<<t|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned)):(e-=32,t=32-e,u(this.low<<t|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned))},_.rotr=_.rotateRight,_.toSigned=function(){return this.unsigned?u(this.low,this.high,!1):this},_.toUnsigned=function(){return this.unsigned?this:u(this.low,this.high,!0)},_.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},_.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},_.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},r.fromBytes=function(e,t,n){return n?r.fromBytesLE(e,t):r.fromBytesBE(e,t)},r.fromBytesLE=function(e,t){return new r(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},r.fromBytesBE=function(e,t){return new r(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)},"function"==typeof BigInt&&(r.fromBigInt=function(e,t){return u(Number(BigInt.asIntN(32,e)),Number(BigInt.asIntN(32,e>>BigInt(32))),t)},r.fromValue=function(e,t){return"bigint"==typeof e?r.fromBigInt(e,t):d(e,t)},_.toBigInt=function(){var e=BigInt(this.low>>>0);return BigInt(this.unsigned?this.high>>>0:this.high)<<BigInt(32)|e}),e.default=r})},2248:(e,t,r)=>{"use strict";let n,i;r.d(t,{Jn:()=>G,rh:()=>j,Xd:()=>V,KN:()=>$});var s=r(7965),a=r(9740),o=r(9810);let l=(e,t)=>t.some(t=>e instanceof t);function u(){return n||(n=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function c(){return i||(i=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}let h=new WeakMap,d=new WeakMap,p=new WeakMap,f=new WeakMap,m=new WeakMap;function g(e){let t=new Promise((t,r)=>{let n=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(E(e.result)),n()},s=()=>{r(e.error),n()};e.addEventListener("success",i),e.addEventListener("error",s)});return t.then(t=>{t instanceof IDBCursor&&h.set(t,e)}).catch(()=>{}),m.set(t,e),t}function y(e){if(d.has(e))return;let t=new Promise((t,r)=>{let n=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),n()},s=()=>{r(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)});d.set(e,t)}let v={get(e,t,r){if(e instanceof IDBTransaction){if("done"===t)return d.get(e);if("objectStoreNames"===t)return e.objectStoreNames||p.get(e);if("store"===t)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return E(e[t])},set:(e,t,r)=>(e[t]=r,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function b(e){v=e(v)}function T(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?c().includes(e)?function(...t){return e.apply(w(this),t),E(h.get(this))}:function(...t){return E(e.apply(w(this),t))}:function(t,...r){let n=e.call(w(this),t,...r);return p.set(n,t.sort?t.sort():[t]),E(n)}}function S(e){return"function"==typeof e?T(e):(e instanceof IDBTransaction&&y(e),l(e,u()))?new Proxy(e,v):e}function E(e){if(e instanceof IDBRequest)return g(e);if(f.has(e))return f.get(e);let t=S(e);return t!==e&&(f.set(e,t),m.set(t,e)),t}let w=e=>m.get(e);function C(e,t,{blocked:r,upgrade:n,blocking:i,terminated:s}={}){let a=indexedDB.open(e,t),o=E(a);return n&&a.addEventListener("upgradeneeded",e=>{n(E(a.result),e.oldVersion,e.newVersion,E(a.transaction),e)}),r&&a.addEventListener("blocked",e=>r(e.oldVersion,e.newVersion,e)),o.then(e=>{s&&e.addEventListener("close",()=>s()),i&&e.addEventListener("versionchange",e=>i(e.oldVersion,e.newVersion,e))}).catch(()=>{}),o}let _=["get","getKey","getAll","getAllKeys","count"],I=["put","add","delete","clear"],R=new Map;function N(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(R.get(t))return R.get(t);let r=t.replace(/FromIndex$/,""),n=t!==r,i=I.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!(i||_.includes(r)))return;let s=async function(e,...t){let s=this.transaction(e,i?"readwrite":"readonly"),a=s.store;return n&&(a=a.index(t.shift())),(await Promise.all([a[r](...t),i&&s.done]))[0]};return R.set(t,s),s}b(e=>({...e,get:(t,r,n)=>N(t,r)||e.get(t,r,n),has:(t,r)=>!!N(t,r)||e.has(t,r)}));class k{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(!A(e))return null;{let t=e.getImmediate();return`${t.library}/${t.version}`}}).filter(e=>e).join(" ")}}function A(e){let t=e.getComponent();return t?.type==="VERSION"}let D="@firebase/app",O="0.14.6",x=new a.Yd("@firebase/app"),P="12.6.0",M={[D]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/data-connect":"fire-data-connect","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","@firebase/ai":"fire-vertex","fire-js":"fire-js",firebase:"fire-js-all"},L=new Map,F=new Map,B=new Map;function U(e,t){try{e.container.addComponent(t)}catch(r){x.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,r)}}function V(e){let t=e.name;if(B.has(t))return x.debug(`There were multiple attempts to register component ${t}.`),!1;for(let r of(B.set(t,e),L.values()))U(r,e);for(let t of F.values())U(t,e);return!0}function j(e){return null!=e&&void 0!==e.settings}let z={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},q=new o.LL("app","Firebase",z),G=P;function $(e,t,r){let n=M[e]??e;r&&(n+=`-${r}`);let i=n.match(/\s|\//),a=t.match(/\s|\//);if(i||a){let e=[`Unable to register library "${n}" with version "${t}":`];i&&e.push(`library name "${n}" contains illegal characters (whitespace or "/")`),i&&a&&e.push("and"),a&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),x.warn(e.join(" "));return}V(new s.wA(`${n}-version`,()=>({library:n,version:t}),"VERSION"))}let K="firebase-heartbeat-database",W=1,H="firebase-heartbeat-store",Q=null;function Y(){return Q||(Q=C(K,W,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(H)}catch(e){console.warn(e)}}}).catch(e=>{throw q.create("idb-open",{originalErrorMessage:e.message})})),Q}async function J(e){try{let t=(await Y()).transaction(H),r=await t.objectStore(H).get(Z(e));return await t.done,r}catch(e){if(e instanceof o.ZR)x.warn(e.message);else{let t=q.create("idb-get",{originalErrorMessage:e?.message});x.warn(t.message)}}}async function X(e,t){try{let r=(await Y()).transaction(H,"readwrite"),n=r.objectStore(H);await n.put(t,Z(e)),await r.done}catch(e){if(e instanceof o.ZR)x.warn(e.message);else{let t=q.create("idb-set",{originalErrorMessage:e?.message});x.warn(t.message)}}}function Z(e){return`${e.name}!${e.options.appId}`}let ee=1024,et=30;class er{constructor(e){this.container=e,this._heartbeatsCache=null;let t=this.container.getProvider("app").getImmediate();this._storage=new es(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){try{let e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=en();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===t||this._heartbeatsCache.heartbeats.some(e=>e.date===t))return;if(this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats.length>et){let e=eo(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){x.warn(e)}}async getHeartbeatsHeader(){try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||0===this._heartbeatsCache.heartbeats.length)return"";let e=en(),{heartbeatsToSend:t,unsentEntries:r}=ei(this._heartbeatsCache.heartbeats),n=(0,o.L)(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),n}catch(e){return x.warn(e),""}}}function en(){return new Date().toISOString().substring(0,10)}function ei(e,t=ee){let r=[],n=e.slice();for(let i of e){let e=r.find(e=>e.agent===i.agent);if(e){if(e.dates.push(i.date),ea(r)>t){e.dates.pop();break}}else if(r.push({agent:i.agent,dates:[i.date]}),ea(r)>t){r.pop();break}n=n.slice(1)}return{heartbeatsToSend:r,unsentEntries:n}}class es{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!(0,o.hl)()&&(0,o.eu)().then(()=>!0).catch(()=>!1)}async read(){if(!await this._canUseIndexedDBPromise)return{heartbeats:[]};{let e=await J(this.app);return e?.heartbeats?e:{heartbeats:[]}}}async overwrite(e){if(await this._canUseIndexedDBPromise){let t=await this.read();return X(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){if(await this._canUseIndexedDBPromise){let t=await this.read();return X(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:[...t.heartbeats,...e.heartbeats]})}}}function ea(e){return(0,o.L)(JSON.stringify({version:2,heartbeats:e})).length}function eo(e){if(0===e.length)return -1;let t=0,r=e[0].date;for(let n=1;n<e.length;n++)e[n].date<r&&(r=e[n].date,t=n);return t}(function(e){V(new s.wA("platform-logger",e=>new k(e),"PRIVATE")),V(new s.wA("heartbeat",e=>new er(e),"PRIVATE")),$(D,O,""),$(D,O,"esm2020"),$("fire-js","")})(0)},7965:(e,t,r)=>{"use strict";r.d(t,{wA:()=>n}),r(9810);class n{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}},9740:(e,t,r)=>{"use strict";var n;r.d(t,{Yd:()=>u,in:()=>n});let i=[];!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(n||(n={}));let s={debug:n.DEBUG,verbose:n.VERBOSE,info:n.INFO,warn:n.WARN,error:n.ERROR,silent:n.SILENT},a=n.INFO,o={[n.DEBUG]:"log",[n.VERBOSE]:"log",[n.INFO]:"info",[n.WARN]:"warn",[n.ERROR]:"error"},l=(e,t,...r)=>{if(t<e.logLevel)return;let n=new Date().toISOString(),i=o[t];if(i)console[i](`[${n}]  ${e.name}:`,...r);else throw Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class u{constructor(e){this.name=e,this._logLevel=a,this._logHandler=l,this._userLogHandler=null,i.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in n))throw TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?s[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,n.DEBUG,...e),this._logHandler(this,n.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,n.VERBOSE,...e),this._logHandler(this,n.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,n.INFO,...e),this._logHandler(this,n.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,n.WARN,...e),this._logHandler(this,n.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,n.ERROR,...e),this._logHandler(this,n.ERROR,...e)}}},9810:(e,t,r)=>{"use strict";r.d(t,{LL:()=>A,ZR:()=>k,tV:()=>h,L:()=>c,ne:()=>B,vZ:()=>x,pd:()=>F,Rd:()=>d,m9:()=>z,z$:()=>v,ru:()=>E,Xx:()=>y,L_:()=>S,hl:()=>I,uI:()=>b,b$:()=>w,G6:()=>C,WO:()=>_,xO:()=>M,zd:()=>L,eu:()=>R});let n=()=>void 0,i={NODE_CLIENT:!1},s=function(e){let t=[],r=0;for(let n=0;n<e.length;n++){let i=e.charCodeAt(n);i<128?t[r++]=i:(i<2048?t[r++]=i>>6|192:((64512&i)==55296&&n+1<e.length&&(64512&e.charCodeAt(n+1))==56320?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++n)),t[r++]=i>>18|240,t[r++]=i>>12&63|128):t[r++]=i>>12|224,t[r++]=i>>6&63|128),t[r++]=63&i|128)}return t},a=function(e){let t=[],r=0,n=0;for(;r<e.length;){let i=e[r++];if(i<128)t[n++]=String.fromCharCode(i);else if(i>191&&i<224){let s=e[r++];t[n++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){let s=((7&i)<<18|(63&e[r++])<<12|(63&e[r++])<<6|63&e[r++])-65536;t[n++]=String.fromCharCode(55296+(s>>10)),t[n++]=String.fromCharCode(56320+(1023&s))}else{let s=e[r++],a=e[r++];t[n++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&a)}}return t.join("")},o={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();let r=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let t=0;t<e.length;t+=3){let i=e[t],s=t+1<e.length,a=s?e[t+1]:0,o=t+2<e.length,l=o?e[t+2]:0,u=i>>2,c=(3&i)<<4|a>>4,h=(15&a)<<2|l>>6,d=63&l;o||(d=64,s||(h=64)),n.push(r[u],r[c],r[h],r[d])}return n.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(s(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):a(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();let r=t?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let t=0;t<e.length;){let i=r[e.charAt(t++)],s=t<e.length?r[e.charAt(t)]:0,a=++t<e.length?r[e.charAt(t)]:64,o=++t<e.length?r[e.charAt(t)]:64;if(++t,null==i||null==s||null==a||null==o)throw new l;let u=i<<2|s>>4;if(n.push(u),64!==a){let e=s<<4&240|a>>2;if(n.push(e),64!==o){let e=a<<6&192|o;n.push(e)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class l extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}let u=function(e){let t=s(e);return o.encodeByteArray(t,!0)},c=function(e){return u(e).replace(/\./g,"")},h=function(e){try{return o.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function d(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw Error("Unable to locate global object.")}let p=()=>d().__FIREBASE_DEFAULTS__,f=()=>{if("undefined"==typeof process||void 0===process.env)return;let e=process.env.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)},m=()=>{let e;if("undefined"==typeof document)return;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}let t=e&&h(e[1]);return t&&JSON.parse(t)},g=()=>{try{return n()||p()||f()||m()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}};function y(e){try{return(e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname:e).endsWith(".cloudworkstations.dev")}catch{return!1}}function v(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function b(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(v())}function T(){let e=g()?.forceEnvironment;if("node"===e)return!0;if("browser"===e)return!1;try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(e){return!1}}function S(){return"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent}function E(){let e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function w(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function C(){return!T()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function _(){return!T()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function I(){try{return"object"==typeof indexedDB}catch(e){return!1}}function R(){return new Promise((e,t)=>{try{let r=!0,n="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(n);i.onsuccess=()=>{i.result.close(),r||self.indexedDB.deleteDatabase(n),e(!0)},i.onupgradeneeded=()=>{r=!1},i.onerror=()=>{t(i.error?.message||"")}}catch(e){t(e)}})}let N="FirebaseError";class k extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=N,Object.setPrototypeOf(this,k.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,A.prototype.create)}}class A{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){let r=t[0]||{},n=`${this.service}/${e}`,i=this.errors[e],s=i?D(i,r):"Error",a=`${this.serviceName}: ${s} (${n}).`;return new k(n,a,r)}}function D(e,t){return e.replace(O,(e,r)=>{let n=t[r];return null!=n?String(n):`<${r}?>`})}let O=/\{\$([^}]+)}/g;function x(e,t){if(e===t)return!0;let r=Object.keys(e),n=Object.keys(t);for(let i of r){if(!n.includes(i))return!1;let r=e[i],s=t[i];if(P(r)&&P(s)){if(!x(r,s))return!1}else if(r!==s)return!1}for(let e of n)if(!r.includes(e))return!1;return!0}function P(e){return null!==e&&"object"==typeof e}function M(e){let t=[];for(let[r,n]of Object.entries(e))Array.isArray(n)?n.forEach(e=>{t.push(encodeURIComponent(r)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(r)+"="+encodeURIComponent(n));return t.length?"&"+t.join("&"):""}function L(e){let t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){let[r,n]=e.split("=");t[decodeURIComponent(r)]=decodeURIComponent(n)}}),t}function F(e){let t=e.indexOf("?");if(!t)return"";let r=e.indexOf("#",t);return e.substring(t,r>0?r:void 0)}function B(e,t){let r=new U(e,t);return r.subscribe.bind(r)}class U{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let n;if(void 0===e&&void 0===t&&void 0===r)throw Error("Missing Observer.");void 0===(n=V(e,["next","error","complete"])?e:{next:e,error:t,complete:r}).next&&(n.next=j),void 0===n.error&&(n.error=j),void 0===n.complete&&(n.complete=j);let i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?n.error(this.finalError):n.complete()}catch(e){}}),this.observers.push(n),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function V(e,t){if("object"!=typeof e||null===e)return!1;for(let r of t)if(r in e&&"function"==typeof e[r])return!0;return!1}function j(){}function z(e){return e&&e._delegate?e._delegate:e}i.NODE_CLIENT=!0},2585:(e,t,r)=>{"use strict";var n=r(2248),i="firebase",s="12.6.0";(0,n.KN)(i,s,"app")},9705:(e,t,r)=>{"use strict";var n=r(2248),i=r(9810),s=r(7965),a=r(9740);function o(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}let l=o,u=new i.LL("auth","Firebase",o()),c=new a.Yd("@firebase/auth");function h(e,...t){c.logLevel<=a.in.WARN&&c.warn(`Auth (${n.Jn}): ${e}`,...t)}function d(e,...t){c.logLevel<=a.in.ERROR&&c.error(`Auth (${n.Jn}): ${e}`,...t)}function p(e,...t){throw y(e,...t)}function f(e,...t){return y(e,...t)}function m(e,t,r){let n={...l(),[t]:r};return new i.LL("auth","Firebase",n).create(t,{appName:e.name})}function g(e){return m(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function y(e,...t){if("string"!=typeof e){let r=t[0],n=[...t.slice(1)];return n[0]&&(n[0].appName=e.name),e._errorFactory.create(r,...n)}return u.create(e,...t)}function v(e,t,...r){if(!e)throw y(t,...r)}function b(e){let t="INTERNAL ASSERTION FAILED: "+e;throw d(t),Error(t)}function T(e,t){e||b(t)}function S(){return"http:"===E()||"https:"===E()}function E(){return"undefined"!=typeof self&&self.location?.protocol||null}function w(){return!("undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(S()||(0,i.ru)()||"connection"in navigator))||navigator.onLine}function C(){if("undefined"==typeof navigator)return null;let e=navigator;return e.languages&&e.languages[0]||e.language||null}class _{constructor(e,t){this.shortDelay=e,this.longDelay=t,T(t>e,"Short delay should be less than long delay!"),this.isMobile=(0,i.uI)()||(0,i.b$)()}get(){return w()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function I(e,t){T(e.emulator,"Emulator should always be set here");let{url:r}=e.emulator;return t?`${r}${t.startsWith("/")?t.slice(1):t}`:r}class R{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:"undefined"!=typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void b("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:"undefined"!=typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void b("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:"undefined"!=typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void b("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}let N={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},k=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],A=new _(3e4,6e4);function D(e,t){return e.tenantId&&!t.tenantId?{...t,tenantId:e.tenantId}:t}async function O(e,t,r,n,s={}){return x(e,s,async()=>{let s={},a={};n&&("GET"===t?a=n:s={body:JSON.stringify(n)});let o=(0,i.xO)({key:e.config.apiKey,...a}).slice(1),l=await e._getAdditionalHeaders();l["Content-Type"]="application/json",e.languageCode&&(l["X-Firebase-Locale"]=e.languageCode);let u={method:t,headers:l,...s};return(0,i.L_)()||(u.referrerPolicy="no-referrer"),e.emulatorConfig&&(0,i.Xx)(e.emulatorConfig.host)&&(u.credentials="include"),R.fetch()(await M(e,e.config.apiHost,r,o),u)})}async function x(e,t,r){e._canInitEmulator=!1;let n={...N,...t};try{let t=new F(e),i=await Promise.race([r(),t.promise]);t.clearNetworkTimeout();let s=await i.json();if("needConfirmation"in s)throw B(e,"account-exists-with-different-credential",s);if(i.ok&&!("errorMessage"in s))return s;{let[t,r]=(i.ok?s.errorMessage:s.error.message).split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===t)throw B(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===t)throw B(e,"email-already-in-use",s);if("USER_DISABLED"===t)throw B(e,"user-disabled",s);let a=n[t]||t.toLowerCase().replace(/[_\s]+/g,"-");if(r)throw m(e,a,r);p(e,a)}}catch(t){if(t instanceof i.ZR)throw t;p(e,"network-request-failed",{message:String(t)})}}async function P(e,t,r,n,i={}){let s=await O(e,t,r,n,i);return"mfaPendingCredential"in s&&p(e,"multi-factor-auth-required",{_serverResponse:s}),s}async function M(e,t,r,n){let i=`${t}${r}?${n}`,s=e,a=s.config.emulator?I(e.config,i):`${e.config.apiScheme}://${i}`;return k.includes(r)&&(await s._persistenceManagerAvailable,"COOKIE"===s._getPersistenceType())?s._getPersistence()._getFinalTarget(a).toString():a}function L(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class F{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(f(this.auth,"network-request-failed")),A.get())})}}function B(e,t,r){let n={appName:e.name};r.email&&(n.email=r.email),r.phoneNumber&&(n.phoneNumber=r.phoneNumber);let i=f(e,t,n);return i.customData._tokenResponse=r,i}function U(e){return void 0!==e&&void 0!==e.enterprise}class V{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(let t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return L(t.enforcementState);return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function j(e,t){return O(e,"GET","/v2/recaptchaConfig",D(e,t))}async function z(e,t){return O(e,"POST","/v1/accounts:delete",t)}async function q(e,t){return O(e,"POST","/v1/accounts:lookup",t)}function G(e){if(e)try{let t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}async function $(e,t=!1){let r=(0,i.m9)(e),n=await r.getIdToken(t),s=W(n);v(s&&s.exp&&s.auth_time&&s.iat,r.auth,"internal-error");let a="object"==typeof s.firebase?s.firebase:void 0,o=a?.sign_in_provider;return{claims:s,token:n,authTime:G(K(s.auth_time)),issuedAtTime:G(K(s.iat)),expirationTime:G(K(s.exp)),signInProvider:o||null,signInSecondFactor:a?.sign_in_second_factor||null}}function K(e){return 1e3*Number(e)}function W(e){let[t,r,n]=e.split(".");if(void 0===t||void 0===r||void 0===n)return d("JWT malformed, contained fewer than 3 sections"),null;try{let e=(0,i.tV)(r);if(!e)return d("Failed to decode base64 JWT payload"),null;return JSON.parse(e)}catch(e){return d("Caught error parsing JWT payload as JSON",e?.toString()),null}}function H(e){let t=W(e);return v(t,"internal-error"),v(void 0!==t.exp,"internal-error"),v(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function Q(e,t,r=!1){if(r)return t;try{return await t}catch(t){throw t instanceof i.ZR&&Y(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}function Y({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}class J{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){if(!e)return this.errorBackoff=3e4,Math.max(0,(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5);{let e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}}schedule(e=!1){if(!this.isRunning)return;let t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class X{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=G(this.lastLoginAt),this.creationTime=G(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function Z(e){let t=e.auth,r=await e.getIdToken(),n=await Q(e,q(t,{idToken:r}));v(n?.users.length,t,"internal-error");let i=n.users[0];e._notifyReloadListener(i);let s=i.providerUserInfo?.length?er(i.providerUserInfo):[],a=et(e.providerData,s),o=e.isAnonymous,l=!(e.email&&i.passwordHash)&&!a?.length,u=!!o&&l;Object.assign(e,{uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:a,metadata:new X(i.createdAt,i.lastLoginAt),isAnonymous:u})}async function ee(e){let t=(0,i.m9)(e);await Z(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function et(e,t){return[...e.filter(e=>!t.some(t=>t.providerId===e.providerId)),...t]}function er(e){return e.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}async function en(e,t){let r=await x(e,{},async()=>{let r=(0,i.xO)({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:n,apiKey:s}=e.config,a=await M(e,n,"/v1/token",`key=${s}`),o=await e._getAdditionalHeaders();o["Content-Type"]="application/x-www-form-urlencoded";let l={method:"POST",headers:o,body:r};return e.emulatorConfig&&(0,i.Xx)(e.emulatorConfig.host)&&(l.credentials="include"),R.fetch()(a,l)});return{accessToken:r.access_token,expiresIn:r.expires_in,refreshToken:r.refresh_token}}async function ei(e,t){return O(e,"POST","/v2/accounts:revokeToken",D(e,t))}class es{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){v(e.idToken,"internal-error"),v(void 0!==e.idToken,"internal-error"),v(void 0!==e.refreshToken,"internal-error");let t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):H(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){v(0!==e.length,"internal-error");let t=H(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return t||!this.accessToken||this.isExpired?(v(this.refreshToken,e,"user-token-expired"),this.refreshToken)?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){let{accessToken:r,refreshToken:n,expiresIn:i}=await en(e,t);this.updateTokensAndExpiration(r,n,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*r}static fromJSON(e,t){let{refreshToken:r,accessToken:n,expirationTime:i}=t,s=new es;return r&&(v("string"==typeof r,"internal-error",{appName:e}),s.refreshToken=r),n&&(v("string"==typeof n,"internal-error",{appName:e}),s.accessToken=n),i&&(v("number"==typeof i,"internal-error",{appName:e}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new es,this.toJSON())}_performRefresh(){return b("not implemented")}}function ea(e,t){v("string"==typeof e||void 0===e,"internal-error",{appName:t})}class eo{constructor({uid:e,auth:t,stsTokenManager:r,...n}){this.providerId="firebase",this.proactiveRefresh=new J(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=n.displayName||null,this.email=n.email||null,this.emailVerified=n.emailVerified||!1,this.phoneNumber=n.phoneNumber||null,this.photoURL=n.photoURL||null,this.isAnonymous=n.isAnonymous||!1,this.tenantId=n.tenantId||null,this.providerData=n.providerData?[...n.providerData]:[],this.metadata=new X(n.createdAt||void 0,n.lastLoginAt||void 0)}async getIdToken(e){let t=await Q(this,this.stsTokenManager.getToken(this.auth,e));return v(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return $(this,e)}reload(){return ee(this)}_assign(e){this!==e&&(v(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>({...e})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){let t=new eo({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){v(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await Z(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if((0,n.rh)(this.auth.app))return Promise.reject(g(this.auth));let e=await this.getIdToken();return await Q(this,z(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){let r=t.displayName??void 0,n=t.email??void 0,i=t.phoneNumber??void 0,s=t.photoURL??void 0,a=t.tenantId??void 0,o=t._redirectEventId??void 0,l=t.createdAt??void 0,u=t.lastLoginAt??void 0,{uid:c,emailVerified:h,isAnonymous:d,providerData:p,stsTokenManager:f}=t;v(c&&f,e,"internal-error");let m=es.fromJSON(this.name,f);v("string"==typeof c,e,"internal-error"),ea(r,e.name),ea(n,e.name),v("boolean"==typeof h,e,"internal-error"),v("boolean"==typeof d,e,"internal-error"),ea(i,e.name),ea(s,e.name),ea(a,e.name),ea(o,e.name),ea(l,e.name),ea(u,e.name);let g=new eo({uid:c,auth:e,email:n,emailVerified:h,displayName:r,isAnonymous:d,photoURL:s,phoneNumber:i,tenantId:a,stsTokenManager:m,createdAt:l,lastLoginAt:u});return p&&Array.isArray(p)&&(g.providerData=p.map(e=>({...e}))),o&&(g._redirectEventId=o),g}static async _fromIdTokenResponse(e,t,r=!1){let n=new es;n.updateFromServerResponse(t);let i=new eo({uid:t.localId,auth:e,stsTokenManager:n,isAnonymous:r});return await Z(i),i}static async _fromGetAccountInfoResponse(e,t,r){let n=t.users[0];v(void 0!==n.localId,"internal-error");let i=void 0!==n.providerUserInfo?er(n.providerUserInfo):[],s=!(n.email&&n.passwordHash)&&!i?.length,a=new es;a.updateFromIdToken(r);let o=new eo({uid:n.localId,auth:e,stsTokenManager:a,isAnonymous:s});return Object.assign(o,{uid:n.localId,displayName:n.displayName||null,photoURL:n.photoUrl||null,email:n.email||null,emailVerified:n.emailVerified||!1,phoneNumber:n.phoneNumber||null,tenantId:n.tenantId||null,providerData:i,metadata:new X(n.createdAt,n.lastLoginAt),isAnonymous:!(n.email&&n.passwordHash)&&!i?.length}),o}}let el=new Map;function eu(e){T(e instanceof Function,"Expected a class definition");let t=el.get(e);return t?T(t instanceof e,"Instance stored in cache mismatched with class"):(t=new e,el.set(e,t)),t}class ec{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){let t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}ec.type="NONE";let eh=ec;function ed(e,t,r){return`firebase:${e}:${t}:${r}`}class ep{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;let{config:n,name:i}=this.auth;this.fullUserKey=ed(this.userKey,n.apiKey,i),this.fullPersistenceKey=ed("persistence",n.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){let e=await this.persistence._get(this.fullUserKey);if(!e)return null;if("string"==typeof e){let t=await q(this.auth,{idToken:e}).catch(()=>void 0);return t?eo._fromGetAccountInfoResponse(this.auth,t,e):null}return eo._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;let t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new ep(eu(eh),e,r);let n=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e),i=n[0]||eu(eh),s=ed(r,e.config.apiKey,e.name),a=null;for(let r of t)try{let t=await r._get(s);if(t){let n;if("string"==typeof t){let r=await q(e,{idToken:t}).catch(()=>void 0);if(!r)break;n=await eo._fromGetAccountInfoResponse(e,r,t)}else n=eo._fromJSON(e,t);r!==i&&(a=n),i=r;break}}catch{}let o=n.filter(e=>e._shouldAllowMigration);return i._shouldAllowMigration&&o.length&&(i=o[0],a&&await i._set(s,a.toJSON()),await Promise.all(t.map(async e=>{if(e!==i)try{await e._remove(s)}catch{}}))),new ep(i,e,r)}}function ef(e){let t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(ev(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";{if(t.includes("edge/"))return"Edge";if(em(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(eT(t))return"Blackberry";if(eS(t))return"Webos";if(eg(t))return"Safari";if((t.includes("chrome/")||ey(t))&&!t.includes("edge/"))return"Chrome";if(eb(t))return"Android";let r=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(r);if(n?.length===2)return n[1]}return"Other"}function em(e=(0,i.z$)()){return/firefox\//i.test(e)}function eg(e=(0,i.z$)()){let t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function ey(e=(0,i.z$)()){return/crios\//i.test(e)}function ev(e=(0,i.z$)()){return/iemobile/i.test(e)}function eb(e=(0,i.z$)()){return/android/i.test(e)}function eT(e=(0,i.z$)()){return/blackberry/i.test(e)}function eS(e=(0,i.z$)()){return/webos/i.test(e)}function eE(e,t=[]){let r;switch(e){case"Browser":r=ef((0,i.z$)());break;case"Worker":r=`${ef((0,i.z$)())}-${e}`;break;default:r=e}let s=t.length?t.join(","):"FirebaseCore-web";return`${r}/JsCore/${n.Jn}/${s}`}class ew{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){let r=t=>new Promise((r,n)=>{try{let n=e(t);r(n)}catch(e){n(e)}});r.onAbort=t,this.queue.push(r);let n=this.queue.length-1;return()=>{this.queue[n]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;let t=[];try{for(let r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(e){for(let e of(t.reverse(),t))try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:e?.message})}}}async function eC(e,t={}){return O(e,"GET","/v2/passwordPolicy",D(e,t))}let e_=6;class eI{constructor(e){let t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??e_,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),void 0!==t.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),void 0!==t.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),void 0!==t.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),void 0!==t.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){let t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){let r=this.customStrengthOptions.minPasswordLength,n=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),n&&(t.meetsMaxPasswordLength=e.length<=n)}validatePasswordCharacterOptions(e,t){let r;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let n=0;n<e.length;n++)r=e.charAt(n),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,n,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=n)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}class eR{constructor(e,t,r,n){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=n,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new ek(this),this.idTokenSubscription=new ek(this),this.beforeStateQueue=new ew(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=u,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=n.sdkClientVersion,this._persistenceManagerAvailable=new Promise(e=>this._resolvePersistenceManagerAvailable=e)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=eu(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await ep.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,this._deleted||(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;let e=await this.assertedPersistence.getCurrentUser();if(this.currentUser||e){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{let t=await q(this,{idToken:e}),r=await eo._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(e){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",e),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if((0,n.rh)(this.app)){let e=this.app.settings.authIdToken;return e?new Promise(t=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(e).then(t,t))}):this.directlySetCurrentUser(null)}let t=await this.assertedPersistence.getCurrentUser(),r=t,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();let t=this.redirectUser?._redirectEventId,n=r?._redirectEventId,s=await this.tryRedirectSignIn(e);(!t||t===n)&&s?.user&&(r=s.user,i=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(r)}catch(e){r=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(e))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return(v(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId)?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Z(e)}catch(e){if(e?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=C()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if((0,n.rh)(this.app))return Promise.reject(g(this));let t=e?(0,i.m9)(e):null;return t&&v(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&v(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return(0,n.rh)(this.app)?Promise.reject(g(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return(0,n.rh)(this.app)?Promise.reject(g(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(eu(e))})}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();let t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){let e=new eI(await eC(this));null===this.tenantId?this._projectPasswordPolicy=e:this._tenantPasswordPolicies[this.tenantId]=e}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new i.LL("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{let r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){let t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await ei(this,t)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){let r=await this.getOrInitRedirectPersistenceManager(t);return null===e?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){let t=e&&eu(e)||this._popupRedirectResolver;v(t,this,"argument-error"),this.redirectPersistenceManager=await ep.create(this,[eu(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return(this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e)?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,n){if(this._deleted)return()=>{};let i="function"==typeof t?t:t.next.bind(t),s=!1,a=this._isInitialized?Promise.resolve():this._initializationPromise;if(v(a,this,"internal-error"),a.then(()=>{s||i(this.currentUser)}),"function"==typeof t){let i=e.addObserver(t,r,n);return()=>{s=!0,i()}}{let r=e.addObserver(t);return()=>{s=!0,r()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return v(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=eE(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){let e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);let t=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);let r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){if((0,n.rh)(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&h(`Error while retrieving App Check token: ${e.error}`),e?.token}}function eN(e){return(0,i.m9)(e)}class ek{constructor(e){this.auth=e,this.observer=null,this.addObserver=(0,i.ne)(e=>this.observer=e)}get next(){return v(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let eA={async loadJS(){throw Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function eD(e){return eA.loadJS(e)}function eO(){return eA.recaptchaEnterpriseScript}class ex{constructor(){this.enterprise=new eP}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class eP{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}let eM="recaptcha-enterprise",eL="NO_RECAPTCHA";class eF{constructor(e){this.type=eM,this.auth=eN(e)}async verify(e="verify",t=!1){async function r(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise(async(t,r)=>{j(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(n=>{if(void 0===n.recaptchaKey)r(Error("recaptcha Enterprise site key undefined"));else{let r=new V(n);return null==e.tenantId?e._agentRecaptchaConfig=r:e._tenantRecaptchaConfigs[e.tenantId]=r,t(r.siteKey)}}).catch(e=>{r(e)})})}function n(t,r,n){let i=window.grecaptcha;U(i)?i.enterprise.ready(()=>{i.enterprise.execute(t,{action:e}).then(e=>{r(e)}).catch(()=>{r(eL)})}):n(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new ex().execute("siteKey",{action:"verify"}):new Promise((e,i)=>{r(this.auth).then(r=>{if(!t&&U(window.grecaptcha))n(r,e,i);else{if("undefined"==typeof window){i(Error("RecaptchaVerifier is only supported in browser"));return}let t=eO();0!==t.length&&(t+=r),eD(t).then(()=>{n(r,e,i)}).catch(e=>{i(e)})}}).catch(e=>{i(e)})})}}async function eB(e,t,r,n=!1,i=!1){let s;let a=new eF(e);if(i)s=eL;else try{s=await a.verify(r)}catch(e){s=await a.verify(r,!0)}let o={...t};if("mfaSmsEnrollment"===r||"mfaSmsSignIn"===r){if("phoneEnrollmentInfo"in o){let e=o.phoneEnrollmentInfo.phoneNumber,t=o.phoneEnrollmentInfo.recaptchaToken;Object.assign(o,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:t,captchaResponse:s,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in o){let e=o.phoneSignInInfo.recaptchaToken;Object.assign(o,{phoneSignInInfo:{recaptchaToken:e,captchaResponse:s,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return o}return n?Object.assign(o,{captchaResp:s}):Object.assign(o,{captchaResponse:s}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function eU(e,t,r,n,i){if("EMAIL_PASSWORD_PROVIDER"===i){if(!e._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER"))return n(e,t).catch(async i=>{if("auth/missing-recaptcha-token"!==i.code)return Promise.reject(i);{console.log(`${r} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);let i=await eB(e,t,r,"getOobCode"===r);return n(e,i)}});{let i=await eB(e,t,r,"getOobCode"===r);return n(e,i)}}if("PHONE_PROVIDER"!==i)return Promise.reject(i+" provider is not supported.");if(e._getRecaptchaConfig()?.isProviderEnabled("PHONE_PROVIDER")){let i=await eB(e,t,r);return n(e,i).catch(async i=>{if(e._getRecaptchaConfig()?.getProviderEnforcementState("PHONE_PROVIDER")==="AUDIT"&&("auth/missing-recaptcha-token"===i.code||"auth/invalid-app-credential"===i.code)){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${r} flow.`);let i=await eB(e,t,r,!1,!0);return n(e,i)}return Promise.reject(i)})}{let i=await eB(e,t,r,!1,!0);return n(e,i)}}function eV(e,t){let r=t?.persistence||[],n=(Array.isArray(r)?r:[r]).map(eu);t?.errorMap&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(n,t?.popupRedirectResolver)}function ej(e){let t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function ez(e){if(!e)return null;let t=Number(e);return isNaN(t)?null:t}class eq{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return b("not implemented")}_getIdTokenResponse(e){return b("not implemented")}_linkToIdToken(e,t){return b("not implemented")}_getReauthenticationResolver(e){return b("not implemented")}}async function eG(e,t){return O(e,"POST","/v1/accounts:signUp",t)}async function e$(e,t){return P(e,"POST","/v1/accounts:signInWithPassword",D(e,t))}async function eK(e,t){return P(e,"POST","/v1/accounts:signInWithEmailLink",D(e,t))}async function eW(e,t){return P(e,"POST","/v1/accounts:signInWithEmailLink",D(e,t))}class eH extends eq{constructor(e,t,r,n=null){super("password",r),this._email=e,this._password=t,this._tenantId=n}static _fromEmailAndPassword(e,t){return new eH(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new eH(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){let t="string"==typeof e?JSON.parse(e):e;if(t?.email&&t?.password){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return eU(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",e$,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return eK(e,{email:this._email,oobCode:this._password});default:p(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return eU(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",eG,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return eW(e,{idToken:t,email:this._email,oobCode:this._password});default:p(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function eQ(e,t){return P(e,"POST","/v1/accounts:signInWithIdp",D(e,t))}let eY="http://localhost";class eJ extends eq{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){let t=new eJ(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):p("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){let{providerId:t,signInMethod:r,...n}="string"==typeof e?JSON.parse(e):e;if(!t||!r)return null;let i=new eJ(t,r);return i.idToken=n.idToken||void 0,i.accessToken=n.accessToken||void 0,i.secret=n.secret,i.nonce=n.nonce,i.pendingToken=n.pendingToken||null,i}_getIdTokenResponse(e){return eQ(e,this.buildRequest())}_linkToIdToken(e,t){let r=this.buildRequest();return r.idToken=t,eQ(e,r)}_getReauthenticationResolver(e){let t=this.buildRequest();return t.autoCreate=!1,eQ(e,t)}buildRequest(){let e={requestUri:eY,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{let t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=(0,i.xO)(t)}return e}}function eX(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function eZ(e){let t=(0,i.zd)((0,i.pd)(e)).link,r=t?(0,i.zd)((0,i.pd)(t)).deep_link_id:null,n=(0,i.zd)((0,i.pd)(e)).deep_link_id;return(n?(0,i.zd)((0,i.pd)(n)).link:null)||n||r||t||e}class e0{constructor(e){let t=(0,i.zd)((0,i.pd)(e)),r=t.apiKey??null,n=t.oobCode??null,s=eX(t.mode??null);v(r&&n&&s,"argument-error"),this.apiKey=r,this.operation=s,this.code=n,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){let t=eZ(e);try{return new e0(t)}catch{return null}}}class e1{constructor(){this.providerId=e1.PROVIDER_ID}static credential(e,t){return eH._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){let r=e0.parseLink(t);return v(r,"argument-error"),eH._fromEmailAndCode(e,r.code,r.tenantId)}}e1.PROVIDER_ID="password",e1.EMAIL_PASSWORD_SIGN_IN_METHOD="password",e1.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class e2{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class e4 extends e2{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class e3 extends e4{constructor(){super("facebook.com")}static credential(e){return eJ._fromParams({providerId:e3.PROVIDER_ID,signInMethod:e3.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return e3.credentialFromTaggedObject(e)}static credentialFromError(e){return e3.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return e3.credential(e.oauthAccessToken)}catch{return null}}}e3.FACEBOOK_SIGN_IN_METHOD="facebook.com",e3.PROVIDER_ID="facebook.com";class e6 extends e4{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return eJ._fromParams({providerId:e6.PROVIDER_ID,signInMethod:e6.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return e6.credentialFromTaggedObject(e)}static credentialFromError(e){return e6.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return e6.credential(t,r)}catch{return null}}}e6.GOOGLE_SIGN_IN_METHOD="google.com",e6.PROVIDER_ID="google.com";class e9 extends e4{constructor(){super("github.com")}static credential(e){return eJ._fromParams({providerId:e9.PROVIDER_ID,signInMethod:e9.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return e9.credentialFromTaggedObject(e)}static credentialFromError(e){return e9.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return e9.credential(e.oauthAccessToken)}catch{return null}}}e9.GITHUB_SIGN_IN_METHOD="github.com",e9.PROVIDER_ID="github.com";class e5 extends e4{constructor(){super("twitter.com")}static credential(e,t){return eJ._fromParams({providerId:e5.PROVIDER_ID,signInMethod:e5.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return e5.credentialFromTaggedObject(e)}static credentialFromError(e){return e5.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return e5.credential(t,r)}catch{return null}}}e5.TWITTER_SIGN_IN_METHOD="twitter.com",e5.PROVIDER_ID="twitter.com";class e7{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,n=!1){return new e7({user:await eo._fromIdTokenResponse(e,r,n),providerId:e8(r),_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){return await e._updateTokensIfNecessary(r,!0),new e7({user:e,providerId:e8(r),_tokenResponse:r,operationType:t})}}function e8(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class te extends i.ZR{constructor(e,t,r,n){super(t.code,t.message),this.operationType=r,this.user=n,Object.setPrototypeOf(this,te.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,n){return new te(e,t,r,n)}}function tt(e,t,r,n){return("reauthenticate"===t?r._getReauthenticationResolver(e):r._getIdTokenResponse(e)).catch(r=>{if("auth/multi-factor-auth-required"===r.code)throw te._fromErrorAndOperation(e,r,t,n);throw r})}class tr{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?tn._fromServerResponse(e,t):"totpInfo"in t?ti._fromServerResponse(e,t):p(e,"internal-error")}}class tn extends tr{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new tn(t)}}class ti extends tr{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new ti(t)}}class ts{constructor(e,t,r={}){this.isNewUser=e,this.providerId=t,this.profile=r}}class ta extends ts{constructor(e,t,r,n){super(e,t,r),this.username=n}}class to{constructor(e,t,r){this.type=e,this.credential=t,this.user=r}static _fromIdtoken(e,t){return new to("enroll",e,t)}static _fromMfaPendingCredential(e){return new to("signin",e)}toJSON(){return{multiFactorSession:{["enroll"===this.type?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){if(e?.multiFactorSession){if(e.multiFactorSession?.pendingCredential)return to._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(e.multiFactorSession?.idToken)return to._fromIdtoken(e.multiFactorSession.idToken)}return null}}class tl{constructor(e,t,r){this.session=e,this.hints=t,this.signInResolver=r}static _fromError(e,t){let r=eN(e),n=t.customData._serverResponse,i=(n.mfaInfo||[]).map(e=>tr._fromServerResponse(r,e));v(n.mfaPendingCredential,r,"internal-error");let s=to._fromMfaPendingCredential(n.mfaPendingCredential);return new tl(s,i,async e=>{let i=await e._process(r,s);delete n.mfaInfo,delete n.mfaPendingCredential;let a={...n,idToken:i.idToken,refreshToken:i.refreshToken};switch(t.operationType){case"signIn":let o=await e7._fromIdTokenResponse(r,t.operationType,a);return await r._updateCurrentUser(o.user),o;case"reauthenticate":return v(t.user,r,"internal-error"),e7._forOperation(t.user,t.operationType,a);default:p(r,"internal-error")}})}async resolveSignIn(e){let t=e;return this.signInResolver(t)}}function tu(e,t){return O(e,"POST","/v2/accounts/mfaEnrollment:start",D(e,t))}function tc(e,t){return O(e,"POST","/v2/accounts/mfaEnrollment:finalize",D(e,t))}function th(e,t){return O(e,"POST","/v2/accounts/mfaEnrollment:withdraw",D(e,t))}class td{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload(t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map(t=>tr._fromServerResponse(e.auth,t)))})}static _fromUser(e){return new td(e)}async getSession(){return to._fromIdtoken(await this.user.getIdToken(),this.user)}async enroll(e,t){let r=e,n=await this.getSession(),i=await Q(this.user,r._process(this.user.auth,n,t));return await this.user._updateTokensIfNecessary(i),this.user.reload()}async unenroll(e){let t="string"==typeof e?e:e.uid,r=await this.user.getIdToken();try{let e=await Q(this.user,th(this.user.auth,{idToken:r,mfaEnrollmentId:t}));this.enrolledFactors=this.enrolledFactors.filter(({uid:e})=>e!==t),await this.user._updateTokensIfNecessary(e),await this.user.reload()}catch(e){throw e}}}new WeakMap;var tp="@firebase/auth",tf="1.11.1";class tm{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return(this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser)?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let t=this.auth.onIdTokenChanged(t=>{e(t?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){v(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function tg(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function ty(e){(0,n.Xd)(new s.wA("auth",(t,{options:r})=>{let n=t.getProvider("app").getImmediate(),i=t.getProvider("heartbeat"),s=t.getProvider("app-check-internal"),{apiKey:a,authDomain:o}=n.options;v(a&&!a.includes(":"),"invalid-api-key",{appName:n.name});let l=new eR(n,i,s,{apiKey:a,authDomain:o,clientPlatform:e,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:eE(e)});return eV(l,r),l},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),(0,n.Xd)(new s.wA("auth-internal",e=>new tm(eN(e.getProvider("auth").getImmediate())),"PRIVATE").setInstantiationMode("EXPLICIT")),(0,n.KN)(tp,tf,tg(e)),(0,n.KN)(tp,tf,"esm2020")}function tv(e,t){return O(e,"POST","/v2/accounts/mfaSignIn:finalize",D(e,t))}R.initialize(fetch,Headers,Response),ty("Node"),f("operation-not-supported-in-this-environment"),eR.prototype.setPersistence=async()=>{};class tb{constructor(e){this.factorId=e}_process(e,t,r){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,r);case"signin":return this._finalizeSignIn(e,t.credential);default:return b("unexpected MultiFactorSessionType")}}}class tT{static assertionForEnrollment(e,t){return tS._fromSecret(e,t)}static assertionForSignIn(e,t){return tS._fromEnrollmentId(e,t)}static async generateSecret(e){let t=e;v(void 0!==t.user?.auth,"internal-error");let r=await tu(t.user.auth,{idToken:t.credential,totpEnrollmentInfo:{}});return tE._fromStartTotpMfaEnrollmentResponse(r,t.user.auth)}}tT.FACTOR_ID="totp";class tS extends tb{constructor(e,t,r){super("totp"),this.otp=e,this.enrollmentId=t,this.secret=r}static _fromSecret(e,t){return new tS(t,void 0,e)}static _fromEnrollmentId(e,t){return new tS(t,e)}async _finalizeEnroll(e,t,r){return v(void 0!==this.secret,e,"argument-error"),tc(e,{idToken:t,displayName:r,totpVerificationInfo:this.secret._makeTotpVerificationInfo(this.otp)})}async _finalizeSignIn(e,t){v(void 0!==this.enrollmentId&&void 0!==this.otp,e,"argument-error");let r={verificationCode:this.otp};return tv(e,{mfaPendingCredential:t,mfaEnrollmentId:this.enrollmentId,totpVerificationInfo:r})}}class tE{constructor(e,t,r,n,i,s,a){this.sessionInfo=s,this.auth=a,this.secretKey=e,this.hashingAlgorithm=t,this.codeLength=r,this.codeIntervalSeconds=n,this.enrollmentCompletionDeadline=i}static _fromStartTotpMfaEnrollmentResponse(e,t){return new tE(e.totpSessionInfo.sharedSecretKey,e.totpSessionInfo.hashingAlgorithm,e.totpSessionInfo.verificationCodeLength,e.totpSessionInfo.periodSec,new Date(e.totpSessionInfo.finalizeEnrollmentTime).toUTCString(),e.totpSessionInfo.sessionInfo,t)}_makeTotpVerificationInfo(e){return{sessionInfo:this.sessionInfo,verificationCode:e}}generateQrCodeUrl(e,t){let r=!1;return(tw(e)||tw(t))&&(r=!0),r&&(tw(e)&&(e=this.auth.currentUser?.email||"unknownuser"),tw(t)&&(t=this.auth.name)),`otpauth://totp/${t}:${e}?secret=${this.secretKey}&issuer=${t}&algorithm=${this.hashingAlgorithm}&digits=${this.codeLength}`}}function tw(e){return void 0===e||e?.length===0}},76:(e,t,r)=>{"use strict";r.d(t,{EK:()=>ey,hJ:()=>fN,oe:()=>m4,JU:()=>fk,QT:()=>mX,PL:()=>m0,pl:()=>m1,r7:()=>m2});var n,i,s,a,o=r(2248),l=r(7965),u=r(9740),c=r(1764),h=r(9810),d="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},p={};(function(){function e(){this.blockSize=-1,this.blockSize=64,this.g=[,,,,],this.C=Array(this.blockSize),this.o=this.h=0,this.u()}function t(e,t,r){r||(r=0);let n=Array(16);if("string"==typeof t)for(var i=0;i<16;++i)n[i]=t.charCodeAt(r++)|t.charCodeAt(r++)<<8|t.charCodeAt(r++)<<16|t.charCodeAt(r++)<<24;else for(i=0;i<16;++i)n[i]=t[r++]|t[r++]<<8|t[r++]<<16|t[r++]<<24;t=e.g[0],r=e.g[1],i=e.g[2];let s=e.g[3],a;a=t+(s^r&(i^s))+n[0]+3614090360&4294967295,a=s+(i^(t=r+(a<<7&4294967295|a>>>25))&(r^i))+n[1]+3905402710&4294967295,a=i+(r^(s=t+(a<<12&4294967295|a>>>20))&(t^r))+n[2]+606105819&4294967295,a=r+(t^(i=s+(a<<17&4294967295|a>>>15))&(s^t))+n[3]+3250441966&4294967295,a=t+(s^(r=i+(a<<22&4294967295|a>>>10))&(i^s))+n[4]+4118548399&4294967295,a=s+(i^(t=r+(a<<7&4294967295|a>>>25))&(r^i))+n[5]+1200080426&4294967295,a=i+(r^(s=t+(a<<12&4294967295|a>>>20))&(t^r))+n[6]+2821735955&4294967295,a=r+(t^(i=s+(a<<17&4294967295|a>>>15))&(s^t))+n[7]+4249261313&4294967295,a=t+(s^(r=i+(a<<22&4294967295|a>>>10))&(i^s))+n[8]+1770035416&4294967295,a=s+(i^(t=r+(a<<7&4294967295|a>>>25))&(r^i))+n[9]+2336552879&4294967295,a=i+(r^(s=t+(a<<12&4294967295|a>>>20))&(t^r))+n[10]+4294925233&4294967295,a=r+(t^(i=s+(a<<17&4294967295|a>>>15))&(s^t))+n[11]+2304563134&4294967295,a=t+(s^(r=i+(a<<22&4294967295|a>>>10))&(i^s))+n[12]+1804603682&4294967295,a=s+(i^(t=r+(a<<7&4294967295|a>>>25))&(r^i))+n[13]+4254626195&4294967295,a=i+(r^(s=t+(a<<12&4294967295|a>>>20))&(t^r))+n[14]+2792965006&4294967295,a=r+(t^(i=s+(a<<17&4294967295|a>>>15))&(s^t))+n[15]+1236535329&4294967295,r=i+(a<<22&4294967295|a>>>10),a=t+(i^s&(r^i))+n[1]+4129170786&4294967295,t=r+(a<<5&4294967295|a>>>27),a=s+(r^i&(t^r))+n[6]+3225465664&4294967295,s=t+(a<<9&4294967295|a>>>23),a=i+(t^r&(s^t))+n[11]+643717713&4294967295,i=s+(a<<14&4294967295|a>>>18),a=r+(s^t&(i^s))+n[0]+3921069994&4294967295,r=i+(a<<20&4294967295|a>>>12),a=t+(i^s&(r^i))+n[5]+3593408605&4294967295,t=r+(a<<5&4294967295|a>>>27),a=s+(r^i&(t^r))+n[10]+38016083&4294967295,s=t+(a<<9&4294967295|a>>>23),a=i+(t^r&(s^t))+n[15]+3634488961&4294967295,i=s+(a<<14&4294967295|a>>>18),a=r+(s^t&(i^s))+n[4]+3889429448&4294967295,r=i+(a<<20&4294967295|a>>>12),a=t+(i^s&(r^i))+n[9]+568446438&4294967295,t=r+(a<<5&4294967295|a>>>27),a=s+(r^i&(t^r))+n[14]+3275163606&4294967295,s=t+(a<<9&4294967295|a>>>23),a=i+(t^r&(s^t))+n[3]+4107603335&4294967295,i=s+(a<<14&4294967295|a>>>18),a=r+(s^t&(i^s))+n[8]+1163531501&4294967295,r=i+(a<<20&4294967295|a>>>12),a=t+(i^s&(r^i))+n[13]+2850285829&4294967295,t=r+(a<<5&4294967295|a>>>27),a=s+(r^i&(t^r))+n[2]+4243563512&4294967295,s=t+(a<<9&4294967295|a>>>23),a=i+(t^r&(s^t))+n[7]+1735328473&4294967295,i=s+(a<<14&4294967295|a>>>18),a=r+(s^t&(i^s))+n[12]+2368359562&4294967295,a=t+((r=i+(a<<20&4294967295|a>>>12))^i^s)+n[5]+4294588738&4294967295,a=s+((t=r+(a<<4&4294967295|a>>>28))^r^i)+n[8]+2272392833&4294967295,a=i+((s=t+(a<<11&4294967295|a>>>21))^t^r)+n[11]+1839030562&4294967295,a=r+((i=s+(a<<16&4294967295|a>>>16))^s^t)+n[14]+4259657740&4294967295,a=t+((r=i+(a<<23&4294967295|a>>>9))^i^s)+n[1]+2763975236&4294967295,a=s+((t=r+(a<<4&4294967295|a>>>28))^r^i)+n[4]+1272893353&4294967295,a=i+((s=t+(a<<11&4294967295|a>>>21))^t^r)+n[7]+4139469664&4294967295,a=r+((i=s+(a<<16&4294967295|a>>>16))^s^t)+n[10]+3200236656&4294967295,a=t+((r=i+(a<<23&4294967295|a>>>9))^i^s)+n[13]+681279174&4294967295,a=s+((t=r+(a<<4&4294967295|a>>>28))^r^i)+n[0]+3936430074&4294967295,a=i+((s=t+(a<<11&4294967295|a>>>21))^t^r)+n[3]+3572445317&4294967295,a=r+((i=s+(a<<16&4294967295|a>>>16))^s^t)+n[6]+76029189&4294967295,a=t+((r=i+(a<<23&4294967295|a>>>9))^i^s)+n[9]+3654602809&4294967295,a=s+((t=r+(a<<4&4294967295|a>>>28))^r^i)+n[12]+3873151461&4294967295,a=i+((s=t+(a<<11&4294967295|a>>>21))^t^r)+n[15]+530742520&4294967295,a=r+((i=s+(a<<16&4294967295|a>>>16))^s^t)+n[2]+3299628645&4294967295,r=i+(a<<23&4294967295|a>>>9),a=t+(i^(r|~s))+n[0]+4096336452&4294967295,t=r+(a<<6&4294967295|a>>>26),a=s+(r^(t|~i))+n[7]+1126891415&4294967295,s=t+(a<<10&4294967295|a>>>22),a=i+(t^(s|~r))+n[14]+2878612391&4294967295,i=s+(a<<15&4294967295|a>>>17),a=r+(s^(i|~t))+n[5]+4237533241&4294967295,r=i+(a<<21&4294967295|a>>>11),a=t+(i^(r|~s))+n[12]+1700485571&4294967295,t=r+(a<<6&4294967295|a>>>26),a=s+(r^(t|~i))+n[3]+2399980690&4294967295,s=t+(a<<10&4294967295|a>>>22),a=i+(t^(s|~r))+n[10]+4293915773&4294967295,i=s+(a<<15&4294967295|a>>>17),a=r+(s^(i|~t))+n[1]+2240044497&4294967295,r=i+(a<<21&4294967295|a>>>11),a=t+(i^(r|~s))+n[8]+1873313359&4294967295,t=r+(a<<6&4294967295|a>>>26),a=s+(r^(t|~i))+n[15]+4264355552&4294967295,s=t+(a<<10&4294967295|a>>>22),a=i+(t^(s|~r))+n[6]+2734768916&4294967295,i=s+(a<<15&4294967295|a>>>17),a=r+(s^(i|~t))+n[13]+1309151649&4294967295,r=i+(a<<21&4294967295|a>>>11),a=t+(i^(r|~s))+n[4]+4149444226&4294967295,t=r+(a<<6&4294967295|a>>>26),a=s+(r^(t|~i))+n[11]+3174756917&4294967295,s=t+(a<<10&4294967295|a>>>22),a=i+(t^(s|~r))+n[2]+718787259&4294967295,i=s+(a<<15&4294967295|a>>>17),a=r+(s^(i|~t))+n[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(i+(a<<21&4294967295|a>>>11))&4294967295,e.g[2]=e.g[2]+i&4294967295,e.g[3]=e.g[3]+s&4294967295}function r(e,t){var r=o;return Object.prototype.hasOwnProperty.call(r,e)?r[e]:r[e]=t(e)}function s(e,t){this.h=t;let r=[],n=!0;for(let i=e.length-1;i>=0;i--){let s=0|e[i];n&&s==t||(r[i]=s,n=!1)}this.g=r}(function(e,t){function r(){}r.prototype=t.prototype,e.F=t.prototype,e.prototype=new r,e.prototype.constructor=e,e.D=function(e,r,n){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[r].apply(e,i)}})(e,function(){this.blockSize=-1}),e.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},e.prototype.v=function(e,r){void 0===r&&(r=e.length);let n=r-this.blockSize,i=this.C,s=this.h,a=0;for(;a<r;){if(0==s)for(;a<=n;)t(this,e,a),a+=this.blockSize;if("string"==typeof e){for(;a<r;)if(i[s++]=e.charCodeAt(a++),s==this.blockSize){t(this,i),s=0;break}}else for(;a<r;)if(i[s++]=e[a++],s==this.blockSize){t(this,i),s=0;break}}this.h=s,this.o+=r},e.prototype.A=function(){var e=Array((this.h<56?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;t=8*this.o;for(var r=e.length-8;r<e.length;++r)e[r]=255&t,t/=256;for(this.v(e),e=Array(16),t=0,r=0;r<4;++r)for(let n=0;n<32;n+=8)e[t++]=this.g[r]>>>n&255;return e};var a,o={};function l(e){return -128<=e&&e<128?r(e,function(e){return new s([0|e],e<0?-1:0)}):new s([0|e],e<0?-1:0)}function u(e){if(isNaN(e)||!isFinite(e))return h;if(e<0)return y(u(-e));let t=[],r=1;for(let n=0;e>=r;n++)t[n]=e/r|0,r*=4294967296;return new s(t,0)}function c(e,t){if(0==e.length)throw Error("number format error: empty string");if((t=t||10)<2||36<t)throw Error("radix out of range: "+t);if("-"==e.charAt(0))return y(c(e.substring(1),t));if(e.indexOf("-")>=0)throw Error('number format error: interior "-" character');let r=u(Math.pow(t,8)),n=h;for(let s=0;s<e.length;s+=8){var i=Math.min(8,e.length-s);let a=parseInt(e.substring(s,s+i),t);i<8?(i=u(Math.pow(t,i)),n=n.j(i).add(u(a))):n=(n=n.j(r)).add(u(a))}return n}var h=l(0),d=l(1),f=l(16777216);function m(e){if(0!=e.h)return!1;for(let t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function g(e){return -1==e.h}function y(e){let t=e.g.length,r=[];for(let n=0;n<t;n++)r[n]=~e.g[n];return new s(r,~e.h).add(d)}function v(e,t){return e.add(y(t))}function b(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function T(e,t){this.g=e,this.h=t}function S(e,t){if(m(t))throw Error("division by zero");if(m(e))return new T(h,h);if(g(e))return t=S(y(e),t),new T(y(t.g),y(t.h));if(g(t))return t=S(e,y(t)),new T(y(t.g),t.h);if(e.g.length>30){if(g(e)||g(t))throw Error("slowDivide_ only works with positive integers.");for(var r=d,n=t;0>=n.l(e);)r=E(r),n=E(n);var i=w(r,1),s=w(n,1);for(n=w(n,2),r=w(r,2);!m(n);){var a=s.add(n);0>=a.l(e)&&(i=i.add(r),s=a),n=w(n,1),r=w(r,1)}return t=v(e,i.j(t)),new T(i,t)}for(i=h;e.l(t)>=0;){for(n=(n=Math.ceil(Math.log(r=Math.max(1,Math.floor(e.m()/t.m())))/Math.LN2))<=48?1:Math.pow(2,n-48),a=(s=u(r)).j(t);g(a)||a.l(e)>0;)r-=n,a=(s=u(r)).j(t);m(s)&&(s=d),i=i.add(s),e=v(e,a)}return new T(i,e)}function E(e){let t=e.g.length+1,r=[];for(let n=0;n<t;n++)r[n]=e.i(n)<<1|e.i(n-1)>>>31;return new s(r,e.h)}function w(e,t){let r=t>>5;t%=32;let n=e.g.length-r,i=[];for(let s=0;s<n;s++)i[s]=t>0?e.i(s+r)>>>t|e.i(s+r+1)<<32-t:e.i(s+r);return new s(i,e.h)}(a=s.prototype).m=function(){if(g(this))return-y(this).m();let e=0,t=1;for(let r=0;r<this.g.length;r++){let n=this.i(r);e+=(n>=0?n:4294967296+n)*t,t*=4294967296}return e},a.toString=function(e){if((e=e||10)<2||36<e)throw Error("radix out of range: "+e);if(m(this))return"0";if(g(this))return"-"+y(this).toString(e);let t=u(Math.pow(e,6));var r=this;let n="";for(;;){let i=S(r,t).g,s=(((r=v(r,i.j(t))).g.length>0?r.g[0]:r.h)>>>0).toString(e);if(m(r=i))return s+n;for(;s.length<6;)s="0"+s;n=s+n}},a.i=function(e){return e<0?0:e<this.g.length?this.g[e]:this.h},a.l=function(e){return g(e=v(this,e))?-1:m(e)?0:1},a.abs=function(){return g(this)?y(this):this},a.add=function(e){let t=Math.max(this.g.length,e.g.length),r=[],n=0;for(let i=0;i<=t;i++){let t=n+(65535&this.i(i))+(65535&e.i(i)),s=(t>>>16)+(this.i(i)>>>16)+(e.i(i)>>>16);n=s>>>16,t&=65535,s&=65535,r[i]=s<<16|t}return new s(r,-2147483648&r[r.length-1]?-1:0)},a.j=function(e){if(m(this)||m(e))return h;if(g(this))return g(e)?y(this).j(y(e)):y(y(this).j(e));if(g(e))return y(this.j(y(e)));if(0>this.l(f)&&0>e.l(f))return u(this.m()*e.m());let t=this.g.length+e.g.length,r=[];for(var n=0;n<2*t;n++)r[n]=0;for(n=0;n<this.g.length;n++)for(let t=0;t<e.g.length;t++){let i=this.i(n)>>>16,s=65535&this.i(n),a=e.i(t)>>>16,o=65535&e.i(t);r[2*n+2*t]+=s*o,b(r,2*n+2*t),r[2*n+2*t+1]+=i*o,b(r,2*n+2*t+1),r[2*n+2*t+1]+=s*a,b(r,2*n+2*t+1),r[2*n+2*t+2]+=i*a,b(r,2*n+2*t+2)}for(e=0;e<t;e++)r[e]=r[2*e+1]<<16|r[2*e];for(e=t;e<2*t;e++)r[e]=0;return new s(r,0)},a.B=function(e){return S(this,e).h},a.and=function(e){let t=Math.max(this.g.length,e.g.length),r=[];for(let n=0;n<t;n++)r[n]=this.i(n)&e.i(n);return new s(r,this.h&e.h)},a.or=function(e){let t=Math.max(this.g.length,e.g.length),r=[];for(let n=0;n<t;n++)r[n]=this.i(n)|e.i(n);return new s(r,this.h|e.h)},a.xor=function(e){let t=Math.max(this.g.length,e.g.length),r=[];for(let n=0;n<t;n++)r[n]=this.i(n)^e.i(n);return new s(r,this.h^e.h)},e.prototype.digest=e.prototype.A,e.prototype.reset=e.prototype.u,e.prototype.update=e.prototype.v,i=p.Md5=e,s.prototype.add=s.prototype.add,s.prototype.multiply=s.prototype.j,s.prototype.modulo=s.prototype.B,s.prototype.compare=s.prototype.l,s.prototype.toNumber=s.prototype.m,s.prototype.toString=s.prototype.toString,s.prototype.getBits=s.prototype.i,s.fromNumber=u,s.fromString=c,n=p.Integer=s}).apply(void 0!==d?d:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var f=r(4770),m=r(1968),g=r(3716);let y="@firebase/firestore",v="4.9.2";class b{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}b.UNAUTHENTICATED=new b(null),b.GOOGLE_CREDENTIALS=new b("google-credentials-uid"),b.FIRST_PARTY=new b("first-party-uid"),b.MOCK_USER=new b("mock-user");let T="12.3.0";function S(e){T=e}function E(e){return(0,c.inspect)(e,{depth:100})}let w=new u.Yd("@firebase/firestore");function C(){return w.logLevel}function _(e,...t){if(w.logLevel<=u.in.DEBUG){let r=t.map(N);w.debug(`Firestore (${T}): ${e}`,...r)}}function I(e,...t){if(w.logLevel<=u.in.ERROR){let r=t.map(N);w.error(`Firestore (${T}): ${e}`,...r)}}function R(e,...t){if(w.logLevel<=u.in.WARN){let r=t.map(N);w.warn(`Firestore (${T}): ${e}`,...r)}}function N(e){if("string"==typeof e)return e;try{return E(e)}catch(t){return e}}function k(e,t,r){let n="Unexpected state";"string"==typeof t?n=t:r=t,A(e,n,r)}function A(e,t,r){let n=`FIRESTORE (${T}) INTERNAL ASSERTION FAILED: ${t} (ID: ${e.toString(16)})`;if(void 0!==r)try{let e=JSON.stringify(r);n+=" CONTEXT: "+e}catch(e){n+=" CONTEXT: "+r}throw I(n),Error(n)}function D(e,t,r,n){let i="Unexpected state";"string"==typeof r?i=r:n=r,e||A(t,i,n)}function O(e,t){return e}let x={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class P extends h.ZR{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class M{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class L{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class F{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(b.UNAUTHENTICATED))}shutdown(){}}class B{constructor(e){this.authProvider=e,this.currentUser=b.UNAUTHENTICATED,this.tokenCounter=0,this.forceRefresh=!1,this.auth=null}start(e,t){D(void 0===this.tokenListener,42304);let r=this.tokenCounter,n=e=>this.tokenCounter!==r?(r=this.tokenCounter,t(e)):Promise.resolve(),i=new M;this.tokenListener=()=>{this.tokenCounter++,this.currentUser=this.getUser(),i.resolve(),i=new M,e.enqueueRetryable(()=>n(this.currentUser))};let s=()=>{let t=i;e.enqueueRetryable(async()=>{await t.promise,await n(this.currentUser)})},a=e=>{_("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.tokenListener&&(this.auth.addAuthTokenListener(this.tokenListener),s())};this.authProvider.onInit(e=>a(e)),setTimeout(()=>{if(!this.auth){let e=this.authProvider.getImmediate({optional:!0});e?a(e):(_("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new M)}},0),s()}getToken(){let e=this.tokenCounter,t=this.forceRefresh;return(this.forceRefresh=!1,this.auth)?this.auth.getToken(t).then(t=>this.tokenCounter!==e?(_("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(D("string"==typeof t.accessToken,31837,{tokenData:t}),new L(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.tokenListener&&this.auth.removeAuthTokenListener(this.tokenListener),this.tokenListener=void 0}getUser(){let e=this.auth&&this.auth.getUid();return D(null===e||"string"==typeof e,2055,{currentUid:e}),new b(e)}}class U{constructor(e,t,r){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=r,this.type="FirstParty",this.user=b.FIRST_PARTY,this._headers=new Map}getAuthToken(){return this.authTokenFactory?this.authTokenFactory():null}get headers(){this._headers.set("X-Goog-AuthUser",this.sessionIndex);let e=this.getAuthToken();return e&&this._headers.set("Authorization",e),this.iamToken&&this._headers.set("X-Goog-Iam-Authorization-Token",this.iamToken),this._headers}}class V{constructor(e,t,r){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=r}getToken(){return Promise.resolve(new U(this.sessionIndex,this.iamToken,this.authTokenFactory))}start(e,t){e.enqueueRetryable(()=>t(b.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class j{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class z{constructor(e,t){this.appCheckProvider=t,this.forceRefresh=!1,this.appCheck=null,this.latestAppCheckToken=null,this.serverAppAppCheckToken=null,(0,o.rh)(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken)}start(e,t){D(void 0===this.tokenListener,3512);let r=e=>{null!=e.error&&_("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);let r=e.token!==this.latestAppCheckToken;return this.latestAppCheckToken=e.token,_("FirebaseAppCheckTokenProvider",`Received ${r?"new":"existing"} token.`),r?t(e.token):Promise.resolve()};this.tokenListener=t=>{e.enqueueRetryable(()=>r(t))};let n=e=>{_("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.tokenListener&&this.appCheck.addTokenListener(this.tokenListener)};this.appCheckProvider.onInit(e=>n(e)),setTimeout(()=>{if(!this.appCheck){let e=this.appCheckProvider.getImmediate({optional:!0});e?n(e):_("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.serverAppAppCheckToken)return Promise.resolve(new j(this.serverAppAppCheckToken));let e=this.forceRefresh;return(this.forceRefresh=!1,this.appCheck)?this.appCheck.getToken(e).then(e=>e?(D("string"==typeof e.token,44558,{tokenResult:e}),this.latestAppCheckToken=e.token,new j(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.tokenListener&&this.appCheck.removeTokenListener(this.tokenListener),this.tokenListener=void 0}}function q(e){if(!e)return new F;switch(e.type){case"firstParty":return new V(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new P(x.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}function G(e){return(0,f.randomBytes)(e)}class ${static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,r="",n=20;for(;r.length<n;){let i=G(40);for(let s=0;s<i.length;++s)r.length<n&&i[s]<t&&(r+=e.charAt(i[s]%e.length))}return r}}function K(e,t){return e<t?-1:e>t?1:0}function W(e,t){let r=Math.min(e.length,t.length);for(let n=0;n<r;n++){let r=e.charAt(n),i=t.charAt(n);if(r!==i)return Y(r)===Y(i)?K(r,i):Y(r)?1:-1}return K(e.length,t.length)}let H=55296,Q=57343;function Y(e){let t=e.charCodeAt(0);return t>=H&&t<=Q}function J(e,t,r){return e.length===t.length&&e.every((e,n)=>r(e,t[n]))}function X(e){return e+"\0"}let Z="__name__";class ee{constructor(e,t,r){void 0===t?t=0:t>e.length&&k(637,{offset:t,range:e.length}),void 0===r?r=e.length-t:r>e.length-t&&k(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return 0===ee.comparator(this,e)}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof ee?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let n=0;n<r;n++){let r=ee.compareSegments(e.get(n),t.get(n));if(0!==r)return r}return K(e.length,t.length)}static compareSegments(e,t){let r=ee.isNumericId(e),n=ee.isNumericId(t);return r&&!n?-1:!r&&n?1:r&&n?ee.extractNumericId(e).compare(ee.extractNumericId(t)):W(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return n.fromString(e.substring(4,e.length-2))}}class et extends ee{construct(e,t,r){return new et(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new P(x.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(e=>e.length>0))}return new et(t)}static emptyPath(){return new et([])}}let er=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class en extends ee{construct(e,t,r){return new en(e,t,r)}static isValidIdentifier(e){return er.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),en.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===Z}static keyField(){return new en([Z])}static fromServerFormat(e){let t=[],r="",n=0,i=()=>{if(0===r.length)throw new P(x.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},s=!1;for(;n<e.length;){let t=e[n];if("\\"===t){if(n+1===e.length)throw new P(x.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let t=e[n+1];if(!("\\"===t||"."===t||"`"===t))throw new P(x.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=t,n+=2}else"`"===t?s=!s:"."!==t||s?r+=t:i(),n++}if(i(),s)throw new P(x.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new en(t)}static emptyPath(){return new en([])}}class ei{constructor(e){this.path=e}static fromPath(e){return new ei(et.fromString(e))}static fromName(e){return new ei(et.fromString(e).popFirst(5))}static empty(){return new ei(et.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===et.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return et.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new ei(new et(e.slice()))}}function es(e,t,r){if(!r)throw new P(x.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function ea(e,t,r,n){if(!0===t&&!0===n)throw new P(x.INVALID_ARGUMENT,`${e} and ${r} cannot be used together.`)}function eo(e){if(!ei.isDocumentKey(e))throw new P(x.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function el(e){if(ei.isDocumentKey(e))throw new P(x.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function eu(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}function ec(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{let t=eh(e);return t?`a custom ${t} object`:"an object"}}if("function"==typeof e)return"a function";return k(12329,{type:typeof e})}function eh(e){return e.constructor?e.constructor.name:null}function ed(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new P(x.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let r=ec(e);throw new P(x.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${r}`)}}return e}function ep(e,t){let r={typeString:e};return t&&(r.value=t),r}function ef(e,t){let r;if(!eu(e))throw new P(x.INVALID_ARGUMENT,"JSON must be an object");for(let n in t)if(t[n]){let i=t[n].typeString,s="value"in t[n]?{value:t[n].value}:void 0;if(!(n in e)){r=`JSON missing required field: '${n}'`;break}let a=e[n];if(i&&typeof a!==i){r=`JSON field '${n}' must be a ${i}.`;break}if(void 0!==s&&a!==s.value){r=`Expected '${n}' field to equal '${s.value}'`;break}}if(r)throw new P(x.INVALID_ARGUMENT,r);return!0}let em=-62135596800,eg=1e6;class ey{static now(){return ey.fromMillis(Date.now())}static fromDate(e){return ey.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*eg);return new ey(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0||t>=1e9)throw new P(x.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<em||e>=253402300800)throw new P(x.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/eg}_compareTo(e){return this.seconds===e.seconds?K(this.nanoseconds,e.nanoseconds):K(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:ey._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(ef(e,ey._jsonSchema))return new ey(e.seconds,e.nanoseconds)}valueOf(){return String(this.seconds-em).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}ey._jsonSchemaVersion="firestore/timestamp/1.0",ey._jsonSchema={type:ep("string",ey._jsonSchemaVersion),seconds:ep("number"),nanoseconds:ep("number")};class ev{static fromTimestamp(e){return new ev(e)}static min(){return new ev(new ey(0,0))}static max(){return new ev(new ey(253402300799,1e9-1))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}let eb=-1,eT=0;class eS{constructor(e,t,r,n){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=n}}function eE(e){return e.fields.find(e=>2===e.kind)}function ew(e){return e.fields.filter(e=>2!==e.kind)}function eC(e){let t=ew(e);return 0===t.length?0:t[t.length-1].kind}function e_(e,t){let r=K(e.collectionGroup,t.collectionGroup);if(0!==r)return r;for(let n=0;n<Math.min(e.fields.length,t.fields.length);++n)if(0!==(r=eN(e.fields[n],t.fields[n])))return r;return K(e.fields.length,t.fields.length)}function eI(e){return`id=${e.indexId}|cg=${e.collectionGroup}|f=${e.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")}`}eS.UNKNOWN_ID=-1;class eR{constructor(e,t){this.fieldPath=e,this.kind=t}}function eN(e,t){let r=en.comparator(e.fieldPath,t.fieldPath);return 0!==r?r:K(e.kind,t.kind)}class ek{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new ek(eT,eO.min())}}function eA(e,t){let r=e.toTimestamp().seconds,n=e.toTimestamp().nanoseconds+1;return new eO(ev.fromTimestamp(1e9===n?new ey(r+1,0):new ey(r,n)),ei.empty(),t)}function eD(e){return new eO(e.readTime,e.key,eb)}class eO{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new eO(ev.min(),ei.empty(),eb)}static max(){return new eO(ev.max(),ei.empty(),eb)}}function ex(e,t){let r=e.readTime.compareTo(t.readTime);return 0!==r||0!==(r=ei.comparator(e.documentKey,t.documentKey))?r:K(e.largestBatchId,t.largestBatchId)}let eP="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class eM{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function eL(e){if(e.code===x.FAILED_PRECONDITION&&e.message===eP)_("LocalStore","Unexpectedly lost primary lease");else throw e}class eF{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return(this.callbackAttached&&k(59440),this.callbackAttached=!0,this.isDone)?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new eF((r,n)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(r,n)},this.catchCallback=e=>{this.wrapFailure(t,e).next(r,n)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();if(t instanceof eF)return t;return eF.resolve(t)}catch(e){return eF.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):eF.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):eF.reject(t)}static resolve(e){return new eF((t,r)=>{t(e)})}static reject(e){return new eF((t,r)=>{r(e)})}static waitFor(e){return new eF((t,r)=>{let n=0,i=0,s=!1;e.forEach(e=>{++n,e.next(()=>{++i,s&&i===n&&t()},e=>r(e))}),s=!0,i===n&&t()})}static or(e){let t=eF.resolve(!1);for(let r of e)t=t.next(e=>e?eF.resolve(e):r());return t}static forEach(e,t){let r=[];return e.forEach((e,n)=>{r.push(t.call(this,e,n))}),this.waitFor(r)}static mapArray(e,t){return new eF((r,n)=>{let i=e.length,s=Array(i),a=0;for(let o=0;o<i;o++){let l=o;t(e[l]).next(e=>{s[l]=e,++a===i&&r(s)},e=>n(e))}})}static doWhile(e,t){return new eF((r,n)=>{let i=()=>{!0===e()?t().next(()=>{i()},n):r()};i()})}}let eB="SimpleDb",eU=3;class eV{static open(e,t,r,n){try{return new eV(t,e.transaction(n,r))}catch(e){throw new eG(t,e)}}constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.completionDeferred=new M,this.transaction.oncomplete=()=>{this.completionDeferred.resolve()},this.transaction.onabort=()=>{t.error?this.completionDeferred.reject(new eG(e,t.error)):this.completionDeferred.resolve()},this.transaction.onerror=t=>{let r=eQ(t.target.error);this.completionDeferred.reject(new eG(e,r))}}get completionPromise(){return this.completionDeferred.promise}abort(e){e&&this.completionDeferred.reject(e),this.aborted||(_(eB,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}maybeCommit(){let e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){return new eK(this.transaction.objectStore(e))}}class ej{static delete(e){return _(eB,"Removing database:",e),eW((0,h.Rd)().indexedDB.deleteDatabase(e)).toPromise()}static isAvailable(){if(!(0,h.hl)())return!1;if(ej.isMockPersistence())return!0;let e=(0,h.z$)(),t=ej.getIOSVersion(e),r=0<t&&t<10,n=ez(e),i=0<n&&n<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0)&&!r&&!i}static isMockPersistence(){return"undefined"!=typeof process&&process.env?.USE_MOCK_PERSISTENCE==="YES"}static getStore(e,t){return e.store(t)}static getIOSVersion(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i);return Number(t?t[1].split("_").slice(0,2).join("."):"-1")}constructor(e,t,r){this.name=e,this.version=t,this.schemaConverter=r,this.lastClosedDbVersion=null,12.2===ej.getIOSVersion((0,h.z$)())&&I("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async ensureDb(e){return this.db||(_(eB,"Opening database:",this.name),this.db=await new Promise((t,r)=>{let n=indexedDB.open(this.name,this.version);n.onsuccess=e=>{t(e.target.result)},n.onblocked=()=>{r(new eG(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},n.onerror=t=>{let n=t.target.error;"VersionError"===n.name?r(new P(x.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===n.name?r(new P(x.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+n)):r(new eG(e,n))},n.onupgradeneeded=e=>{_(eB,'Database "'+this.name+'" requires upgrade from version:',e.oldVersion);let t=e.target.result;this.schemaConverter.createOrUpgrade(t,n.transaction,e.oldVersion,this.version).next(()=>{_(eB,"Database upgrade to version "+this.version+" complete")})}})),this.versionchangelistener&&(this.db.onversionchange=e=>this.versionchangelistener(e)),this.db}setVersionChangeListener(e){this.versionchangelistener=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,r,n){let i="readonly"===t,s=0;for(;;){++s;try{this.db=await this.ensureDb(e);let t=eV.open(this.db,e,i?"readonly":"readwrite",r),s=n(t).next(e=>(t.maybeCommit(),e)).catch(e=>(t.abort(e),eF.reject(e))).toPromise();return s.catch(()=>{}),await t.completionPromise,s}catch(r){let e=r,t="FirebaseError"!==e.name&&s<eU;if(_(eB,"Transaction failed with error:",e.message,"Retrying:",t),this.close(),!t)return Promise.reject(e)}}}close(){this.db&&this.db.close(),this.db=void 0}}function ez(e){let t=e.match(/Android ([\d.]+)/i);return Number(t?t[1].split(".").slice(0,2).join("."):"-1")}class eq{constructor(e){this.dbCursor=e,this.shouldStop=!1,this.nextKey=null}get isDone(){return this.shouldStop}get skipToKey(){return this.nextKey}set cursor(e){this.dbCursor=e}done(){this.shouldStop=!0}skip(e){this.nextKey=e}delete(){return eW(this.dbCursor.delete())}}class eG extends P{constructor(e,t){super(x.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function e$(e){return"IndexedDbTransactionError"===e.name}class eK{constructor(e){this.store=e}put(e,t){let r;return void 0!==t?(_(eB,"PUT",this.store.name,e,t),r=this.store.put(t,e)):(_(eB,"PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),eW(r)}add(e){return _(eB,"ADD",this.store.name,e,e),eW(this.store.add(e))}get(e){return eW(this.store.get(e)).next(t=>(void 0===t&&(t=null),_(eB,"GET",this.store.name,e,t),t))}delete(e){return _(eB,"DELETE",this.store.name,e),eW(this.store.delete(e))}count(){return _(eB,"COUNT",this.store.name),eW(this.store.count())}loadAll(e,t){let r=this.options(e,t),n=r.index?this.store.index(r.index):this.store;if("function"==typeof n.getAll){let e=n.getAll(r.range);return new eF((t,r)=>{e.onerror=e=>{r(e.target.error)},e.onsuccess=e=>{t(e.target.result)}})}{let e=this.cursor(r),t=[];return this.iterateCursor(e,(e,r)=>{t.push(r)}).next(()=>t)}}loadFirst(e,t){let r=this.store.getAll(e,null===t?void 0:t);return new eF((e,t)=>{r.onerror=e=>{t(e.target.error)},r.onsuccess=t=>{e(t.target.result)}})}deleteAll(e,t){_(eB,"DELETE ALL",this.store.name);let r=this.options(e,t);r.keysOnly=!1;let n=this.cursor(r);return this.iterateCursor(n,(e,t,r)=>r.delete())}iterate(e,t){let r;t?r=e:(r={},t=e);let n=this.cursor(r);return this.iterateCursor(n,t)}iterateSerial(e){let t=this.cursor({});return new eF((r,n)=>{t.onerror=e=>{n(eQ(e.target.error))},t.onsuccess=t=>{let n=t.target.result;if(!n){r();return}e(n.primaryKey,n.value).next(e=>{e?n.continue():r()})}})}iterateCursor(e,t){let r=[];return new eF((n,i)=>{e.onerror=e=>{i(e.target.error)},e.onsuccess=e=>{let i=e.target.result;if(!i){n();return}let s=new eq(i),a=t(i.primaryKey,i.value,s);if(a instanceof eF){let e=a.catch(e=>(s.done(),eF.reject(e)));r.push(e)}s.isDone?n():null===s.skipToKey?i.continue():i.continue(s.skipToKey)}}).next(()=>eF.waitFor(r))}options(e,t){let r;return void 0!==e&&("string"==typeof e?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),!e.index)return this.store.openCursor(e.range,t);{let r=this.store.index(e.index);return e.keysOnly?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}}}function eW(e){return new eF((t,r)=>{e.onsuccess=e=>{t(e.target.result)},e.onerror=e=>{r(eQ(e.target.error))}})}let eH=!1;function eQ(e){let t=ej.getIOSVersion((0,h.z$)());if(t>=12.2&&t<13){let t="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(t)>=0){let e=new P("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return eH||(eH=!0,setTimeout(()=>{throw e},0)),e}}return e}let eY="IndexBackfiller",eJ=15e3,eX=6e4,eZ=50;class e0{constructor(e,t){this.asyncQueue=e,this.backfiller=t,this.task=null}start(){this.schedule(eJ)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}schedule(e){_(eY,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{let e=await this.backfiller.backfill();_(eY,`Documents written: ${e}`)}catch(e){e$(e)?_(eY,"Ignoring IndexedDB error during index backfill: ",e):await eL(e)}await this.schedule(eX)})}}class e1{constructor(e,t){this.localStore=e,this.persistence=t}async backfill(e=eZ){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.writeIndexEntries(t,e))}writeIndexEntries(e,t){let r=new Set,n=t,i=!0;return eF.doWhile(()=>!0===i&&n>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(t=>{if(!(null===t||r.has(t)))return _(eY,`Processing collection: ${t}`),this.writeEntriesForCollectionGroup(e,t,n).next(e=>{n-=e,r.add(t)});i=!1})).next(()=>t-n)}writeEntriesForCollectionGroup(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(n=>this.localStore.localDocuments.getNextDocuments(e,t,n,r).next(r=>{let i=r.changes;return this.localStore.indexManager.updateIndexEntries(e,i).next(()=>this.getNewOffset(n,r)).next(r=>(_(eY,`Updating offset: ${r}`),this.localStore.indexManager.updateCollectionGroup(e,t,r))).next(()=>i.size)}))}getNewOffset(e,t){let r=e;return t.changes.forEach((e,t)=>{let n=eD(t);ex(n,r)>0&&(r=n)}),new eO(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}class e2{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.setPreviousValue(e),this.writeNewSequenceNumber=e=>t.writeSequenceNumber(e))}setPreviousValue(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(e),e}}e2.INVALID=-1;let e4="\x01",e3="\x01",e6="\x10",e9="\x11";function e5(e){let t="";for(let r=0;r<e.length;r++)t.length>0&&(t=e8(t)),t=e7(e.get(r),t);return e8(t)}function e7(e,t){let r=t,n=e.length;for(let t=0;t<n;t++){let n=e.charAt(t);switch(n){case"\0":r+=e4+e6;break;case e4:r+=e4+e9;break;default:r+=n}}return r}function e8(e){return e+e4+e3}function te(e){let t=e.length;if(D(t>=2,64408,{path:e}),2===t)return D(e.charAt(0)===e4&&e.charAt(1)===e3,56145,{path:e}),et.emptyPath();let r=t-2,n=[],i="";for(let s=0;s<t;){let t=e.indexOf(e4,s);switch((t<0||t>r)&&k(50515,{path:e}),e.charAt(t+1)){case e3:let a;let o=e.substring(s,t);0===i.length?a=o:(i+=o,a=i,i=""),n.push(a);break;case e6:i+=e.substring(s,t)+"\0";break;case e9:i+=e.substring(s,t+1);break;default:k(61167,{path:e})}s=t+2}return new et(n)}let tt="remoteDocuments",tr="owner",tn="owner",ti="mutationQueues",ts="userId",ta="mutations",to="batchId",tl="userMutationsIndex",tu=["userId","batchId"];function tc(e){return[e]}function th(e,t){return[e,e5(t)]}function td(e,t,r){return[e,e5(t),r]}let tp={},tf="documentMutations",tm="remoteDocumentsV14",tg=["prefixPath","collectionGroup","readTime","documentId"],ty="documentKeyIndex",tv=["prefixPath","collectionGroup","documentId"],tb="collectionGroupIndex",tT=["collectionGroup","readTime","prefixPath","documentId"],tS="remoteDocumentGlobal",tE="remoteDocumentGlobalKey",tw="targets",tC="targetId",t_="queryTargetsIndex",tI=["canonicalId","targetId"],tR="targetDocuments",tN=["targetId","path"],tk="documentTargetsIndex",tA=["path","targetId"],tD="targetGlobalKey",tO="targetGlobal",tx="collectionParents",tP=["collectionId","parent"],tM="clientMetadata",tL="clientId",tF="bundles",tB="bundleId",tU="namedQueries",tV="name",tj="indexConfiguration",tz="indexId",tq="collectionGroupIndex",tG="collectionGroup",t$="indexState",tK=["indexId","uid"],tW="sequenceNumberIndex",tH=["uid","sequenceNumber"],tQ="indexEntries",tY=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],tJ="documentKeyIndex",tX=["indexId","uid","orderedDocumentKey"],tZ="documentOverlays",t0=["userId","collectionPath","documentId"],t1="collectionPathOverlayIndex",t2=["userId","collectionPath","largestBatchId"],t4="collectionGroupOverlayIndex",t3=["userId","collectionGroup","largestBatchId"],t6="globals",t9="name",t5=[ti,ta,tf,tt,tw,tr,tO,tR,tM,tS,tx,tF,tU],t7=[...t5,tZ],t8=[ti,ta,tf,tm,tw,tr,tO,tR,tM,tS,tx,tF,tU,tZ],re=t8,rt=[...re,tj,t$,tQ],rr=rt,rn=[...rt,t6],ri=rn;function rs(e){return 18===e?ri:17===e?rn:16===e?rr:15===e?rt:14===e?re:13===e?t8:12===e?t7:11===e?t5:void k(60245)}class ra extends eM{constructor(e,t){super(),this.simpleDbTransaction=e,this.currentSequenceNumber=t}}function ro(e,t){let r=O(e);return ej.getStore(r.simpleDbTransaction,t)}function rl(e){let t=0;for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t++;return t}function ru(e,t){for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t(r,e[r])}function rc(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class rh{constructor(e,t){this.comparator=e,this.root=t||rp.EMPTY}insert(e,t){return new rh(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,rp.BLACK,null,null))}remove(e){return new rh(this.comparator,this.root.remove(e,this.comparator).copy(null,null,rp.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(0===r)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let n=this.comparator(e,r.key);if(0===n)return t+r.left.size;n<0?r=r.left:(t+=r.left.size+1,r=r.right)}return -1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new rd(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new rd(this.root,e,this.comparator,!1)}getReverseIterator(){return new rd(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new rd(this.root,e,this.comparator,!0)}}class rd{constructor(e,t,r,n){this.isReverse=n,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&n&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else if(0===i){this.nodeStack.push(e);break}else this.nodeStack.push(e),e=this.isReverse?e.right:e.left}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class rp{constructor(e,t,r,n,i){this.key=e,this.value=t,this.color=null!=r?r:rp.RED,this.left=null!=n?n:rp.EMPTY,this.right=null!=i?i:rp.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,n,i){return new rp(null!=e?e:this.key,null!=t?t:this.value,null!=r?r:this.color,null!=n?n:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let n=this,i=r(e,n.key);return(n=i<0?n.copy(null,null,null,n.left.insert(e,t,r),null):0===i?n.copy(null,t,null,null,null):n.copy(null,null,null,null,n.right.insert(e,t,r))).fixUp()}removeMin(){if(this.left.isEmpty())return rp.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()}remove(e,t){let r;let n=this;if(0>t(e,n.key))n.left.isEmpty()||n.left.isRed()||n.left.left.isRed()||(n=n.moveRedLeft()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed()&&(n=n.rotateRight()),n.right.isEmpty()||n.right.isRed()||n.right.left.isRed()||(n=n.moveRedRight()),0===t(e,n.key)){if(n.right.isEmpty())return rp.EMPTY;r=n.right.min(),n=n.copy(r.key,r.value,null,null,n.right.removeMin())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}rotateLeft(){let e=this.copy(null,null,rp.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,rp.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){return Math.pow(2,this.check())<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw k(43730,{key:this.key,value:this.value});if(this.right.isRed())throw k(14113,{key:this.key,value:this.value});let e=this.left.check();if(e===this.right.check())return e+(this.isRed()?0:1);throw k(27949)}}rp.EMPTY=null,rp.RED=!0,rp.BLACK=!1;class rf{constructor(){this.size=0}get key(){throw k(57766)}get value(){throw k(16141)}get color(){throw k(16727)}get left(){throw k(29726)}get right(){throw k(36894)}copy(e,t,r,n,i){return this}insert(e,t,r){return new rp(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}}rp.EMPTY=new rf;class rm{constructor(e){this.comparator=e,this.data=new rh(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let n=r.getNext();if(this.comparator(n.key,e[1])>=0)return;t(n.key)}}forEachWhile(e,t){let r;for(r=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new rg(this.data.getIterator())}getIteratorFrom(e){return new rg(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof rm)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let e=t.getNext().key,n=r.getNext().key;if(0!==this.comparator(e,n))return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new rm(this.comparator);return t.data=e,t}}class rg{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function ry(e,t,r,n,i){let s=e.getIterator(),a=t.getIterator(),o=rv(s),l=rv(a);for(;o||l;){let e=!1,t=!1;if(o&&l){let n=r(o,l);n<0?t=!0:n>0&&(e=!0)}else null!=o?t=!0:e=!0;e?(n(l),l=rv(a)):t?(i(o),o=rv(s)):(o=rv(s),l=rv(a))}}function rv(e){return e.hasNext()?e.getNext():void 0}class rb{constructor(e){this.fields=e,e.sort(en.comparator)}static empty(){return new rb([])}unionWith(e){let t=new rm(en.comparator);for(let e of this.fields)t=t.add(e);for(let r of e)t=t.add(r);return new rb(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return J(this.fields,e.fields,(e,t)=>e.isEqual(t))}}function rT(e){return Buffer.from(e,"base64").toString("binary")}function rS(e){return Buffer.from(e,"binary").toString("base64")}class rE{constructor(e){this.binaryString=e}static fromBase64String(e){return new rE(rT(e))}static fromUint8Array(e){return new rE(rw(e))}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return rS(this.binaryString)}toUint8Array(){return rC(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return K(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}function rw(e){let t="";for(let r=0;r<e.length;++r)t+=String.fromCharCode(e[r]);return t}function rC(e){let t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}rE.EMPTY_BYTE_STRING=new rE("");let r_=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function rI(e){if(D(!!e,39018),"string"==typeof e){let t=0,r=r_.exec(e);if(D(!!r,46558,{timestamp:e}),r[1]){let e=r[1];t=Number(e=(e+"000000000").substr(0,9))}return{seconds:Math.floor(new Date(e).getTime()/1e3),nanos:t}}return{seconds:rR(e.seconds),nanos:rR(e.nanos)}}function rR(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function rN(e){return"string"==typeof e?rE.fromBase64String(e):rE.fromUint8Array(e)}let rk="server_timestamp",rA="__type__",rD="__previous_value__",rO="__local_write_time__";function rx(e){return(e?.mapValue?.fields||{})[rA]?.stringValue===rk}function rP(e,t){let r={fields:{[rA]:{stringValue:rk},[rO]:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&rx(t)&&(t=rM(t)),t&&(r.fields[rD]=t),{mapValue:r}}function rM(e){let t=e.mapValue.fields[rD];return rx(t)?rM(t):t}function rL(e){let t=rI(e.mapValue.fields[rO].timestampValue);return new ey(t.seconds,t.nanos)}class rF{constructor(e,t,r,n,i,s,a,o,l,u){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=n,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=a,this.longPollingOptions=o,this.useFetchStreams=l,this.isUsingEmulator=u}}let rB="(default)";class rU{constructor(e,t){this.projectId=e,this.database=t||rB}static empty(){return new rU("","")}get isDefaultDatabase(){return this.database===rB}isEqual(e){return e instanceof rU&&e.projectId===this.projectId&&e.database===this.database}}function rV(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new P(x.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new rU(e.options.projectId,t)}let rj=-1;function rz(e){return null==e}function rq(e){return 0===e&&1/e==-1/0}function rG(e){return"number"==typeof e&&Number.isInteger(e)&&!rq(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}let r$="__type__",rK="__max__",rW={mapValue:{fields:{__type__:{stringValue:rK}}}},rH="__vector__",rQ="value",rY={nullValue:"NULL_VALUE"};function rJ(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?rx(e)?4:n_(e)?9007199254740991:nw(e)?10:11:k(28295,{value:e})}function rX(e,t){if(e===t)return!0;let r=rJ(e);if(r!==rJ(t))return!1;switch(r){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return rL(e).isEqual(rL(t));case 3:return rZ(e,t);case 5:return e.stringValue===t.stringValue;case 6:return r1(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return r0(e,t);case 2:return r2(e,t);case 9:return J(e.arrayValue.values||[],t.arrayValue.values||[],rX);case 10:case 11:return r4(e,t);default:return k(52216,{left:e})}}function rZ(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;let r=rI(e.timestampValue),n=rI(t.timestampValue);return r.seconds===n.seconds&&r.nanos===n.nanos}function r0(e,t){return rR(e.geoPointValue.latitude)===rR(t.geoPointValue.latitude)&&rR(e.geoPointValue.longitude)===rR(t.geoPointValue.longitude)}function r1(e,t){return rN(e.bytesValue).isEqual(rN(t.bytesValue))}function r2(e,t){if("integerValue"in e&&"integerValue"in t)return rR(e.integerValue)===rR(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){let r=rR(e.doubleValue),n=rR(t.doubleValue);return r===n?rq(r)===rq(n):isNaN(r)&&isNaN(n)}return!1}function r4(e,t){let r=e.mapValue.fields||{},n=t.mapValue.fields||{};if(rl(r)!==rl(n))return!1;for(let e in r)if(r.hasOwnProperty(e)&&(void 0===n[e]||!rX(r[e],n[e])))return!1;return!0}function r3(e,t){return void 0!==(e.values||[]).find(e=>rX(e,t))}function r6(e,t){if(e===t)return 0;let r=rJ(e),n=rJ(t);if(r!==n)return K(r,n);switch(r){case 0:case 9007199254740991:return 0;case 1:return K(e.booleanValue,t.booleanValue);case 2:return r9(e,t);case 3:return r5(e.timestampValue,t.timestampValue);case 4:return r5(rL(e),rL(t));case 5:return W(e.stringValue,t.stringValue);case 6:return ne(e.bytesValue,t.bytesValue);case 7:return r7(e.referenceValue,t.referenceValue);case 8:return r8(e.geoPointValue,t.geoPointValue);case 9:return nt(e.arrayValue,t.arrayValue);case 10:return nr(e.mapValue,t.mapValue);case 11:return nn(e.mapValue,t.mapValue);default:throw k(23264,{leftType:r})}}function r9(e,t){let r=rR(e.integerValue||e.doubleValue),n=rR(t.integerValue||t.doubleValue);return r<n?-1:r>n?1:r===n?0:isNaN(r)?isNaN(n)?0:-1:1}function r5(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return K(e,t);let r=rI(e),n=rI(t),i=K(r.seconds,n.seconds);return 0!==i?i:K(r.nanos,n.nanos)}function r7(e,t){let r=e.split("/"),n=t.split("/");for(let e=0;e<r.length&&e<n.length;e++){let t=K(r[e],n[e]);if(0!==t)return t}return K(r.length,n.length)}function r8(e,t){let r=K(rR(e.latitude),rR(t.latitude));return 0!==r?r:K(rR(e.longitude),rR(t.longitude))}function ne(e,t){let r=rN(e),n=rN(t);return r.compareTo(n)}function nt(e,t){let r=e.values||[],n=t.values||[];for(let e=0;e<r.length&&e<n.length;++e){let t=r6(r[e],n[e]);if(t)return t}return K(r.length,n.length)}function nr(e,t){let r=e.fields||{},n=t.fields||{},i=r[rQ]?.arrayValue,s=n[rQ]?.arrayValue,a=K(i?.values?.length||0,s?.values?.length||0);return 0!==a?a:nt(i,s)}function nn(e,t){if(e===rW.mapValue&&t===rW.mapValue)return 0;if(e===rW.mapValue)return 1;if(t===rW.mapValue)return -1;let r=e.fields||{},n=Object.keys(r),i=t.fields||{},s=Object.keys(i);n.sort(),s.sort();for(let e=0;e<n.length&&e<s.length;++e){let t=W(n[e],s[e]);if(0!==t)return t;let a=r6(r[n[e]],i[s[e]]);if(0!==a)return a}return K(n.length,s.length)}function ni(e){return ns(e)}function ns(e){if("nullValue"in e)return"null";if("booleanValue"in e)return""+e.booleanValue;if("integerValue"in e)return""+e.integerValue;if("doubleValue"in e)return""+e.doubleValue;if("timestampValue"in e)return no(e.timestampValue);if("stringValue"in e)return e.stringValue;if("bytesValue"in e)return na(e.bytesValue);else if("referenceValue"in e)return nu(e.referenceValue);else if("geoPointValue"in e)return nl(e.geoPointValue);else if("arrayValue"in e)return nh(e.arrayValue);else if("mapValue"in e)return nc(e.mapValue);else return k(61005,{value:e})}function na(e){return rN(e).toBase64()}function no(e){let t=rI(e);return`time(${t.seconds},${t.nanos})`}function nl(e){return`geo(${e.latitude},${e.longitude})`}function nu(e){return ei.fromName(e).toString()}function nc(e){let t=Object.keys(e.fields||{}).sort(),r="{",n=!0;for(let i of t)n?n=!1:r+=",",r+=`${i}:${ns(e.fields[i])}`;return r+"}"}function nh(e){let t="[",r=!0;for(let n of e.values||[])r?r=!1:t+=",",t+=ns(n);return t+"]"}function nd(e){switch(rJ(e)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let t=rM(e);return t?16+nd(t):16;case 5:return 2*e.stringValue.length;case 6:return rN(e.bytesValue).approximateByteSize();case 7:return e.referenceValue.length;case 9:return nf(e.arrayValue);case 10:case 11:return np(e.mapValue);default:throw k(13486,{value:e})}}function np(e){let t=0;return ru(e.fields,(e,r)=>{t+=e.length+nd(r)}),t}function nf(e){return(e.values||[]).reduce((e,t)=>e+nd(t),0)}function nm(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function ng(e){return!!e&&"integerValue"in e}function ny(e){return!!e&&"doubleValue"in e}function nv(e){return ng(e)||ny(e)}function nb(e){return!!e&&"arrayValue"in e}function nT(e){return!!e&&"nullValue"in e}function nS(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function nE(e){return!!e&&"mapValue"in e}function nw(e){return(e?.mapValue?.fields||{})[r$]?.stringValue===rH}function nC(e){if(e.geoPointValue)return{geoPointValue:{...e.geoPointValue}};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:{...e.timestampValue}};if(e.mapValue){let t={mapValue:{fields:{}}};return ru(e.mapValue.fields,(e,r)=>t.mapValue.fields[e]=nC(r)),t}{if(!e.arrayValue)return{...e};let t={arrayValue:{values:[]}};for(let r=0;r<(e.arrayValue.values||[]).length;++r)t.arrayValue.values[r]=nC(e.arrayValue.values[r]);return t}}function n_(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===rK}let nI={mapValue:{fields:{[r$]:{stringValue:rH},[rQ]:{arrayValue:{}}}}};function nR(e){if("nullValue"in e)return rY;if("booleanValue"in e)return{booleanValue:!1};if("integerValue"in e||"doubleValue"in e)return{doubleValue:NaN};if("timestampValue"in e)return{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}};if("stringValue"in e)return{stringValue:""};if("bytesValue"in e)return{bytesValue:""};if("referenceValue"in e)return nm(rU.empty(),ei.empty());else if("geoPointValue"in e)return{geoPointValue:{latitude:-90,longitude:-180}};else if("arrayValue"in e)return{arrayValue:{}};else if(!("mapValue"in e))return k(35942,{value:e});else return nw(e)?nI:{mapValue:{}}}function nN(e){if("nullValue"in e)return{booleanValue:!1};if("booleanValue"in e)return{doubleValue:NaN};if("integerValue"in e||"doubleValue"in e)return{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}};if("timestampValue"in e)return{stringValue:""};if("stringValue"in e)return{bytesValue:""};if("bytesValue"in e)return nm(rU.empty(),ei.empty());if("referenceValue"in e)return{geoPointValue:{latitude:-90,longitude:-180}};else if("geoPointValue"in e)return{arrayValue:{}};else if("arrayValue"in e)return nI;else if(!("mapValue"in e))return k(61959,{value:e});else return nw(e)?{mapValue:{}}:rW}function nk(e,t){let r=r6(e.value,t.value);return 0!==r?r:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function nA(e,t){let r=r6(e.value,t.value);return 0!==r?r:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}class nD{constructor(e){this.value=e}static empty(){return new nD({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(!nE(t=(t.mapValue.fields||{})[e.get(r)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=nC(t)}setAll(e){let t=en.emptyPath(),r={},n=[];e.forEach((e,i)=>{if(!t.isImmediateParentOf(i)){let e=this.getFieldsMap(t);this.applyChanges(e,r,n),r={},n=[],t=i.popLast()}e?r[i.lastSegment()]=nC(e):n.push(i.lastSegment())});let i=this.getFieldsMap(t);this.applyChanges(i,r,n)}delete(e){let t=this.field(e.popLast());nE(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return rX(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let n=t.mapValue.fields[e.get(r)];nE(n)&&n.mapValue.fields||(n={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=n),t=n}return t.mapValue.fields}applyChanges(e,t,r){for(let n of(ru(t,(t,r)=>e[t]=r),r))delete e[n]}clone(){return new nD(nC(this.value))}}function nO(e){let t=[];return ru(e.fields,(e,r)=>{let n=new en([e]);if(nE(r)){let e=nO(r.mapValue).fields;if(0===e.length)t.push(n);else for(let r of e)t.push(n.child(r))}else t.push(n)}),new rb(t)}class nx{constructor(e,t,r,n,i,s,a){this.key=e,this.documentType=t,this.version=r,this.readTime=n,this.createTime=i,this.data=s,this.documentState=a}static newInvalidDocument(e){return new nx(e,0,ev.min(),ev.min(),ev.min(),nD.empty(),0)}static newFoundDocument(e,t,r,n){return new nx(e,1,t,ev.min(),r,n,0)}static newNoDocument(e,t){return new nx(e,2,t,ev.min(),ev.min(),nD.empty(),0)}static newUnknownDocument(e,t){return new nx(e,3,t,ev.min(),ev.min(),nD.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(ev.min())&&(2===this.documentType||0===this.documentType)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=nD.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=nD.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ev.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof nx&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new nx(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}function nP(e,t,r){let n=t.data.field(e),i=r.data.field(e);return null!==n&&null!==i?r6(n,i):k(42886)}class nM{constructor(e,t){this.position=e,this.inclusive=t}}function nL(e,t,r){let n=0;for(let i=0;i<e.position.length;i++){let s=t[i],a=e.position[i];if(n=s.field.isKeyField()?ei.comparator(ei.fromName(a.referenceValue),r.key):r6(a,r.data.field(s.field)),"desc"===s.dir&&(n*=-1),0!==n)break}return n}function nF(e,t,r){let n=nL(e,t,r);return e.inclusive?n>=0:n>0}function nB(e,t,r){let n=nL(e,t,r);return e.inclusive?n<=0:n<0}function nU(e,t){if(null===e)return null===t;if(null===t||e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let r=0;r<e.position.length;r++)if(!rX(e.position[r],t.position[r]))return!1;return!0}class nV{constructor(e,t="asc"){this.field=e,this.dir=t}}function nj(e){return e.field.canonicalString()+e.dir}function nz(e){return`${e.field.canonicalString()} (${e.dir})`}function nq(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class nG{}class n$ extends nG{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,r):new n6(e,t,r):"array-contains"===t?new n8(e,r):"in"===t?new ie(e,r):"not-in"===t?new it(e,r):"array-contains-any"===t?new ir(e,r):new n$(e,t,r)}static createKeyFieldInFilter(e,t,r){return"in"===t?new n9(e,r):new n5(e,r)}matches(e){let t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(r6(t,this.value)):null!==t&&rJ(this.value)===rJ(t)&&this.matchesComparison(r6(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return k(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class nK extends nG{constructor(e,t){super(),this.filters=e,this.op=t,this.memoizedFlattenedFilters=null}static create(e,t){return new nK(e,t)}matches(e){return nW(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.memoizedFlattenedFilters||(this.memoizedFlattenedFilters=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.memoizedFlattenedFilters}getFilters(){return Object.assign([],this.filters)}}function nW(e){return"and"===e.op}function nH(e){return"or"===e.op}function nQ(e){return nY(e)&&nW(e)}function nY(e){for(let t of e.filters)if(t instanceof nK)return!1;return!0}function nJ(e){if(e instanceof n$)return e.field.canonicalString()+e.op.toString()+ni(e.value);if(nQ(e))return e.filters.map(e=>nJ(e)).join(",");{let t=e.filters.map(e=>nJ(e)).join(",");return`${e.op}(${t})`}}function nX(e,t){return e instanceof n$?nZ(e,t):e instanceof nK?n0(e,t):void k(19439)}function nZ(e,t){return t instanceof n$&&e.op===t.op&&e.field.isEqual(t.field)&&rX(e.value,t.value)}function n0(e,t){return t instanceof nK&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce((e,r,n)=>e&&nX(r,t.filters[n]),!0)}function n1(e,t){let r=e.filters.concat(t);return nK.create(r,e.op)}function n2(e){return e instanceof n$?n3(e):e instanceof nK?n4(e):"Filter"}function n4(e){return e.op.toString()+" {"+e.getFilters().map(n2).join(" ,")+"}"}function n3(e){return`${e.field.canonicalString()} ${e.op} ${ni(e.value)}`}class n6 extends n${constructor(e,t,r){super(e,t,r),this.key=ei.fromName(r.referenceValue)}matches(e){let t=ei.comparator(e.key,this.key);return this.matchesComparison(t)}}class n9 extends n${constructor(e,t){super(e,"in",t),this.keys=n7("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class n5 extends n${constructor(e,t){super(e,"not-in",t),this.keys=n7("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function n7(e,t){return(t.arrayValue?.values||[]).map(e=>ei.fromName(e.referenceValue))}class n8 extends n${constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return nb(t)&&r3(t.arrayValue,this.value)}}class ie extends n${constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return null!==t&&r3(this.value.arrayValue,t)}}class it extends n${constructor(e,t){super(e,"not-in",t)}matches(e){if(r3(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!r3(this.value.arrayValue,t)}}class ir extends n${constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!!nb(t)&&!!t.arrayValue.values&&t.arrayValue.values.some(e=>r3(this.value.arrayValue,e))}}class ii{constructor(e,t=null,r=[],n=[],i=null,s=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=n,this.limit=i,this.startAt=s,this.endAt=a,this.memoizedCanonicalId=null}}function is(e,t=null,r=[],n=[],i=null,s=null,a=null){return new ii(e,t,r,n,i,s,a)}function ia(e){let t=O(e);if(null===t.memoizedCanonicalId){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:"+t.filters.map(e=>nJ(e)).join(",")+"|ob:"+t.orderBy.map(e=>nj(e)).join(","),rz(t.limit)||(e+="|l:"+t.limit),t.startAt&&(e+="|lb:"+(t.startAt.inclusive?"b:":"a:")+t.startAt.position.map(e=>ni(e)).join(",")),t.endAt&&(e+="|ub:"+(t.endAt.inclusive?"a:":"b:")+t.endAt.position.map(e=>ni(e)).join(",")),t.memoizedCanonicalId=e}return t.memoizedCanonicalId}function io(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map(e=>n2(e)).join(", ")}]`),rz(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map(e=>nz(e)).join(", ")}]`),e.startAt&&(t+=", startAt: "+(e.startAt.inclusive?"b:":"a:")+e.startAt.position.map(e=>ni(e)).join(",")),e.endAt&&(t+=", endAt: "+(e.endAt.inclusive?"a:":"b:")+e.endAt.position.map(e=>ni(e)).join(",")),`Target(${t})`}function il(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let r=0;r<e.orderBy.length;r++)if(!nq(e.orderBy[r],t.orderBy[r]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let r=0;r<e.filters.length;r++)if(!nX(e.filters[r],t.filters[r]))return!1;return!!(e.collectionGroup===t.collectionGroup&&e.path.isEqual(t.path)&&nU(e.startAt,t.startAt))&&nU(e.endAt,t.endAt)}function iu(e){return ei.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function ic(e,t){return e.filters.filter(e=>e instanceof n$&&e.field.isEqual(t))}function ih(e,t){let r=eE(t);if(void 0===r)return null;for(let t of ic(e,r.fieldPath))switch(t.op){case"array-contains-any":return t.value.arrayValue.values||[];case"array-contains":return[t.value]}return null}function id(e,t){let r=new Map;for(let n of ew(t))for(let t of ic(e,n.fieldPath))switch(t.op){case"==":case"in":r.set(n.fieldPath.canonicalString(),t.value);break;case"not-in":case"!=":return r.set(n.fieldPath.canonicalString(),t.value),Array.from(r.values())}return null}function ip(e,t){let r=[],n=!0;for(let i of ew(t)){let t=0===i.kind?ig(e,i.fieldPath,e.startAt):iy(e,i.fieldPath,e.startAt);r.push(t.value),n&&(n=t.inclusive)}return new nM(r,n)}function im(e,t){let r=[],n=!0;for(let i of ew(t)){let t=0===i.kind?iy(e,i.fieldPath,e.endAt):ig(e,i.fieldPath,e.endAt);r.push(t.value),n&&(n=t.inclusive)}return new nM(r,n)}function ig(e,t,r){let n=rY,i=!0;for(let r of ic(e,t)){let e=rY,t=!0;switch(r.op){case"<":case"<=":e=nR(r.value);break;case"==":case"in":case">=":e=r.value;break;case">":e=r.value,t=!1;break;case"!=":case"not-in":e=rY}0>nk({value:n,inclusive:i},{value:e,inclusive:t})&&(n=e,i=t)}if(null!==r){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=r.position[s];0>nk({value:n,inclusive:i},{value:e,inclusive:r.inclusive})&&(n=e,i=r.inclusive);break}}return{value:n,inclusive:i}}function iy(e,t,r){let n=rW,i=!0;for(let r of ic(e,t)){let e=rW,t=!0;switch(r.op){case">=":case">":e=nN(r.value),t=!1;break;case"==":case"in":case"<=":e=r.value;break;case"<":e=r.value,t=!1;break;case"!=":case"not-in":e=rW}nA({value:n,inclusive:i},{value:e,inclusive:t})>0&&(n=e,i=t)}if(null!==r){for(let s=0;s<e.orderBy.length;++s)if(e.orderBy[s].field.isEqual(t)){let e=r.position[s];nA({value:n,inclusive:i},{value:e,inclusive:r.inclusive})>0&&(n=e,i=r.inclusive);break}}return{value:n,inclusive:i}}function iv(e){let t=new rm(en.comparator),r=!1;for(let n of e.filters)for(let e of n.getFlattenedFilters())e.field.isKeyField()||("array-contains"===e.op||"array-contains-any"===e.op?r=!0:t=t.add(e.field));for(let r of e.orderBy)r.field.isKeyField()||(t=t.add(r.field));return t.size+(r?1:0)}function ib(e){return null!==e.limit}class iT{constructor(e,t=null,r=[],n=[],i=null,s="F",a=null,o=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=n,this.limit=i,this.limitType=s,this.startAt=a,this.endAt=o,this.memoizedNormalizedOrderBy=null,this.memoizedTarget=null,this.memoizedAggregateTarget=null,this.startAt,this.endAt}}function iS(e,t,r,n,i,s,a,o){return new iT(e,t,r,n,i,s,a,o)}function iE(e){return new iT(e)}function iw(e,t){return new iT(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}function iC(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function i_(e){let t=new rm(en.comparator);return e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t}function iI(e){return ei.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function iR(e){return null!==e.collectionGroup}function iN(e){let t=O(e);if(null===t.memoizedNormalizedOrderBy){t.memoizedNormalizedOrderBy=[];let e=new Set;for(let r of t.explicitOrderBy)t.memoizedNormalizedOrderBy.push(r),e.add(r.field.canonicalString());let r=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";i_(t).forEach(n=>{e.has(n.canonicalString())||n.isKeyField()||t.memoizedNormalizedOrderBy.push(new nV(n,r))}),e.has(en.keyField().canonicalString())||t.memoizedNormalizedOrderBy.push(new nV(en.keyField(),r))}return t.memoizedNormalizedOrderBy}function ik(e){let t=O(e);return t.memoizedTarget||(t.memoizedTarget=iD(t,iN(e))),t.memoizedTarget}function iA(e){let t=O(e);return t.memoizedAggregateTarget||(t.memoizedAggregateTarget=iD(t,e.explicitOrderBy)),t.memoizedAggregateTarget}function iD(e,t){if("F"===e.limitType)return is(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{let t="desc"===e.dir?"asc":"desc";return new nV(e.field,t)});let r=e.endAt?new nM(e.endAt.position,e.endAt.inclusive):null,n=e.startAt?new nM(e.startAt.position,e.startAt.inclusive):null;return is(e.path,e.collectionGroup,t,e.filters,e.limit,r,n)}}function iO(e,t){let r=e.filters.concat([t]);return new iT(e.path,e.collectionGroup,e.explicitOrderBy.slice(),r,e.limit,e.limitType,e.startAt,e.endAt)}function ix(e,t){let r=e.explicitOrderBy.concat([t]);return new iT(e.path,e.collectionGroup,r,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}function iP(e,t,r){return new iT(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,r,e.startAt,e.endAt)}function iM(e,t){return new iT(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,t,e.endAt)}function iL(e,t){return new iT(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,t)}function iF(e,t){return il(ik(e),ik(t))&&e.limitType===t.limitType}function iB(e){return`${ia(ik(e))}|lt:${e.limitType}`}function iU(e){return`Query(target=${io(ik(e))}; limitType=${e.limitType})`}function iV(e,t){return t.isFoundDocument()&&ij(e,t)&&iz(e,t)&&iq(e,t)&&iG(e,t)}function ij(e,t){let r=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(r):ei.isDocumentKey(e.path)?e.path.isEqual(r):e.path.isImmediateParentOf(r)}function iz(e,t){for(let r of iN(e))if(!r.field.isKeyField()&&null===t.data.field(r.field))return!1;return!0}function iq(e,t){for(let r of e.filters)if(!r.matches(t))return!1;return!0}function iG(e,t){return(!e.startAt||!!nB(e.startAt,iN(e),t))&&(!e.endAt||!!nF(e.endAt,iN(e),t))}function i$(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function iK(e){return(t,r)=>{let n=!1;for(let i of iN(e)){let e=iW(i,t,r);if(0!==e)return e;n=n||i.field.isKeyField()}return 0}}function iW(e,t,r){let n=e.field.isKeyField()?ei.comparator(t.key,r.key):nP(e.field,t,r);switch(e.dir){case"asc":return n;case"desc":return -1*n;default:return k(19790,{direction:e.dir})}}class iH{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(void 0!==r){for(let[t,n]of r)if(this.equalsFn(t,e))return n}}has(e){return void 0!==this.get(e)}set(e,t){let r=this.mapKeyFn(e),n=this.inner[r];if(void 0===n){this.inner[r]=[[e,t]],this.innerSize++;return}for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e)){n[r]=[e,t];return}n.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(void 0===r)return!1;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return 1===r.length?delete this.inner[t]:r.splice(n,1),this.innerSize--,!0;return!1}forEach(e){ru(this.inner,(t,r)=>{for(let[t,n]of r)e(t,n)})}isEmpty(){return rc(this.inner)}size(){return this.innerSize}}let iQ=new rh(ei.comparator);function iY(){return iQ}let iJ=new rh(ei.comparator);function iX(...e){let t=iJ;for(let r of e)t=t.insert(r.key,r);return t}function iZ(){return i4()}function i0(e){let t=iJ;return e.forEach((e,r)=>t=t.insert(e,r.overlayedDocument)),t}function i1(){return i4()}function i2(){return i4()}function i4(){return new iH(e=>e.toString(),(e,t)=>e.isEqual(t))}let i3=new rh(ei.comparator);function i6(){return i3}let i9=new rm(ei.comparator);function i5(...e){let t=i9;for(let r of e)t=t.add(r);return t}let i7=new rm(K);function i8(){return i7}function se(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:rq(t)?"-0":t}}function st(e){return{integerValue:""+e}}function sr(e,t){return rG(t)?st(t):se(e,t)}class sn{constructor(){this._=void 0}}function si(e,t,r){return e instanceof sl?rP(r,t):e instanceof su?sc(e,t):e instanceof sh?sd(e,t):sf(e,t)}function ss(e,t,r){return e instanceof su?sc(e,t):e instanceof sh?sd(e,t):r}function sa(e,t){return e instanceof sp?nv(t)?t:{integerValue:0}:null}function so(e,t){return e instanceof su&&t instanceof su||e instanceof sh&&t instanceof sh?J(e.elements,t.elements,rX):e instanceof sp&&t instanceof sp?rX(e.operand,t.operand):e instanceof sl&&t instanceof sl}class sl extends sn{}class su extends sn{constructor(e){super(),this.elements=e}}function sc(e,t){let r=sg(t);for(let t of e.elements)r.some(e=>rX(e,t))||r.push(t);return{arrayValue:{values:r}}}class sh extends sn{constructor(e){super(),this.elements=e}}function sd(e,t){let r=sg(t);for(let t of e.elements)r=r.filter(e=>!rX(e,t));return{arrayValue:{values:r}}}class sp extends sn{constructor(e,t){super(),this.serializer=e,this.operand=t}}function sf(e,t){let r=sa(e,t),n=sm(r)+sm(e.operand);return ng(r)&&ng(e.operand)?st(n):se(e.serializer,n)}function sm(e){return rR(e.integerValue||e.doubleValue)}function sg(e){return nb(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class sy{constructor(e,t){this.field=e,this.transform=t}}function sv(e,t){return e.field.isEqual(t.field)&&so(e.transform,t.transform)}function sb(e,t){return void 0===e&&void 0===t||!!e&&!!t&&J(e,t,(e,t)=>sv(e,t))}class sT{constructor(e,t){this.version=e,this.transformResults=t}}class sS{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new sS}static exists(e){return new sS(void 0,e)}static updateTime(e){return new sS(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function sE(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class sw{}function sC(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new sB(e.key,sS.none()):new sk(e.key,e.data,sS.none());{let r=e.data,n=nD.empty(),i=new rm(en.comparator);for(let e of t.fields)if(!i.has(e)){let t=r.field(e);null===t&&e.length>1&&(e=e.popLast(),t=r.field(e)),null===t?n.delete(e):n.set(e,t),i=i.add(e)}return new sO(e.key,n,new rb(i.toArray()),sS.none())}}function s_(e,t,r){e instanceof sk?sA(e,t,r):e instanceof sO?sx(e,t,r):sU(e,t,r)}function sI(e,t,r,n){return e instanceof sk?sD(e,t,r,n):e instanceof sO?sP(e,t,r,n):sV(e,t,r)}function sR(e,t){let r=null;for(let n of e.fieldTransforms){let e=t.data.field(n.field),i=sa(n.transform,e||null);null!=i&&(null===r&&(r=nD.empty()),r.set(n.field,i))}return r||null}function sN(e,t){return!!(e.type===t.type&&e.key.isEqual(t.key)&&e.precondition.isEqual(t.precondition)&&sb(e.fieldTransforms,t.fieldTransforms))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class sk extends sw{constructor(e,t,r,n=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=n,this.type=0}getFieldMask(){return null}}function sA(e,t,r){let n=e.value.clone(),i=sL(e.fieldTransforms,t,r.transformResults);n.setAll(i),t.convertToFoundDocument(r.version,n).setHasCommittedMutations()}function sD(e,t,r,n){if(!sE(e.precondition,t))return r;let i=e.value.clone(),s=sF(e.fieldTransforms,n,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}class sO extends sw{constructor(e,t,r,n,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=n,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function sx(e,t,r){if(!sE(e.precondition,t)){t.convertToUnknownDocument(r.version);return}let n=sL(e.fieldTransforms,t,r.transformResults),i=t.data;i.setAll(sM(e)),i.setAll(n),t.convertToFoundDocument(r.version,i).setHasCommittedMutations()}function sP(e,t,r,n){if(!sE(e.precondition,t))return r;let i=sF(e.fieldTransforms,n,t),s=t.data;return(s.setAll(sM(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===r)?null:r.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}function sM(e){let t=new Map;return e.fieldMask.fields.forEach(r=>{if(!r.isEmpty()){let n=e.data.field(r);t.set(r,n)}}),t}function sL(e,t,r){let n=new Map;D(e.length===r.length,32656,{serverTransformResultCount:r.length,fieldTransformCount:e.length});for(let i=0;i<r.length;i++){let s=e[i],a=s.transform,o=t.data.field(s.field);n.set(s.field,ss(a,o,r[i]))}return n}function sF(e,t,r){let n=new Map;for(let i of e){let e=i.transform,s=r.data.field(i.field);n.set(i.field,si(e,s,t))}return n}class sB extends sw{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}function sU(e,t,r){t.convertToNoDocument(r.version).setHasCommittedMutations()}function sV(e,t,r){return sE(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):r}class sj extends sw{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class sz{constructor(e,t,r,n){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=n}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let t=0;t<this.mutations.length;t++){let n=this.mutations[t];n.key.isEqual(e.key)&&s_(n,e,r[t])}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=sI(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=sI(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=i2();return this.mutations.forEach(n=>{let i=e.get(n.key),s=i.overlayedDocument,a=this.applyToLocalView(s,i.mutatedFields),o=sC(s,a=t.has(n.key)?null:a);null!==o&&r.set(n.key,o),s.isValidDocument()||s.convertToNoDocument(ev.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),i5())}isEqual(e){return this.batchId===e.batchId&&J(this.mutations,e.mutations,(e,t)=>sN(e,t))&&J(this.baseMutations,e.baseMutations,(e,t)=>sN(e,t))}}class sq{constructor(e,t,r,n){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=n}static from(e,t,r){D(e.mutations.length===r.length,58842,{mutationsSent:e.mutations.length,resultsReceived:r.length});let n=i6(),i=e.mutations;for(let e=0;e<i.length;e++)n=n.insert(i[e].key,r[e].version);return new sq(e,t,r,n)}}class sG{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class s${constructor(e,t){this.count=e,this.unchangedNames=t}}function sK(e){switch(e){case x.OK:return k(64938);case x.CANCELLED:case x.UNKNOWN:case x.DEADLINE_EXCEEDED:case x.RESOURCE_EXHAUSTED:case x.INTERNAL:case x.UNAVAILABLE:case x.UNAUTHENTICATED:return!1;case x.INVALID_ARGUMENT:case x.NOT_FOUND:case x.ALREADY_EXISTS:case x.PERMISSION_DENIED:case x.FAILED_PRECONDITION:case x.ABORTED:case x.OUT_OF_RANGE:case x.UNIMPLEMENTED:case x.DATA_LOSS:return!0;default:return k(15467,{code:e})}}function sW(e){return sK(e)&&e!==x.ABORTED}function sH(e){if(void 0===e)return I("GRPC error has no .code"),x.UNKNOWN;switch(e){case s.OK:return x.OK;case s.CANCELLED:return x.CANCELLED;case s.UNKNOWN:return x.UNKNOWN;case s.DEADLINE_EXCEEDED:return x.DEADLINE_EXCEEDED;case s.RESOURCE_EXHAUSTED:return x.RESOURCE_EXHAUSTED;case s.INTERNAL:return x.INTERNAL;case s.UNAVAILABLE:return x.UNAVAILABLE;case s.UNAUTHENTICATED:return x.UNAUTHENTICATED;case s.INVALID_ARGUMENT:return x.INVALID_ARGUMENT;case s.NOT_FOUND:return x.NOT_FOUND;case s.ALREADY_EXISTS:return x.ALREADY_EXISTS;case s.PERMISSION_DENIED:return x.PERMISSION_DENIED;case s.FAILED_PRECONDITION:return x.FAILED_PRECONDITION;case s.ABORTED:return x.ABORTED;case s.OUT_OF_RANGE:return x.OUT_OF_RANGE;case s.UNIMPLEMENTED:return x.UNIMPLEMENTED;case s.DATA_LOSS:return x.DATA_LOSS;default:return k(39323,{code:e})}}!function(e){e[e.OK=0]="OK",e[e.CANCELLED=1]="CANCELLED",e[e.UNKNOWN=2]="UNKNOWN",e[e.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",e[e.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",e[e.NOT_FOUND=5]="NOT_FOUND",e[e.ALREADY_EXISTS=6]="ALREADY_EXISTS",e[e.PERMISSION_DENIED=7]="PERMISSION_DENIED",e[e.UNAUTHENTICATED=16]="UNAUTHENTICATED",e[e.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",e[e.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",e[e.ABORTED=10]="ABORTED",e[e.OUT_OF_RANGE=11]="OUT_OF_RANGE",e[e.UNIMPLEMENTED=12]="UNIMPLEMENTED",e[e.INTERNAL=13]="INTERNAL",e[e.UNAVAILABLE=14]="UNAVAILABLE",e[e.DATA_LOSS=15]="DATA_LOSS"}(s||(s={}));class sQ extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}let sY=null;function sJ(){return new c.TextEncoder}function sX(){return new TextDecoder("utf-8")}let sZ=new n([4294967295,4294967295],0);function s0(e){let t=sJ().encode(e),r=new i;return r.update(t),new Uint8Array(r.digest())}function s1(e){let t=new DataView(e.buffer),r=t.getUint32(0,!0),i=t.getUint32(4,!0),s=t.getUint32(8,!0),a=t.getUint32(12,!0);return[new n([r,i],0),new n([s,a],0)]}class s2{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new s4(`Invalid padding: ${t}`);if(r<0||e.length>0&&0===this.hashCount)throw new s4(`Invalid hash count: ${r}`);if(0===e.length&&0!==t)throw new s4(`Invalid padding when bitmap length is 0: ${t}`);this.bitCount=8*e.length-t,this.bitCountInInteger=n.fromNumber(this.bitCount)}getBitIndex(e,t,r){let i=e.add(t.multiply(n.fromNumber(r)));return 1===i.compare(sZ)&&(i=new n([i.getBits(0),i.getBits(1)],0)),i.modulo(this.bitCountInInteger).toNumber()}isBitSet(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(0===this.bitCount)return!1;let[t,r]=s1(s0(e));for(let e=0;e<this.hashCount;e++){let n=this.getBitIndex(t,r,e);if(!this.isBitSet(n))return!1}return!0}static create(e,t,r){let n=e%8==0?0:8-e%8,i=new s2(new Uint8Array(Math.ceil(e/8)),n,t);return r.forEach(e=>i.insert(e)),i}insert(e){if(0===this.bitCount)return;let[t,r]=s1(s0(e));for(let e=0;e<this.hashCount;e++){let n=this.getBitIndex(t,r,e);this.setBit(n)}}setBit(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class s4 extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class s3{constructor(e,t,r,n,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=n,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let n=new Map;return n.set(e,s6.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new s3(ev.min(),n,new rh(K),iY(),i5())}}class s6{constructor(e,t,r,n,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=n,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new s6(r,t,i5(),i5(),i5())}}class s9{constructor(e,t,r,n){this.updatedTargetIds=e,this.removedTargetIds=t,this.key=r,this.newDoc=n}}class s5{constructor(e,t){this.targetId=e,this.existenceFilter=t}}class s7{constructor(e,t,r=rE.EMPTY_BYTE_STRING,n=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=n}}class s8{constructor(){this.pendingResponses=0,this.documentChanges=an(),this._resumeToken=rE.EMPTY_BYTE_STRING,this._current=!1,this._hasPendingChanges=!0}get current(){return this._current}get resumeToken(){return this._resumeToken}get isPending(){return 0!==this.pendingResponses}get hasPendingChanges(){return this._hasPendingChanges}updateResumeToken(e){e.approximateByteSize()>0&&(this._hasPendingChanges=!0,this._resumeToken=e)}toTargetChange(){let e=i5(),t=i5(),r=i5();return this.documentChanges.forEach((n,i)=>{switch(i){case 0:e=e.add(n);break;case 2:t=t.add(n);break;case 1:r=r.add(n);break;default:k(38017,{changeType:i})}}),new s6(this._resumeToken,this._current,e,t,r)}clearPendingChanges(){this._hasPendingChanges=!1,this.documentChanges=an()}addDocumentChange(e,t){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(e,t)}removeDocumentChange(e){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(e)}recordPendingTargetRequest(){this.pendingResponses+=1}recordTargetResponse(){this.pendingResponses-=1,D(this.pendingResponses>=0,3241,{pendingResponses:this.pendingResponses})}markCurrent(){this._hasPendingChanges=!0,this._current=!0}}let ae="WatchChangeAggregator";class at{constructor(e){this.metadataProvider=e,this.targetStates=new Map,this.pendingDocumentUpdates=iY(),this.pendingDocumentUpdatesByTarget=ar(),this.pendingDocumentTargetMapping=ar(),this.pendingTargetResets=new rh(K)}handleDocumentChange(e){for(let t of e.updatedTargetIds)e.newDoc&&e.newDoc.isFoundDocument()?this.addDocumentToTarget(t,e.newDoc):this.removeDocumentFromTarget(t,e.key,e.newDoc);for(let t of e.removedTargetIds)this.removeDocumentFromTarget(t,e.key,e.newDoc)}handleTargetChange(e){this.forEachTarget(e,t=>{let r=this.ensureTargetState(t);switch(e.state){case 0:this.isActiveTarget(t)&&r.updateResumeToken(e.resumeToken);break;case 1:r.recordTargetResponse(),r.isPending||r.clearPendingChanges(),r.updateResumeToken(e.resumeToken);break;case 2:r.recordTargetResponse(),r.isPending||this.removeTarget(t);break;case 3:this.isActiveTarget(t)&&(r.markCurrent(),r.updateResumeToken(e.resumeToken));break;case 4:this.isActiveTarget(t)&&(this.resetTarget(t),r.updateResumeToken(e.resumeToken));break;default:k(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.targetStates.forEach((e,r)=>{this.isActiveTarget(r)&&t(r)})}handleExistenceFilter(e){let t=e.targetId,r=e.existenceFilter.count,n=this.targetDataForActiveTarget(t);if(n){let i=n.target;if(iu(i)){if(0===r){let e=new ei(i.path);this.removeDocumentFromTarget(t,e,nx.newNoDocument(e,ev.min()))}else D(1===r,20013,{expectedCount:r})}else{let n=this.getCurrentDocumentCountForTarget(t);if(n!==r){let r=this.parseBloomFilter(e),i=r?this.applyBloomFilter(r,e,n):1;if(0!==i){this.resetTarget(t);let e=2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.pendingTargetResets=this.pendingTargetResets.insert(t,e)}sY?.notifyOnExistenceFilterMismatch(ai(n,e.existenceFilter,this.metadataProvider.getDatabaseId(),r,i))}}}}parseBloomFilter(e){let t,r;let n=e.existenceFilter.unchangedNames;if(!n||!n.bits)return null;let{bits:{bitmap:i="",padding:s=0},hashCount:a=0}=n;try{t=rN(i).toUint8Array()}catch(e){if(e instanceof sQ)return R("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{r=new s2(t,s,a)}catch(e){return e instanceof s4?R("BloomFilter error: ",e):R("Applying bloom filter failed: ",e),null}return 0===r.bitCount?null:r}applyBloomFilter(e,t,r){return t.existenceFilter.count===r-this.filterRemovedDocuments(e,t.targetId)?0:2}filterRemovedDocuments(e,t){let r=this.metadataProvider.getRemoteKeysForTarget(t),n=0;return r.forEach(r=>{let i=this.metadataProvider.getDatabaseId(),s=`projects/${i.projectId}/databases/${i.database}/documents/${r.path.canonicalString()}`;!e.mightContain(s)&&(this.removeDocumentFromTarget(t,r,null),n++)}),n}createRemoteEvent(e){let t=new Map;this.targetStates.forEach((r,n)=>{let i=this.targetDataForActiveTarget(n);if(i){if(r.current&&iu(i.target)){let t=new ei(i.target.path);this.ensureDocumentUpdateByTarget(t).has(n)||this.targetContainsDocument(n,t)||this.removeDocumentFromTarget(n,t,nx.newNoDocument(t,e))}r.hasPendingChanges&&(t.set(n,r.toTargetChange()),r.clearPendingChanges())}});let r=i5();this.pendingDocumentTargetMapping.forEach((e,t)=>{let n=!0;t.forEachWhile(e=>{let t=this.targetDataForActiveTarget(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(n=!1,!1)}),n&&(r=r.add(e))}),this.pendingDocumentUpdates.forEach((t,r)=>r.setReadTime(e));let n=new s3(e,t,this.pendingTargetResets,this.pendingDocumentUpdates,r);return this.pendingDocumentUpdates=iY(),this.pendingDocumentUpdatesByTarget=ar(),this.pendingDocumentTargetMapping=ar(),this.pendingTargetResets=new rh(K),n}addDocumentToTarget(e,t){if(!this.isActiveTarget(e))return;let r=this.targetContainsDocument(e,t.key)?2:0;this.ensureTargetState(e).addDocumentChange(t.key,r),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t.key,t),this.pendingDocumentUpdatesByTarget=this.pendingDocumentUpdatesByTarget.insert(t.key,this.ensureDocumentUpdateByTarget(t.key).add(e)),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t.key,this.ensureDocumentTargetMapping(t.key).add(e))}removeDocumentFromTarget(e,t,r){if(!this.isActiveTarget(e))return;let n=this.ensureTargetState(e);this.targetContainsDocument(e,t)?n.addDocumentChange(t,1):n.removeDocumentChange(t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,this.ensureDocumentTargetMapping(t).delete(e)),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,this.ensureDocumentTargetMapping(t).add(e)),r&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t,r))}removeTarget(e){this.targetStates.delete(e)}getCurrentDocumentCountForTarget(e){let t=this.ensureTargetState(e).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}recordPendingTargetRequest(e){this.ensureTargetState(e).recordPendingTargetRequest()}ensureTargetState(e){let t=this.targetStates.get(e);return t||(t=new s8,this.targetStates.set(e,t)),t}ensureDocumentTargetMapping(e){let t=this.pendingDocumentTargetMapping.get(e);return t||(t=new rm(K),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e,t)),t}ensureDocumentUpdateByTarget(e){let t=this.pendingDocumentUpdatesByTarget.get(e);return t||(t=new rm(K),this.pendingDocumentUpdatesByTarget=this.pendingDocumentUpdatesByTarget.insert(e,t)),t}isActiveTarget(e){let t=null!==this.targetDataForActiveTarget(e);return t||_(ae,"Detected inactive target",e),t}targetDataForActiveTarget(e){let t=this.targetStates.get(e);return t&&t.isPending?null:this.metadataProvider.getTargetDataForTarget(e)}resetTarget(e){this.targetStates.set(e,new s8),this.metadataProvider.getRemoteKeysForTarget(e).forEach(t=>{this.removeDocumentFromTarget(e,t,null)})}targetContainsDocument(e,t){return this.metadataProvider.getRemoteKeysForTarget(e).has(t)}}function ar(){return new rh(ei.comparator)}function an(){return new rh(ei.comparator)}function ai(e,t,r,n,i){let s={localCacheCount:e,existenceFilterCount:t.count,databaseId:r.database,projectId:r.projectId},a=t.unchangedNames;return a&&(s.bloomFilter={applied:0===i,hashCount:a?.hashCount??0,bitmapLength:a?.bits?.bitmap?.length??0,padding:a?.bits?.padding??0,mightContain:e=>n?.mightContain(e)??!1}),s}let as=(()=>{let e={};return e.asc="ASCENDING",e.desc="DESCENDING",e})(),aa=(()=>{let e={};return e["<"]="LESS_THAN",e["<="]="LESS_THAN_OR_EQUAL",e[">"]="GREATER_THAN",e[">="]="GREATER_THAN_OR_EQUAL",e["=="]="EQUAL",e["!="]="NOT_EQUAL",e["array-contains"]="ARRAY_CONTAINS",e.in="IN",e["not-in"]="NOT_IN",e["array-contains-any"]="ARRAY_CONTAINS_ANY",e})(),ao=(()=>{let e={};return e.and="AND",e.or="OR",e})();class al{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function au(e){return new P(void 0===e.code?x.UNKNOWN:sH(e.code),e.message||"")}function ac(e,t){return e.useProto3Json||rz(t)?t:{value:t}}function ah(e){let t;return rz(t="object"==typeof e?e.value:e)?null:t}function ad(e,t){if(!e.useProto3Json)return{seconds:""+t.seconds,nanos:t.nanoseconds};{let e=new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z",""),r=("000000000"+t.nanoseconds).slice(-9);return`${e}.${r}Z`}}function ap(e){let t=rI(e);return new ey(t.seconds,t.nanos)}function af(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function am(e,t){return e.useProto3Json?(D(void 0===t||"string"==typeof t,58123),rE.fromBase64String(t||"")):(D(void 0===t||t instanceof Buffer||t instanceof Uint8Array,16193),rE.fromUint8Array(t||new Uint8Array))}function ag(e,t){return ad(e,t.toTimestamp())}function ay(e){return D(!!e,49232),ev.fromTimestamp(ap(e))}function av(e,t){return ab(e,t).canonicalString()}function ab(e,t){let r=aI(e).child("documents");return void 0===t?r:r.child(t)}function aT(e){let t=et.fromString(e);return D(oy(t),10190,{key:t.toString()}),t}function aS(e,t){return av(e.databaseId,t.path)}function aE(e,t){let r=aT(t);if(r.get(1)!==e.databaseId.projectId)throw new P(x.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+r.get(1)+" vs "+e.databaseId.projectId);if(r.get(3)!==e.databaseId.database)throw new P(x.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+r.get(3)+" vs "+e.databaseId.database);return new ei(aR(r))}function aw(e,t){return av(e.databaseId,t)}function aC(e){let t=aT(e);return 4===t.length?et.emptyPath():aR(t)}function a_(e){return new et(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function aI(e){return new et(["projects",e.projectId,"databases",e.database])}function aR(e){return D(e.length>4&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function aN(e,t,r){return{name:aS(e,t),fields:r.value.mapValue.fields}}function ak(e,t){return{name:aS(e,t.key),fields:t.data.value.mapValue.fields,updateTime:ad(e,t.version.toTimestamp()),createTime:ad(e,t.createTime.toTimestamp())}}function aA(e,t,r){let n=aE(e,t.name),i=ay(t.updateTime),s=t.createTime?ay(t.createTime):ev.min(),a=new nD({mapValue:{fields:t.fields}}),o=nx.newFoundDocument(n,i,s,a);return r&&o.setHasCommittedMutations(),r?o.setHasCommittedMutations():o}function aD(e,t){D(!!t.found,43571),t.found.name,t.found.updateTime;let r=aE(e,t.found.name),n=ay(t.found.updateTime),i=t.found.createTime?ay(t.found.createTime):ev.min(),s=new nD({mapValue:{fields:t.found.fields}});return nx.newFoundDocument(r,n,i,s)}function aO(e,t){D(!!t.missing,3894),D(!!t.readTime,22933);let r=aE(e,t.missing),n=ay(t.readTime);return nx.newNoDocument(r,n)}function ax(e,t){return"found"in t?aD(e,t):"missing"in t?aO(e,t):k(7234,{result:t})}function aP(e,t){let r;if("targetChange"in t){t.targetChange;let n=aM(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],s=am(e,t.targetChange.resumeToken),a=t.targetChange.cause;r=new s7(n,i,s,a&&au(a)||null)}else if("documentChange"in t){t.documentChange;let n=t.documentChange;n.document,n.document.name,n.document.updateTime;let i=aE(e,n.document.name),s=ay(n.document.updateTime),a=n.document.createTime?ay(n.document.createTime):ev.min(),o=new nD({mapValue:{fields:n.document.fields}}),l=nx.newFoundDocument(i,s,a,o);r=new s9(n.targetIds||[],n.removedTargetIds||[],l.key,l)}else if("documentDelete"in t){t.documentDelete;let n=t.documentDelete;n.document;let i=aE(e,n.document),s=n.readTime?ay(n.readTime):ev.min(),a=nx.newNoDocument(i,s);r=new s9([],n.removedTargetIds||[],a.key,a)}else if("documentRemove"in t){t.documentRemove;let n=t.documentRemove;n.document;let i=aE(e,n.document);r=new s9([],n.removedTargetIds||[],i,null)}else{if(!("filter"in t))return k(11601,{change:t});t.filter;let e=t.filter;e.targetId;let{count:n=0,unchangedNames:i}=e,s=new s$(n,i);r=new s5(e.targetId,s)}return r}function aM(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:k(39313,{state:e})}function aL(e){if(!("targetChange"in e))return ev.min();let t=e.targetChange;return t.targetIds&&t.targetIds.length||!t.readTime?ev.min():ay(t.readTime)}function aF(e,t){let r;if(t instanceof sk)r={update:aN(e,t.key,t.value)};else if(t instanceof sB)r={delete:aS(e,t.key)};else if(t instanceof sO)r={update:aN(e,t.key,t.data),updateMask:om(t.fieldMask)};else{if(!(t instanceof sj))return k(16599,{mutationType:t.type});r={verify:aS(e,t.key)}}return t.fieldTransforms.length>0&&(r.updateTransforms=t.fieldTransforms.map(t=>aq(e,t))),t.precondition.isNone||(r.currentDocument=aU(e,t.precondition)),r}function aB(e,t){let r=t.currentDocument?aV(t.currentDocument):sS.none(),n=t.updateTransforms?t.updateTransforms.map(t=>aG(e,t)):[];if(t.update){t.update.name;let i=aE(e,t.update.name),s=new nD({mapValue:{fields:t.update.fields}});return t.updateMask?new sO(i,s,og(t.updateMask),r,n):new sk(i,s,r,n)}return t.delete?new sB(aE(e,t.delete),r):t.verify?new sj(aE(e,t.verify),r):k(1463,{proto:t})}function aU(e,t){return void 0!==t.updateTime?{updateTime:ag(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:k(27497)}function aV(e){return void 0!==e.updateTime?sS.updateTime(ay(e.updateTime)):void 0!==e.exists?sS.exists(e.exists):sS.none()}function aj(e,t){let r=e.updateTime?ay(e.updateTime):ay(t);return r.isEqual(ev.min())&&(r=ay(t)),new sT(r,e.transformResults||[])}function az(e,t){return e&&e.length>0?(D(void 0!==t,14353),e.map(e=>aj(e,t))):[]}function aq(e,t){let r=t.transform;if(r instanceof sl)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(r instanceof su)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:r.elements}};if(r instanceof sh)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:r.elements}};if(r instanceof sp)return{fieldPath:t.field.canonicalString(),increment:r.operand};throw k(20930,{transform:t.transform})}function aG(e,t){let r=null;return"setToServerValue"in t?(D("REQUEST_TIME"===t.setToServerValue,16630,{proto:t}),r=new sl):"appendMissingElements"in t?r=new su(t.appendMissingElements.values||[]):"removeAllFromArray"in t?r=new sh(t.removeAllFromArray.values||[]):"increment"in t?r=new sp(e,t.increment):k(16584,{proto:t}),new sy(en.fromServerFormat(t.fieldPath),r)}function a$(e,t){return{documents:[aw(e,t.path)]}}function aK(e){let t=e.documents.length;return D(1===t,1966,{count:t}),ik(iE(aC(e.documents[0])))}function aW(e,t){let r;let n={structuredQuery:{}},i=t.path;null!==t.collectionGroup?(r=i,n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(r=i.popLast(),n.structuredQuery.from=[{collectionId:i.lastSegment()}]),n.parent=aw(e,r);let s=a0(t.filters);s&&(n.structuredQuery.where=s);let a=a4(t.orderBy);a&&(n.structuredQuery.orderBy=a);let o=ac(e,t.limit);return null!==o&&(n.structuredQuery.limit=o),t.startAt&&(n.structuredQuery.startAt=a6(t.startAt)),t.endAt&&(n.structuredQuery.endAt=a9(t.endAt)),{queryTarget:n,parent:r}}function aH(e,t,r,n){let{queryTarget:i,parent:s}=aW(e,t),a={},o=[],l=0;return r.forEach(e=>{let t=n?e.alias:`aggregate_${l++}`;a[t]=e.alias,"count"===e.aggregateType?o.push({alias:t,count:{}}):"avg"===e.aggregateType?o.push({alias:t,avg:{field:os(e.fieldPath)}}):"sum"===e.aggregateType&&o.push({alias:t,sum:{field:os(e.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:o,structuredQuery:i.structuredQuery},parent:i.parent},aliasMap:a,parent:s}}function aQ(e){let t=aC(e.parent),r=e.structuredQuery,n=r.from?r.from.length:0,i=null;if(n>0){D(1===n,65062);let e=r.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let s=[];r.where&&(s=a1(r.where));let a=[];r.orderBy&&(a=a3(r.orderBy));let o=null;r.limit&&(o=ah(r.limit));let l=null;r.startAt&&(l=a5(r.startAt));let u=null;return r.endAt&&(u=a7(r.endAt)),iS(t,i,a,s,o,"F",l,u)}function aY(e){return ik(aQ(e))}function aJ(e,t){let r=aX(t.purpose);return null==r?null:{"goog-listen-tags":r}}function aX(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return k(28987,{purpose:e})}}function aZ(e,t){let r;let n=t.target;if((r=iu(n)?{documents:a$(e,n)}:{query:aW(e,n).queryTarget}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0){r.resumeToken=af(e,t.resumeToken);let n=ac(e,t.expectedCount);null!==n&&(r.expectedCount=n)}else if(t.snapshotVersion.compareTo(ev.min())>0){r.readTime=ad(e,t.snapshotVersion.toTimestamp());let n=ac(e,t.expectedCount);null!==n&&(r.expectedCount=n)}return r}function a0(e){if(0!==e.length)return ou(nK.create(e,"and"))}function a1(e){let t=a2(e);return t instanceof nK&&nQ(t)?t.getFilters():[t]}function a2(e){return void 0!==e.unaryFilter?od(e):void 0!==e.fieldFilter?op(e):void 0!==e.compositeFilter?of(e):k(30097,{filter:e})}function a4(e){if(0!==e.length)return e.map(e=>oo(e))}function a3(e){return e.map(e=>ol(e))}function a6(e){return{before:e.inclusive,values:e.position}}function a9(e){return{before:!e.inclusive,values:e.position}}function a5(e){let t=!!e.before;return new nM(e.values||[],t)}function a7(e){let t=!e.before;return new nM(e.values||[],t)}function a8(e){return as[e]}function oe(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}function ot(e){return aa[e]}function or(e){return ao[e]}function on(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return k(58110);default:return k(50506)}}function oi(e){switch(e){case"AND":return"and";case"OR":return"or";default:return k(1026)}}function os(e){return{fieldPath:e.canonicalString()}}function oa(e){return en.fromServerFormat(e.fieldPath)}function oo(e){return{field:os(e.field),direction:a8(e.dir)}}function ol(e){return new nV(oa(e.field),oe(e.direction))}function ou(e){return e instanceof n$?oh(e):e instanceof nK?oc(e):k(54877,{filter:e})}function oc(e){let t=e.getFilters().map(e=>ou(e));return 1===t.length?t[0]:{compositeFilter:{op:or(e.op),filters:t}}}function oh(e){if("=="===e.op){if(nS(e.value))return{unaryFilter:{field:os(e.field),op:"IS_NAN"}};if(nT(e.value))return{unaryFilter:{field:os(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(nS(e.value))return{unaryFilter:{field:os(e.field),op:"IS_NOT_NAN"}};if(nT(e.value))return{unaryFilter:{field:os(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:os(e.field),op:ot(e.op),value:e.value}}}function od(e){switch(e.unaryFilter.op){case"IS_NAN":let t=oa(e.unaryFilter.field);return n$.create(t,"==",{doubleValue:NaN});case"IS_NULL":let r=oa(e.unaryFilter.field);return n$.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let n=oa(e.unaryFilter.field);return n$.create(n,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let i=oa(e.unaryFilter.field);return n$.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return k(61313);default:return k(60726)}}function op(e){return n$.create(oa(e.fieldFilter.field),on(e.fieldFilter.op),e.fieldFilter.value)}function of(e){return nK.create(e.compositeFilter.filters.map(e=>a2(e)),oi(e.compositeFilter.op))}function om(e){let t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function og(e){return new rb((e.fieldPaths||[]).map(e=>en.fromServerFormat(e)))}function oy(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class ov{constructor(e,t,r,n,i=ev.min(),s=ev.min(),a=rE.EMPTY_BYTE_STRING,o=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=n,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=a,this.expectedCount=o}withSequenceNumber(e){return new ov(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new ov(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new ov(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new ov(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class ob{constructor(e){this.remoteSerializer=e}}function oT(e,t){let r;if(t.document)r=aA(e.remoteSerializer,t.document,!!t.hasCommittedMutations);else if(t.noDocument){let e=ei.fromSegments(t.noDocument.path),n=o_(t.noDocument.readTime);r=nx.newNoDocument(e,n),t.hasCommittedMutations&&r.setHasCommittedMutations()}else{if(!t.unknownDocument)return k(56709);let e=ei.fromSegments(t.unknownDocument.path),n=o_(t.unknownDocument.version);r=nx.newUnknownDocument(e,n)}return t.readTime&&r.setReadTime(ow(t.readTime)),r}function oS(e,t){let r=t.key,n={prefixPath:r.getCollectionPath().popLast().toArray(),collectionGroup:r.collectionGroup,documentId:r.path.lastSegment(),readTime:oE(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())n.document=ak(e.remoteSerializer,t);else if(t.isNoDocument())n.noDocument={path:r.path.toArray(),readTime:oC(t.version)};else{if(!t.isUnknownDocument())return k(57904,{document:t});n.unknownDocument={path:r.path.toArray(),version:oC(t.version)}}return n}function oE(e){let t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function ow(e){let t=new ey(e[0],e[1]);return ev.fromTimestamp(t)}function oC(e){let t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function o_(e){let t=new ey(e.seconds,e.nanoseconds);return ev.fromTimestamp(t)}function oI(e,t,r){let n=r.baseMutations.map(t=>aF(e.remoteSerializer,t)),i=r.mutations.map(t=>aF(e.remoteSerializer,t));return{userId:t,batchId:r.batchId,localWriteTimeMs:r.localWriteTime.toMillis(),baseMutations:n,mutations:i}}function oR(e,t){let r=(t.baseMutations||[]).map(t=>aB(e.remoteSerializer,t));for(let e=0;e<t.mutations.length-1;++e){let r=t.mutations[e];if(e+1<t.mutations.length&&void 0!==t.mutations[e+1].transform){let n=t.mutations[e+1];r.updateTransforms=n.transform.fieldTransforms,t.mutations.splice(e+1,1),++e}}let n=t.mutations.map(t=>aB(e.remoteSerializer,t)),i=ey.fromMillis(t.localWriteTimeMs);return new sz(t.batchId,i,r,n)}function oN(e){let t;let r=o_(e.readTime),n=void 0!==e.lastLimboFreeSnapshotVersion?o_(e.lastLimboFreeSnapshotVersion):ev.min();return new ov(t=oA(e.query)?aK(e.query):aY(e.query),e.targetId,"TargetPurposeListen",e.lastListenSequenceNumber,r,n,rE.fromBase64String(e.resumeToken))}function ok(e,t){let r;let n=oC(t.snapshotVersion),i=oC(t.lastLimboFreeSnapshotVersion);r=iu(t.target)?a$(e.remoteSerializer,t.target):aW(e.remoteSerializer,t.target).queryTarget;let s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:ia(t.target),readTime:n,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:i,query:r}}function oA(e){return void 0!==e.documents}function oD(e){return{id:e.bundleId,createTime:o_(e.createTime),version:e.version}}function oO(e){return{bundleId:e.id,createTime:oC(ay(e.createTime)),version:e.version}}function ox(e){return{name:e.name,query:oM(e.bundledQuery),readTime:o_(e.readTime)}}function oP(e){return{name:e.name,readTime:oC(ay(e.readTime)),bundledQuery:e.bundledQuery}}function oM(e){let t=aQ({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?iP(t,t.limit,"L"):t}function oL(e){return{name:e.name,query:oM(e.bundledQuery),readTime:ay(e.readTime)}}function oF(e){return{id:e.id,version:e.version,createTime:ay(e.createTime)}}function oB(e,t){return new sG(t.largestBatchId,aB(e.remoteSerializer,t.overlayMutation))}function oU(e,t,r){let[n,i,s]=oV(t,r.mutation.key);return{userId:t,collectionPath:i,documentId:s,collectionGroup:r.mutation.key.getCollectionGroup(),largestBatchId:r.largestBatchId,overlayMutation:aF(e.remoteSerializer,r.mutation)}}function oV(e,t){let r=t.path.lastSegment();return[e,e5(t.path.popLast()),r]}function oj(e){return{indexId:e.indexId,collectionGroup:e.collectionGroup,fields:e.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])}}function oz(e,t){let r=t?new ek(t.sequenceNumber,new eO(o_(t.readTime),new ei(te(t.documentKey)),t.largestBatchId)):ek.empty(),n=e.fields.map(([e,t])=>new eR(en.fromServerFormat(e),t));return new eS(e.indexId,e.collectionGroup,n,r)}function oq(e,t,r,n){return{indexId:e,uid:t,sequenceNumber:r,readTime:oC(n.readTime),documentKey:e5(n.documentKey.path),largestBatchId:n.largestBatchId}}class oG{getBundleMetadata(e,t){return o$(e).get(t).next(e=>{if(e)return oD(e)})}saveBundleMetadata(e,t){return o$(e).put(oO(t))}getNamedQuery(e,t){return oK(e).get(t).next(e=>{if(e)return ox(e)})}saveNamedQuery(e,t){return oK(e).put(oP(t))}}function o$(e){return ro(e,tF)}function oK(e){return ro(e,tU)}class oW{constructor(e,t){this.serializer=e,this.userId=t}static forUser(e,t){return new oW(e,t.uid||"")}getOverlay(e,t){return oH(e).get(oV(this.userId,t)).next(e=>e?oB(this.serializer,e):null)}getOverlays(e,t){let r=i1();return eF.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&r.set(t,e)})).next(()=>r)}saveOverlays(e,t,r){let n=[];return r.forEach((r,i)=>{let s=new sG(t,i);n.push(this.saveOverlay(e,s))}),eF.waitFor(n)}removeOverlaysForBatchId(e,t,r){let n=new Set;t.forEach(e=>n.add(e5(e.getCollectionPath())));let i=[];return n.forEach(t=>{let n=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,r+1],!1,!0);i.push(oH(e).deleteAll(t1,n))}),eF.waitFor(i)}getOverlaysForCollection(e,t,r){let n=i1(),i=e5(t),s=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,Number.POSITIVE_INFINITY],!0);return oH(e).loadAll(t1,s).next(e=>{for(let t of e){let e=oB(this.serializer,t);n.set(e.getKey(),e)}return n})}getOverlaysForCollectionGroup(e,t,r,n){let i;let s=i1(),a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return oH(e).iterate({index:t4,range:a},(e,t,r)=>{let a=oB(this.serializer,t);s.size()<n||a.largestBatchId===i?(s.set(a.getKey(),a),i=a.largestBatchId):r.done()}).next(()=>s)}saveOverlay(e,t){return oH(e).put(oU(this.serializer,this.userId,t))}}function oH(e){return ro(e,tZ)}class oQ{globalsStore(e){return ro(e,t6)}getSessionToken(e){return this.globalsStore(e).get("sessionToken").next(e=>{let t=e?.value;return t?rE.fromUint8Array(t):rE.EMPTY_BYTE_STRING})}setSessionToken(e,t){return this.globalsStore(e).put({name:"sessionToken",value:t.toUint8Array()})}}let oY=5,oJ=10,oX=13,oZ=15,o0=20,o1=25,o2=30,o4=37,o3=45,o6=50,o9=53,o5=55,o7=60,o8=2;class le{constructor(){}writeIndexValue(e,t){this.writeIndexValueAux(e,t),t.writeInfinity()}writeIndexValueAux(e,t){if("nullValue"in e)this.writeValueTypeLabel(t,oY);else if("booleanValue"in e)this.writeValueTypeLabel(t,oJ),t.writeNumber(e.booleanValue?1:0);else if("integerValue"in e)this.writeValueTypeLabel(t,oZ),t.writeNumber(rR(e.integerValue));else if("doubleValue"in e){let r=rR(e.doubleValue);isNaN(r)?this.writeValueTypeLabel(t,oX):(this.writeValueTypeLabel(t,oZ),rq(r)?t.writeNumber(0):t.writeNumber(r))}else if("timestampValue"in e){let r=e.timestampValue;this.writeValueTypeLabel(t,o0),"string"==typeof r&&(r=rI(r)),t.writeString(`${r.seconds||""}`),t.writeNumber(r.nanos||0)}else if("stringValue"in e)this.writeIndexString(e.stringValue,t),this.writeTruncationMarker(t);else if("bytesValue"in e)this.writeValueTypeLabel(t,o2),t.writeBytes(rN(e.bytesValue)),this.writeTruncationMarker(t);else if("referenceValue"in e)this.writeIndexEntityRef(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.writeValueTypeLabel(t,o3),t.writeNumber(r.latitude||0),t.writeNumber(r.longitude||0)}else"mapValue"in e?n_(e)?this.writeValueTypeLabel(t,Number.MAX_SAFE_INTEGER):nw(e)?this.writeIndexVector(e.mapValue,t):(this.writeIndexMap(e.mapValue,t),this.writeTruncationMarker(t)):"arrayValue"in e?(this.writeIndexArray(e.arrayValue,t),this.writeTruncationMarker(t)):k(19022,{indexValue:e})}writeIndexString(e,t){this.writeValueTypeLabel(t,o1),this.writeUnlabeledIndexString(e,t)}writeUnlabeledIndexString(e,t){t.writeString(e)}writeIndexMap(e,t){let r=e.fields||{};for(let e of(this.writeValueTypeLabel(t,o5),Object.keys(r)))this.writeIndexString(e,t),this.writeIndexValueAux(r[e],t)}writeIndexVector(e,t){let r=e.fields||{};this.writeValueTypeLabel(t,o9);let n=rQ,i=r[n].arrayValue?.values?.length||0;this.writeValueTypeLabel(t,oZ),t.writeNumber(rR(i)),this.writeIndexString(n,t),this.writeIndexValueAux(r[n],t)}writeIndexArray(e,t){let r=e.values||[];for(let e of(this.writeValueTypeLabel(t,o6),r))this.writeIndexValueAux(e,t)}writeIndexEntityRef(e,t){this.writeValueTypeLabel(t,o4),ei.fromName(e).path.forEach(e=>{this.writeValueTypeLabel(t,o7),this.writeUnlabeledIndexString(e,t)})}writeValueTypeLabel(e,t){e.writeNumber(t)}writeTruncationMarker(e){e.writeNumber(o8)}}le.INSTANCE=new le;let lt="\uD800",lr="\uDBFF",ln=0,li=255,ls=1,la=255,lo=255,ll=0,lu=64,lc=8,lh=1024;function ld(e){let t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}function lp(e){if(0===e)return 8;let t=0;return e>>4==0&&(t+=4,e<<=4),e>>6==0&&(t+=2,e<<=2),e>>7==0&&(t+=1),t}function lf(e){let t=0;for(let r=0;r<8;++r){let n=lp(255&e[r]);if(t+=n,8!==n)break}return t}function lm(e){return Math.ceil((lu-lf(e))/lc)}class lg{constructor(){this.buffer=new Uint8Array(lh),this.position=0}writeBytesAscending(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.writeByteAscending(r.value),r=t.next();this.writeSeparatorAscending()}writeBytesDescending(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.writeByteDescending(r.value),r=t.next();this.writeSeparatorDescending()}writeUtf8Ascending(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.writeByteAscending(e);else if(e<2048)this.writeByteAscending(960|e>>>6),this.writeByteAscending(128|63&e);else if(t<lt||lr<t)this.writeByteAscending(480|e>>>12),this.writeByteAscending(128|63&e>>>6),this.writeByteAscending(128|63&e);else{let e=t.codePointAt(0);this.writeByteAscending(240|e>>>18),this.writeByteAscending(128|63&e>>>12),this.writeByteAscending(128|63&e>>>6),this.writeByteAscending(128|63&e)}}this.writeSeparatorAscending()}writeUtf8Descending(e){for(let t of e){let e=t.charCodeAt(0);if(e<128)this.writeByteDescending(e);else if(e<2048)this.writeByteDescending(960|e>>>6),this.writeByteDescending(128|63&e);else if(t<lt||lr<t)this.writeByteDescending(480|e>>>12),this.writeByteDescending(128|63&e>>>6),this.writeByteDescending(128|63&e);else{let e=t.codePointAt(0);this.writeByteDescending(240|e>>>18),this.writeByteDescending(128|63&e>>>12),this.writeByteDescending(128|63&e>>>6),this.writeByteDescending(128|63&e)}}this.writeSeparatorDescending()}writeNumberAscending(e){let t=this.toOrderedBits(e),r=lm(t);this.ensureAvailable(1+r),this.buffer[this.position++]=255&r;for(let e=t.length-r;e<t.length;++e)this.buffer[this.position++]=255&t[e]}writeNumberDescending(e){let t=this.toOrderedBits(e),r=lm(t);this.ensureAvailable(1+r),this.buffer[this.position++]=~(255&r);for(let e=t.length-r;e<t.length;++e)this.buffer[this.position++]=~(255&t[e])}writeInfinityAscending(){this.writeEscapedByteAscending(la),this.writeEscapedByteAscending(lo)}writeInfinityDescending(){this.writeEscapedByteDescending(la),this.writeEscapedByteDescending(lo)}reset(){this.position=0}seed(e){this.ensureAvailable(e.length),this.buffer.set(e,this.position),this.position+=e.length}encodedBytes(){return this.buffer.slice(0,this.position)}toOrderedBits(e){let t=ld(e),r=(128&t[0])!=0;t[0]^=r?255:128;for(let e=1;e<t.length;++e)t[e]^=r?255:0;return t}writeByteAscending(e){let t=255&e;t===ln?(this.writeEscapedByteAscending(ln),this.writeEscapedByteAscending(li)):t===la?(this.writeEscapedByteAscending(la),this.writeEscapedByteAscending(ll)):this.writeEscapedByteAscending(t)}writeByteDescending(e){let t=255&e;t===ln?(this.writeEscapedByteDescending(ln),this.writeEscapedByteDescending(li)):t===la?(this.writeEscapedByteDescending(la),this.writeEscapedByteDescending(ll)):this.writeEscapedByteDescending(e)}writeSeparatorAscending(){this.writeEscapedByteAscending(ln),this.writeEscapedByteAscending(ls)}writeSeparatorDescending(){this.writeEscapedByteDescending(ln),this.writeEscapedByteDescending(ls)}writeEscapedByteAscending(e){this.ensureAvailable(1),this.buffer[this.position++]=e}writeEscapedByteDescending(e){this.ensureAvailable(1),this.buffer[this.position++]=~e}ensureAvailable(e){let t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);let n=new Uint8Array(r);n.set(this.buffer),this.buffer=n}}class ly{constructor(e){this.orderedCode=e}writeBytes(e){this.orderedCode.writeBytesAscending(e)}writeString(e){this.orderedCode.writeUtf8Ascending(e)}writeNumber(e){this.orderedCode.writeNumberAscending(e)}writeInfinity(){this.orderedCode.writeInfinityAscending()}}class lv{constructor(e){this.orderedCode=e}writeBytes(e){this.orderedCode.writeBytesDescending(e)}writeString(e){this.orderedCode.writeUtf8Descending(e)}writeNumber(e){this.orderedCode.writeNumberDescending(e)}writeInfinity(){this.orderedCode.writeInfinityDescending()}}class lb{constructor(){this.orderedCode=new lg,this.ascending=new ly(this.orderedCode),this.descending=new lv(this.orderedCode)}seed(e){this.orderedCode.seed(e)}forKind(e){return 0===e?this.ascending:this.descending}encodedBytes(){return this.orderedCode.encodedBytes()}reset(){this.orderedCode.reset()}}class lT{constructor(e,t,r,n){this._indexId=e,this._documentKey=t,this._arrayValue=r,this._directionalValue=n}successor(){let e=this._directionalValue.length,t=0===e||255===this._directionalValue[e-1]?e+1:e,r=new Uint8Array(t);return r.set(this._directionalValue,0),t!==e?r.set([0],this._directionalValue.length):++r[r.length-1],new lT(this._indexId,this._documentKey,this._arrayValue,r)}dbIndexEntry(e,t,r){return{indexId:this._indexId,uid:e,arrayValue:lw(this._arrayValue),directionalValue:lw(this._directionalValue),orderedDocumentKey:lw(t),documentKey:r.path.toArray()}}dbIndexEntryKey(e,t,r){let n=this.dbIndexEntry(e,t,r);return[n.indexId,n.uid,n.arrayValue,n.directionalValue,n.orderedDocumentKey,n.documentKey]}}function lS(e,t){let r=e._indexId-t._indexId;return 0!==r||0!==(r=lE(e._arrayValue,t._arrayValue))||0!==(r=lE(e._directionalValue,t._directionalValue))?r:ei.comparator(e._documentKey,t._documentKey)}function lE(e,t){for(let r=0;r<e.length&&r<t.length;++r){let n=e[r]-t[r];if(0!==n)return n}return e.length-t.length}function lw(e){return(0,h.WO)()?l_(e):e}function lC(e){return"string"!=typeof e?e:lI(e)}function l_(e){let t="";for(let r=0;r<e.length;r++)t+=String.fromCharCode(e[r]);return t}function lI(e){let t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}class lR{constructor(e){for(let t of(this.inequalityFilters=new rm((e,t)=>en.comparator(e.field,t.field)),this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.orderBys=e.orderBy,this.equalityFilters=[],e.filters)){let e=t;e.isInequality()?this.inequalityFilters=this.inequalityFilters.add(e):this.equalityFilters.push(e)}}get hasMultipleInequality(){return this.inequalityFilters.size>1}servedByIndex(e){if(D(e.collectionGroup===this.collectionId,49279),this.hasMultipleInequality)return!1;let t=eE(e);if(void 0!==t&&!this.hasMatchingEqualityFilter(t))return!1;let r=ew(e),n=new Set,i=0,s=0;for(;i<r.length;++i)if(this.hasMatchingEqualityFilter(r[i]))n=n.add(r[i].fieldPath.canonicalString());else break;if(i===r.length)return!0;if(this.inequalityFilters.size>0){let e=this.inequalityFilters.getIterator().getNext();if(!n.has(e.field.canonicalString())){let t=r[i];if(!this.matchesFilter(e,t)||!this.matchesOrderBy(this.orderBys[s++],t))return!1}++i}for(;i<r.length;++i){let e=r[i];if(s>=this.orderBys.length||!this.matchesOrderBy(this.orderBys[s++],e))return!1}return!0}buildTargetIndex(){if(this.hasMultipleInequality)return null;let e=new rm(en.comparator),t=[];for(let r of this.equalityFilters)if(!r.field.isKeyField()){if("array-contains"===r.op||"array-contains-any"===r.op)t.push(new eR(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new eR(r.field,0))}}for(let r of this.orderBys)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new eR(r.field,"asc"===r.dir?0:1)));return new eS(eS.UNKNOWN_ID,this.collectionId,t,ek.empty())}hasMatchingEqualityFilter(e){for(let t of this.equalityFilters)if(this.matchesFilter(t,e))return!0;return!1}matchesFilter(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;let r="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===r}matchesOrderBy(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function lN(e){if(D(e instanceof n$||e instanceof nK,20012),e instanceof n$){if(!(e instanceof ie))return e;{let t=e.value.arrayValue?.values?.map(t=>n$.create(e.field,"==",t))||[];return nK.create(t,"or")}}let t=e.filters.map(e=>lN(e));return nK.create(t,e.op)}function lk(e){if(0===e.getFilters().length)return[];let t=lP(lN(e));return(D(lO(t),7391),lA(t)||lD(t))?[t]:t.getFilters()}function lA(e){return e instanceof n$}function lD(e){return e instanceof nK&&nQ(e)}function lO(e){return lA(e)||lD(e)||lx(e)}function lx(e){if(e instanceof nK&&nH(e)){for(let t of e.getFilters())if(!lA(t)&&!lD(t))return!1;return!0}return!1}function lP(e){if(D(e instanceof n$||e instanceof nK,34018),e instanceof n$)return e;if(1===e.filters.length)return lP(e.filters[0]);let t=e.filters.map(e=>lP(e)),r=nK.create(t,e.op);return lO(r=lU(r))?r:(D(r instanceof nK,64498),D(nW(r),40251),D(r.filters.length>1,57927),r.filters.reduce((e,t)=>lM(e,t)))}function lM(e,t){let r;return D(e instanceof n$||e instanceof nK,38388),D(t instanceof n$||t instanceof nK,25473),lU(r=e instanceof n$?t instanceof n$?lL(e,t):lB(e,t):t instanceof n$?lB(t,e):lF(e,t))}function lL(e,t){return nK.create([e,t],"and")}function lF(e,t){if(D(e.filters.length>0&&t.filters.length>0,48005),nW(e)&&nW(t))return n1(e,t.getFilters());let r=nH(e)?e:t,n=nH(e)?t:e,i=r.filters.map(e=>lM(e,n));return nK.create(i,"or")}function lB(e,t){if(nW(t))return n1(t,e.getFilters());{let r=t.filters.map(t=>lM(e,t));return nK.create(r,"or")}}function lU(e){if(D(e instanceof n$||e instanceof nK,11850),e instanceof n$)return e;let t=e.getFilters();if(1===t.length)return lU(t[0]);if(nY(e))return e;let r=t.map(e=>lU(e)),n=[];return(r.forEach(t=>{t instanceof n$?n.push(t):t instanceof nK&&(t.op===e.op?n.push(...t.filters):n.push(t))}),1===n.length)?n[0]:nK.create(n,e.op)}class lV{constructor(){this.collectionParentIndex=new lj}addToCollectionParentIndex(e,t){return this.collectionParentIndex.add(t),eF.resolve()}getCollectionParents(e,t){return eF.resolve(this.collectionParentIndex.getEntries(t))}addFieldIndex(e,t){return eF.resolve()}deleteFieldIndex(e,t){return eF.resolve()}deleteAllFieldIndexes(e){return eF.resolve()}createTargetIndexes(e,t){return eF.resolve()}getDocumentsMatchingTarget(e,t){return eF.resolve(null)}getIndexType(e,t){return eF.resolve(0)}getFieldIndexes(e,t){return eF.resolve([])}getNextCollectionGroupToUpdate(e){return eF.resolve(null)}getMinOffset(e,t){return eF.resolve(eO.min())}getMinOffsetFromCollectionGroup(e,t){return eF.resolve(eO.min())}updateCollectionGroup(e,t,r){return eF.resolve()}updateIndexEntries(e,t){return eF.resolve()}}class lj{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),n=this.index[t]||new rm(et.comparator),i=!n.has(r);return this.index[t]=n.add(r),i}has(e){let t=e.lastSegment(),r=e.popLast(),n=this.index[t];return n&&n.has(r)}getEntries(e){return(this.index[e]||new rm(et.comparator)).toArray()}}let lz="IndexedDbIndexManager",lq=new Uint8Array(0);class lG{constructor(e,t){this.databaseId=t,this.collectionParentsCache=new lj,this.targetToDnfSubTargets=new iH(e=>ia(e),(e,t)=>il(e,t)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.collectionParentsCache.has(t)){let r=t.lastSegment(),n=t.popLast();e.addOnCommittedListener(()=>{this.collectionParentsCache.add(t)});let i={collectionId:r,parent:e5(n)};return l$(e).put(i)}return eF.resolve()}getCollectionParents(e,t){let r=[],n=IDBKeyRange.bound([t,""],[X(t),""],!1,!0);return l$(e).loadAll(n).next(e=>{for(let n of e){if(n.collectionId!==t)break;r.push(te(n.parent))}return r})}addFieldIndex(e,t){let r=lW(e),n=oj(t);delete n.indexId;let i=r.add(n);if(!t.indexState)return i.next();{let r=lH(e);return i.next(e=>{r.put(oq(e,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}}deleteFieldIndex(e,t){let r=lW(e),n=lH(e),i=lK(e);return r.delete(t.indexId).next(()=>n.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=lW(e),r=lK(e),n=lH(e);return t.deleteAll().next(()=>r.deleteAll()).next(()=>n.deleteAll())}createTargetIndexes(e,t){return eF.forEach(this.getSubTargets(t),t=>this.getIndexType(e,t).next(r=>{if(0===r||1===r){let r=new lR(t).buildTargetIndex();if(null!=r)return this.addFieldIndex(e,r)}}))}getDocumentsMatchingTarget(e,t){let r=lK(e),n=!0,i=new Map;return eF.forEach(this.getSubTargets(t),t=>this.getFieldIndex(e,t).next(e=>{n&&(n=!!e),i.set(t,e)})).next(()=>{if(!n)return eF.resolve(null);{let e=i5(),n=[];return eF.forEach(i,(i,s)=>{_(lz,`Using index ${eI(i)} to execute ${ia(t)}`);let a=ih(s,i),o=id(s,i),l=ip(s,i),u=im(s,i),c=this.encodeBound(i,s,l),h=this.encodeBound(i,s,u),d=this.encodeValues(i,s,o),p=this.generateIndexRanges(i.indexId,a,c,l.inclusive,h,u.inclusive,d);return eF.forEach(p,i=>r.loadFirst(i,t.limit).next(t=>{t.forEach(t=>{let r=ei.fromSegments(t.documentKey);e.has(r)||(e=e.add(r),n.push(r))})}))}).next(()=>n)}})}getSubTargets(e){let t=this.targetToDnfSubTargets.get(e);return t||(t=0===e.filters.length?[e]:lk(nK.create(e.filters,"and")).map(t=>is(e.path,e.collectionGroup,e.orderBy,t.getFilters(),e.limit,e.startAt,e.endAt)),this.targetToDnfSubTargets.set(e,t)),t}generateIndexRanges(e,t,r,n,i,s,a){let o=(null!=t?t.length:1)*Math.max(r.length,i.length),l=o/(null!=t?t.length:1),u=[];for(let c=0;c<o;++c){let o=t?this.encodeSingleElement(t[c/l]):lq,h=this.generateLowerBound(e,o,r[c%l],n),d=this.generateUpperBound(e,o,i[c%l],s),p=a.map(t=>this.generateLowerBound(e,o,t,!0));u.push(...this.createRange(h,d,p))}return u}generateLowerBound(e,t,r,n){let i=new lT(e,ei.empty(),t,r);return n?i:i.successor()}generateUpperBound(e,t,r,n){let i=new lT(e,ei.empty(),t,r);return n?i.successor():i}getFieldIndex(e,t){let r=new lR(t),n=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,n).next(e=>{let t=null;for(let n of e)r.servedByIndex(n)&&(!t||n.fields.length>t.fields.length)&&(t=n);return t})}getIndexType(e,t){let r=2,n=this.getSubTargets(t);return eF.forEach(n,t=>this.getFieldIndex(e,t).next(e=>{e?0!==r&&e.fields.length<iv(t)&&(r=1):r=0})).next(()=>ib(t)&&n.length>1&&2===r?1:r)}encodeDirectionalElements(e,t){let r=new lb;for(let n of ew(e)){let e=t.data.field(n.fieldPath);if(null==e)return null;let i=r.forKind(n.kind);le.INSTANCE.writeIndexValue(e,i)}return r.encodedBytes()}encodeSingleElement(e){let t=new lb;return le.INSTANCE.writeIndexValue(e,t.forKind(0)),t.encodedBytes()}encodeDirectionalKey(e,t){let r=new lb;return le.INSTANCE.writeIndexValue(nm(this.databaseId,t),r.forKind(eC(e))),r.encodedBytes()}encodeValues(e,t,r){if(null===r)return[];let n=[];n.push(new lb);let i=0;for(let s of ew(e)){let e=r[i++];for(let r of n)if(this.isInFilter(t,s.fieldPath)&&nb(e))n=this.expandIndexValues(n,s,e);else{let t=r.forKind(s.kind);le.INSTANCE.writeIndexValue(e,t)}}return this.getEncodedBytes(n)}encodeBound(e,t,r){return this.encodeValues(e,t,r.position)}getEncodedBytes(e){let t=[];for(let r=0;r<e.length;++r)t[r]=e[r].encodedBytes();return t}expandIndexValues(e,t,r){let n=[...e],i=[];for(let e of r.arrayValue.values||[])for(let r of n){let n=new lb;n.seed(r.encodedBytes()),le.INSTANCE.writeIndexValue(e,n.forKind(t.kind)),i.push(n)}return i}isInFilter(e,t){return!!e.filters.find(e=>e instanceof n$&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op))}getFieldIndexes(e,t){let r=lW(e),n=lH(e);return(t?r.loadAll(tq,IDBKeyRange.bound(t,t)):r.loadAll()).next(e=>{let t=[];return eF.forEach(e,e=>n.get([e.indexId,this.uid]).next(r=>{t.push(oz(e,r))})).next(()=>t)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(e=>0===e.length?null:(e.sort((e,t)=>{let r=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==r?r:K(e.collectionGroup,t.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(e,t,r){let n=lW(e),i=lH(e);return this.getNextSequenceNumber(e).next(e=>n.loadAll(tq,IDBKeyRange.bound(t,t)).next(t=>eF.forEach(t,t=>i.put(oq(t.indexId,this.uid,e,r)))))}updateIndexEntries(e,t){let r=new Map;return eF.forEach(t,(t,n)=>{let i=r.get(t.collectionGroup);return(i?eF.resolve(i):this.getFieldIndexes(e,t.collectionGroup)).next(i=>(r.set(t.collectionGroup,i),eF.forEach(i,r=>this.getExistingIndexEntries(e,t,r).next(t=>{let i=this.computeIndexEntries(n,r);return t.isEqual(i)?eF.resolve():this.updateEntries(e,n,r,t,i)}))))})}addIndexEntry(e,t,r,n){return lK(e).put(n.dbIndexEntry(this.uid,this.encodeDirectionalKey(r,t.key),t.key))}deleteIndexEntry(e,t,r,n){return lK(e).delete(n.dbIndexEntryKey(this.uid,this.encodeDirectionalKey(r,t.key),t.key))}getExistingIndexEntries(e,t,r){let n=lK(e),i=new rm(lS);return n.iterate({index:tJ,range:IDBKeyRange.only([r.indexId,this.uid,lw(this.encodeDirectionalKey(r,t))])},(e,n)=>{i=i.add(new lT(r.indexId,t,lC(n.arrayValue),lC(n.directionalValue)))}).next(()=>i)}computeIndexEntries(e,t){let r=new rm(lS),n=this.encodeDirectionalElements(t,e);if(null==n)return r;let i=eE(t);if(null!=i){let s=e.data.field(i.fieldPath);if(nb(s))for(let i of s.arrayValue.values||[])r=r.add(new lT(t.indexId,e.key,this.encodeSingleElement(i),n))}else r=r.add(new lT(t.indexId,e.key,lq,n));return r}updateEntries(e,t,r,n,i){_(lz,"Updating index entries for document '%s'",t.key);let s=[];return ry(n,i,lS,n=>{s.push(this.addIndexEntry(e,t,r,n))},n=>{s.push(this.deleteIndexEntry(e,t,r,n))}),eF.waitFor(s)}getNextSequenceNumber(e){let t=1;return lH(e).iterate({index:tW,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(e,r,n)=>{n.done(),t=r.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((e,t)=>lS(e,t)).filter((e,t,r)=>!t||0!==lS(e,r[t-1]));let n=[];for(let i of(n.push(e),r)){let r=lS(i,e),s=lS(i,t);if(0===r)n[0]=e.successor();else if(r>0&&s<0)n.push(i),n.push(i.successor());else if(s>0)break}n.push(t);let i=[];for(let e=0;e<n.length;e+=2){if(this.isRangeMatchable(n[e],n[e+1]))return[];let t=n[e].dbIndexEntryKey(this.uid,lq,ei.empty()),r=n[e+1].dbIndexEntryKey(this.uid,lq,ei.empty());i.push(IDBKeyRange.bound(t,r))}return i}isRangeMatchable(e,t){return lS(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(lQ)}getMinOffset(e,t){return eF.mapArray(this.getSubTargets(t),t=>this.getFieldIndex(e,t).next(e=>e||k(44426))).next(lQ)}}function l$(e){return ro(e,tx)}function lK(e){return ro(e,tQ)}function lW(e){return ro(e,tj)}function lH(e){return ro(e,t$)}function lQ(e){D(0!==e.length,28825);let t=e[0].indexState.offset,r=t.largestBatchId;for(let n=1;n<e.length;n++){let i=e[n].indexState.offset;0>ex(i,t)&&(t=i),r<i.largestBatchId&&(r=i.largestBatchId)}return new eO(t.readTime,t.documentKey,r)}function lY(e,t,r){let n=e.store(ta),i=e.store(tf),s=[],a=IDBKeyRange.only(r.batchId),o=0,l=n.iterate({range:a},(e,t,r)=>(o++,r.delete()));s.push(l.next(()=>{D(1===o,47070,{batchId:r.batchId})}));let u=[];for(let e of r.mutations){let n=td(t,e.key.path,r.batchId);s.push(i.delete(n)),u.push(e.key)}return eF.waitFor(s).next(()=>u)}function lJ(e){let t;if(!e)return 0;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else if(e.noDocument)t=e.noDocument;else throw k(14731);return JSON.stringify(t).length}class lX{constructor(e,t,r,n){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=n,this.documentKeysByBatchId={}}static forUser(e,t,r,n){return D(""!==e.uid,64387),new lX(e.isAuthenticated()?e.uid:"",t,r,n)}checkEmpty(e){let t=!0,r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return l1(e).iterate({index:tl,range:r},(e,r,n)=>{t=!1,n.done()}).next(()=>t)}addMutationBatch(e,t,r,n){let i=l2(e),s=l1(e);return s.add({}).next(a=>{D("number"==typeof a,49019);let o=new sz(a,t,r,n),l=oI(this.serializer,this.userId,o),u=[],c=new rm((e,t)=>K(e.canonicalString(),t.canonicalString()));for(let e of n){let t=td(this.userId,e.key.path,a);c=c.add(e.key.path.popLast()),u.push(s.put(l)),u.push(i.put(t,tp))}return c.forEach(t=>{u.push(this.indexManager.addToCollectionParentIndex(e,t))}),e.addOnCommittedListener(()=>{this.documentKeysByBatchId[a]=o.keys()}),eF.waitFor(u).next(()=>o)})}lookupMutationBatch(e,t){return l1(e).get(t).next(e=>e?(D(e.userId===this.userId,48,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),oR(this.serializer,e)):null)}lookupMutationKeys(e,t){return this.documentKeysByBatchId[t]?eF.resolve(this.documentKeysByBatchId[t]):this.lookupMutationBatch(e,t).next(e=>{if(!e)return null;{let r=e.keys();return this.documentKeysByBatchId[t]=r,r}})}getNextMutationBatchAfterBatchId(e,t){let r=t+1,n=IDBKeyRange.lowerBound([this.userId,r]),i=null;return l1(e).iterate({index:tl,range:n},(e,t,n)=>{t.userId===this.userId&&(D(t.batchId>=r,47524,{nextBatchId:r}),i=oR(this.serializer,t)),n.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=rj;return l1(e).iterate({index:tl,range:t,reverse:!0},(e,t,n)=>{r=t.batchId,n.done()}).next(()=>r)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,rj],[this.userId,Number.POSITIVE_INFINITY]);return l1(e).loadAll(tl,t).next(e=>e.map(e=>oR(this.serializer,e)))}getAllMutationBatchesAffectingDocumentKey(e,t){let r=th(this.userId,t.path),n=IDBKeyRange.lowerBound(r),i=[];return l2(e).iterate({range:n},(r,n,s)=>{let[a,o,l]=r,u=te(o);if(a!==this.userId||!t.path.isEqual(u)){s.done();return}return l1(e).get(l).next(e=>{if(!e)throw k(61480,{indexKey:r,batchId:l});D(e.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:e.userId,batchId:l}),i.push(oR(this.serializer,e))})}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new rm(K),n=[];return t.forEach(t=>{let i=th(this.userId,t.path),s=IDBKeyRange.lowerBound(i),a=l2(e).iterate({range:s},(e,n,i)=>{let[s,a,o]=e,l=te(a);if(s!==this.userId||!t.path.isEqual(l)){i.done();return}r=r.add(o)});n.push(a)}),eF.waitFor(n).next(()=>this.lookupMutationBatches(e,r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,n=r.length+1,i=th(this.userId,r),s=IDBKeyRange.lowerBound(i),a=new rm(K);return l2(e).iterate({range:s},(e,t,i)=>{let[s,o,l]=e,u=te(o);if(s!==this.userId||!r.isPrefixOf(u)){i.done();return}u.length===n&&(a=a.add(l))}).next(()=>this.lookupMutationBatches(e,a))}lookupMutationBatches(e,t){let r=[],n=[];return t.forEach(t=>{n.push(l1(e).get(t).next(e=>{if(null===e)throw k(35274,{batchId:t});D(e.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:e.userId,batchId:t}),r.push(oR(this.serializer,e))}))}),eF.waitFor(n).next(()=>r)}removeMutationBatch(e,t){return lY(e.simpleDbTransaction,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.removeCachedMutationKeys(t.batchId)}),eF.forEach(r,t=>this.referenceDelegate.markPotentiallyOrphaned(e,t))))}removeCachedMutationKeys(e){delete this.documentKeysByBatchId[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return eF.resolve();let r=IDBKeyRange.lowerBound(tc(this.userId)),n=[];return l2(e).iterate({range:r},(e,t,r)=>{if(e[0]!==this.userId){r.done();return}{let t=te(e[1]);n.push(t)}}).next(()=>{D(0===n.length,56720,{danglingKeys:n.map(e=>e.canonicalString())})})})}containsKey(e,t){return lZ(e,this.userId,t)}getMutationQueueMetadata(e){return l4(e).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:rj,lastStreamToken:""})}}function lZ(e,t,r){let n=th(t,r.path),i=n[1],s=IDBKeyRange.lowerBound(n),a=!1;return l2(e).iterate({range:s,keysOnly:!0},(e,r,n)=>{let[s,o,l]=e;s===t&&o===i&&(a=!0),n.done()}).next(()=>a)}function l0(e,t){let r=!1;return l4(e).iterateSerial(n=>lZ(e,n,t).next(e=>(e&&(r=!0),eF.resolve(!e)))).next(()=>r)}function l1(e){return ro(e,ta)}function l2(e){return ro(e,tf)}function l4(e){return ro(e,ti)}let l3=2;class l6{constructor(e){this.lastId=e}next(){return this.lastId+=l3,this.lastId}static forTargetCache(){return new l6(2-l3)}static forSyncEngine(){return new l6(1-l3)}}class l9{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.retrieveMetadata(e).next(t=>{let r=new l6(t.highestTargetId);return t.highestTargetId=r.next(),this.saveMetadata(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.retrieveMetadata(e).next(e=>ev.fromTimestamp(new ey(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.retrieveMetadata(e).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.retrieveMetadata(e).next(n=>(n.highestListenSequenceNumber=t,r&&(n.lastRemoteSnapshotVersion=r.toTimestamp()),t>n.highestListenSequenceNumber&&(n.highestListenSequenceNumber=t),this.saveMetadata(e,n)))}addTargetData(e,t){return this.saveTargetData(e,t).next(()=>this.retrieveMetadata(e).next(r=>(r.targetCount+=1,this.updateMetadataFromTargetData(t,r),this.saveMetadata(e,r))))}updateTargetData(e,t){return this.saveTargetData(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>l5(e).delete(t.targetId)).next(()=>this.retrieveMetadata(e)).next(t=>(D(t.targetCount>0,8065),t.targetCount-=1,this.saveMetadata(e,t)))}removeTargets(e,t,r){let n=0,i=[];return l5(e).iterate((s,a)=>{let o=oN(a);o.sequenceNumber<=t&&null===r.get(o.targetId)&&(n++,i.push(this.removeTargetData(e,o)))}).next(()=>eF.waitFor(i)).next(()=>n)}forEachTarget(e,t){return l5(e).iterate((e,r)=>{t(oN(r))})}retrieveMetadata(e){return l7(e).get(tD).next(e=>(D(null!==e,2888),e))}saveMetadata(e,t){return l7(e).put(tD,t)}saveTargetData(e,t){return l5(e).put(ok(this.serializer,t))}updateMetadataFromTargetData(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.retrieveMetadata(e).next(e=>e.targetCount)}getTargetData(e,t){let r=ia(t),n=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),i=null;return l5(e).iterate({range:n,index:t_},(e,r,n)=>{let s=oN(r);il(t,s.target)&&(i=s,n.done())}).next(()=>i)}addMatchingKeys(e,t,r){let n=[],i=l8(e);return t.forEach(t=>{let s=e5(t.path);n.push(i.put({targetId:r,path:s})),n.push(this.referenceDelegate.addReference(e,r,t))}),eF.waitFor(n)}removeMatchingKeys(e,t,r){let n=l8(e);return eF.forEach(t,t=>{let i=e5(t.path);return eF.waitFor([n.delete([r,i]),this.referenceDelegate.removeReference(e,r,t)])})}removeMatchingKeysForTargetId(e,t){let r=l8(e),n=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(n)}getMatchingKeysForTargetId(e,t){let r=IDBKeyRange.bound([t],[t+1],!1,!0),n=l8(e),i=i5();return n.iterate({range:r,keysOnly:!0},(e,t,r)=>{let n=new ei(te(e[1]));i=i.add(n)}).next(()=>i)}containsKey(e,t){let r=e5(t.path),n=IDBKeyRange.bound([r],[X(r)],!1,!0),i=0;return l8(e).iterate({index:tk,keysOnly:!0,range:n},([e,t],r,n)=>{0!==e&&(i++,n.done())}).next(()=>i>0)}getTargetDataForTarget(e,t){return l5(e).get(t).next(e=>e?oN(e):null)}}function l5(e){return ro(e,tw)}function l7(e){return ro(e,tO)}function l8(e){return ro(e,tR)}let ue={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},ut=-1,ur=41943040;class un{static withCacheSize(e){return new un(e,un.DEFAULT_COLLECTION_PERCENTILE,un.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}un.DEFAULT_COLLECTION_PERCENTILE=10,un.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,un.DEFAULT=new un(ur,un.DEFAULT_COLLECTION_PERCENTILE,un.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),un.DISABLED=new un(ut,0,0);let ui="LruGarbageCollector",us=1048576,ua=6e4,uo=3e5;function ul([e,t],[r,n]){let i=K(e,r);return 0===i?K(t,n):i}class uu{constructor(e){this.maxElements=e,this.buffer=new rm(ul),this.previousIndex=0}nextIndex(){return++this.previousIndex}addElement(e){let t=[e,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(t);else{let e=this.buffer.last();0>ul(t,e)&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class uc{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.gcTask=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==ut&&this.scheduleGC(ua)}stop(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)}get started(){return null!==this.gcTask}scheduleGC(e){_(ui,`Garbage collection scheduled in ${e}ms`),this.gcTask=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.gcTask=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){e$(e)?_(ui,"Ignoring IndexedDB error during garbage collection: ",e):await eL(e)}await this.scheduleGC(uo)})}}class uh{constructor(e,t){this.delegate=e,this.params=t}calculateTargetCount(e,t){return this.delegate.getSequenceNumberCount(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return eF.resolve(e2.INVALID);let r=new uu(t);return this.delegate.forEachTarget(e,e=>r.addElement(e.sequenceNumber)).next(()=>this.delegate.forEachOrphanedDocumentSequenceNumber(e,e=>r.addElement(e))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.delegate.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.delegate.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===ut?(_("LruGarbageCollector","Garbage collection skipped; disabled"),eF.resolve(ue)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(_("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),ue):this.runGarbageCollection(e,t))}getCacheSize(e){return this.delegate.getCacheSize(e)}runGarbageCollection(e,t){let r,n,i,s,a,o,l;let c=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(_("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),n=this.params.maximumSequenceNumbersToCollect):n=t,s=Date.now(),this.nthSequenceNumber(e,n))).next(n=>(r=n,a=Date.now(),this.removeTargets(e,r,t))).next(t=>(i=t,o=Date.now(),this.removeOrphanedDocuments(e,r))).next(e=>(l=Date.now(),C()<=u.in.DEBUG&&_("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${s-c}ms
	Determined least recently used ${n} in ${a-s}ms
	Removed ${i} targets in ${o-a}ms
	Removed ${e} documents in ${l-o}ms
Total Duration: ${l-c}ms`),eF.resolve({didRun:!0,sequenceNumbersCollected:n,targetsRemoved:i,documentsRemoved:e})))}}function ud(e,t){return new uh(e,t)}class up{constructor(e,t){this.db=e,this.garbageCollector=ud(this,t)}getSequenceNumberCount(e){let t=this.orphanedDocumentCount(e);return this.db.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}orphanedDocumentCount(e){let t=0;return this.forEachOrphanedDocumentSequenceNumber(e,e=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}forEachOrphanedDocumentSequenceNumber(e,t){return this.forEachOrphanedDocument(e,(e,r)=>t(r))}addReference(e,t,r){return ug(e,r)}removeReference(e,t,r){return ug(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return ug(e,t)}isPinned(e,t){return l0(e,t)}removeOrphanedDocuments(e,t){let r=this.db.getRemoteDocumentCache().newChangeBuffer(),n=[],i=0;return this.forEachOrphanedDocument(e,(s,a)=>{if(a<=t){let t=this.isPinned(e,s).next(t=>{if(!t)return i++,r.getEntry(e,s).next(()=>(r.removeEntry(s,ev.min()),l8(e).delete(uf(s))))});n.push(t)}}).next(()=>eF.waitFor(n)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return ug(e,t)}forEachOrphanedDocument(e,t){let r;let n=l8(e),i=e2.INVALID;return n.iterate({index:tk},([e,n],{path:s,sequenceNumber:a})=>{0===e?(i!==e2.INVALID&&t(new ei(te(r)),i),i=a,r=s):i=e2.INVALID}).next(()=>{i!==e2.INVALID&&t(new ei(te(r)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function uf(e){return[0,e5(e.path)]}function um(e,t){return{targetId:0,path:e5(e.path),sequenceNumber:t}}function ug(e,t){return l8(e).put(um(t,e.currentSequenceNumber))}class uy{constructor(){this.changes=new iH(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,nx.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return void 0!==r?eF.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class uv{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return uE(e).put(r)}removeEntry(e,t,r){return uE(e).delete(uC(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.setMetadata(e,r)))}getEntry(e,t){let r=nx.newInvalidDocument(t);return uE(e).iterate({index:ty,range:IDBKeyRange.only(uw(t))},(e,n)=>{r=this.maybeDecodeDocument(t,n)}).next(()=>r)}getSizedEntry(e,t){let r={size:0,document:nx.newInvalidDocument(t)};return uE(e).iterate({index:ty,range:IDBKeyRange.only(uw(t))},(e,n)=>{r={document:this.maybeDecodeDocument(t,n),size:lJ(n)}}).next(()=>r)}getEntries(e,t){let r=iY();return this.forEachDbEntry(e,t,(e,t)=>{let n=this.maybeDecodeDocument(e,t);r=r.insert(e,n)}).next(()=>r)}getSizedEntries(e,t){let r=iY(),n=new rh(ei.comparator);return this.forEachDbEntry(e,t,(e,t)=>{let i=this.maybeDecodeDocument(e,t);r=r.insert(e,i),n=n.insert(e,lJ(t))}).next(()=>({documents:r,sizeMap:n}))}forEachDbEntry(e,t,r){if(t.isEmpty())return eF.resolve();let n=new rm(uI);t.forEach(e=>n=n.add(e));let i=IDBKeyRange.bound(uw(n.first()),uw(n.last())),s=n.getIterator(),a=s.getNext();return uE(e).iterate({index:ty,range:i},(e,t,n)=>{let i=ei.fromSegments([...t.prefixPath,t.collectionGroup,t.documentId]);for(;a&&0>uI(a,i);)r(a,null),a=s.getNext();a&&a.isEqual(i)&&(r(a,t),a=s.hasNext()?s.getNext():null),a?n.skip(uw(a)):n.done()}).next(()=>{for(;a;)r(a,null),a=s.hasNext()?s.getNext():null})}getDocumentsMatchingQuery(e,t,r,n,i){let s=t.path,a=[s.popLast().toArray(),s.lastSegment(),oE(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],o=[s.popLast().toArray(),s.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return uE(e).loadAll(IDBKeyRange.bound(a,o,!0)).next(e=>{i?.incrementDocumentReadCount(e.length);let r=iY();for(let i of e){let e=this.maybeDecodeDocument(ei.fromSegments(i.prefixPath.concat(i.collectionGroup,i.documentId)),i);e.isFoundDocument()&&(iV(t,e)||n.has(e.key))&&(r=r.insert(e.key,e))}return r})}getAllFromCollectionGroup(e,t,r,n){let i=iY(),s=u_(t,r),a=u_(t,eO.max());return uE(e).iterate({index:tb,range:IDBKeyRange.bound(s,a,!0)},(e,t,r)=>{let s=this.maybeDecodeDocument(ei.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);(i=i.insert(s.key,s)).size===n&&r.done()}).next(()=>i)}newChangeBuffer(e){return new uT(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(e=>e.byteSize)}getMetadata(e){return uS(e).get(tE).next(e=>(D(!!e,20021),e))}setMetadata(e,t){return uS(e).put(tE,t)}maybeDecodeDocument(e,t){if(t){let e=oT(this.serializer,t);if(!(e.isNoDocument()&&e.version.isEqual(ev.min())))return e}return nx.newInvalidDocument(e)}}function ub(e){return new uv(e)}class uT extends uy{constructor(e,t){super(),this.documentCache=e,this.trackRemovals=t,this.documentStates=new iH(e=>e.toString(),(e,t)=>e.isEqual(t))}applyChanges(e){let t=[],r=0,n=new rm((e,t)=>K(e.canonicalString(),t.canonicalString()));return this.changes.forEach((i,s)=>{let a=this.documentStates.get(i);if(t.push(this.documentCache.removeEntry(e,i,a.readTime)),s.isValidDocument()){let o=oS(this.documentCache.serializer,s);n=n.add(i.path.popLast());let l=lJ(o);r+=l-a.size,t.push(this.documentCache.addEntry(e,i,o))}else if(r-=a.size,this.trackRemovals){let r=oS(this.documentCache.serializer,s.convertToNoDocument(ev.min()));t.push(this.documentCache.addEntry(e,i,r))}}),n.forEach(r=>{t.push(this.documentCache.indexManager.addToCollectionParentIndex(e,r))}),t.push(this.documentCache.updateMetadata(e,r)),eF.waitFor(t)}getFromCache(e,t){return this.documentCache.getSizedEntry(e,t).next(e=>(this.documentStates.set(t,{size:e.size,readTime:e.document.readTime}),e.document))}getAllFromCache(e,t){return this.documentCache.getSizedEntries(e,t).next(({documents:e,sizeMap:t})=>(t.forEach((t,r)=>{this.documentStates.set(t,{size:r,readTime:e.get(t).readTime})}),e))}}function uS(e){return ro(e,tS)}function uE(e){return ro(e,tm)}function uw(e){let t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function uC(e,t){let r=e.path.toArray();return[r.slice(0,r.length-2),r[r.length-2],oE(t),r[r.length-1]]}function u_(e,t){let r=t.documentKey.path.toArray();return[e,oE(t.readTime),r.slice(0,r.length-2),r.length>0?r[r.length-1]:""]}function uI(e,t){let r=e.path.toArray(),n=t.path.toArray(),i=0;for(let e=0;e<r.length-2&&e<n.length-2;++e)if(i=K(r[e],n[e]))return i;return(i=K(r.length,n.length))||(i=K(r[r.length-2],n[n.length-2]))?i:K(r[r.length-1],n[n.length-1])}let uR=18;class uN{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class uk{constructor(e,t,r,n){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=n}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(n=>(r=n,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==r&&sI(r.mutation,e,rb.empty(),ey.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,i5()).next(()=>t))}getLocalViewOfDocuments(e,t,r=i5()){let n=i1();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,r).next(e=>{let t=iX();return e.forEach((e,r)=>{t=t.insert(e,r.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){let r=i1();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,i5()))}populateOverlays(e,t,r){let n=[];return r.forEach(e=>{t.has(e)||n.push(e)}),this.documentOverlayCache.getOverlays(e,n).next(e=>{e.forEach((e,r)=>{t.set(e,r)})})}computeViews(e,t,r,n){let i=iY(),s=i4(),a=iZ();return t.forEach((e,t)=>{let a=r.get(t.key);n.has(t.key)&&(void 0===a||a.mutation instanceof sO)?i=i.insert(t.key,t):void 0!==a?(s.set(t.key,a.mutation.getFieldMask()),sI(a.mutation,t,a.mutation.getFieldMask(),ey.now())):s.set(t.key,rb.empty())}),this.recalculateAndSaveOverlays(e,i).next(e=>(e.forEach((e,t)=>s.set(e,t)),t.forEach((e,t)=>a.set(e,new uN(t,s.get(e)??null))),a))}recalculateAndSaveOverlays(e,t){let r=i4(),n=new rh((e,t)=>e-t),i=i5();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(let i of e)i.keys().forEach(e=>{let s=t.get(e);if(null===s)return;let a=r.get(e)||rb.empty();a=i.applyToLocalView(s,a),r.set(e,a);let o=(n.get(i.batchId)||i5()).add(e);n=n.insert(i.batchId,o)})}).next(()=>{let s=[],a=n.getReverseIterator();for(;a.hasNext();){let n=a.getNext(),o=n.key,l=n.value,u=i2();l.forEach(e=>{if(!i.has(e)){let n=sC(t.get(e),r.get(e));null!==n&&u.set(e,n),i=i.add(e)}}),s.push(this.documentOverlayCache.saveOverlays(e,o,u))}return eF.waitFor(s)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,r,n){return iI(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):iR(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,n):this.getDocumentsMatchingCollectionQuery(e,t,r,n)}getNextDocuments(e,t,r,n){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,n).next(i=>{let s=n-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,n-i.size):eF.resolve(i1()),a=eb,o=i;return s.next(t=>eF.forEach(t,(t,r)=>(a<r.largestBatchId&&(a=r.largestBatchId),i.get(t))?eF.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{o=o.insert(t,e)})).next(()=>this.populateOverlays(e,t,i)).next(()=>this.computeViews(e,o,t,i5())).next(e=>({batchId:a,changes:i0(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new ei(t)).next(e=>{let t=iX();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,r,n){let i=t.collectionGroup,s=iX();return this.indexManager.getCollectionParents(e,i).next(a=>eF.forEach(a,a=>{let o=iw(t,a.child(i));return this.getDocumentsMatchingCollectionQuery(e,o,r,n).next(e=>{e.forEach((e,t)=>{s=s.insert(e,t)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,r,n){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,n))).next(e=>{i.forEach((t,r)=>{let n=r.getKey();null===e.get(n)&&(e=e.insert(n,nx.newInvalidDocument(n)))});let r=iX();return e.forEach((e,n)=>{let s=i.get(e);void 0!==s&&sI(s.mutation,n,rb.empty(),ey.now()),iV(t,n)&&(r=r.insert(e,n))}),r})}}class uA{constructor(e){this.serializer=e,this.bundles=new Map,this.namedQueries=new Map}getBundleMetadata(e,t){return eF.resolve(this.bundles.get(t))}saveBundleMetadata(e,t){return this.bundles.set(t.id,oF(t)),eF.resolve()}getNamedQuery(e,t){return eF.resolve(this.namedQueries.get(t))}saveNamedQuery(e,t){return this.namedQueries.set(t.name,oL(t)),eF.resolve()}}class uD{constructor(){this.overlays=new rh(ei.comparator),this.overlayByBatchId=new Map}getOverlay(e,t){return eF.resolve(this.overlays.get(t))}getOverlays(e,t){let r=i1();return eF.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&r.set(t,e)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((r,n)=>{this.saveOverlay(e,t,n)}),eF.resolve()}removeOverlaysForBatchId(e,t,r){let n=this.overlayByBatchId.get(r);return void 0!==n&&(n.forEach(e=>this.overlays=this.overlays.remove(e)),this.overlayByBatchId.delete(r)),eF.resolve()}getOverlaysForCollection(e,t,r){let n=i1(),i=t.length+1,s=new ei(t.child("")),a=this.overlays.getIteratorFrom(s);for(;a.hasNext();){let e=a.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>r&&n.set(e.getKey(),e)}return eF.resolve(n)}getOverlaysForCollectionGroup(e,t,r,n){let i=new rh((e,t)=>e-t),s=this.overlays.getIterator();for(;s.hasNext();){let e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>r){let t=i.get(e.largestBatchId);null===t&&(t=i1(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}let a=i1(),o=i.getIterator();for(;o.hasNext()&&(o.getNext().value.forEach((e,t)=>a.set(e,t)),!(a.size()>=n)););return eF.resolve(a)}saveOverlay(e,t,r){let n=this.overlays.get(r.key);if(null!==n){let e=this.overlayByBatchId.get(n.largestBatchId).delete(r.key);this.overlayByBatchId.set(n.largestBatchId,e)}this.overlays=this.overlays.insert(r.key,new sG(t,r));let i=this.overlayByBatchId.get(t);void 0===i&&(i=i5(),this.overlayByBatchId.set(t,i)),this.overlayByBatchId.set(t,i.add(r.key))}}class uO{constructor(){this.sessionToken=rE.EMPTY_BYTE_STRING}getSessionToken(e){return eF.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,eF.resolve()}}class ux{constructor(){this.refsByKey=new rm(uP.compareByKey),this.refsByTarget=new rm(uP.compareByTargetId)}isEmpty(){return this.refsByKey.isEmpty()}addReference(e,t){let r=new uP(e,t);this.refsByKey=this.refsByKey.add(r),this.refsByTarget=this.refsByTarget.add(r)}addReferences(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.removeRef(new uP(e,t))}removeReferences(e,t){e.forEach(e=>this.removeReference(e,t))}removeReferencesForId(e){let t=new ei(new et([])),r=new uP(t,e),n=new uP(t,e+1),i=[];return this.refsByTarget.forEachInRange([r,n],e=>{this.removeRef(e),i.push(e.key)}),i}removeAllReferences(){this.refsByKey.forEach(e=>this.removeRef(e))}removeRef(e){this.refsByKey=this.refsByKey.delete(e),this.refsByTarget=this.refsByTarget.delete(e)}referencesForId(e){let t=new ei(new et([])),r=new uP(t,e),n=new uP(t,e+1),i=i5();return this.refsByTarget.forEachInRange([r,n],e=>{i=i.add(e.key)}),i}containsKey(e){let t=new uP(e,0),r=this.refsByKey.firstAfterOrEqual(t);return null!==r&&e.isEqual(r.key)}}class uP{constructor(e,t){this.key=e,this.targetOrBatchId=t}static compareByKey(e,t){return ei.comparator(e.key,t.key)||K(e.targetOrBatchId,t.targetOrBatchId)}static compareByTargetId(e,t){return K(e.targetOrBatchId,t.targetOrBatchId)||ei.comparator(e.key,t.key)}}class uM{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.nextBatchId=1,this.batchesByDocumentKey=new rm(uP.compareByKey)}checkEmpty(e){return eF.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,r,n){let i=this.nextBatchId;this.nextBatchId++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let s=new sz(i,t,r,n);for(let t of(this.mutationQueue.push(s),n))this.batchesByDocumentKey=this.batchesByDocumentKey.add(new uP(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return eF.resolve(s)}lookupMutationBatch(e,t){return eF.resolve(this.findMutationBatch(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,n=this.indexOfBatchId(r),i=n<0?0:n;return eF.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return eF.resolve(0===this.mutationQueue.length?rj:this.nextBatchId-1)}getAllMutationBatches(e){return eF.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new uP(t,0),n=new uP(t,Number.POSITIVE_INFINITY),i=[];return this.batchesByDocumentKey.forEachInRange([r,n],e=>{let t=this.findMutationBatch(e.targetOrBatchId);i.push(t)}),eF.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new rm(K);return t.forEach(e=>{let t=new uP(e,0),n=new uP(e,Number.POSITIVE_INFINITY);this.batchesByDocumentKey.forEachInRange([t,n],e=>{r=r.add(e.targetOrBatchId)})}),eF.resolve(this.findMutationBatches(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,n=r.length+1,i=r;ei.isDocumentKey(i)||(i=i.child(""));let s=new uP(new ei(i),0),a=new rm(K);return this.batchesByDocumentKey.forEachWhile(e=>{let t=e.key.path;return!!r.isPrefixOf(t)&&(t.length===n&&(a=a.add(e.targetOrBatchId)),!0)},s),eF.resolve(this.findMutationBatches(a))}findMutationBatches(e){let t=[];return e.forEach(e=>{let r=this.findMutationBatch(e);null!==r&&t.push(r)}),t}removeMutationBatch(e,t){D(0===this.indexOfExistingBatchId(t.batchId,"removed"),55003),this.mutationQueue.shift();let r=this.batchesByDocumentKey;return eF.forEach(t.mutations,n=>{let i=new uP(n.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,n.key)}).next(()=>{this.batchesByDocumentKey=r})}removeCachedMutationKeys(e){}containsKey(e,t){let r=new uP(t,0),n=this.batchesByDocumentKey.firstAfterOrEqual(r);return eF.resolve(t.isEqual(n&&n.key))}performConsistencyCheck(e){return this.mutationQueue.length,eF.resolve()}indexOfExistingBatchId(e,t){return this.indexOfBatchId(e)}indexOfBatchId(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}findMutationBatch(e){let t=this.indexOfBatchId(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}let uL="-9223372036854775808";function uF(){return new rh(ei.comparator)}class uB{constructor(e){this.sizer=e,this.docs=uF(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,n=this.docs.get(r),i=n?n.size:0,s=this.sizer(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return eF.resolve(r?r.document.mutableCopy():nx.newInvalidDocument(t))}getEntries(e,t){let r=iY();return t.forEach(e=>{let t=this.docs.get(e);r=r.insert(e,t?t.document.mutableCopy():nx.newInvalidDocument(e))}),eF.resolve(r)}getDocumentsMatchingQuery(e,t,r,n){let i=iY(),s=t.path,a=new ei(s.child("__id"+uL+"__")),o=this.docs.getIteratorFrom(a);for(;o.hasNext();){let{key:e,value:{document:a}}=o.getNext();if(!s.isPrefixOf(e.path))break;!(e.path.length>s.length+1||0>=ex(eD(a),r))&&(n.has(a.key)||iV(t,a))&&(i=i.insert(a.key,a.mutableCopy()))}return eF.resolve(i)}getAllFromCollectionGroup(e,t,r,n){k(9500)}forEachDocumentKey(e,t){return eF.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new uV(this)}getSize(e){return eF.resolve(this.size)}}function uU(e){return new uB(e)}class uV extends uy{constructor(e){super(),this.documentCache=e}applyChanges(e){let t=[];return this.changes.forEach((r,n)=>{n.isValidDocument()?t.push(this.documentCache.addEntry(e,n)):this.documentCache.removeEntry(r)}),eF.waitFor(t)}getFromCache(e,t){return this.documentCache.getEntry(e,t)}getAllFromCache(e,t){return this.documentCache.getEntries(e,t)}}class uj{constructor(e){this.persistence=e,this.targets=new iH(e=>ia(e),il),this.lastRemoteSnapshotVersion=ev.min(),this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new ux,this.targetCount=0,this.targetIdGenerator=l6.forTargetCache()}forEachTarget(e,t){return this.targets.forEach((e,r)=>t(r)),eF.resolve()}getLastRemoteSnapshotVersion(e){return eF.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return eF.resolve(this.highestSequenceNumber)}allocateTargetId(e){return this.highestTargetId=this.targetIdGenerator.next(),eF.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.highestSequenceNumber&&(this.highestSequenceNumber=t),eF.resolve()}saveTargetData(e){this.targets.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.targetIdGenerator=new l6(t),this.highestTargetId=t),e.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=e.sequenceNumber)}addTargetData(e,t){return this.saveTargetData(t),this.targetCount+=1,eF.resolve()}updateTargetData(e,t){return this.saveTargetData(t),eF.resolve()}removeTargetData(e,t){return this.targets.delete(t.target),this.references.removeReferencesForId(t.targetId),this.targetCount-=1,eF.resolve()}removeTargets(e,t,r){let n=0,i=[];return this.targets.forEach((s,a)=>{a.sequenceNumber<=t&&null===r.get(a.targetId)&&(this.targets.delete(s),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),n++)}),eF.waitFor(i).next(()=>n)}getTargetCount(e){return eF.resolve(this.targetCount)}getTargetData(e,t){let r=this.targets.get(t)||null;return eF.resolve(r)}addMatchingKeys(e,t,r){return this.references.addReferences(t,r),eF.resolve()}removeMatchingKeys(e,t,r){this.references.removeReferences(t,r);let n=this.persistence.referenceDelegate,i=[];return n&&t.forEach(t=>{i.push(n.markPotentiallyOrphaned(e,t))}),eF.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this.references.removeReferencesForId(t),eF.resolve()}getMatchingKeysForTargetId(e,t){let r=this.references.referencesForId(t);return eF.resolve(r)}containsKey(e,t){return eF.resolve(this.references.containsKey(t))}}let uz="MemoryPersistence";class uq{constructor(e,t){this.mutationQueues={},this.overlays={},this.listenSequence=new e2(0),this._started=!1,this._started=!0,this.globalsCache=new uO,this.referenceDelegate=e(this),this.targetCache=new uj(this);let r=e=>this.referenceDelegate.documentSize(e);this.indexManager=new lV,this.remoteDocumentCache=uU(r),this.serializer=new ob(t),this.bundleCache=new uA(this.serializer)}start(){return Promise.resolve()}shutdown(){return this._started=!1,Promise.resolve()}get started(){return this._started}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new uD,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.mutationQueues[e.toKey()];return r||(r=new uM(t,this.referenceDelegate),this.mutationQueues[e.toKey()]=r),r}getGlobalsCache(){return this.globalsCache}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.bundleCache}runTransaction(e,t,r){_(uz,"Starting transaction:",e);let n=new uG(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),r(n).next(e=>this.referenceDelegate.onTransactionCommitted(n).next(()=>e)).toPromise().then(e=>(n.raiseOnCommittedEvent(),e))}mutationQueuesContainKey(e,t){return eF.or(Object.values(this.mutationQueues).map(r=>()=>r.containsKey(e,t)))}}class uG extends eM{constructor(e){super(),this.currentSequenceNumber=e}}class u${constructor(e){this.persistence=e,this.localViewReferences=new ux,this._orphanedDocuments=null}static factory(e){return new u$(e)}get orphanedDocuments(){if(this._orphanedDocuments)return this._orphanedDocuments;throw k(60996)}addReference(e,t,r){return this.localViewReferences.addReference(r,t),this.orphanedDocuments.delete(r.toString()),eF.resolve()}removeReference(e,t,r){return this.localViewReferences.removeReference(r,t),this.orphanedDocuments.add(r.toString()),eF.resolve()}markPotentiallyOrphaned(e,t){return this.orphanedDocuments.add(t.toString()),eF.resolve()}removeTarget(e,t){this.localViewReferences.removeReferencesForId(t.targetId).forEach(e=>this.orphanedDocuments.add(e.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.orphanedDocuments.add(e.toString()))}).next(()=>r.removeTargetData(e,t))}onTransactionStarted(){this._orphanedDocuments=new Set}onTransactionCommitted(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return eF.forEach(this.orphanedDocuments,r=>{let n=ei.fromPath(r);return this.isReferenced(e,n).next(e=>{e||t.removeEntry(n,ev.min())})}).next(()=>(this._orphanedDocuments=null,t.apply(e)))}updateLimboDocument(e,t){return this.isReferenced(e,t).next(e=>{e?this.orphanedDocuments.delete(t.toString()):this.orphanedDocuments.add(t.toString())})}documentSize(e){return 0}isReferenced(e,t){return eF.or([()=>eF.resolve(this.localViewReferences.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.mutationQueuesContainKey(e,t)])}}class uK{constructor(e,t){this.persistence=e,this.orphanedSequenceNumbers=new iH(e=>e5(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=ud(this,t)}static factory(e,t){return new uK(e,t)}onTransactionStarted(){}onTransactionCommitted(e){return eF.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}getSequenceNumberCount(e){let t=this.orphanedDocumentCount(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}orphanedDocumentCount(e){let t=0;return this.forEachOrphanedDocumentSequenceNumber(e,e=>{t++}).next(()=>t)}forEachOrphanedDocumentSequenceNumber(e,t){return eF.forEach(this.orphanedSequenceNumbers,(r,n)=>this.isPinned(e,r,n).next(e=>e?eF.resolve():t(n)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0,n=this.persistence.getRemoteDocumentCache(),i=n.newChangeBuffer();return n.forEachDocumentKey(e,n=>this.isPinned(e,n,t).next(e=>{e||(r++,i.removeEntry(n,ev.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.orphanedSequenceNumbers.set(t,e.currentSequenceNumber),eF.resolve()}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.orphanedSequenceNumbers.set(r,e.currentSequenceNumber),eF.resolve()}removeReference(e,t,r){return this.orphanedSequenceNumbers.set(r,e.currentSequenceNumber),eF.resolve()}updateLimboDocument(e,t){return this.orphanedSequenceNumbers.set(t,e.currentSequenceNumber),eF.resolve()}documentSize(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=nd(e.data.value)),t}isPinned(e,t,r){return eF.or([()=>this.persistence.mutationQueuesContainKey(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let e=this.orphanedSequenceNumbers.get(t);return eF.resolve(void 0!==e&&e>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class uW{constructor(e){this.serializer=e}createOrUpgrade(e,t,r,n){let i=new eV("createOrUpgrade",t);r<1&&n>=1&&(uQ(e),uY(e),u1(e),uX(e));let s=eF.resolve();return r<3&&n>=3&&(0!==r&&(u2(e),u1(e)),s=s.next(()=>u3(i))),r<4&&n>=4&&(0!==r&&(s=s.next(()=>uJ(e,i))),s=s.next(()=>{u6(e)})),r<5&&n>=5&&(s=s.next(()=>this.removeAcknowledgedMutations(i))),r<6&&n>=6&&(s=s.next(()=>(u0(e),this.addDocumentGlobal(i)))),r<7&&n>=7&&(s=s.next(()=>this.ensureSequenceNumbers(i))),r<8&&n>=8&&(s=s.next(()=>this.createCollectionParentIndex(e,i))),r<9&&n>=9&&(s=s.next(()=>{u4(e)})),r<10&&n>=10&&(s=s.next(()=>this.rewriteCanonicalIds(i))),r<11&&n>=11&&(s=s.next(()=>{u9(e),u5(e)})),r<12&&n>=12&&(s=s.next(()=>{u8(e)})),r<13&&n>=13&&(s=s.next(()=>uZ(e)).next(()=>this.rewriteRemoteDocumentCache(e,i)).next(()=>e.deleteObjectStore(tt))),r<14&&n>=14&&(s=s.next(()=>this.runOverlayMigration(e,i))),r<15&&n>=15&&(s=s.next(()=>u7(e))),r<16&&n>=16&&(s=s.next(()=>{t.objectStore(t$).clear()}).next(()=>{t.objectStore(tQ).clear()})),r<17&&n>=17&&(s=s.next(()=>{ce(e)})),r<18&&n>=18&&(0,h.WO)()&&(s=s.next(()=>{t.objectStore(t$).clear()}).next(()=>{t.objectStore(tQ).clear()})),s}addDocumentGlobal(e){let t=0;return e.store(tt).iterate((e,r)=>{t+=lJ(r)}).next(()=>{let r={byteSize:t};return e.store(tS).put(tE,r)})}removeAcknowledgedMutations(e){let t=e.store(ti),r=e.store(ta);return t.loadAll().next(t=>eF.forEach(t,t=>{let n=IDBKeyRange.bound([t.userId,rj],[t.userId,t.lastAcknowledgedBatchId]);return r.loadAll(tl,n).next(r=>eF.forEach(r,r=>{D(r.userId===t.userId,18650,"Cannot process batch from unexpected user",{batchId:r.batchId});let n=oR(this.serializer,r);return lY(e,t.userId,n).next(()=>{})}))}))}ensureSequenceNumbers(e){let t=e.store(tR),r=e.store(tt);return e.store(tO).get(tD).next(e=>{let n=r=>t.put({targetId:0,path:e5(r),sequenceNumber:e.highestListenSequenceNumber}),i=[];return r.iterate((e,r)=>{let s=new et(e),a=uH(s);i.push(t.get(a).next(e=>e?eF.resolve():n(s)))}).next(()=>eF.waitFor(i))})}createCollectionParentIndex(e,t){e.createObjectStore(tx,{keyPath:tP});let r=t.store(tx),n=new lj,i=e=>{if(n.add(e)){let t=e.lastSegment(),n=e.popLast();return r.put({collectionId:t,parent:e5(n)})}};return t.store(tt).iterate({keysOnly:!0},(e,t)=>i(new et(e).popLast())).next(()=>t.store(tf).iterate({keysOnly:!0},([e,t,r],n)=>i(te(t).popLast())))}rewriteCanonicalIds(e){let t=e.store(tw);return t.iterate((e,r)=>{let n=oN(r),i=ok(this.serializer,n);return t.put(i)})}rewriteRemoteDocumentCache(e,t){let r=t.store(tt),n=[];return r.iterate((e,r)=>{let i=t.store(tm),s=ct(r).path.toArray(),a={prefixPath:s.slice(0,s.length-2),collectionGroup:s[s.length-2],documentId:s[s.length-1],readTime:r.readTime||[0,0],unknownDocument:r.unknownDocument,noDocument:r.noDocument,document:r.document,hasCommittedMutations:!!r.hasCommittedMutations};n.push(i.put(a))}).next(()=>eF.waitFor(n))}runOverlayMigration(e,t){let r=t.store(ta),n=ub(this.serializer),i=new uq(u$.factory,this.serializer.remoteSerializer);return r.loadAll().next(e=>{let r=new Map;return e.forEach(e=>{let t=r.get(e.userId)??i5();oR(this.serializer,e).keys().forEach(e=>t=t.add(e)),r.set(e.userId,t)}),eF.forEach(r,(e,r)=>{let s=new b(r),a=oW.forUser(this.serializer,s),o=i.getIndexManager(s);return new uk(n,lX.forUser(s,this.serializer,o,i.referenceDelegate),a,o).recalculateAndSaveOverlaysForDocumentKeys(new ra(t,e2.INVALID),e).next()})})}}function uH(e){return[0,e5(e)]}function uQ(e){e.createObjectStore(tr)}function uY(e){e.createObjectStore(ti,{keyPath:ts}),e.createObjectStore(ta,{keyPath:to,autoIncrement:!0}).createIndex(tl,tu,{unique:!0}),e.createObjectStore(tf)}function uJ(e,t){return t.store(ta).loadAll().next(r=>{e.deleteObjectStore(ta),e.createObjectStore(ta,{keyPath:to,autoIncrement:!0}).createIndex(tl,tu,{unique:!0});let n=t.store(ta),i=r.map(e=>n.put(e));return eF.waitFor(i)})}function uX(e){e.createObjectStore(tt)}function uZ(e){let t=e.createObjectStore(tm,{keyPath:tg});t.createIndex(ty,tv),t.createIndex(tb,tT)}function u0(e){e.createObjectStore(tS)}function u1(e){e.createObjectStore(tR,{keyPath:tN}).createIndex(tk,tA,{unique:!0}),e.createObjectStore(tw,{keyPath:tC}).createIndex(t_,tI,{unique:!0}),e.createObjectStore(tO)}function u2(e){e.deleteObjectStore(tR),e.deleteObjectStore(tw),e.deleteObjectStore(tO)}function u4(e){e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")}function u3(e){let t=e.store(tO),r={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:ev.min().toTimestamp(),targetCount:0};return t.put(tD,r)}function u6(e){e.createObjectStore(tM,{keyPath:tL})}function u9(e){e.createObjectStore(tF,{keyPath:tB})}function u5(e){e.createObjectStore(tU,{keyPath:tV})}function u7(e){e.createObjectStore(tj,{keyPath:tz,autoIncrement:!0}).createIndex(tq,tG,{unique:!1}),e.createObjectStore(t$,{keyPath:tK}).createIndex(tW,tH,{unique:!1}),e.createObjectStore(tQ,{keyPath:tY}).createIndex(tJ,tX,{unique:!1})}function u8(e){let t=e.createObjectStore(tZ,{keyPath:t0});t.createIndex(t1,t2,{unique:!1}),t.createIndex(t4,t3,{unique:!1})}function ce(e){e.createObjectStore(t6,{keyPath:t9})}function ct(e){return e.document?new ei(et.fromString(e.document.name).popFirst(5)):e.noDocument?ei.fromSegments(e.noDocument.path):e.unknownDocument?ei.fromSegments(e.unknownDocument.path):k(36783)}let cr="IndexedDbPersistence",cn=18e5,ci=5e3,cs=4e3,ca="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",co="This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.",cl="firestore_zombie",cu="main";class cc{constructor(e,t,r,n,i,s,a,o,l,u,c=uR){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.queue=i,this.window=s,this.document=a,this.sequenceNumberSyncer=l,this.forceOwningTab=u,this.schemaVersion=c,this.listenSequence=null,this._started=!1,this.isPrimary=!1,this.networkEnabled=!0,this.windowUnloadHandler=null,this.inForeground=!1,this.documentVisibilityHandler=null,this.clientMetadataRefresher=null,this.lastGarbageCollectionTime=Number.NEGATIVE_INFINITY,this.primaryStateListener=e=>Promise.resolve(),!cc.isAvailable())throw new P(x.UNIMPLEMENTED,co);this.referenceDelegate=new up(this,n),this.dbName=t+cu,this.serializer=new ob(o),this.simpleDb=new ej(this.dbName,this.schemaVersion,new uW(this.serializer)),this.globalsCache=new oQ,this.targetCache=new l9(this.referenceDelegate,this.serializer),this.remoteDocumentCache=ub(this.serializer),this.bundleCache=new oG,this.window&&this.window.localStorage?this.webStorage=this.window.localStorage:(this.webStorage=null,!1===u&&I(cr,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.updateClientMetadataAndTryBecomePrimary().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new P(x.FAILED_PRECONDITION,ca);return this.attachVisibilityHandler(),this.attachWindowUnloadHook(),this.scheduleClientMetadataAndPrimaryLeaseRefreshes(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.targetCache.getHighestSequenceNumber(e))}).then(e=>{this.listenSequence=new e2(e,this.sequenceNumberSyncer)}).then(()=>{this._started=!0}).catch(e=>(this.simpleDb&&this.simpleDb.close(),Promise.reject(e)))}setPrimaryStateListener(e){return this.primaryStateListener=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.simpleDb.setVersionChangeListener(async t=>{null===t.newVersion&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.queue.enqueueAndForget(async()=>{this.started&&await this.updateClientMetadataAndTryBecomePrimary()}))}updateClientMetadataAndTryBecomePrimary(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>cd(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.verifyPrimaryLease(e).next(e=>{e||(this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)))})}).next(()=>this.canActAsPrimary(e)).next(t=>this.isPrimary&&!t?this.releasePrimaryLeaseIfHeld(e).next(()=>!1):!!t&&this.acquireOrExtendPrimaryLease(e).next(()=>!0))).catch(e=>{if(e$(e))return _(cr,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return _(cr,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.queue.enqueueRetryable(()=>this.primaryStateListener(e)),this.isPrimary=e})}verifyPrimaryLease(e){return ch(e).get(tn).next(e=>eF.resolve(this.isLocalClient(e)))}removeClientMetadata(e){return cd(e).delete(this.clientId)}async maybeGarbageCollectMultiClientState(){if(this.isPrimary&&!this.isWithinAge(this.lastGarbageCollectionTime,cn)){this.lastGarbageCollectionTime=Date.now();let e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{let t=ro(e,tM);return t.loadAll().next(e=>{let r=this.filterActiveClients(e,cn),n=e.filter(e=>-1===r.indexOf(e));return eF.forEach(n,e=>t.delete(e.clientId)).next(()=>n)})}).catch(()=>[]);if(this.webStorage)for(let t of e)this.webStorage.removeItem(this.zombiedClientLocalStorageKey(t.clientId))}}scheduleClientMetadataAndPrimaryLeaseRefreshes(){this.clientMetadataRefresher=this.queue.enqueueAfterDelay("client_metadata_refresh",cs,()=>this.updateClientMetadataAndTryBecomePrimary().then(()=>this.maybeGarbageCollectMultiClientState()).then(()=>this.scheduleClientMetadataAndPrimaryLeaseRefreshes()))}isLocalClient(e){return!!e&&e.ownerId===this.clientId}canActAsPrimary(e){return this.forceOwningTab?eF.resolve(!0):ch(e).get(tn).next(t=>{if(null!==t&&this.isWithinAge(t.leaseTimestampMs,ci)&&!this.isClientZombied(t.ownerId)){if(this.isLocalClient(t)&&this.networkEnabled)return!0;if(!this.isLocalClient(t)){if(!t.allowTabSynchronization)throw new P(x.FAILED_PRECONDITION,ca);return!1}}return!!this.networkEnabled&&!!this.inForeground||cd(e).loadAll().next(e=>void 0===this.filterActiveClients(e,ci).find(e=>{if(this.clientId!==e.clientId){let t=!this.networkEnabled&&e.networkEnabled,r=!this.inForeground&&e.inForeground,n=this.networkEnabled===e.networkEnabled;if(t||r&&n)return!0}return!1}))}).next(e=>(this.isPrimary!==e&&_(cr,`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}async shutdown(){this._started=!1,this.markClientZombied(),this.clientMetadataRefresher&&(this.clientMetadataRefresher.cancel(),this.clientMetadataRefresher=null),this.detachVisibilityHandler(),this.detachWindowUnloadHook(),await this.simpleDb.runTransaction("shutdown","readwrite",[tr,tM],e=>{let t=new ra(e,e2.INVALID);return this.releasePrimaryLeaseIfHeld(t).next(()=>this.removeClientMetadata(t))}),this.simpleDb.close(),this.removeClientZombiedEntry()}filterActiveClients(e,t){return e.filter(e=>this.isWithinAge(e.updateTimeMs,t)&&!this.isClientZombied(e.clientId))}getActiveClients(){return this.runTransaction("getActiveClients","readonly",e=>cd(e).loadAll().next(e=>this.filterActiveClients(e,cn).map(e=>e.clientId)))}get started(){return this._started}getGlobalsCache(){return this.globalsCache}getMutationQueue(e,t){return lX.forUser(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new lG(e,this.serializer.remoteSerializer.databaseId)}getDocumentOverlayCache(e){return oW.forUser(this.serializer,e)}getBundleCache(){return this.bundleCache}runTransaction(e,t,r){let n;_(cr,"Starting transaction:",e);let i="readonly"===t?"readonly":"readwrite",s=rs(this.schemaVersion);return this.simpleDb.runTransaction(e,i,s,i=>(n=new ra(i,this.listenSequence?this.listenSequence.next():e2.INVALID),"readwrite-primary"===t)?this.verifyPrimaryLease(n).next(e=>!!e||this.canActAsPrimary(n)).next(t=>{if(!t)throw I(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)),new P(x.FAILED_PRECONDITION,eP);return r(n)}).next(e=>this.acquireOrExtendPrimaryLease(n).next(()=>e)):this.verifyAllowTabSynchronization(n).next(()=>r(n))).then(e=>(n.raiseOnCommittedEvent(),e))}verifyAllowTabSynchronization(e){return ch(e).get(tn).next(e=>{if(null!==e&&this.isWithinAge(e.leaseTimestampMs,ci)&&!this.isClientZombied(e.ownerId)&&!this.isLocalClient(e)&&!this.forceOwningTab&&(!this.allowTabSynchronization||!e.allowTabSynchronization))throw new P(x.FAILED_PRECONDITION,ca)})}acquireOrExtendPrimaryLease(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return ch(e).put(tn,t)}static isAvailable(){return ej.isAvailable()}releasePrimaryLeaseIfHeld(e){let t=ch(e);return t.get(tn).next(e=>this.isLocalClient(e)?(_(cr,"Releasing primary lease."),t.delete(tn)):eF.resolve())}isWithinAge(e,t){let r=Date.now(),n=r-t,i=r;return!(e<n)&&(!(e>i)||(I(`Detected an update time that is in the future: ${e} > ${i}`),!1))}attachVisibilityHandler(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.documentVisibilityHandler=()=>{this.queue.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.updateClientMetadataAndTryBecomePrimary()))},this.document.addEventListener("visibilitychange",this.documentVisibilityHandler),this.inForeground="visible"===this.document.visibilityState)}detachVisibilityHandler(){this.documentVisibilityHandler&&(this.document.removeEventListener("visibilitychange",this.documentVisibilityHandler),this.documentVisibilityHandler=null)}attachWindowUnloadHook(){"function"==typeof this.window?.addEventListener&&(this.windowUnloadHandler=()=>{this.markClientZombied();let e=/(?:Version|Mobile)\/1[456]/;(0,h.G6)()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.queue.enterRestrictedMode(!0),this.queue.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.windowUnloadHandler))}detachWindowUnloadHook(){this.windowUnloadHandler&&(this.window.removeEventListener("pagehide",this.windowUnloadHandler),this.windowUnloadHandler=null)}isClientZombied(e){try{let t=this.webStorage?.getItem(this.zombiedClientLocalStorageKey(e))!==null;return _(cr,`Client '${e}' ${t?"is":"is not"} zombied in LocalStorage`),t}catch(e){return I(cr,"Failed to get zombied client id.",e),!1}}markClientZombied(){if(this.webStorage)try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),String(Date.now()))}catch(e){I("Failed to set zombie client id.",e)}}removeClientZombiedEntry(){if(this.webStorage)try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch(e){}}zombiedClientLocalStorageKey(e){return`${cl}_${this.persistenceKey}_${e}`}}function ch(e){return ro(e,tr)}function cd(e){return ro(e,tM)}function cp(e,t){let r=e.projectId;return e.isDefaultDatabase||(r+="."+e.database),"firestore/"+t+"/"+r+"/"}function cf(e,t,r,n,i){t=[...t],(e=[...e]).sort(r),t.sort(r);let s=e.length,a=t.length,o=0,l=0;for(;o<a&&l<s;){let s=r(e[l],t[o]);s<0?i(e[l++]):s>0?n(t[o++]):(o++,l++)}for(;o<a;)n(t[o++]);for(;l<s;)i(e[l++])}function cm(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}let cg="LocalStore",cy=3e8;class cv{constructor(e,t,r,n){this.persistence=e,this.queryEngine=t,this.serializer=n,this.targetDataByTarget=new rh(K),this.targetIdByTarget=new iH(e=>ia(e),il),this.collectionGroupReadTime=new Map,this.remoteDocuments=e.getRemoteDocumentCache(),this.targetCache=e.getTargetCache(),this.bundleCache=e.getBundleCache(),this.initializeUserComponents(r)}initializeUserComponents(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new uk(this.remoteDocuments,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.remoteDocuments.setIndexManager(this.indexManager),this.queryEngine.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.targetDataByTarget))}}function cb(e,t,r,n){return new cv(e,t,r,n)}async function cT(e,t){let r=O(e);return await r.persistence.runTransaction("Handle user change","readonly",e=>{let n;return r.mutationQueue.getAllMutationBatches(e).next(i=>(n=i,r.initializeUserComponents(t),r.mutationQueue.getAllMutationBatches(e))).next(t=>{let i=[],s=[],a=i5();for(let e of n)for(let t of(i.push(e.batchId),e.mutations))a=a.add(t.key);for(let e of t)for(let t of(s.push(e.batchId),e.mutations))a=a.add(t.key);return r.localDocuments.getDocuments(e,a).next(e=>({affectedDocuments:e,removedBatchIds:i,addedBatchIds:s}))})})}function cS(e,t){let r,n;let i=O(e),s=ey.now(),a=t.reduce((e,t)=>e.add(t.key),i5());return i.persistence.runTransaction("Locally write mutations","readwrite",e=>{let o=iY(),l=i5();return i.remoteDocuments.getEntries(e,a).next(e=>{(o=e).forEach((e,t)=>{t.isValidDocument()||(l=l.add(e))})}).next(()=>i.localDocuments.getOverlayedDocuments(e,o)).next(n=>{r=n;let a=[];for(let e of t){let t=sR(e,r.get(e.key).overlayedDocument);null!=t&&a.push(new sO(e.key,t,nO(t.value.mapValue),sS.exists(!0)))}return i.mutationQueue.addMutationBatch(e,s,a,t)}).next(t=>{n=t;let s=t.applyToLocalDocumentSet(r,l);return i.documentOverlayCache.saveOverlays(e,t.batchId,s)})}).then(()=>({batchId:n.batchId,changes:i0(r)}))}function cE(e,t){let r=O(e);return r.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{let n=t.batch.keys(),i=r.remoteDocuments.newChangeBuffer({trackRemovals:!0});return cF(r,e,t,i).next(()=>i.apply(e)).next(()=>r.mutationQueue.performConsistencyCheck(e)).next(()=>r.documentOverlayCache.removeOverlaysForBatchId(e,n,t.batch.batchId)).next(()=>r.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,cw(t))).next(()=>r.localDocuments.getDocuments(e,n))})}function cw(e){let t=i5();for(let r=0;r<e.mutationResults.length;++r)e.mutationResults[r].transformResults.length>0&&(t=t.add(e.batch.mutations[r].key));return t}function cC(e,t){let r=O(e);return r.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let n;return r.mutationQueue.lookupMutationBatch(e,t).next(t=>(D(null!==t,37113),n=t.keys(),r.mutationQueue.removeMutationBatch(e,t))).next(()=>r.mutationQueue.performConsistencyCheck(e)).next(()=>r.documentOverlayCache.removeOverlaysForBatchId(e,n,t)).next(()=>r.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,n)).next(()=>r.localDocuments.getDocuments(e,n))})}function c_(e){let t=O(e);return t.persistence.runTransaction("Get highest unacknowledged batch id","readonly",e=>t.mutationQueue.getHighestUnacknowledgedBatchId(e))}function cI(e){let t=O(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.targetCache.getLastRemoteSnapshotVersion(e))}function cR(e,t){let r=O(e),n=t.snapshotVersion,i=r.targetDataByTarget;return r.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{let s=r.remoteDocuments.newChangeBuffer({trackRemovals:!0});i=r.targetDataByTarget;let a=[];t.targetChanges.forEach((s,o)=>{let l=i.get(o);if(!l)return;a.push(r.targetCache.removeMatchingKeys(e,s.removedDocuments,o).next(()=>r.targetCache.addMatchingKeys(e,s.addedDocuments,o)));let u=l.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(o)?u=u.withResumeToken(rE.EMPTY_BYTE_STRING,ev.min()).withLastLimboFreeSnapshotVersion(ev.min()):s.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(s.resumeToken,n)),i=i.insert(o,u),ck(l,u,s)&&a.push(r.targetCache.updateTargetData(e,u))});let o=iY(),l=i5();if(t.documentUpdates.forEach(n=>{t.resolvedLimboDocuments.has(n)&&a.push(r.persistence.referenceDelegate.updateLimboDocument(e,n))}),a.push(cN(e,s,t.documentUpdates).next(e=>{o=e.changedDocuments,l=e.existenceChangedKeys})),!n.isEqual(ev.min())){let t=r.targetCache.getLastRemoteSnapshotVersion(e).next(t=>r.targetCache.setTargetsMetadata(e,e.currentSequenceNumber,n));a.push(t)}return eF.waitFor(a).next(()=>s.apply(e)).next(()=>r.localDocuments.getLocalViewOfDocuments(e,o,l)).next(()=>o)}).then(e=>(r.targetDataByTarget=i,e))}function cN(e,t,r){let n=i5(),i=i5();return r.forEach(e=>n=n.add(e)),t.getEntries(e,n).next(e=>{let n=iY();return r.forEach((r,s)=>{let a=e.get(r);s.isFoundDocument()!==a.isFoundDocument()&&(i=i.add(r)),s.isNoDocument()&&s.version.isEqual(ev.min())?(t.removeEntry(r,s.readTime),n=n.insert(r,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(t.addEntry(s),n=n.insert(r,s)):_(cg,"Ignoring outdated watch update for ",r,". Current version:",a.version," Watch version:",s.version)}),{changedDocuments:n,existenceChangedKeys:i}})}function ck(e,t,r){return!!(0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=cy)||r.addedDocuments.size+r.modifiedDocuments.size+r.removedDocuments.size>0}async function cA(e,t){let r=O(e);try{await r.persistence.runTransaction("notifyLocalViewChanges","readwrite",e=>eF.forEach(t,t=>eF.forEach(t.addedKeys,n=>r.persistence.referenceDelegate.addReference(e,t.targetId,n)).next(()=>eF.forEach(t.removedKeys,n=>r.persistence.referenceDelegate.removeReference(e,t.targetId,n)))))}catch(e){if(e$(e))_(cg,"Failed to update sequence numbers: "+e);else throw e}for(let e of t){let t=e.targetId;if(!e.fromCache){let e=r.targetDataByTarget.get(t),n=e.snapshotVersion,i=e.withLastLimboFreeSnapshotVersion(n);r.targetDataByTarget=r.targetDataByTarget.insert(t,i)}}}function cD(e,t){let r=O(e);return r.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=rj),r.mutationQueue.getNextMutationBatchAfterBatchId(e,t)))}function cO(e,t){let r=O(e);return r.persistence.runTransaction("read document","readonly",e=>r.localDocuments.getDocument(e,t))}function cx(e,t){let r=O(e);return r.persistence.runTransaction("Allocate target","readwrite",e=>{let n;return r.targetCache.getTargetData(e,t).next(i=>i?(n=i,eF.resolve(n)):r.targetCache.allocateTargetId(e).next(i=>(n=new ov(t,i,"TargetPurposeListen",e.currentSequenceNumber),r.targetCache.addTargetData(e,n).next(()=>n))))}).then(e=>{let n=r.targetDataByTarget.get(e.targetId);return(null===n||e.snapshotVersion.compareTo(n.snapshotVersion)>0)&&(r.targetDataByTarget=r.targetDataByTarget.insert(e.targetId,e),r.targetIdByTarget.set(t,e.targetId)),e})}function cP(e,t,r){let n=O(e),i=n.targetIdByTarget.get(r);return void 0!==i?eF.resolve(n.targetDataByTarget.get(i)):n.targetCache.getTargetData(t,r)}async function cM(e,t,r){let n=O(e),i=n.targetDataByTarget.get(t),s=r?"readwrite":"readwrite-primary";try{r||await n.persistence.runTransaction("Release target",s,e=>n.persistence.referenceDelegate.removeTarget(e,i))}catch(e){if(e$(e))_(cg,`Failed to update sequence numbers for target ${t}: ${e}`);else throw e}n.targetDataByTarget=n.targetDataByTarget.remove(t),n.targetIdByTarget.delete(i.target)}function cL(e,t,r){let n=O(e),i=ev.min(),s=i5();return n.persistence.runTransaction("Execute query","readwrite",e=>cP(n,e,ik(t)).next(t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,n.targetCache.getMatchingKeysForTargetId(e,t.targetId).next(e=>{s=e})}).next(()=>n.queryEngine.getDocumentsMatchingQuery(e,t,r?i:ev.min(),r?s:i5())).next(e=>(cq(n,i$(t),e),{documents:e,remoteKeys:s})))}function cF(e,t,r,n){let i=r.batch,s=i.keys(),a=eF.resolve();return s.forEach(e=>{a=a.next(()=>n.getEntry(t,e)).next(t=>{let s=r.docVersions.get(e);D(null!==s,48541),0>t.version.compareTo(s)&&(i.applyToRemoteDocument(t,r),t.isValidDocument()&&(t.setReadTime(r.commitVersion),n.addEntry(t)))})}),a.next(()=>e.mutationQueue.removeMutationBatch(t,i))}function cB(e,t){let r=O(e),n=O(r.mutationQueue);return r.persistence.runTransaction("Lookup mutation documents","readonly",e=>n.lookupMutationKeys(e,t).next(t=>t?r.localDocuments.getDocuments(e,t):eF.resolve(null)))}function cU(e,t){O(O(e,cv).mutationQueue).removeCachedMutationKeys(t)}function cV(e){return O(O(e,cv).persistence).getActiveClients()}function cj(e,t){let r=O(e),n=O(r.targetCache),i=r.targetDataByTarget.get(t);return i?Promise.resolve(i.target):r.persistence.runTransaction("Get target data","readonly",e=>n.getTargetDataForTarget(e,t).next(e=>e?e.target:null))}function cz(e,t){let r=O(e),n=r.collectionGroupReadTime.get(t)||ev.min();return r.persistence.runTransaction("Get new document changes","readonly",e=>r.remoteDocuments.getAllFromCollectionGroup(e,t,eA(n,eb),Number.MAX_SAFE_INTEGER)).then(e=>(cq(r,t,e),e))}function cq(e,t,r){let n=e.collectionGroupReadTime.get(t)||ev.min();r.forEach((e,t)=>{t.readTime.compareTo(n)>0&&(n=t.readTime)}),e.collectionGroupReadTime.set(t,n)}function cG(e){return ik(iE(et.fromString(`__bundle__/docs/${e}`)))}async function c$(e,t,r,n){let i=O(e),s=i5(),a=iY();for(let e of r){let r=t.toDocumentKey(e.metadata.name);e.document&&(s=s.add(r));let n=t.toMutableDocument(e);n.setReadTime(t.toSnapshotVersion(e.metadata.readTime)),a=a.insert(r,n)}let o=i.remoteDocuments.newChangeBuffer({trackRemovals:!0}),l=await cx(i,cG(n));return i.persistence.runTransaction("Apply bundle documents","readwrite",e=>cN(e,o,a).next(t=>(o.apply(e),t)).next(t=>i.targetCache.removeMatchingKeysForTargetId(e,l.targetId).next(()=>i.targetCache.addMatchingKeys(e,s,l.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(e,t.changedDocuments,t.existenceChangedKeys)).next(()=>t.changedDocuments)))}function cK(e,t){let r=O(e),n=ay(t.createTime);return r.persistence.runTransaction("hasNewerBundle","readonly",e=>r.bundleCache.getBundleMetadata(e,t.id)).then(e=>!!e&&e.createTime.compareTo(n)>=0)}function cW(e,t){let r=O(e);return r.persistence.runTransaction("Save bundle","readwrite",e=>r.bundleCache.saveBundleMetadata(e,t))}function cH(e,t){let r=O(e);return r.persistence.runTransaction("Get named query","readonly",e=>r.bundleCache.getNamedQuery(e,t))}async function cQ(e,t,r=i5()){let n=await cx(e,ik(oM(t.bundledQuery))),i=O(e);return i.persistence.runTransaction("Save named query","readwrite",e=>{let s=ay(t.readTime);if(n.snapshotVersion.compareTo(s)>=0)return i.bundleCache.saveNamedQuery(e,t);let a=n.withResumeToken(rE.EMPTY_BYTE_STRING,s);return i.targetDataByTarget=i.targetDataByTarget.insert(a.targetId,a),i.targetCache.updateTargetData(e,a).next(()=>i.targetCache.removeMatchingKeysForTargetId(e,n.targetId)).next(()=>i.targetCache.addMatchingKeys(e,r,n.targetId)).next(()=>i.bundleCache.saveNamedQuery(e,t))})}function cY(e,t){O(e).queryEngine.indexAutoCreationEnabled=t}class cJ{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}let cX=100;function cZ(){return(0,h.G6)()?8:ez((0,h.z$)())>0?6:4}class c0{constructor(){this.initialized=!1,this.indexAutoCreationEnabled=!1,this.indexAutoCreationMinCollectionSize=cX,this.relativeIndexReadCostPerDocument=cZ()}initialize(e,t){this.localDocumentsView=e,this.indexManager=t,this.initialized=!0}getDocumentsMatchingQuery(e,t,r,n){let i={result:null};return this.performQueryUsingIndex(e,t).next(e=>{i.result=e}).next(()=>{if(!i.result)return this.performQueryUsingRemoteKeys(e,t,n,r).next(e=>{i.result=e})}).next(()=>{if(i.result)return;let r=new cJ;return this.executeFullCollectionScan(e,t,r).next(n=>{if(i.result=n,this.indexAutoCreationEnabled)return this.createCacheIndexes(e,t,r,n.size)})}).next(()=>i.result)}createCacheIndexes(e,t,r,n){return r.documentReadCount<this.indexAutoCreationMinCollectionSize?(C()<=u.in.DEBUG&&_("QueryEngine","SDK will not create cache indexes for query:",iU(t),"since it only creates cache indexes for collection contains","more than or equal to",this.indexAutoCreationMinCollectionSize,"documents"),eF.resolve()):(C()<=u.in.DEBUG&&_("QueryEngine","Query:",iU(t),"scans",r.documentReadCount,"local documents and returns",n,"documents as results."),r.documentReadCount>this.relativeIndexReadCostPerDocument*n)?(C()<=u.in.DEBUG&&_("QueryEngine","The SDK decides to create cache indexes for query:",iU(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,ik(t))):eF.resolve()}performQueryUsingIndex(e,t){if(iC(t))return eF.resolve(null);let r=ik(t);return this.indexManager.getIndexType(e,r).next(n=>0===n?null:(null!==t.limit&&1===n&&(r=ik(t=iP(t,null,"F"))),this.indexManager.getDocumentsMatchingTarget(e,r).next(n=>{let i=i5(...n);return this.localDocumentsView.getDocuments(e,i).next(n=>this.indexManager.getMinOffset(e,r).next(r=>{let s=this.applyQuery(t,n);return this.needsRefill(t,s,i,r.readTime)?this.performQueryUsingIndex(e,iP(t,null,"F")):this.appendRemainingResults(e,s,t,r)}))})))}performQueryUsingRemoteKeys(e,t,r,n){return iC(t)||n.isEqual(ev.min())?eF.resolve(null):this.localDocumentsView.getDocuments(e,r).next(i=>{let s=this.applyQuery(t,i);return this.needsRefill(t,s,r,n)?eF.resolve(null):(C()<=u.in.DEBUG&&_("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),iU(t)),this.appendRemainingResults(e,s,t,eA(n,eb)).next(e=>e))})}applyQuery(e,t){let r=new rm(iK(e));return t.forEach((t,n)=>{iV(e,n)&&(r=r.add(n))}),r}needsRefill(e,t,r,n){if(null===e.limit)return!1;if(r.size!==t.size)return!0;let i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(n)>0)}executeFullCollectionScan(e,t,r){return C()<=u.in.DEBUG&&_("QueryEngine","Using full collection scan to execute query:",iU(t)),this.localDocumentsView.getDocumentsMatchingQuery(e,t,eO.min(),r)}appendRemainingResults(e,t,r,n){return this.localDocumentsView.getDocumentsMatchingQuery(e,r,n).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}let c1="firestore_clients";function c2(e,t){return`${c1}_${e}_${t}`}let c4="firestore_mutations";function c3(e,t,r){let n=`${c4}_${e}_${r}`;return t.isAuthenticated()&&(n+=`_${t.uid}`),n}let c6="firestore_targets";function c9(e,t){return`${c6}_${e}_${t}`}let c5="firestore_online_state";function c7(e){return`${c5}_${e}`}let c8="firestore_bundle_loaded_v2";function he(e){return`${c8}_${e}`}let ht="firestore_sequence_number";function hr(e){return`${ht}_${e}`}let hn="SharedClientState";class hi{constructor(e,t,r,n){this.user=e,this.batchId=t,this.state=r,this.error=n}static fromWebStorageEntry(e,t,r){let n;let i=JSON.parse(r),s="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return(s&&i.error&&(s="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(n=new P(i.error.code,i.error.message)),s)?new hi(e,t,i.state,n):(I(hn,`Failed to parse mutation state for ID '${t}': ${r}`),null)}toWebStorageJSON(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class hs{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static fromWebStorageEntry(e,t){let r;let n=JSON.parse(t),i="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return(i&&n.error&&(i="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(r=new P(n.error.code,n.error.message)),i)?new hs(e,n.state,r):(I(hn,`Failed to parse target state for ID '${e}': ${t}`),null)}toWebStorageJSON(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class ha{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static fromWebStorageEntry(e,t){let r=JSON.parse(t),n="object"==typeof r&&r.activeTargetIds instanceof Array,i=i8();for(let e=0;n&&e<r.activeTargetIds.length;++e)n=rG(r.activeTargetIds[e]),i=i.add(r.activeTargetIds[e]);return n?new ha(e,i):(I(hn,`Failed to parse client data for instance '${e}': ${t}`),null)}}class ho{constructor(e,t){this.clientId=e,this.onlineState=t}static fromWebStorageEntry(e){let t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new ho(t.clientId,t.onlineState):(I(hn,`Failed to parse online state: ${e}`),null)}}class hl{constructor(){this.activeTargetIds=i8()}addQueryTarget(e){this.activeTargetIds=this.activeTargetIds.add(e)}removeQueryTarget(e){this.activeTargetIds=this.activeTargetIds.delete(e)}toWebStorageJSON(){return JSON.stringify({activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()})}}class hu{constructor(e,t,r,n,i){this.window=e,this.queue=t,this.persistenceKey=r,this.localClientId=n,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.storageListener=this.handleWebStorageEvent.bind(this),this.activeClients=new rh(K),this.started=!1,this.earlyEvents=[];let s=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.localClientStorageKey=c2(this.persistenceKey,this.localClientId),this.sequenceNumberKey=hr(this.persistenceKey),this.activeClients=this.activeClients.insert(this.localClientId,new hl),this.clientStateKeyRe=RegExp(`^${c1}_${s}_([^_]*)$`),this.mutationBatchKeyRe=RegExp(`^${c4}_${s}_(\\d+)(?:_(.*))?$`),this.queryTargetKeyRe=RegExp(`^${c6}_${s}_(\\d+)$`),this.onlineStateKey=c7(this.persistenceKey),this.bundleLoadedKey=he(this.persistenceKey),this.window.addEventListener("storage",this.storageListener)}static isAvailable(e){return!!(e&&e.localStorage)}async start(){for(let e of(await this.syncEngine.getActiveClients())){if(e===this.localClientId)continue;let t=this.getItem(c2(this.persistenceKey,e));if(t){let r=ha.fromWebStorageEntry(e,t);r&&(this.activeClients=this.activeClients.insert(r.clientId,r))}}this.persistClientState();let e=this.storage.getItem(this.onlineStateKey);if(e){let t=this.fromWebStorageOnlineState(e);t&&this.handleOnlineStateEvent(t)}for(let e of this.earlyEvents)this.handleWebStorageEvent(e);this.earlyEvents=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.sequenceNumberKey,JSON.stringify(e))}getAllActiveQueryTargets(){return this.extractActiveQueryTargets(this.activeClients)}isActiveQueryTarget(e){let t=!1;return this.activeClients.forEach((r,n)=>{n.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.persistMutationState(e,"pending")}updateMutationState(e,t,r){this.persistMutationState(e,t,r),this.removeMutationState(e)}addLocalQueryTarget(e,t=!0){let r="not-current";if(this.isActiveQueryTarget(e)){let t=this.storage.getItem(c9(this.persistenceKey,e));if(t){let n=hs.fromWebStorageEntry(e,t);n&&(r=n.state)}}return t&&this.localClientState.addQueryTarget(e),this.persistClientState(),r}removeLocalQueryTarget(e){this.localClientState.removeQueryTarget(e),this.persistClientState()}isLocalQueryTarget(e){return this.localClientState.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(c9(this.persistenceKey,e))}updateQueryState(e,t,r){this.persistQueryTargetState(e,t,r)}handleUserChange(e,t,r){t.forEach(e=>{this.removeMutationState(e)}),this.currentUser=e,r.forEach(e=>{this.addPendingMutation(e)})}setOnlineState(e){this.persistOnlineState(e)}notifyBundleLoaded(e){this.persistBundleLoadedState(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.storageListener),this.removeItem(this.localClientStorageKey),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return _(hn,"READ",e,t),t}setItem(e,t){_(hn,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){_(hn,"REMOVE",e),this.storage.removeItem(e)}handleWebStorageEvent(e){let t=e;if(t.storageArea===this.storage){if(_(hn,"EVENT",t.key,t.newValue),t.key===this.localClientStorageKey){I("Received WebStorage notification for local change. Another client might have garbage-collected our state");return}this.queue.enqueueRetryable(async()=>{if(!this.started){this.earlyEvents.push(t);return}if(null!==t.key){if(this.clientStateKeyRe.test(t.key)){if(null!=t.newValue){let e=this.fromWebStorageClientState(t.key,t.newValue);if(e)return this.handleClientStateEvent(e.clientId,e)}else{let e=this.fromWebStorageClientStateKey(t.key);return this.handleClientStateEvent(e,null)}}else if(this.mutationBatchKeyRe.test(t.key)){if(null!==t.newValue){let e=this.fromWebStorageMutationMetadata(t.key,t.newValue);if(e)return this.handleMutationBatchEvent(e)}}else if(this.queryTargetKeyRe.test(t.key)){if(null!==t.newValue){let e=this.fromWebStorageQueryTargetMetadata(t.key,t.newValue);if(e)return this.handleQueryTargetEvent(e)}}else if(t.key===this.onlineStateKey){if(null!==t.newValue){let e=this.fromWebStorageOnlineState(t.newValue);if(e)return this.handleOnlineStateEvent(e)}}else if(t.key===this.sequenceNumberKey){let e=hc(t.newValue);e!==e2.INVALID&&this.sequenceNumberHandler(e)}else if(t.key===this.bundleLoadedKey){let e=this.fromWebStoreBundleLoadedState(t.newValue);await Promise.all(e.map(e=>this.syncEngine.synchronizeWithChangedDocuments(e)))}}})}}get localClientState(){return this.activeClients.get(this.localClientId)}persistClientState(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())}persistMutationState(e,t,r){let n=new hi(this.currentUser,e,t,r),i=c3(this.persistenceKey,this.currentUser,e);this.setItem(i,n.toWebStorageJSON())}removeMutationState(e){let t=c3(this.persistenceKey,this.currentUser,e);this.removeItem(t)}persistOnlineState(e){let t={clientId:this.localClientId,onlineState:e};this.storage.setItem(this.onlineStateKey,JSON.stringify(t))}persistQueryTargetState(e,t,r){let n=c9(this.persistenceKey,e),i=new hs(e,t,r);this.setItem(n,i.toWebStorageJSON())}persistBundleLoadedState(e){let t=JSON.stringify(Array.from(e));this.setItem(this.bundleLoadedKey,t)}fromWebStorageClientStateKey(e){let t=this.clientStateKeyRe.exec(e);return t?t[1]:null}fromWebStorageClientState(e,t){let r=this.fromWebStorageClientStateKey(e);return ha.fromWebStorageEntry(r,t)}fromWebStorageMutationMetadata(e,t){let r=this.mutationBatchKeyRe.exec(e),n=Number(r[1]),i=void 0!==r[2]?r[2]:null;return hi.fromWebStorageEntry(new b(i),n,t)}fromWebStorageQueryTargetMetadata(e,t){let r=Number(this.queryTargetKeyRe.exec(e)[1]);return hs.fromWebStorageEntry(r,t)}fromWebStorageOnlineState(e){return ho.fromWebStorageEntry(e)}fromWebStoreBundleLoadedState(e){return JSON.parse(e)}async handleMutationBatchEvent(e){if(e.user.uid!==this.currentUser.uid){_(hn,`Ignoring mutation for non-active user ${e.user.uid}`);return}return this.syncEngine.applyBatchState(e.batchId,e.state,e.error)}handleQueryTargetEvent(e){return this.syncEngine.applyTargetState(e.targetId,e.state,e.error)}handleClientStateEvent(e,t){let r=t?this.activeClients.insert(e,t):this.activeClients.remove(e),n=this.extractActiveQueryTargets(this.activeClients),i=this.extractActiveQueryTargets(r),s=[],a=[];return i.forEach(e=>{n.has(e)||s.push(e)}),n.forEach(e=>{i.has(e)||a.push(e)}),this.syncEngine.applyActiveTargetsChange(s,a).then(()=>{this.activeClients=r})}handleOnlineStateEvent(e){this.activeClients.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}extractActiveQueryTargets(e){let t=i8();return e.forEach((e,r)=>{t=t.unionWith(r.activeTargetIds)}),t}}function hc(e){let t=e2.INVALID;if(null!=e)try{let r=JSON.parse(e);D("number"==typeof r,30636,{seqString:e}),t=r}catch(e){I(hn,"Failed to read sequence number from WebStorage",e)}return t}class hh{constructor(){this.localState=new hl,this.queryState={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.localState.addQueryTarget(e),this.queryState[e]||"not-current"}updateQueryState(e,t,r){this.queryState[e]=t}removeLocalQueryTarget(e){this.localState.removeQueryTarget(e)}isLocalQueryTarget(e){return this.localState.activeTargetIds.has(e)}clearQueryState(e){delete this.queryState[e]}getAllActiveQueryTargets(){return this.localState.activeTargetIds}isActiveQueryTarget(e){return this.localState.activeTargetIds.has(e)}start(){return this.localState=new hl,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class hd{addCallback(e){}shutdown(){}}class hp{constructor(e){this.sendFn=e.sendFn,this.closeFn=e.closeFn}onConnected(e){this.wrappedOnConnected=e}onOpen(e){this.wrappedOnOpen=e}onClose(e){this.wrappedOnClose=e}onMessage(e){this.wrappedOnMessage=e}close(){this.closeFn()}send(e){this.sendFn(e)}callOnConnected(){this.wrappedOnConnected()}callOnOpen(){this.wrappedOnOpen()}callOnClose(e){this.wrappedOnClose(e)}callOnMessage(e){this.wrappedOnMessage(e)}}let hf=null;function hm(){return 268435456+Math.round(2147483648*Math.random())}function hg(){return null===hf?hf=hm():hf++,"0x"+hf.toString(16)}function hy(e){return new Promise((t,r)=>{e((e,n)=>{e?r(e):t(n)})})}let hv="1.9.15",hb="GrpcConnection",hT=`gl-node/${process.versions.node} fire/${T} grpc/${hv}`;function hS(e,t,r,n){D(null===t||"OAuth"===t.type,36936);let i=new m.SF;return t&&t.headers.forEach((e,t)=>i.set(t,e)),r&&r.headers.forEach((e,t)=>i.set(t,e)),n&&i.set("X-Firebase-GMPID",n),i.set("X-Goog-Api-Client",hT),i.set("Google-Cloud-Resource-Prefix",e),i.set("x-goog-request-params",e),i}class hE{get shouldResourcePathBeIncludedInRequest(){return!0}constructor(e,t){this.databaseInfo=t,this.cachedStub=null,this.firestore=e.google.firestore.v1,this.databasePath=`projects/${t.databaseId.projectId}/databases/${t.databaseId.database}`}ensureActiveStub(){if(!this.cachedStub){_(hb,"Creating Firestore stub.");let e=this.databaseInfo.ssl?m.K9.createSsl():m.K9.createInsecure();this.cachedStub=new this.firestore.Firestore(this.databaseInfo.host,e)}return this.cachedStub}invokeRPC(e,t,r,n,i){let s=hg(),a=this.ensureActiveStub(),o=hS(this.databasePath,n,i,this.databaseInfo.appId),l={database:this.databasePath,...r};return hy(t=>(_(hb,`RPC '${e}' ${s} invoked with request:`,r),a[e](l,o,(r,n)=>{r?(_(hb,`RPC '${e}' ${s} failed with error:`,r),t(new P(sH(r.code),r.message))):(_(hb,`RPC '${e}' ${s} completed with response:`,n),t(void 0,n))})))}invokeStreamingRPC(e,t,r,n,i,s){let a=hg(),o=[],l=new M;_(hb,`RPC '${e}' ${a} invoked (streaming) with request:`,r);let u=this.ensureActiveStub(),c=hS(this.databasePath,n,i,this.databaseInfo.appId),h={...r,database:this.databasePath},d=u[e](h,c),p=!1;return d.on("data",t=>{_(hb,`RPC ${e} ${a} received result:`,t),o.push(t),void 0!==s&&o.length===s&&(p=!0,l.resolve(o))}),d.on("end",()=>{_(hb,`RPC '${e}' ${a} completed.`),p||(p=!0,l.resolve(o))}),d.on("error",t=>{_(hb,`RPC '${e}' ${a} failed with error:`,t);let r=sH(t.code);l.reject(new P(r,t.message))}),l.promise}openStream(e,t,r){let n=hg(),i=this.ensureActiveStub(),s=hS(this.databasePath,t,r,this.databaseInfo.appId),a=i[e](s),o=!1,l=e=>{o||(o=!0,u.callOnClose(e),a.end())},u=new hp({sendFn:t=>{if(o)_(hb,`RPC '${e}' stream ${n} not sending because gRPC stream is closed:`,t);else{_(hb,`RPC '${e}' stream ${n} sending:`,t);try{a.write(t)}catch(e){throw I("Failure sending:",t),I("Error:",e),e}}},closeFn:()=>{_(hb,`RPC '${e}' stream ${n} closed locally via close().`),l()}}),c=!1;return a.on("data",t=>{o||(_(hb,`RPC '${e}' stream ${n} received:`,t),c||(u.callOnConnected(),c=!0),u.callOnMessage(t))}),a.on("end",()=>{_(hb,`RPC '${e}' stream ${n} ended.`),l()}),a.on("error",t=>{o||(R(hb,`RPC '${e}' stream ${n} error. Code:`,t.code,"Message:",t.message),l(new P(sH(t.code),t.message)))}),_(hb,`Opening RPC '${e}' stream ${n} to ${this.databaseInfo.host}`),setTimeout(()=>{u.callOnOpen()},0),u}terminate(){this.cachedStub&&(this.cachedStub.close(),this.cachedStub=void 0)}}let hw={google:{nested:{protobuf:{options:{csharp_namespace:"Google.Protobuf.WellKnownTypes",go_package:"github.com/golang/protobuf/ptypes/wrappers",java_package:"com.google.protobuf",java_outer_classname:"WrappersProto",java_multiple_files:!0,objc_class_prefix:"GPB",cc_enable_arenas:!0,optimize_for:"SPEED"},nested:{Timestamp:{fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}},FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5},serverStreaming:{type:"bool",id:6}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16},javaGenericServices:{type:"bool",id:17},pyGenericServices:{type:"bool",id:18},deprecated:{type:"bool",id:23},ccEnableArenas:{type:"bool",id:31},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1},noStandardDescriptorAccessor:{type:"bool",id:2},deprecated:{type:"bool",id:3},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[8,8]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5},deprecated:{type:"bool",id:3},weak:{type:"bool",id:10},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}},Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},Empty:{fields:{}},DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}},Any:{fields:{typeUrl:{type:"string",id:1},value:{type:"bytes",id:2}}}}},firestore:{nested:{v1:{options:{csharp_namespace:"Google.Cloud.Firestore.V1",go_package:"google.golang.org/genproto/googleapis/firestore/v1;firestore",java_multiple_files:!0,java_outer_classname:"WriteProto",java_package:"com.google.firestore.v1",objc_class_prefix:"GCFS",php_namespace:"Google\\Cloud\\Firestore\\V1",ruby_package:"Google::Cloud::Firestore::V1"},nested:{AggregationResult:{fields:{aggregateFields:{keyType:"string",type:"Value",id:2}}},BitSequence:{fields:{bitmap:{type:"bytes",id:1},padding:{type:"int32",id:2}}},BloomFilter:{fields:{bits:{type:"BitSequence",id:1},hashCount:{type:"int32",id:2}}},DocumentMask:{fields:{fieldPaths:{rule:"repeated",type:"string",id:1}}},Precondition:{oneofs:{conditionType:{oneof:["exists","updateTime"]}},fields:{exists:{type:"bool",id:1},updateTime:{type:"google.protobuf.Timestamp",id:2}}},TransactionOptions:{oneofs:{mode:{oneof:["readOnly","readWrite"]}},fields:{readOnly:{type:"ReadOnly",id:2},readWrite:{type:"ReadWrite",id:3}},nested:{ReadWrite:{fields:{retryTransaction:{type:"bytes",id:1}}},ReadOnly:{oneofs:{consistencySelector:{oneof:["readTime"]}},fields:{readTime:{type:"google.protobuf.Timestamp",id:2}}}}},Document:{fields:{name:{type:"string",id:1},fields:{keyType:"string",type:"Value",id:2},createTime:{type:"google.protobuf.Timestamp",id:3},updateTime:{type:"google.protobuf.Timestamp",id:4}}},Value:{oneofs:{valueType:{oneof:["nullValue","booleanValue","integerValue","doubleValue","timestampValue","stringValue","bytesValue","referenceValue","geoPointValue","arrayValue","mapValue"]}},fields:{nullValue:{type:"google.protobuf.NullValue",id:11},booleanValue:{type:"bool",id:1},integerValue:{type:"int64",id:2},doubleValue:{type:"double",id:3},timestampValue:{type:"google.protobuf.Timestamp",id:10},stringValue:{type:"string",id:17},bytesValue:{type:"bytes",id:18},referenceValue:{type:"string",id:5},geoPointValue:{type:"google.type.LatLng",id:8},arrayValue:{type:"ArrayValue",id:9},mapValue:{type:"MapValue",id:6}}},ArrayValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},MapValue:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Firestore:{options:{"(google.api.default_host)":"firestore.googleapis.com","(google.api.oauth_scopes)":"https://www.googleapis.com/auth/cloud-platform,https://www.googleapis.com/auth/datastore"},methods:{GetDocument:{requestType:"GetDocumentRequest",responseType:"Document",options:{"(google.api.http).get":"/v1/{name=projects/*/databases/*/documents/*/**}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{name=projects/*/databases/*/documents/*/**}"}}]},ListDocuments:{requestType:"ListDocumentsRequest",responseType:"ListDocumentsResponse",options:{"(google.api.http).get":"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"}}]},UpdateDocument:{requestType:"UpdateDocumentRequest",responseType:"Document",options:{"(google.api.http).patch":"/v1/{document.name=projects/*/databases/*/documents/*/**}","(google.api.http).body":"document","(google.api.method_signature)":"document,update_mask"},parsedOptions:[{"(google.api.http)":{patch:"/v1/{document.name=projects/*/databases/*/documents/*/**}",body:"document"}},{"(google.api.method_signature)":"document,update_mask"}]},DeleteDocument:{requestType:"DeleteDocumentRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).delete":"/v1/{name=projects/*/databases/*/documents/*/**}","(google.api.method_signature)":"name"},parsedOptions:[{"(google.api.http)":{delete:"/v1/{name=projects/*/databases/*/documents/*/**}"}},{"(google.api.method_signature)":"name"}]},BatchGetDocuments:{requestType:"BatchGetDocumentsRequest",responseType:"BatchGetDocumentsResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchGet","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchGet",body:"*"}}]},BeginTransaction:{requestType:"BeginTransactionRequest",responseType:"BeginTransactionResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:beginTransaction","(google.api.http).body":"*","(google.api.method_signature)":"database"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:beginTransaction",body:"*"}},{"(google.api.method_signature)":"database"}]},Commit:{requestType:"CommitRequest",responseType:"CommitResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:commit","(google.api.http).body":"*","(google.api.method_signature)":"database,writes"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:commit",body:"*"}},{"(google.api.method_signature)":"database,writes"}]},Rollback:{requestType:"RollbackRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:rollback","(google.api.http).body":"*","(google.api.method_signature)":"database,transaction"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:rollback",body:"*"}},{"(google.api.method_signature)":"database,transaction"}]},RunQuery:{requestType:"RunQueryRequest",responseType:"RunQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery",body:"*"}}}]},RunAggregationQuery:{requestType:"RunAggregationQueryRequest",responseType:"RunAggregationQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery",body:"*"}}}]},PartitionQuery:{requestType:"PartitionQueryRequest",responseType:"PartitionQueryResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:partitionQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:partitionQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery",body:"*"}}}]},Write:{requestType:"WriteRequest",requestStream:!0,responseType:"WriteResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:write","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:write",body:"*"}}]},Listen:{requestType:"ListenRequest",requestStream:!0,responseType:"ListenResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:listen","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:listen",body:"*"}}]},ListCollectionIds:{requestType:"ListCollectionIdsRequest",responseType:"ListCollectionIdsResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds","(google.api.http).additional_bindings.body":"*","(google.api.method_signature)":"parent"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds",body:"*"}}},{"(google.api.method_signature)":"parent"}]},BatchWrite:{requestType:"BatchWriteRequest",responseType:"BatchWriteResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchWrite","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchWrite",body:"*"}}]},CreateDocument:{requestType:"CreateDocumentRequest",responseType:"Document",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}","(google.api.http).body":"document"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}",body:"document"}}]}}},GetDocumentRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:5}}},ListDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:3},pageToken:{type:"string",id:4},orderBy:{type:"string",id:6},mask:{type:"DocumentMask",id:7},transaction:{type:"bytes",id:8},readTime:{type:"google.protobuf.Timestamp",id:10},showMissing:{type:"bool",id:12}}},ListDocumentsResponse:{fields:{documents:{rule:"repeated",type:"Document",id:1},nextPageToken:{type:"string",id:2}}},CreateDocumentRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},documentId:{type:"string",id:3},document:{type:"Document",id:4,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:5}}},UpdateDocumentRequest:{fields:{document:{type:"Document",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},updateMask:{type:"DocumentMask",id:2},mask:{type:"DocumentMask",id:3},currentDocument:{type:"Precondition",id:4}}},DeleteDocumentRequest:{fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},currentDocument:{type:"Precondition",id:2}}},BatchGetDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},documents:{rule:"repeated",type:"string",id:2},mask:{type:"DocumentMask",id:3},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:7}}},BatchGetDocumentsResponse:{oneofs:{result:{oneof:["found","missing"]}},fields:{found:{type:"Document",id:1},missing:{type:"string",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:4}}},BeginTransactionRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},options:{type:"TransactionOptions",id:2}}},BeginTransactionResponse:{fields:{transaction:{type:"bytes",id:1}}},CommitRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},transaction:{type:"bytes",id:3}}},CommitResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},commitTime:{type:"google.protobuf.Timestamp",id:2}}},RollbackRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},transaction:{type:"bytes",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}}}},RunQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},transaction:{type:"bytes",id:5},newTransaction:{type:"TransactionOptions",id:6},readTime:{type:"google.protobuf.Timestamp",id:7}}},RunQueryResponse:{fields:{transaction:{type:"bytes",id:2},document:{type:"Document",id:1},readTime:{type:"google.protobuf.Timestamp",id:3},skippedResults:{type:"int32",id:4}}},RunAggregationQueryRequest:{oneofs:{queryType:{oneof:["structuredAggregationQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredAggregationQuery:{type:"StructuredAggregationQuery",id:2},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:6}}},RunAggregationQueryResponse:{fields:{result:{type:"AggregationResult",id:1},transaction:{type:"bytes",id:2},readTime:{type:"google.protobuf.Timestamp",id:3}}},PartitionQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},partitionCount:{type:"int64",id:3},pageToken:{type:"string",id:4},pageSize:{type:"int32",id:5}}},PartitionQueryResponse:{fields:{partitions:{rule:"repeated",type:"Cursor",id:1},nextPageToken:{type:"string",id:2}}},WriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},streamId:{type:"string",id:2},writes:{rule:"repeated",type:"Write",id:3},streamToken:{type:"bytes",id:4},labels:{keyType:"string",type:"string",id:5}}},WriteResponse:{fields:{streamId:{type:"string",id:1},streamToken:{type:"bytes",id:2},writeResults:{rule:"repeated",type:"WriteResult",id:3},commitTime:{type:"google.protobuf.Timestamp",id:4}}},ListenRequest:{oneofs:{targetChange:{oneof:["addTarget","removeTarget"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},addTarget:{type:"Target",id:2},removeTarget:{type:"int32",id:3},labels:{keyType:"string",type:"string",id:4}}},ListenResponse:{oneofs:{responseType:{oneof:["targetChange","documentChange","documentDelete","documentRemove","filter"]}},fields:{targetChange:{type:"TargetChange",id:2},documentChange:{type:"DocumentChange",id:3},documentDelete:{type:"DocumentDelete",id:4},documentRemove:{type:"DocumentRemove",id:6},filter:{type:"ExistenceFilter",id:5}}},Target:{oneofs:{targetType:{oneof:["query","documents"]},resumeType:{oneof:["resumeToken","readTime"]}},fields:{query:{type:"QueryTarget",id:2},documents:{type:"DocumentsTarget",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:11},targetId:{type:"int32",id:5},once:{type:"bool",id:6},expectedCount:{type:"google.protobuf.Int32Value",id:12}},nested:{DocumentsTarget:{fields:{documents:{rule:"repeated",type:"string",id:2}}},QueryTarget:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1},structuredQuery:{type:"StructuredQuery",id:2}}}}},TargetChange:{fields:{targetChangeType:{type:"TargetChangeType",id:1},targetIds:{rule:"repeated",type:"int32",id:2},cause:{type:"google.rpc.Status",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:6}},nested:{TargetChangeType:{values:{NO_CHANGE:0,ADD:1,REMOVE:2,CURRENT:3,RESET:4}}}},ListCollectionIdsRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:2},pageToken:{type:"string",id:3}}},ListCollectionIdsResponse:{fields:{collectionIds:{rule:"repeated",type:"string",id:1},nextPageToken:{type:"string",id:2}}},BatchWriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},labels:{keyType:"string",type:"string",id:3}}},BatchWriteResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},status:{rule:"repeated",type:"google.rpc.Status",id:2}}},StructuredQuery:{fields:{select:{type:"Projection",id:1},from:{rule:"repeated",type:"CollectionSelector",id:2},where:{type:"Filter",id:3},orderBy:{rule:"repeated",type:"Order",id:4},startAt:{type:"Cursor",id:7},endAt:{type:"Cursor",id:8},offset:{type:"int32",id:6},limit:{type:"google.protobuf.Int32Value",id:5}},nested:{CollectionSelector:{fields:{collectionId:{type:"string",id:2},allDescendants:{type:"bool",id:3}}},Filter:{oneofs:{filterType:{oneof:["compositeFilter","fieldFilter","unaryFilter"]}},fields:{compositeFilter:{type:"CompositeFilter",id:1},fieldFilter:{type:"FieldFilter",id:2},unaryFilter:{type:"UnaryFilter",id:3}}},CompositeFilter:{fields:{op:{type:"Operator",id:1},filters:{rule:"repeated",type:"Filter",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,AND:1,OR:2}}}},FieldFilter:{fields:{field:{type:"FieldReference",id:1},op:{type:"Operator",id:2},value:{type:"Value",id:3}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,LESS_THAN:1,LESS_THAN_OR_EQUAL:2,GREATER_THAN:3,GREATER_THAN_OR_EQUAL:4,EQUAL:5,NOT_EQUAL:6,ARRAY_CONTAINS:7,IN:8,ARRAY_CONTAINS_ANY:9,NOT_IN:10}}}},UnaryFilter:{oneofs:{operandType:{oneof:["field"]}},fields:{op:{type:"Operator",id:1},field:{type:"FieldReference",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,IS_NAN:2,IS_NULL:3,IS_NOT_NAN:4,IS_NOT_NULL:5}}}},Order:{fields:{field:{type:"FieldReference",id:1},direction:{type:"Direction",id:2}}},FieldReference:{fields:{fieldPath:{type:"string",id:2}}},Projection:{fields:{fields:{rule:"repeated",type:"FieldReference",id:2}}},Direction:{values:{DIRECTION_UNSPECIFIED:0,ASCENDING:1,DESCENDING:2}}}},StructuredAggregationQuery:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{structuredQuery:{type:"StructuredQuery",id:1},aggregations:{rule:"repeated",type:"Aggregation",id:3}},nested:{Aggregation:{oneofs:{operator:{oneof:["count","sum","avg"]}},fields:{count:{type:"Count",id:1},sum:{type:"Sum",id:2},avg:{type:"Avg",id:3},alias:{type:"string",id:7}},nested:{Count:{fields:{upTo:{type:"google.protobuf.Int64Value",id:1}}},Sum:{fields:{field:{type:"FieldReference",id:1}}},Avg:{fields:{field:{type:"FieldReference",id:1}}}}}}},Cursor:{fields:{values:{rule:"repeated",type:"Value",id:1},before:{type:"bool",id:2}}},Write:{oneofs:{operation:{oneof:["update","delete","verify","transform"]}},fields:{update:{type:"Document",id:1},delete:{type:"string",id:2},verify:{type:"string",id:5},transform:{type:"DocumentTransform",id:6},updateMask:{type:"DocumentMask",id:3},updateTransforms:{rule:"repeated",type:"DocumentTransform.FieldTransform",id:7},currentDocument:{type:"Precondition",id:4}}},DocumentTransform:{fields:{document:{type:"string",id:1},fieldTransforms:{rule:"repeated",type:"FieldTransform",id:2}},nested:{FieldTransform:{oneofs:{transformType:{oneof:["setToServerValue","increment","maximum","minimum","appendMissingElements","removeAllFromArray"]}},fields:{fieldPath:{type:"string",id:1},setToServerValue:{type:"ServerValue",id:2},increment:{type:"Value",id:3},maximum:{type:"Value",id:4},minimum:{type:"Value",id:5},appendMissingElements:{type:"ArrayValue",id:6},removeAllFromArray:{type:"ArrayValue",id:7}},nested:{ServerValue:{values:{SERVER_VALUE_UNSPECIFIED:0,REQUEST_TIME:1}}}}}},WriteResult:{fields:{updateTime:{type:"google.protobuf.Timestamp",id:1},transformResults:{rule:"repeated",type:"Value",id:2}}},DocumentChange:{fields:{document:{type:"Document",id:1},targetIds:{rule:"repeated",type:"int32",id:5},removedTargetIds:{rule:"repeated",type:"int32",id:6}}},DocumentDelete:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:6},readTime:{type:"google.protobuf.Timestamp",id:4}}},DocumentRemove:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:2},readTime:{type:"google.protobuf.Timestamp",id:4}}},ExistenceFilter:{fields:{targetId:{type:"int32",id:1},count:{type:"int32",id:2},unchangedNames:{type:"BloomFilter",id:3}}}}}}},api:{options:{go_package:"google.golang.org/genproto/googleapis/api/annotations;annotations",java_multiple_files:!0,java_outer_classname:"HttpProto",java_package:"com.google.api",objc_class_prefix:"GAPI",cc_enable_arenas:!0},nested:{http:{type:"HttpRule",id:72295728,extend:"google.protobuf.MethodOptions"},Http:{fields:{rules:{rule:"repeated",type:"HttpRule",id:1}}},HttpRule:{oneofs:{pattern:{oneof:["get","put","post","delete","patch","custom"]}},fields:{get:{type:"string",id:2},put:{type:"string",id:3},post:{type:"string",id:4},delete:{type:"string",id:5},patch:{type:"string",id:6},custom:{type:"CustomHttpPattern",id:8},selector:{type:"string",id:1},body:{type:"string",id:7},additionalBindings:{rule:"repeated",type:"HttpRule",id:11}}},CustomHttpPattern:{fields:{kind:{type:"string",id:1},path:{type:"string",id:2}}},methodSignature:{rule:"repeated",type:"string",id:1051,extend:"google.protobuf.MethodOptions"},defaultHost:{type:"string",id:1049,extend:"google.protobuf.ServiceOptions"},oauthScopes:{type:"string",id:1050,extend:"google.protobuf.ServiceOptions"},fieldBehavior:{rule:"repeated",type:"google.api.FieldBehavior",id:1052,extend:"google.protobuf.FieldOptions"},FieldBehavior:{values:{FIELD_BEHAVIOR_UNSPECIFIED:0,OPTIONAL:1,REQUIRED:2,OUTPUT_ONLY:3,INPUT_ONLY:4,IMMUTABLE:5,UNORDERED_LIST:6,NON_EMPTY_DEFAULT:7}}}},type:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/type/latlng;latlng",java_multiple_files:!0,java_outer_classname:"LatLngProto",java_package:"com.google.type",objc_class_prefix:"GTP"},nested:{LatLng:{fields:{latitude:{type:"double",id:1},longitude:{type:"double",id:2}}}}},rpc:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/rpc/status;status",java_multiple_files:!0,java_outer_classname:"StatusProto",java_package:"com.google.rpc",objc_class_prefix:"RPC"},nested:{Status:{fields:{code:{type:"int32",id:1},message:{type:"string",id:2},details:{rule:"repeated",type:"google.protobuf.Any",id:3}}}}}}}};var hC={nested:hw},h_=Object.freeze({__proto__:null,nested:hw,default:hC});let hI={longs:String,enums:String,defaults:!0,oneofs:!1};function hR(){let e=g.im(h_,hI);return m.Rz(e)}function hN(e){return new hE(hR(),e)}function hk(){return new hd}function hA(){return"YES"===process.env.USE_MOCK_PERSISTENCE?window:null}function hD(){return null}function hO(e){return new al(e,!1)}let hx="ExponentialBackoff",hP=1e3,hM=1.5,hL=6e4;class hF{constructor(e,t,r=hP,n=hM,i=hL){this.queue=e,this.timerId=t,this.initialDelayMs=r,this.backoffFactor=n,this.maxDelayMs=i,this.currentBaseMs=0,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}reset(){this.currentBaseMs=0}resetToMax(){this.currentBaseMs=this.maxDelayMs}backoffAndRun(e){this.cancel();let t=Math.floor(this.currentBaseMs+this.jitterDelayMs()),r=Math.max(0,Date.now()-this.lastAttemptTime),n=Math.max(0,t-r);n>0&&_(hx,`Backing off for ${n} ms (base delay: ${this.currentBaseMs} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,n,()=>(this.lastAttemptTime=Date.now(),e())),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)}skipBackoff(){null!==this.timerPromise&&(this.timerPromise.skipDelay(),this.timerPromise=null)}cancel(){null!==this.timerPromise&&(this.timerPromise.cancel(),this.timerPromise=null)}jitterDelayMs(){return(Math.random()-.5)*this.currentBaseMs}}let hB="PersistentStream",hU=6e4,hV=1e4;class hj{constructor(e,t,r,n,i,s,a,o){this.queue=e,this.idleTimerId=r,this.healthTimerId=n,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=a,this.listener=o,this.state=0,this.closeCount=0,this.idleTimer=null,this.healthCheck=null,this.stream=null,this.responseCount=0,this.backoff=new hF(e,t)}isStarted(){return 1===this.state||5===this.state||this.isOpen()}isOpen(){return 2===this.state||3===this.state}start(){if(this.responseCount=0,4===this.state){this.performBackoff();return}this.auth()}async stop(){this.isStarted()&&await this.close(0)}inhibitBackoff(){this.state=0,this.backoff.reset()}markIdle(){this.isOpen()&&null===this.idleTimer&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,hU,()=>this.handleIdleCloseTimer()))}sendRequest(e){this.cancelIdleCheck(),this.stream.send(e)}async handleIdleCloseTimer(){if(this.isOpen())return this.close(0)}cancelIdleCheck(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)}cancelHealthCheck(){this.healthCheck&&(this.healthCheck.cancel(),this.healthCheck=null)}async close(e,t){this.cancelIdleCheck(),this.cancelHealthCheck(),this.backoff.cancel(),this.closeCount++,4!==e?this.backoff.reset():t&&t.code===x.RESOURCE_EXHAUSTED?(I(t.toString()),I("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):t&&t.code===x.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=e,await this.listener.onClose(t)}tearDown(){}auth(){this.state=1;let e=this.getCloseGuardedDispatcher(this.closeCount),t=this.closeCount;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,r])=>{this.closeCount===t&&this.startStream(e,r)},t=>{e(()=>{let e=new P(x.UNKNOWN,"Fetching auth token failed: "+t.message);return this.handleStreamClose(e)})})}startStream(e,t){let r=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(e,t),this.stream.onConnected(()=>{r(()=>this.listener.onConnected())}),this.stream.onOpen(()=>{r(()=>(this.state=2,this.healthCheck=this.queue.enqueueAfterDelay(this.healthTimerId,hV,()=>(this.isOpen()&&(this.state=3),Promise.resolve())),this.listener.onOpen()))}),this.stream.onClose(e=>{r(()=>this.handleStreamClose(e))}),this.stream.onMessage(e=>{r(()=>1==++this.responseCount?this.onFirst(e):this.onNext(e))})}performBackoff(){this.state=5,this.backoff.backoffAndRun(async()=>{this.state=0,this.start()})}handleStreamClose(e){return _(hB,`close with error: ${e}`),this.stream=null,this.close(4,e)}getCloseGuardedDispatcher(e){return t=>{this.queue.enqueueAndForget(()=>this.closeCount===e?t():(_(hB,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class hz extends hj{constructor(e,t,r,n,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,n,s),this.serializer=i}startRpc(e,t){return this.connection.openStream("Listen",e,t)}onFirst(e){return this.onNext(e)}onNext(e){this.backoff.reset();let t=aP(this.serializer,e),r=aL(e);return this.listener.onWatchChange(t,r)}watch(e){let t={};t.database=a_(this.serializer),t.addTarget=aZ(this.serializer,e);let r=aJ(this.serializer,e);r&&(t.labels=r),this.sendRequest(t)}unwatch(e){let t={};t.database=a_(this.serializer),t.removeTarget=e,this.sendRequest(t)}}class hq extends hj{constructor(e,t,r,n,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,n,s),this.serializer=i}get handshakeComplete(){return this.responseCount>0}start(){this.lastStreamToken=void 0,super.start()}tearDown(){this.handshakeComplete&&this.writeMutations([])}startRpc(e,t){return this.connection.openStream("Write",e,t)}onFirst(e){return D(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,D(!e.writeResults||0===e.writeResults.length,55816),this.listener.onHandshakeComplete()}onNext(e){D(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.backoff.reset();let t=az(e.writeResults,e.commitTime),r=ay(e.commitTime);return this.listener.onMutationResult(r,t)}writeHandshake(){let e={};e.database=a_(this.serializer),this.sendRequest(e)}writeMutations(e){let t={streamToken:this.lastStreamToken,writes:e.map(e=>aF(this.serializer,e))};this.sendRequest(t)}}class hG{}class h$ extends hG{constructor(e,t,r,n){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=n,this.terminated=!1}verifyInitialized(){if(this.terminated)throw new P(x.FAILED_PRECONDITION,"The client has already been terminated.")}invokeRPC(e,t,r,n){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.invokeRPC(e,ab(t,r),n,i,s)).catch(e=>{if("FirebaseError"===e.name)throw e.code===x.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e;throw new P(x.UNKNOWN,e.toString())})}invokeStreamingRPC(e,t,r,n,i){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.invokeStreamingRPC(e,ab(t,r),n,s,a,i)).catch(e=>{if("FirebaseError"===e.name)throw e.code===x.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e;throw new P(x.UNKNOWN,e.toString())})}terminate(){this.terminated=!0,this.connection.terminate()}}function hK(e,t,r,n){return new h$(e,t,r,n)}async function hW(e,t){let r=O(e),n={writes:t.map(e=>aF(r.serializer,e))};await r.invokeRPC("Commit",r.serializer.databaseId,et.emptyPath(),n)}async function hH(e,t){let r=O(e),n={documents:t.map(e=>aS(r.serializer,e))},i=await r.invokeStreamingRPC("BatchGetDocuments",r.serializer.databaseId,et.emptyPath(),n,t.length),s=new Map;i.forEach(e=>{let t=ax(r.serializer,e);s.set(t.key.toString(),t)});let a=[];return t.forEach(e=>{let t=s.get(e.toString());D(!!t,55234,{key:e}),a.push(t)}),a}async function hQ(e,t,r){let n=O(e),{request:i,aliasMap:s,parent:a}=aH(n.serializer,iA(t),r);n.connection.shouldResourcePathBeIncludedInRequest||delete i.parent;let o=(await n.invokeStreamingRPC("RunAggregationQuery",n.serializer.databaseId,a,i,1)).filter(e=>!!e.result);D(1===o.length,64727);let l=o[0].result?.aggregateFields;return Object.keys(l).reduce((e,t)=>(e[s[t]]=l[t],e),{})}function hY(e,t,r){let n=O(e);return n.verifyInitialized(),new hq(t,n.connection,n.authCredentials,n.appCheckCredentials,n.serializer,r)}function hJ(e,t,r){let n=O(e);return n.verifyInitialized(),new hz(t,n.connection,n.authCredentials,n.appCheckCredentials,n.serializer,r)}let hX="OnlineStateTracker",hZ=1,h0=1e4;class h1{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}handleWatchStreamStart(){0===this.watchStreamFailures&&(this.setAndBroadcast("Unknown"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay("online_state_timeout",h0,()=>(this.onlineStateTimer=null,this.logClientOfflineWarningIfNecessary(`Backend didn't respond within ${h0/1e3} seconds.`),this.setAndBroadcast("Offline"),Promise.resolve())))}handleWatchStreamFailure(e){"Online"===this.state?this.setAndBroadcast("Unknown"):(this.watchStreamFailures++,this.watchStreamFailures>=hZ&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary(`Connection failed ${hZ} times. Most recent error: ${e.toString()}`),this.setAndBroadcast("Offline")))}set(e){this.clearOnlineStateTimer(),this.watchStreamFailures=0,"Online"===e&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(e)}setAndBroadcast(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}logClientOfflineWarningIfNecessary(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.shouldWarnClientIsOffline?(I(t),this.shouldWarnClientIsOffline=!1):_(hX,t)}clearOnlineStateTimer(){null!==this.onlineStateTimer&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)}}let h2="RemoteStore",h4=10;class h3{constructor(e,t,r,n,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.writePipeline=[],this.listenTargets=new Map,this.offlineCauses=new Set,this.onNetworkStatusChange=[],this.connectivityMonitor=i,this.connectivityMonitor.addCallback(e=>{r.enqueueAndForget(async()=>{ds(this)&&(_(h2,"Restarting streams for network reachability change."),await dI(this))})}),this.onlineStateTracker=new h1(r,n)}}function h6(e,t,r,n,i){return new h3(e,t,r,n,i)}async function h9(e){if(ds(e))for(let t of e.onNetworkStatusChange)await t(!0)}async function h5(e){for(let t of e.onNetworkStatusChange)await t(!1)}async function h7(e){let t=O(e);_(h2,"RemoteStore shutting down."),t.offlineCauses.add(5),await h5(t),t.connectivityMonitor.shutdown(),t.onlineStateTracker.set("Unknown")}function h8(e,t){let r=O(e);!r.listenTargets.has(t.targetId)&&(r.listenTargets.set(t.targetId,t),di(r)?dn(r):dk(r).isOpen()&&dt(r,t))}function de(e,t){let r=O(e),n=dk(r);r.listenTargets.delete(t),n.isOpen()&&dr(r,t),0===r.listenTargets.size&&(n.isOpen()?n.markIdle():ds(r)&&r.onlineStateTracker.set("Unknown"))}function dt(e,t){if(e.watchChangeAggregator.recordPendingTargetRequest(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(ev.min())>0){let r=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(r)}dk(e).watch(t)}function dr(e,t){e.watchChangeAggregator.recordPendingTargetRequest(t),dk(e).unwatch(t)}function dn(e){e.watchChangeAggregator=new at({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),getTargetDataForTarget:t=>e.listenTargets.get(t)||null,getDatabaseId:()=>e.datastore.serializer.databaseId}),dk(e).start(),e.onlineStateTracker.handleWatchStreamStart()}function di(e){return ds(e)&&!dk(e).isStarted()&&e.listenTargets.size>0}function ds(e){return 0===O(e).offlineCauses.size}function da(e){e.watchChangeAggregator=void 0}async function dl(e){e.onlineStateTracker.set("Online")}async function du(e){e.listenTargets.forEach((t,r)=>{dt(e,t)})}async function dc(e,t){da(e),di(e)?(e.onlineStateTracker.handleWatchStreamFailure(t),dn(e)):e.onlineStateTracker.set("Unknown")}async function dh(e,t,r){if(e.onlineStateTracker.set("Online"),t instanceof s7&&2===t.state&&t.cause){try{await dm(e,t)}catch(r){_(h2,"Failed to remove targets %s: %s ",t.targetIds.join(","),r),await dd(e,r)}return}if(t instanceof s9?e.watchChangeAggregator.handleDocumentChange(t):t instanceof s5?e.watchChangeAggregator.handleExistenceFilter(t):e.watchChangeAggregator.handleTargetChange(t),!r.isEqual(ev.min()))try{let t=await cI(e.localStore);r.compareTo(t)>=0&&await df(e,r)}catch(t){_(h2,"Failed to raise snapshot:",t),await dd(e,t)}}async function dd(e,t,r){if(e$(t))e.offlineCauses.add(1),await h5(e),e.onlineStateTracker.set("Offline"),r||(r=()=>cI(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{_(h2,"Retrying IndexedDB access"),await r(),e.offlineCauses.delete(1),await h9(e)});else throw t}function dp(e,t){return t().catch(r=>dd(e,r,t))}function df(e,t){let r=e.watchChangeAggregator.createRemoteEvent(t);return r.targetChanges.forEach((r,n)=>{if(r.resumeToken.approximateByteSize()>0){let i=e.listenTargets.get(n);i&&e.listenTargets.set(n,i.withResumeToken(r.resumeToken,t))}}),r.targetMismatches.forEach((t,r)=>{let n=e.listenTargets.get(t);n&&(e.listenTargets.set(t,n.withResumeToken(rE.EMPTY_BYTE_STRING,n.snapshotVersion)),dr(e,t),dt(e,new ov(n.target,t,r,n.sequenceNumber)))}),e.remoteSyncer.applyRemoteEvent(r)}async function dm(e,t){let r=t.cause;for(let n of t.targetIds)e.listenTargets.has(n)&&(await e.remoteSyncer.rejectListen(n,r),e.listenTargets.delete(n),e.watchChangeAggregator.removeTarget(n))}async function dg(e){let t=O(e),r=dA(t),n=t.writePipeline.length>0?t.writePipeline[t.writePipeline.length-1].batchId:rj;for(;dy(t);)try{let e=await cD(t.localStore,n);if(null===e){0===t.writePipeline.length&&r.markIdle();break}n=e.batchId,dv(t,e)}catch(e){await dd(t,e)}db(t)&&dT(t)}function dy(e){return ds(e)&&e.writePipeline.length<h4}function dv(e,t){e.writePipeline.push(t);let r=dA(e);r.isOpen()&&r.handshakeComplete&&r.writeMutations(t.mutations)}function db(e){return ds(e)&&!dA(e).isStarted()&&e.writePipeline.length>0}function dT(e){dA(e).start()}async function dS(e){dA(e).writeHandshake()}async function dE(e){let t=dA(e);for(let r of e.writePipeline)t.writeMutations(r.mutations)}async function dw(e,t,r){let n=e.writePipeline.shift(),i=sq.from(n,t,r);await dp(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await dg(e)}async function dC(e,t){t&&dA(e).handshakeComplete&&await d_(e,t),db(e)&&dT(e)}async function d_(e,t){if(sW(t.code)){let r=e.writePipeline.shift();dA(e).inhibitBackoff(),await dp(e,()=>e.remoteSyncer.rejectFailedWrite(r.batchId,t)),await dg(e)}}async function dI(e){let t=O(e);t.offlineCauses.add(4),await h5(t),t.onlineStateTracker.set("Unknown"),t.offlineCauses.delete(4),await h9(t)}async function dR(e,t){let r=O(e);r.asyncQueue.verifyOperationInProgress(),_(h2,"RemoteStore received new credentials");let n=ds(r);r.offlineCauses.add(3),await h5(r),n&&r.onlineStateTracker.set("Unknown"),await r.remoteSyncer.handleCredentialChange(t),r.offlineCauses.delete(3),await h9(r)}async function dN(e,t){let r=O(e);t?(r.offlineCauses.delete(2),await h9(r)):t||(r.offlineCauses.add(2),await h5(r),r.onlineStateTracker.set("Unknown"))}function dk(e){return e.watchStream||(e.watchStream=hJ(e.datastore,e.asyncQueue,{onConnected:dl.bind(null,e),onOpen:du.bind(null,e),onClose:dc.bind(null,e),onWatchChange:dh.bind(null,e)}),e.onNetworkStatusChange.push(async t=>{t?(e.watchStream.inhibitBackoff(),di(e)?dn(e):e.onlineStateTracker.set("Unknown")):(await e.watchStream.stop(),da(e))})),e.watchStream}function dA(e){return e.writeStream||(e.writeStream=hY(e.datastore,e.asyncQueue,{onConnected:()=>Promise.resolve(),onOpen:dS.bind(null,e),onClose:dC.bind(null,e),onHandshakeComplete:dE.bind(null,e),onMutationResult:dw.bind(null,e)}),e.onNetworkStatusChange.push(async t=>{t?(e.writeStream.inhibitBackoff(),await dg(e)):(await e.writeStream.stop(),e.writePipeline.length>0&&(_(h2,`Stopping write stream with ${e.writePipeline.length} pending writes`),e.writePipeline=[]))})),e.writeStream}let dD="AsyncQueue";class dO{constructor(e,t,r,n,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=n,this.removalCallback=i,this.deferred=new M,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,n,i){let s=new dO(e,t,Date.now()+r,n,i);return s.start(r),s}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new P(x.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function dx(e,t){if(I(dD,`${t}: ${e}`),e$(e))return new P(x.UNAVAILABLE,`${t}: ${e}`);throw e}class dP{static emptySet(e){return new dP(e.comparator)}constructor(e){e?this.comparator=(t,r)=>e(t,r)||ei.comparator(t.key,r.key):this.comparator=(e,t)=>ei.comparator(e.key,t.key),this.keyedMap=iX(),this.sortedSet=new rh(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof dP)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let e=t.getNext().key,n=r.getNext().key;if(!e.isEqual(n))return!1}return!0}toString(){let e=[];return(this.forEach(t=>{e.push(t.toString())}),0===e.length)?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){let r=new dP;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class dM{constructor(){this.changeMap=new rh(ei.comparator)}track(e){let t=e.doc.key,r=this.changeMap.get(t);if(!r){this.changeMap=this.changeMap.insert(t,e);return}0!==e.type&&3===r.type?this.changeMap=this.changeMap.insert(t,e):3===e.type&&1!==r.type?this.changeMap=this.changeMap.insert(t,{type:r.type,doc:e.doc}):2===e.type&&2===r.type?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):2===e.type&&0===r.type?this.changeMap=this.changeMap.insert(t,{type:0,doc:e.doc}):1===e.type&&0===r.type?this.changeMap=this.changeMap.remove(t):1===e.type&&2===r.type?this.changeMap=this.changeMap.insert(t,{type:1,doc:r.doc}):0===e.type&&1===r.type?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):k(63341,{change:e,oldChange:r})}getChanges(){let e=[];return this.changeMap.inorderTraversal((t,r)=>{e.push(r)}),e}}class dL{constructor(e,t,r,n,i,s,a,o,l){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=n,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=a,this.excludesMetadataChanges=o,this.hasCachedResults=l}static fromInitialDocuments(e,t,r,n,i){let s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new dL(e,t,dP.emptySet(t),s,r,n,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(this.fromCache!==e.fromCache||this.hasCachedResults!==e.hasCachedResults||this.syncStateChanged!==e.syncStateChanged||!this.mutatedKeys.isEqual(e.mutatedKeys)||!iF(this.query,e.query)||!this.docs.isEqual(e.docs)||!this.oldDocs.isEqual(e.oldDocs))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==r[e].type||!t[e].doc.isEqual(r[e].doc))return!1;return!0}}class dF{constructor(){this.viewSnap=void 0,this.listeners=[]}hasRemoteListeners(){return this.listeners.some(e=>e.listensToRemoteStore())}}function dB(){return new dU}class dU{constructor(){this.queries=dV(),this.onlineState="Unknown",this.snapshotsInSyncListeners=new Set}terminate(){dK(this,new P(x.ABORTED,"Firestore shutting down"))}}function dV(){return new iH(e=>iB(e),iF)}async function dj(e,t){let r=O(e),n=3,i=t.query,s=r.queries.get(i);s?!s.hasRemoteListeners()&&t.listensToRemoteStore()&&(n=2):(s=new dF,n=t.listensToRemoteStore()?0:1);try{switch(n){case 0:s.viewSnap=await r.onListen(i,!0);break;case 1:s.viewSnap=await r.onListen(i,!1);break;case 2:await r.onFirstRemoteStoreListen(i)}}catch(r){let e=dx(r,`Initialization of query '${iU(t.query)}' failed`);t.onError(e);return}r.queries.set(i,s),s.listeners.push(t),t.applyOnlineStateChange(r.onlineState),s.viewSnap&&t.onViewSnapshot(s.viewSnap)&&dW(r)}async function dz(e,t){let r=O(e),n=t.query,i=3,s=r.queries.get(n);if(s){let e=s.listeners.indexOf(t);e>=0&&(s.listeners.splice(e,1),0===s.listeners.length?i=t.listensToRemoteStore()?0:1:!s.hasRemoteListeners()&&t.listensToRemoteStore()&&(i=2))}switch(i){case 0:return r.queries.delete(n),r.onUnlisten(n,!0);case 1:return r.queries.delete(n),r.onUnlisten(n,!1);case 2:return r.onLastRemoteStoreUnlisten(n);default:return}}function dq(e,t){let r=O(e),n=!1;for(let e of t){let t=e.query,i=r.queries.get(t);if(i){for(let t of i.listeners)t.onViewSnapshot(e)&&(n=!0);i.viewSnap=e}}n&&dW(r)}function dG(e,t,r){let n=O(e),i=n.queries.get(t);if(i)for(let e of i.listeners)e.onError(r);n.queries.delete(t)}function d$(e,t){let r=O(e);r.onlineState=t;let n=!1;r.queries.forEach((e,r)=>{for(let e of r.listeners)e.applyOnlineStateChange(t)&&(n=!0)}),n&&dW(r)}function dK(e,t){let r=O(e),n=r.queries;r.queries=dV(),n.forEach((e,r)=>{for(let e of r.listeners)e.onError(t)})}function dW(e){e.snapshotsInSyncListeners.forEach(e=>{e.next()})}!function(e){e.Default="default",e.Cache="cache"}(a||(a={}));class dH{constructor(e,t,r){this.query=e,this.queryObserver=t,this.raisedInitialEvent=!1,this.snap=null,this.onlineState="Unknown",this.options=r||{}}onViewSnapshot(e){if(!this.options.includeMetadataChanges){let t=[];for(let r of e.docChanges)3!==r.type&&t.push(r);e=new dL(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.raisedInitialEvent?this.shouldRaiseEvent(e)&&(this.queryObserver.next(e),t=!0):this.shouldRaiseInitialEvent(e,this.onlineState)&&(this.raiseInitialEvent(e),t=!0),this.snap=e,t}onError(e){this.queryObserver.error(e)}applyOnlineStateChange(e){this.onlineState=e;let t=!1;return this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,e)&&(this.raiseInitialEvent(this.snap),t=!0),t}shouldRaiseInitialEvent(e,t){if(!e.fromCache||!this.listensToRemoteStore())return!0;let r="Offline"!==t;return(!this.options.waitForSyncWhenOnline||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}shouldRaiseEvent(e){if(e.docChanges.length>0)return!0;let t=this.snap&&this.snap.hasPendingWrites!==e.hasPendingWrites;return(!!e.syncStateChanged||!!t)&&!0===this.options.includeMetadataChanges}raiseInitialEvent(e){e=dL.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.raisedInitialEvent=!0,this.queryObserver.next(e)}listensToRemoteStore(){return this.options.source!==a.Cache}}class dQ{constructor(e,t,r,n){this.targetId=e,this.fromCache=t,this.addedKeys=r,this.removedKeys=n}static fromSnapshot(e,t){let r=i5(),n=i5();for(let e of t.docChanges)switch(e.type){case 0:r=r.add(e.doc.key);break;case 1:n=n.add(e.doc.key)}return new dQ(e,t.fromCache,r,n)}}class dY{constructor(e){this.serializer=e}toDocumentKey(e){return aE(this.serializer,e)}toMutableDocument(e){return e.metadata.exists?aA(this.serializer,e.document,!1):nx.newNoDocument(this.toDocumentKey(e.metadata.name),this.toSnapshotVersion(e.metadata.readTime))}toSnapshotVersion(e){return ay(e)}}class dJ{constructor(e,t){this.bundleMetadata=e,this.serializer=t,this._queries=[],this._documents=[],this.collectionGroups=new Set,this.progress=dX(e)}get queries(){return this._queries}get documents(){return this._documents}addSizedElement(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.payload.namedQuery)this._queries.push(e.payload.namedQuery);else if(e.payload.documentMetadata){this._documents.push({metadata:e.payload.documentMetadata}),!e.payload.documentMetadata.exists&&++t;let r=et.fromString(e.payload.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.payload.document&&(this._documents[this._documents.length-1].document=e.payload.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,{...this.progress}):null}getQueryDocumentMapping(e){let t=new Map,r=new dY(this.serializer);for(let n of e)if(n.metadata.queries){let e=r.toDocumentKey(n.metadata.name);for(let r of n.metadata.queries){let n=(t.get(r)||i5()).add(e);t.set(r,n)}}return t}async completeAndStoreAsync(e){let t=await c$(e,new dY(this.serializer),this._documents,this.bundleMetadata.id),r=this.getQueryDocumentMapping(this.documents);for(let t of this._queries)await cQ(e,t,r.get(t.name));return this.progress.taskState="Success",{progress:this.progress,changedCollectionGroups:this.collectionGroups,changedDocs:t}}}function dX(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}function dZ(e){return{taskState:"Success",documentsLoaded:e.totalDocuments,bytesLoaded:e.totalBytes,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}class d0{constructor(e){this.key=e}}class d1{constructor(e){this.key=e}}class d2{constructor(e,t){this.query=e,this._syncedDocuments=t,this.syncState=null,this.hasCachedResults=!1,this.current=!1,this.limboDocuments=i5(),this.mutatedKeys=i5(),this.docComparator=iK(e),this.documentSet=new dP(this.docComparator)}get syncedDocuments(){return this._syncedDocuments}computeDocChanges(e,t){let r=t?t.changeSet:new dM,n=t?t.documentSet:this.documentSet,i=t?t.mutatedKeys:this.mutatedKeys,s=n,a=!1,o="F"===this.query.limitType&&n.size===this.query.limit?n.last():null,l="L"===this.query.limitType&&n.size===this.query.limit?n.first():null;if(e.inorderTraversal((e,t)=>{let u=n.get(e),c=iV(this.query,t)?t:null,h=!!u&&this.mutatedKeys.has(u.key),d=!!c&&(c.hasLocalMutations||this.mutatedKeys.has(c.key)&&c.hasCommittedMutations),p=!1;u&&c?u.data.isEqual(c.data)?h!==d&&(r.track({type:3,doc:c}),p=!0):!this.shouldWaitForSyncedDocument(u,c)&&(r.track({type:2,doc:c}),p=!0,(o&&this.docComparator(c,o)>0||l&&0>this.docComparator(c,l))&&(a=!0)):!u&&c?(r.track({type:0,doc:c}),p=!0):u&&!c&&(r.track({type:1,doc:u}),p=!0,(o||l)&&(a=!0)),p&&(c?(s=s.add(c),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))}),null!==this.query.limit)for(;s.size>this.query.limit;){let e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),r.track({type:1,doc:e})}return{documentSet:s,changeSet:r,needsRefill:a,mutatedKeys:i}}shouldWaitForSyncedDocument(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,n){let i=this.documentSet;this.documentSet=e.documentSet,this.mutatedKeys=e.mutatedKeys;let s=e.changeSet.getChanges();s.sort((e,t)=>d4(e.type,t.type)||this.docComparator(e.doc,t.doc)),this.applyTargetChange(r),n=n??!1;let a=t&&!n?this.updateLimboDocuments():[],o=0===this.limboDocuments.size&&this.current&&!n?1:0,l=o!==this.syncState;return(this.syncState=o,0!==s.length||l)?{snapshot:new dL(this.query,e.documentSet,i,s,e.mutatedKeys,0===o,l,!1,!!r&&r.resumeToken.approximateByteSize()>0),limboChanges:a}:{limboChanges:a}}applyOnlineStateChange(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new dM,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}}shouldBeInLimbo(e){return!this._syncedDocuments.has(e)&&!!this.documentSet.has(e)&&!this.documentSet.get(e).hasLocalMutations}applyTargetChange(e){e&&(e.addedDocuments.forEach(e=>this._syncedDocuments=this._syncedDocuments.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this._syncedDocuments=this._syncedDocuments.delete(e)),this.current=e.current)}updateLimboDocuments(){if(!this.current)return[];let e=this.limboDocuments;this.limboDocuments=i5(),this.documentSet.forEach(e=>{this.shouldBeInLimbo(e.key)&&(this.limboDocuments=this.limboDocuments.add(e.key))});let t=[];return e.forEach(e=>{this.limboDocuments.has(e)||t.push(new d1(e))}),this.limboDocuments.forEach(r=>{e.has(r)||t.push(new d0(r))}),t}synchronizeWithPersistedState(e){this._syncedDocuments=e.remoteKeys,this.limboDocuments=i5();let t=this.computeDocChanges(e.documents);return this.applyChanges(t,!0)}computeInitialSnapshot(){return dL.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,0===this.syncState,this.hasCachedResults)}}function d4(e,t){let r=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return k(20277,{change:e})}};return r(e)-r(t)}let d3="SyncEngine";class d6{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class d9{constructor(e){this.key=e,this.receivedDocument=!1}}class d5{constructor(e,t,r,n,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=n,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.syncEngineListener={},this.queryViewsByQuery=new iH(e=>iB(e),iF),this.queriesByTarget=new Map,this.enqueuedLimboResolutions=new Set,this.activeLimboTargetsByKey=new rh(ei.comparator),this.activeLimboResolutionsByTarget=new Map,this.limboDocumentRefs=new ux,this.mutationUserCallbacks={},this.pendingWritesCallbacks=new Map,this.limboTargetIdGenerator=l6.forSyncEngine(),this.onlineState="Unknown",this._isPrimaryClient=void 0}get isPrimaryClient(){return!0===this._isPrimaryClient}}function d7(e,t,r,n,i,s,a){let o=new d5(e,t,r,n,i,s);return a&&(o._isPrimaryClient=!0),o}async function d8(e,t,r=!0){let n;let i=pP(e),s=i.queryViewsByQuery.get(t);return s?(i.sharedClientState.addLocalQueryTarget(s.targetId),n=s.view.computeInitialSnapshot()):n=await pt(i,t,r,!0),n}async function pe(e,t){let r=pP(e);await pt(r,t,!0,!1)}async function pt(e,t,r,n){let i;let s=await cx(e.localStore,ik(t)),a=s.targetId,o=e.sharedClientState.addLocalQueryTarget(a,r);return n&&(i=await pr(e,t,a,"current"===o,s.resumeToken)),e.isPrimaryClient&&r&&h8(e.remoteStore,s),i}async function pr(e,t,r,n,i){e.applyDocChanges=(t,r,n)=>pS(e,t,r,n);let s=await cL(e.localStore,t,!0),a=new d2(t,s.remoteKeys),o=a.computeDocChanges(s.documents),l=s6.createSynthesizedTargetChangeForCurrentChange(r,n&&"Offline"!==e.onlineState,i),u=a.applyChanges(o,e.isPrimaryClient,l);py(e,r,u.limboChanges);let c=new d6(t,r,a);return e.queryViewsByQuery.set(t,c),e.queriesByTarget.has(r)?e.queriesByTarget.get(r).push(t):e.queriesByTarget.set(r,[t]),u.snapshot}async function pn(e,t,r){let n=O(e),i=n.queryViewsByQuery.get(t),s=n.queriesByTarget.get(i.targetId);if(s.length>1){n.queriesByTarget.set(i.targetId,s.filter(e=>!iF(e,t))),n.queryViewsByQuery.delete(t);return}n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||await cM(n.localStore,i.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(i.targetId),r&&de(n.remoteStore,i.targetId),pm(n,i.targetId)}).catch(eL)):(pm(n,i.targetId),await cM(n.localStore,i.targetId,!0))}async function pi(e,t){let r=O(e),n=r.queryViewsByQuery.get(t),i=r.queriesByTarget.get(n.targetId);r.isPrimaryClient&&1===i.length&&(r.sharedClientState.removeLocalQueryTarget(n.targetId),de(r.remoteStore,n.targetId))}async function ps(e,t,r){let n=pM(e);try{let e=await cS(n.localStore,t);n.sharedClientState.addPendingMutation(e.batchId),pp(n,e.batchId,r),await pT(n,e.changes),await dg(n.remoteStore)}catch(t){let e=dx(t,"Failed to persist write");r.reject(e)}}async function pa(e,t){let r=O(e);try{let e=await cR(r.localStore,t);t.targetChanges.forEach((e,t)=>{let n=r.activeLimboResolutionsByTarget.get(t);n&&(D(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1,22616),e.addedDocuments.size>0?n.receivedDocument=!0:e.modifiedDocuments.size>0?D(n.receivedDocument,14607):e.removedDocuments.size>0&&(D(n.receivedDocument,42227),n.receivedDocument=!1))}),await pT(r,e,t)}catch(e){await eL(e)}}function po(e,t,r){let n=O(e);if(n.isPrimaryClient&&0===r||!n.isPrimaryClient&&1===r){let e=[];n.queryViewsByQuery.forEach((r,n)=>{let i=n.view.applyOnlineStateChange(t);i.snapshot&&e.push(i.snapshot)}),d$(n.eventManager,t),e.length&&n.syncEngineListener.onWatchChange(e),n.onlineState=t,n.isPrimaryClient&&n.sharedClientState.setOnlineState(t)}}async function pl(e,t,r){let n=O(e);n.sharedClientState.updateQueryState(t,"rejected",r);let i=n.activeLimboResolutionsByTarget.get(t),s=i&&i.key;if(s){let e=new rh(ei.comparator);e=e.insert(s,nx.newNoDocument(s,ev.min()));let r=i5().add(s),i=new s3(ev.min(),new Map,new rh(K),e,r);await pa(n,i),n.activeLimboTargetsByKey=n.activeLimboTargetsByKey.remove(s),n.activeLimboResolutionsByTarget.delete(t),pb(n)}else await cM(n.localStore,t,!1).then(()=>pm(n,t,r)).catch(eL)}async function pu(e,t){let r=O(e),n=t.batch.batchId;try{let e=await cE(r.localStore,t);pf(r,n,null),ph(r,n),r.sharedClientState.updateMutationState(n,"acknowledged"),await pT(r,e)}catch(e){await eL(e)}}async function pc(e,t,r){let n=O(e);try{let e=await cC(n.localStore,t);pf(n,t,r),ph(n,t),n.sharedClientState.updateMutationState(t,"rejected",r),await pT(n,e)}catch(e){await eL(e)}}function ph(e,t){(e.pendingWritesCallbacks.get(t)||[]).forEach(e=>{e.resolve()}),e.pendingWritesCallbacks.delete(t)}function pd(e,t){e.pendingWritesCallbacks.forEach(e=>{e.forEach(e=>{e.reject(new P(x.CANCELLED,t))})}),e.pendingWritesCallbacks.clear()}function pp(e,t,r){let n=e.mutationUserCallbacks[e.currentUser.toKey()];n||(n=new rh(K)),n=n.insert(t,r),e.mutationUserCallbacks[e.currentUser.toKey()]=n}function pf(e,t,r){let n=O(e),i=n.mutationUserCallbacks[n.currentUser.toKey()];if(i){let e=i.get(t);e&&(r?e.reject(r):e.resolve(),i=i.remove(t)),n.mutationUserCallbacks[n.currentUser.toKey()]=i}}function pm(e,t,r=null){for(let n of(e.sharedClientState.removeLocalQueryTarget(t),e.queriesByTarget.get(t)))e.queryViewsByQuery.delete(n),r&&e.syncEngineListener.onWatchError(n,r);e.queriesByTarget.delete(t),e.isPrimaryClient&&e.limboDocumentRefs.removeReferencesForId(t).forEach(t=>{e.limboDocumentRefs.containsKey(t)||pg(e,t)})}function pg(e,t){e.enqueuedLimboResolutions.delete(t.path.canonicalString());let r=e.activeLimboTargetsByKey.get(t);null!==r&&(de(e.remoteStore,r),e.activeLimboTargetsByKey=e.activeLimboTargetsByKey.remove(t),e.activeLimboResolutionsByTarget.delete(r),pb(e))}function py(e,t,r){for(let n of r)n instanceof d0?(e.limboDocumentRefs.addReference(n.key,t),pv(e,n)):n instanceof d1?(_(d3,"Document no longer in limbo: "+n.key),e.limboDocumentRefs.removeReference(n.key,t),e.limboDocumentRefs.containsKey(n.key)||pg(e,n.key)):k(19791,{limboChange:n})}function pv(e,t){let r=t.key,n=r.path.canonicalString();e.activeLimboTargetsByKey.get(r)||e.enqueuedLimboResolutions.has(n)||(_(d3,"New document in limbo: "+r),e.enqueuedLimboResolutions.add(n),pb(e))}function pb(e){for(;e.enqueuedLimboResolutions.size>0&&e.activeLimboTargetsByKey.size<e.maxConcurrentLimboResolutions;){let t=e.enqueuedLimboResolutions.values().next().value;e.enqueuedLimboResolutions.delete(t);let r=new ei(et.fromString(t)),n=e.limboTargetIdGenerator.next();e.activeLimboResolutionsByTarget.set(n,new d9(r)),e.activeLimboTargetsByKey=e.activeLimboTargetsByKey.insert(r,n),h8(e.remoteStore,new ov(ik(iE(r.path)),n,"TargetPurposeLimboResolution",e2.INVALID))}}async function pT(e,t,r){let n=O(e),i=[],s=[],a=[];n.queryViewsByQuery.isEmpty()||(n.queryViewsByQuery.forEach((e,o)=>{a.push(n.applyDocChanges(o,t,r).then(e=>{if((e||r)&&n.isPrimaryClient){let t=e?!e.fromCache:r?.targetChanges.get(o.targetId)?.current;n.sharedClientState.updateQueryState(o.targetId,t?"current":"not-current")}if(e){i.push(e);let t=dQ.fromSnapshot(o.targetId,e);s.push(t)}}))}),await Promise.all(a),n.syncEngineListener.onWatchChange(i),await cA(n.localStore,s))}async function pS(e,t,r,n){let i=t.view.computeDocChanges(r);i.needsRefill&&(i=await cL(e.localStore,t.query,!1).then(({documents:e})=>t.view.computeDocChanges(e,i)));let s=n&&n.targetChanges.get(t.targetId),a=n&&null!=n.targetMismatches.get(t.targetId),o=t.view.applyChanges(i,e.isPrimaryClient,s,a);return py(e,t.targetId,o.limboChanges),o.snapshot}async function pE(e,t){let r=O(e);if(!r.currentUser.isEqual(t)){_(d3,"User change. New user:",t.toKey());let e=await cT(r.localStore,t);r.currentUser=t,pd(r,"'waitForPendingWrites' promise is rejected due to a user change."),r.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await pT(r,e.affectedDocuments)}}function pw(e,t){let r=O(e),n=r.activeLimboResolutionsByTarget.get(t);if(n&&n.receivedDocument)return i5().add(n.key);{let e=i5(),n=r.queriesByTarget.get(t);if(!n)return e;for(let t of n){let n=r.queryViewsByQuery.get(t);e=e.unionWith(n.view.syncedDocuments)}return e}}async function pC(e,t){let r=O(e),n=await cL(r.localStore,t.query,!0),i=t.view.synchronizeWithPersistedState(n);return r.isPrimaryClient&&py(r,t.targetId,i.limboChanges),i}async function p_(e,t){let r=O(e);return cz(r.localStore,t).then(e=>pT(r,e))}async function pI(e,t,r,n){let i=O(e),s=await cB(i.localStore,t);if(null===s){_(d3,"Cannot apply mutation batch with id: "+t);return}"pending"===r?await dg(i.remoteStore):"acknowledged"===r||"rejected"===r?(pf(i,t,n||null),ph(i,t),cU(i.localStore,t)):k(6720,"Unknown batchState",{batchState:r}),await pT(i,s)}async function pR(e,t){let r=O(e);if(pP(r),pM(r),!0===t&&!0!==r._isPrimaryClient){let e=r.sharedClientState.getAllActiveQueryTargets(),t=await pk(r,e.toArray());for(let e of(r._isPrimaryClient=!0,await dN(r.remoteStore,!0),t))h8(r.remoteStore,e)}else if(!1===t&&!1!==r._isPrimaryClient){let e=[],t=Promise.resolve();r.queriesByTarget.forEach((n,i)=>{r.sharedClientState.isLocalQueryTarget(i)?e.push(i):t=t.then(()=>(pm(r,i),cM(r.localStore,i,!0))),de(r.remoteStore,i)}),await t,await pk(r,e),pN(r),r._isPrimaryClient=!1,await dN(r.remoteStore,!1)}}function pN(e){let t=O(e);t.activeLimboResolutionsByTarget.forEach((e,r)=>{de(t.remoteStore,r)}),t.limboDocumentRefs.removeAllReferences(),t.activeLimboResolutionsByTarget=new Map,t.activeLimboTargetsByKey=new rh(ei.comparator)}async function pk(e,t,r){let n=O(e),i=[],s=[];for(let e of t){let t;let r=n.queriesByTarget.get(e);if(r&&0!==r.length)for(let e of(t=await cx(n.localStore,ik(r[0])),r)){let t=n.queryViewsByQuery.get(e),r=await pC(n,t);r.snapshot&&s.push(r.snapshot)}else{let r=await cj(n.localStore,e);t=await cx(n.localStore,r),await pr(n,pA(r),e,!1,t.resumeToken)}i.push(t)}return n.syncEngineListener.onWatchChange(s),i}function pA(e){return iS(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function pD(e){return cV(O(e).localStore)}async function pO(e,t,r,n){let i=O(e);if(i._isPrimaryClient){_(d3,"Ignoring unexpected query state notification.");return}let s=i.queriesByTarget.get(t);if(s&&s.length>0)switch(r){case"current":case"not-current":{let e=await cz(i.localStore,i$(s[0])),n=s3.createSynthesizedRemoteEventForCurrentChange(t,"current"===r,rE.EMPTY_BYTE_STRING);await pT(i,e,n);break}case"rejected":await cM(i.localStore,t,!0),pm(i,t,n);break;default:k(64155,r)}}async function px(e,t,r){let n=pP(e);if(n._isPrimaryClient){for(let e of t){if(n.queriesByTarget.has(e)&&n.sharedClientState.isActiveQueryTarget(e)){_(d3,"Adding an already active target "+e);continue}let t=await cj(n.localStore,e),r=await cx(n.localStore,t);await pr(n,pA(t),r.targetId,!1,r.resumeToken),h8(n.remoteStore,r)}for(let e of r)n.queriesByTarget.has(e)&&await cM(n.localStore,e,!1).then(()=>{de(n.remoteStore,e),pm(n,e)}).catch(eL)}}function pP(e){let t=O(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=pa.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=pw.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=pl.bind(null,t),t.syncEngineListener.onWatchChange=dq.bind(null,t.eventManager),t.syncEngineListener.onWatchError=dG.bind(null,t.eventManager),t}function pM(e){let t=O(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=pu.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=pc.bind(null,t),t}function pL(e,t,r){let n=O(e);pF(n,t,r).then(e=>{n.sharedClientState.notifyBundleLoaded(e)})}async function pF(e,t,r){try{let n=await t.getMetadata();if(await cK(e.localStore,n))return await t.close(),r._completeWith(dZ(n)),Promise.resolve(new Set);r._updateProgress(dX(n));let i=new dJ(n,t.serializer),s=await t.nextElement();for(;s;){let e=await i.addSizedElement(s);e&&r._updateProgress(e),s=await t.nextElement()}let a=await i.completeAndStoreAsync(e.localStore);return await pT(e,a.changedDocs,void 0),await cW(e.localStore,n),r._completeWith(a.progress),Promise.resolve(a.changedCollectionGroups)}catch(e){return R(d3,`Loading bundle failed with ${e}`),r._failWith(e),Promise.resolve(new Set)}}class pB{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=hO(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return cb(this.persistence,new c0,e.initialUser,this.serializer)}createPersistence(e){return new uq(u$.factory,this.serializer)}createSharedClientState(e){return new hh}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}pB.provider={build:()=>new pB};class pU extends pB{constructor(e){super(),this.cacheSizeBytes=e}createGarbageCollectionScheduler(e,t){return D(this.persistence.referenceDelegate instanceof uK,46915),new uc(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}createPersistence(e){let t=void 0!==this.cacheSizeBytes?un.withCacheSize(this.cacheSizeBytes):un.DEFAULT;return new uq(e=>uK.factory(e,t),this.serializer)}}class pV extends pB{constructor(e,t,r){super(),this.onlineComponentProvider=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.onlineComponentProvider.initialize(this,e),await pM(this.onlineComponentProvider.syncEngine),await dg(this.onlineComponentProvider.remoteStore),await this.persistence.setPrimaryStateListener(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}createLocalStore(e){return cb(this.persistence,new c0,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){return new uc(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){let r=new e1(t,this.persistence);return new e0(e.asyncQueue,r)}createPersistence(e){let t=cp(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=void 0!==this.cacheSizeBytes?un.withCacheSize(this.cacheSizeBytes):un.DEFAULT;return new cc(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,hA(),hD(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new hh}}class pj{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>po(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=pE.bind(null,this.syncEngine),await dN(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return dB()}createDatastore(e){let t=hO(e.databaseInfo.databaseId),r=hN(e.databaseInfo);return hK(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return h6(this.localStore,this.datastore,e.asyncQueue,e=>po(this.syncEngine,e,0),hk())}createSyncEngine(e,t){return d7(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await h7(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}pj.provider={build:()=>new pj};let pz=10240;function pq(e,t=pz){let r=0;return{async read(){if(r<e.byteLength){let n={value:e.slice(r,r+t),done:!1};return r+=t,n}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}function pG(e,t){if(!(e instanceof Uint8Array))throw new P(x.INVALID_ARGUMENT,`NodePlatform.toByteStreamReader expects source to be Uint8Array, got ${ec(e)}`);return pq(e,t)}class p${constructor(e){this.observer=e,this.muted=!1}next(e){!this.muted&&this.observer.next&&this.scheduleEvent(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.scheduleEvent(this.observer.error,e):I("Uncaught Error in snapshot listener:",e.toString()))}mute(){this.muted=!0}scheduleEvent(e,t){setTimeout(()=>{this.muted||e(t)},0)}}class pK{constructor(e,t){this.payload=e,this.byteLength=t}isBundleMetadata(){return"metadata"in this.payload}}class pW{constructor(e,t){this.reader=e,this.serializer=t,this.metadata=new M,this.buffer=new Uint8Array,this.textDecoder=sX(),this.nextElementImpl().then(e=>{e&&e.isBundleMetadata()?this.metadata.resolve(e.payload.metadata):this.metadata.reject(Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(e?.payload)}`))},e=>this.metadata.reject(e))}close(){return this.reader.cancel()}async getMetadata(){return this.metadata.promise}async nextElement(){return await this.getMetadata(),this.nextElementImpl()}async nextElementImpl(){let e=await this.readLength();if(null===e)return null;let t=this.textDecoder.decode(e),r=Number(t);return isNaN(r)&&this.raiseError(`length string (${t}) is not valid number`),new pK(JSON.parse(await this.readJsonString(r)),e.length+r)}indexOfOpenBracket(){return this.buffer.findIndex(e=>123===e)}async readLength(){for(;0>this.indexOfOpenBracket()&&!await this.pullMoreDataToBuffer(););if(0===this.buffer.length)return null;let e=this.indexOfOpenBracket();e<0&&this.raiseError("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async readJsonString(e){for(;this.buffer.length<e;)await this.pullMoreDataToBuffer()&&this.raiseError("Reached the end of bundle when more is expected.");let t=this.textDecoder.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}raiseError(e){throw this.reader.cancel(),Error(`Invalid bundle format: ${e}`)}async pullMoreDataToBuffer(){let e=await this.reader.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}function pH(e,t){return new pW(e,t)}class pQ{constructor(e,t){this.bundleData=e,this.serializer=t,this.cursor=0,this.elements=[];let r=this.nextElement();if(r&&r.isBundleMetadata())this.metadata=r;else throw Error(`The first element of the bundle is not a metadata object, it is
         ${JSON.stringify(r?.payload)}`);do null!==(r=this.nextElement())&&this.elements.push(r);while(null!==r)}getMetadata(){return this.metadata}getElements(){return this.elements}nextElement(){if(this.cursor===this.bundleData.length)return null;let e=this.readLength();return new pK(JSON.parse(this.readJsonString(e)),e)}readJsonString(e){if(this.cursor+e>this.bundleData.length)throw new P(x.INTERNAL,"Reached the end of bundle when more is expected.");return this.bundleData.slice(this.cursor,this.cursor+=e)}readLength(){let e=this.cursor,t=this.cursor;for(;t<this.bundleData.length;){if("{"===this.bundleData[t]){if(t===e)throw Error("First character is a bracket and not a number");return this.cursor=t,Number(this.bundleData.slice(e,t))}t++}throw Error("Reached the end of bundle when more is expected.")}}class pY{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new P(x.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=await hH(this.datastore,e);return t.forEach(e=>this.recordVersion(e)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastTransactionError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new sB(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((e,t)=>{let r=ei.fromPath(t);this.mutations.push(new sj(r,this.precondition(r)))}),await hW(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else if(e.isNoDocument())t=ev.min();else throw k(50498,{documentName:e.constructor.name});let r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new P(x.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return this.writtenDocs.has(e.toString())||!t?sS.none():t.isEqual(ev.min())?sS.exists(!1):sS.updateTime(t)}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(this.writtenDocs.has(e.toString())||!t)return sS.exists(!0);if(t.isEqual(ev.min()))throw new P(x.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return sS.updateTime(t)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}let pJ="FirestoreClient",pX=100,pZ=11,p0=20,p1=22;class p2{constructor(e,t,r,n,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=n,this.user=b.UNAUTHENTICATED,this.clientId=$.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async e=>{_(pJ,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(r,e=>(_(pJ,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:pX}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new M;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(r){let t=dx(r,"Failed to shutdown persistence");e.reject(t)}}),e.promise}}async function p4(e,t){e.asyncQueue.verifyOperationInProgress(),_(pJ,"Initializing OfflineComponentProvider");let r=e.configuration;await t.initialize(r);let n=r.initialUser;e.setCredentialChangeListener(async e=>{n.isEqual(e)||(await cT(t.localStore,e),n=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function p3(e,t){e.asyncQueue.verifyOperationInProgress();let r=await p9(e);_(pJ,"Initializing OnlineComponentProvider"),await t.initialize(r,e.configuration),e.setCredentialChangeListener(e=>dR(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,r)=>dR(t.remoteStore,r)),e._onlineComponents=t}function p6(e){return"FirebaseError"===e.name?e.code===x.FAILED_PRECONDITION||e.code===x.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||e.code===p1||e.code===p0||e.code===pZ}async function p9(e){if(!e._offlineComponents){if(e._uninitializedComponentsProvider){_(pJ,"Using user provided OfflineComponentProvider");try{await p4(e,e._uninitializedComponentsProvider._offline)}catch(r){let t=r;if(!p6(t))throw t;R("Error using user provided cache. Falling back to memory cache: "+t),await p4(e,new pB)}}else _(pJ,"Using default OfflineComponentProvider"),await p4(e,new pU(void 0))}return e._offlineComponents}async function p5(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(_(pJ,"Using user provided OnlineComponentProvider"),await p3(e,e._uninitializedComponentsProvider._online)):(_(pJ,"Using default OnlineComponentProvider"),await p3(e,new pj))),e._onlineComponents}function p7(e){return p9(e).then(e=>e.localStore)}function p8(e){return p5(e).then(e=>e.syncEngine)}function fe(e){return p5(e).then(e=>e.datastore)}async function ft(e){let t=await p5(e),r=t.eventManager;return r.onListen=d8.bind(null,t.syncEngine),r.onUnlisten=pn.bind(null,t.syncEngine),r.onFirstRemoteStoreListen=pe.bind(null,t.syncEngine),r.onLastRemoteStoreUnlisten=pi.bind(null,t.syncEngine),r}function fr(e,t,r,n){let i=new p$(n),s=new dH(t,i,r);return e.asyncQueue.enqueueAndForget(async()=>dj(await ft(e),s)),()=>{i.mute(),e.asyncQueue.enqueueAndForget(async()=>dz(await ft(e),s))}}function fn(e,t,r={}){let n=new M;return e.asyncQueue.enqueueAndForget(async()=>fa(await ft(e),e.asyncQueue,t,r,n)),n.promise}function fi(e,t,r={}){let n=new M;return e.asyncQueue.enqueueAndForget(async()=>fo(await ft(e),e.asyncQueue,t,r,n)),n.promise}function fs(e,t){let r=new M;return e.asyncQueue.enqueueAndForget(async()=>ps(await p8(e),t,r)),r.promise}function fa(e,t,r,n,i){let s=new p$({next:o=>{s.mute(),t.enqueueAndForget(()=>dz(e,a));let l=o.docs.has(r);!l&&o.fromCache?i.reject(new P(x.UNAVAILABLE,"Failed to get document because the client is offline.")):l&&o.fromCache&&n&&"server"===n.source?i.reject(new P(x.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:e=>i.reject(e)}),a=new dH(iE(r.path),s,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return dj(e,a)}function fo(e,t,r,n,i){let s=new p$({next:r=>{s.mute(),t.enqueueAndForget(()=>dz(e,a)),r.fromCache&&"server"===n.source?i.reject(new P(x.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(r)},error:e=>i.reject(e)}),a=new dH(r,s,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return dj(e,a)}function fl(e,t,r,n){let i=fc(r,hO(t));e.asyncQueue.enqueueAndForget(async()=>{pL(await p8(e),i,n)})}function fu(e,t){return e.asyncQueue.enqueue(async()=>cH(await p7(e),t))}function fc(e,t){let r;return pH(pG(r="string"==typeof e?sJ().encode(e):e),t)}function fh(e,t){return e.timeoutSeconds===t.timeoutSeconds}function fd(e){let t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}let fp="ComponentProvider",ff=new Map;function fm(e){let t=ff.get(e);t&&(_(fp,"Removing Datastore"),ff.delete(e),t.terminate())}function fg(e,t,r,n){return new rF(e,t,r,n.host,n.ssl,n.experimentalForceLongPolling,n.experimentalAutoDetectLongPolling,fd(n.experimentalLongPollingOptions),n.useFetchStreams,n.isUsingEmulator)}let fy="firestore.googleapis.com",fv=!0,fb=5,fT=30,fS=!0;class fE{constructor(e){if(void 0===e.host){if(void 0!==e.ssl)throw new P(x.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=fy,this.ssl=fv}else this.host=e.host,this.ssl=e.ssl??fv;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=ur;else{if(e.cacheSizeBytes!==ut&&e.cacheSizeBytes<us)throw new P(x.INVALID_ARGUMENT,`cacheSizeBytes must be at least ${us}`);this.cacheSizeBytes=e.cacheSizeBytes}ea("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=fS:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=fd(e.experimentalLongPollingOptions??{}),fw(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&fh(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}function fw(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new P(x.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<fb)throw new P(x.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is ${fb})`);if(e.timeoutSeconds>fT)throw new P(x.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is ${fT})`)}}class fC{constructor(e,t,r,n){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new fE({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new P(x.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new P(x.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new fE(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=q(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return fm(this),Promise.resolve()}}class f_{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new f_(this.firestore,e,this._query)}}class fI{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new fR(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new fI(this.firestore,e,this._key)}toJSON(){return{type:fI._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(ef(t,fI._jsonSchema))return new fI(e,r||null,new ei(et.fromString(t.referencePath)))}}fI._jsonSchemaVersion="firestore/documentReference/1.0",fI._jsonSchema={type:ep("string",fI._jsonSchemaVersion),referencePath:ep("string")};class fR extends f_{constructor(e,t,r){super(e,t,iE(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new fI(this.firestore,null,new ei(e))}withConverter(e){return new fR(this.firestore,e,this._path)}}function fN(e,t,...r){if(e=(0,h.m9)(e),es("collection","path",t),e instanceof fC){let n=et.fromString(t,...r);return el(n),new fR(e,null,n)}{if(!(e instanceof fI)&&!(e instanceof fR))throw new P(x.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=e._path.child(et.fromString(t,...r));return el(n),new fR(e.firestore,null,n)}}function fk(e,t,...r){if(e=(0,h.m9)(e),1==arguments.length&&(t=$.newId()),es("doc","path",t),e instanceof fC){let n=et.fromString(t,...r);return eo(n),new fI(e,null,new ei(n))}{if(!(e instanceof fI)&&!(e instanceof fR))throw new P(x.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=e._path.child(et.fromString(t,...r));return eo(n),new fI(e.firestore,e instanceof fR?e.converter:null,new ei(n))}}let fA="AsyncQueue";class fD{constructor(e=Promise.resolve()){this.retryableOps=[],this._isShuttingDown=!1,this.delayedOperations=[],this.failure=null,this.operationInProgress=!1,this.skipNonRestrictedTasks=!1,this.timerIdsToSkip=[],this.backoff=new hF(this,"async_queue_retry"),this.visibilityHandler=()=>{this.backoff.skipBackoff()},this.tail=e}get isShuttingDown(){return this._isShuttingDown}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.verifyNotFailed(),this.enqueueInternal(e)}enterRestrictedMode(e){this._isShuttingDown||(this._isShuttingDown=!0,this.skipNonRestrictedTasks=e||!1)}enqueue(e){if(this.verifyNotFailed(),this._isShuttingDown)return new Promise(()=>{});let t=new M;return this.enqueueInternal(()=>this._isShuttingDown&&this.skipNonRestrictedTasks?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.retryableOps.push(e),this.retryNextOp()))}async retryNextOp(){if(0!==this.retryableOps.length){try{await this.retryableOps[0](),this.retryableOps.shift(),this.backoff.reset()}catch(e){if(e$(e))_(fA,"Operation failed with retryable error: "+e);else throw e}this.retryableOps.length>0&&this.backoff.backoffAndRun(()=>this.retryNextOp())}}enqueueInternal(e){let t=this.tail.then(()=>(this.operationInProgress=!0,e().catch(e=>{throw this.failure=e,this.operationInProgress=!1,I("INTERNAL UNHANDLED ERROR: ",fO(e)),e}).then(e=>(this.operationInProgress=!1,e))));return this.tail=t,t}enqueueAfterDelay(e,t,r){this.verifyNotFailed(),this.timerIdsToSkip.indexOf(e)>-1&&(t=0);let n=dO.createAndSchedule(this,e,t,r,e=>this.removeDelayedOperation(e));return this.delayedOperations.push(n),n}verifyNotFailed(){this.failure&&k(47125,{messageOrStack:fO(this.failure)})}verifyOperationInProgress(){}async drain(){let e;do e=this.tail,await e;while(e!==this.tail)}containsDelayedOperation(e){for(let t of this.delayedOperations)if(t.timerId===e)return!0;return!1}runAllDelayedOperationsUntil(e){return this.drain().then(()=>{for(let t of(this.delayedOperations.sort((e,t)=>e.targetTimeMs-t.targetTimeMs),this.delayedOperations))if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.drain()})}skipDelaysForTimerId(e){this.timerIdsToSkip.push(e)}removeDelayedOperation(e){let t=this.delayedOperations.indexOf(e);this.delayedOperations.splice(t,1)}}function fO(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}class fx{constructor(){this._progressObserver={},this._taskCompletionResolver=new M,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class fP extends fC{constructor(e,t,r,n){super(e,t,r,n),this.type="firestore",this._queue=new fD,this._persistenceKey=n?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new fD(e),this._firestoreClient=void 0,await e}}}function fM(e){if(e._terminated)throw new P(x.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||fL(e),e._firestoreClient}function fL(e){let t=e._freezeSettings(),r=fg(e._databaseId,e._app?.options.appId||"",e._persistenceKey,t);!e._componentsProvider&&t.localCache?._offlineComponentProvider&&t.localCache?._onlineComponentProvider&&(e._componentsProvider={_offline:t.localCache._offlineComponentProvider,_online:t.localCache._onlineComponentProvider}),e._firestoreClient=new p2(e._authCredentials,e._appCheckCredentials,e._queue,r,e._componentsProvider&&fF(e._componentsProvider))}function fF(e){let t=e?._online.build();return{_offline:e?._offline.build(t),_online:t}}function fB(e,t=!0){S(o.Jn),(0,o.Xd)(new l.wA("firestore",(e,{instanceIdentifier:r,options:n})=>{let i=e.getProvider("app").getImmediate(),s=new fP(new B(e.getProvider("auth-internal")),new z(i,e.getProvider("app-check-internal")),rV(i,r),i);return n={useFetchStreams:t,...n},s._setSettings(n),s},"PUBLIC").setMultipleInstances(!0)),(0,o.KN)(y,v,e),(0,o.KN)(y,v,"esm2020")}class fU{constructor(e,t,r){this._userDataWriter=t,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}class fV{constructor(e){this._byteString=e}static fromBase64String(e){try{return new fV(rE.fromBase64String(e))}catch(e){throw new P(x.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new fV(rE.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:fV._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(ef(e,fV._jsonSchema))return fV.fromBase64String(e.bytes)}}fV._jsonSchemaVersion="firestore/bytes/1.0",fV._jsonSchema={type:ep("string",fV._jsonSchemaVersion),bytes:ep("string")};class fj{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new P(x.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new en(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class fz{constructor(e){this._methodName=e}}class fq{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new P(x.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new P(x.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return K(this._lat,e._lat)||K(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:fq._jsonSchemaVersion}}static fromJSON(e){if(ef(e,fq._jsonSchema))return new fq(e.latitude,e.longitude)}}fq._jsonSchemaVersion="firestore/geoPoint/1.0",fq._jsonSchema={type:ep("string",fq._jsonSchemaVersion),latitude:ep("number"),longitude:ep("number")};class fG{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return cm(this._values,e._values)}toJSON(){return{type:fG._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(ef(e,fG._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(e=>"number"==typeof e))return new fG(e.vectorValues);throw new P(x.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}fG._jsonSchemaVersion="firestore/vectorValue/1.0",fG._jsonSchema={type:ep("string",fG._jsonSchemaVersion),vectorValues:ep("object")};let f$=/^__.*__$/;class fK{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return null!==this.fieldMask?new sO(e,this.data,this.fieldMask,t,this.fieldTransforms):new sk(e,this.data,t,this.fieldTransforms)}}class fW{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new sO(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function fH(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw k(40011,{dataSource:e})}}class fQ{constructor(e,t,r,n,i,s){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=n,void 0===i&&this.validatePath(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new fQ({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){let t=this.path?.child(e),r=this.contextWith({path:t,arrayElement:!1});return r.validatePathSegment(e),r}childContextForFieldPath(e){let t=this.path?.child(e),r=this.contextWith({path:t,arrayElement:!1});return r.validatePath(),r}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return mu(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(0===e.length)throw this.createError("Document fields must not be empty");if(fH(this.dataSource)&&f$.test(e))throw this.createError('Document fields cannot begin and end with "__"')}}class fY{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||hO(e)}createContext(e,t,r,n=!1){return new fQ({dataSource:e,methodName:t,targetDoc:r,path:en.emptyPath(),arrayElement:!1,hasConverter:n},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function fJ(e){let t=e._freezeSettings(),r=hO(e._databaseId);return new fY(e._databaseId,!!t.ignoreUndefinedProperties,r)}function fX(e,t,r,n,i,s={}){let a,o;let l=e.createContext(s.merge||s.mergeFields?2:0,t,r,i);ms("Data must be an object, but it was:",l,n);let u=f8(n,l);if(s.merge)a=new rb(l.fieldMask),o=l.fieldTransforms;else if(s.mergeFields){let e=[];for(let n of s.mergeFields){let i=ma(t,n,r);if(!l.contains(i))throw new P(x.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);mc(e,i)||e.push(i)}a=new rb(e),o=l.fieldTransforms.filter(e=>a.covers(e.field))}else a=null,o=l.fieldTransforms;return new fK(new nD(u),a,o)}class fZ extends fz{_toFieldTransform(e){if(2===e.dataSource)e.fieldMask.push(e.path);else if(1===e.dataSource)throw e.createError(`${this._methodName}() can only appear at the top level of your update data`);else throw e.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return null}isEqual(e){return e instanceof fZ}}function f0(e,t,r){return new fQ({dataSource:3,targetDoc:t.settings.targetDoc,methodName:e._methodName,arrayElement:r},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}class f1 extends null{_toFieldTransform(e){return new sy(e.path,new sl)}isEqual(e){return e instanceof f1}}class f2 extends fz{constructor(e,t){super(e),this._elements=t}_toFieldTransform(e){let t=f0(this,e,!0),r=new su(this._elements.map(e=>f7(e,t)));return new sy(e.path,r)}isEqual(e){return e instanceof f2&&(0,h.vZ)(this._elements,e._elements)}}class f4 extends fz{constructor(e,t){super(e),this._elements=t}_toFieldTransform(e){let t=f0(this,e,!0),r=new sh(this._elements.map(e=>f7(e,t)));return new sy(e.path,r)}isEqual(e){return e instanceof f4&&(0,h.vZ)(this._elements,e._elements)}}class f3 extends fz{constructor(e,t){super(e),this._operand=t}_toFieldTransform(e){let t=new sp(e.serializer,sr(e.serializer,this._operand));return new sy(e.path,t)}isEqual(e){return e instanceof f3&&this._operand===e._operand}}function f6(e,t,r,n){let i=e.createContext(1,t,r);ms("Data must be an object, but it was:",i,n);let s=[],a=nD.empty();return ru(n,(e,n)=>{let o=ml(t,e,r);n=(0,h.m9)(n);let l=i.childContextForFieldPath(o);if(n instanceof fZ)s.push(o);else{let e=f7(n,l);null!=e&&(s.push(o),a.set(o,e))}}),new fW(a,new rb(s),i.fieldTransforms)}function f9(e,t,r,n,i,s){let a=e.createContext(1,t,r),o=[ma(t,n,r)],l=[i];if(s.length%2!=0)throw new P(x.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)o.push(ma(t,s[e])),l.push(s[e+1]);let u=[],c=nD.empty();for(let e=o.length-1;e>=0;--e)if(!mc(u,o[e])){let t=o[e],r=l[e];r=(0,h.m9)(r);let n=a.childContextForFieldPath(t);if(r instanceof fZ)u.push(t);else{let e=f7(r,n);null!=e&&(u.push(t),c.set(t,e))}}return new fW(c,new rb(u),a.fieldTransforms)}function f5(e,t,r,n=!1){return f7(r,e.createContext(n?4:3,t))}function f7(e,t){if(mi(e=(0,h.m9)(e)))return ms("Unsupported field value:",t,e),f8(e,t);if(e instanceof fz)return mt(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),!(e instanceof Array))return mr(e,t);if(t.settings.arrayElement&&4!==t.dataSource)throw t.createError("Nested arrays are not supported");return me(e,t)}function f8(e,t){let r={};return rc(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):ru(e,(e,n)=>{let i=f7(n,t.childContextForField(e));null!=i&&(r[e]=i)}),{mapValue:{fields:r}}}function me(e,t){let r=[],n=0;for(let i of e){let e=f7(i,t.childContextForArray(n));null==e&&(e={nullValue:"NULL_VALUE"}),r.push(e),n++}return{arrayValue:{values:r}}}function mt(e,t){if(!fH(t.dataSource))throw t.createError(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.createError(`${e._methodName}() is not currently supported inside arrays`);let r=e._toFieldTransform(t);r&&t.fieldTransforms.push(r)}function mr(e,t){if(null===(e=(0,h.m9)(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return sr(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){let r=ey.fromDate(e);return{timestampValue:ad(t.serializer,r)}}if(e instanceof ey){let r=new ey(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:ad(t.serializer,r)}}if(e instanceof fq)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};else if(e instanceof fV)return{bytesValue:af(t.serializer,e._byteString)};else if(e instanceof fI){let r=t.databaseId,n=e.firestore._databaseId;if(!n.isEqual(r))throw t.createError(`Document reference is for database ${n.projectId}/${n.database} but should be for database ${r.projectId}/${r.database}`);return{referenceValue:av(e.firestore._databaseId||t.databaseId,e._key.path)}}else if(e instanceof fG)return mn(e,t);else throw t.createError(`Unsupported field value: ${ec(e)}`)}function mn(e,t){return{mapValue:{fields:{[r$]:{stringValue:rH},[rQ]:{arrayValue:{values:e.toArray().map(e=>{if("number"!=typeof e)throw t.createError("VectorValues must only contain numeric values.");return se(t.serializer,e)})}}}}}}function mi(e){return"object"==typeof e&&null!==e&&!(e instanceof Array)&&!(e instanceof Date)&&!(e instanceof ey)&&!(e instanceof fq)&&!(e instanceof fV)&&!(e instanceof fI)&&!(e instanceof fz)&&!(e instanceof fG)}function ms(e,t,r){if(!mi(r)||!eu(r)){let n=ec(r);if("an object"===n)throw t.createError(e+" a custom object");throw t.createError(e+" "+n)}}function ma(e,t,r){if((t=(0,h.m9)(t))instanceof fj)return t._internalPath;if("string"==typeof t)return ml(e,t);throw mu("Field path arguments must be of type string or ",e,!1,void 0,r)}let mo=RegExp("[~\\*/\\[\\]]");function ml(e,t,r){if(t.search(mo)>=0)throw mu(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,r);try{return new fj(...t.split("."))._internalPath}catch(n){throw mu(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,r)}}function mu(e,t,r,n,i){let s=n&&!n.isEmpty(),a=void 0!==i,o=`Function ${t}() called with invalid data`;r&&(o+=" (via `toFirestore()`)"),o+=". ";let l="";return(s||a)&&(l+=" (found",s&&(l+=` in field ${n}`),a&&(l+=` in document ${i}`),l+=")"),new P(x.INVALID_ARGUMENT,o+e+l)}function mc(e,t){return e.some(e=>e.isEqual(t))}class mh{constructor(e,t,r,n,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=n,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new fI(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(!this._converter)return this._userDataWriter.convertValue(this._document.data.value);{let e=new md(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}}}get(e){if(this._document){let t=this._document.data.field(mp("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class md extends mh{data(){return super.data()}}function mp(e,t){return"string"==typeof t?ml(e,t):t instanceof fj?t._internalPath:t._delegate._internalPath}function mf(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new P(x.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class mm{}class mg extends mm{}class my extends mg{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new my(e,t,r)}_apply(e){let t=this._parse(e);return mD(e._query,t),new f_(e.firestore,e.converter,iO(e._query,t))}_parse(e){let t=fJ(e.firestore);return mC(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}class mv extends mm{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new mv(e,t)}_parse(e){let t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:nK.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return 0===t.getFilters().length?e:(mO(e._query,t),new f_(e.firestore,e.converter,iO(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class mb extends mg{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new mb(e,t)}_apply(e){let t=m_(e._query,this._field,this._direction);return new f_(e.firestore,e.converter,ix(e._query,t))}}class mT extends mg{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new mT(e,t,r)}_apply(e){return new f_(e.firestore,e.converter,iP(e._query,this._limit,this._limitType))}}class mS extends mg{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new mS(e,t,r)}_apply(e){let t=mw(e,this.type,this._docOrFields,this._inclusive);return new f_(e.firestore,e.converter,iM(e._query,t))}}class mE extends mg{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new mE(e,t,r)}_apply(e){let t=mw(e,this.type,this._docOrFields,this._inclusive);return new f_(e.firestore,e.converter,iL(e._query,t))}}function mw(e,t,r,n){if(r[0]=(0,h.m9)(r[0]),r[0]instanceof mh)return mI(e._query,e.firestore._databaseId,t,r[0]._document,n);{let i=fJ(e.firestore);return mR(e._query,e.firestore._databaseId,i,t,r,n)}}function mC(e,t,r,n,i,s,a){let o;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new P(x.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if("in"===s||"not-in"===s){mk(a,s);let t=[];for(let r of a)t.push(mN(n,e,r));o={arrayValue:{values:t}}}else o=mN(n,e,a)}else("in"===s||"not-in"===s||"array-contains-any"===s)&&mk(a,s),o=f5(r,t,a,"in"===s||"not-in"===s);return n$.create(i,s,o)}function m_(e,t,r){if(null!==e.startAt)throw new P(x.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new P(x.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new nV(t,r)}function mI(e,t,r,n,i){if(!n)throw new P(x.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${r}().`);let s=[];for(let r of iN(e))if(r.field.isKeyField())s.push(nm(t,n.key));else{let e=n.data.field(r.field);if(rx(e))throw new P(x.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+r.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null!==e)s.push(e);else{let e=r.field.canonicalString();throw new P(x.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${e}' (used as the orderBy) does not exist.`)}}return new nM(s,i)}function mR(e,t,r,n,i,s){let a=e.explicitOrderBy;if(i.length>a.length)throw new P(x.INVALID_ARGUMENT,`Too many arguments provided to ${n}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let o=[];for(let s=0;s<i.length;s++){let l=i[s];if(a[s].field.isKeyField()){if("string"!=typeof l)throw new P(x.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${n}(), but got a ${typeof l}`);if(!iR(e)&&-1!==l.indexOf("/"))throw new P(x.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${n}() must be a plain document ID, but '${l}' contains a slash.`);let r=e.path.child(et.fromString(l));if(!ei.isDocumentKey(r))throw new P(x.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${n}() must result in a valid document path, but '${r}' is not because it contains an odd number of segments.`);let i=new ei(r);o.push(nm(t,i))}else{let e=f5(r,n,l);o.push(e)}}return new nM(o,s)}function mN(e,t,r){if("string"==typeof(r=(0,h.m9)(r))){if(""===r)throw new P(x.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!iR(t)&&-1!==r.indexOf("/"))throw new P(x.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${r}' contains a '/' character.`);let n=t.path.child(et.fromString(r));if(!ei.isDocumentKey(n))throw new P(x.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return nm(e,new ei(n))}if(r instanceof fI)return nm(e,r._key);throw new P(x.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${ec(r)}.`)}function mk(e,t){if(!Array.isArray(e)||0===e.length)throw new P(x.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function mA(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}function mD(e,t){let r=mx(e.filters,mA(t.op));if(null!==r){if(r===t.op)throw new P(x.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`);throw new P(x.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${r.toString()}' filters.`)}}function mO(e,t){let r=e;for(let e of t.getFlattenedFilters())mD(r,e),r=iO(r,e)}function mx(e,t){for(let r of e)for(let e of r.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}class mP{convertValue(e,t="none"){switch(rJ(e)){case 0:return null;case 1:return e.booleanValue;case 2:return rR(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(rN(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw k(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return ru(e,(e,n)=>{r[e]=this.convertValue(n,t)}),r}convertVectorValue(e){return new fG(e.fields?.[rQ].arrayValue?.values?.map(e=>rR(e.doubleValue)))}convertGeoPoint(e){return new fq(rR(e.latitude),rR(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=rM(e);if(null==r)return null;return this.convertValue(r,t);case"estimate":return this.convertTimestamp(rL(e));default:return null}}convertTimestamp(e){let t=rI(e);return new ey(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=et.fromString(e);D(oy(r),9688,{name:e});let n=new rU(r.get(1),r.get(3)),i=new ei(r.popFirst(5));return n.isEqual(t)||I(`Document ${i} contains a document reference within a different database (${n.projectId}/${n.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function mM(e,t,r){return e?r&&(r.merge||r.mergeFields)?e.toFirestore(t,r):e.toFirestore(t):t}class mL extends mP{constructor(e){super(),this.firestore=e}convertBytes(e){return new fV(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new fI(this.firestore,null,t)}}function mF(e){return mB(e,["next","error","complete"])}function mB(e,t){if("object"!=typeof e||null===e)return!1;let r=e;for(let e of t)if(e in r&&"function"==typeof r[e])return!0;return!1}let mU=sJ();function mV(e){let t=JSON.stringify(e),r=mU.encode(t).byteLength;return`${r}${t}`}mV({metadata:{id:"test-bundle",createTime:{seconds:1577836805,nanos:6},version:1,totalDocuments:1,totalBytes:416}}),mV({documentMetadata:{name:"projects/test-project/databases/(default)/documents/collectionId/doc1",readTime:{seconds:5,nanos:6},exists:!0}}),mV({document:{name:"projects/test-project/databases/(default)/documents/collectionId/doc1",createTime:{seconds:1,nanos:2e6},updateTime:{seconds:3,nanos:4e3},fields:{foo:{stringValue:"value"},bar:{integerValue:-42}}}}),mV({documentMetadata:{name:"projects/test-project/databases/(default)/documents/collectionId/doc2",readTime:{seconds:5,nanos:6},exists:!0}}),mV({document:{name:"projects/test-project/databases/(default)/documents/collectionId/doc2",createTime:{seconds:1,nanos:2e6},updateTime:{seconds:3,nanos:4e3},fields:{foo:{stringValue:"value1"},bar:{integerValue:42},emptyArray:{arrayValue:{}},emptyMap:{mapValue:{}}}}}),mV({documentMetadata:{name:"projects/test-project/databases/(default)/documents/collectionId/nodoc",readTime:{seconds:5,nanos:6},exists:!1}}),mV({namedQuery:{name:"limitQuery",bundledQuery:{parent:"projects/fireeats-97d5e/databases/(default)/documents",structuredQuery:{from:[{collectionId:"node_3.7.5_7Li7XoCjutvNxwD0tpo9"}],orderBy:[{field:{fieldPath:"sort"},direction:"DESCENDING"}],limit:{value:1}},limitType:"FIRST"},readTime:{seconds:1590011379,nanos:191164e3}}}),mV({namedQuery:{name:"limitToLastQuery",bundledQuery:{parent:"projects/fireeats-97d5e/databases/(default)/documents",structuredQuery:{from:[{collectionId:"node_3.7.5_7Li7XoCjutvNxwD0tpo9"}],orderBy:[{field:{fieldPath:"sort"},direction:"ASCENDING"}],limit:{value:1}},limitType:"LAST"},readTime:{seconds:1590011379,nanos:543063e3}}});let mj=1;class mz{constructor(e,t){this.firestore=e,this.bundleId=t,this.documents=new Map,this.namedQueries=new Map,this.latestReadTime=new ey(0,0),this.databaseId=e._databaseId,this.serializer=new al(this.databaseId,!0),this.userDataReader=new fY(this.databaseId,!0,this.serializer)}addBundleDocument(e,t){let r=this.documents.get(e.documentPath),n=r?.metadata.queries,i=e.readTime,s=r?.metadata.readTime?ap(r.metadata.readTime):null,a=!i&&null==s,o=void 0!==i&&(null==s||s<i);if((a||o)&&this.documents.set(e.documentPath,{document:this.toBundleDocument(e),metadata:{name:aS(this.serializer,e.documentKey),readTime:i?ad(this.serializer,i):void 0,exists:e.documentExists}}),i&&i>this.latestReadTime&&(this.latestReadTime=i),t){let r=this.documents.get(e.documentPath);r.metadata.queries=n||[],r.metadata.queries.push(t)}}addBundleQuery(e){if(this.namedQueries.has(e.name))throw Error(`Query name conflict: ${name} has already been added.`);let t=new ey(0,0);for(let r of e.docBundleDataArray)this.addBundleDocument(r,e.name),r.readTime&&r.readTime>t&&(t=r.readTime);let r=aW(this.serializer,ik(e.query)),n={parent:e.parent,structuredQuery:r.queryTarget.structuredQuery};this.namedQueries.set(e.name,{name:e.name,bundledQuery:n,readTime:ad(this.serializer,t)})}toBundleDocument(e){let t=this.userDataReader.createContext(4,"internal toBundledDocument"),r=f8(e.documentData,t);return{name:aS(this.serializer,e.documentKey),fields:r.mapValue.fields,updateTime:ad(this.serializer,e.versionTime),createTime:ad(this.serializer,e.createdTime)}}lengthPrefixedString(e){let t=JSON.stringify(e),r=mU.encode(t).byteLength;return`${r}${t}`}build(){let e="";for(let t of this.namedQueries.values())e+=this.lengthPrefixedString({namedQuery:t});for(let t of this.documents.values()){let r=t.metadata;e+=this.lengthPrefixedString({documentMetadata:r});let n=t.document;n&&(e+=this.lengthPrefixedString({document:n}))}let t={id:this.bundleId,createTime:ad(this.serializer,this.latestReadTime),version:mj,totalDocuments:this.documents.size,totalBytes:mU.encode(e).length};return this.lengthPrefixedString({metadata:t})+e}}function mq(e,t,r,n){let i=new mz(e,$.newId());return i.addBundleDocument(m$(n,r,t)),i.build()}function mG(e,t,r,n,i,s,a){let o=[];for(let e=0;e<s.length;e++)o.push(m$(i[e],a[e],s[e]));let l={name:r,query:t,parent:n,docBundleDataArray:o},u=new mz(e,r);return u.addBundleQuery(l),u.build()}function m$(e,t,r){return{documentData:t,documentKey:r.mutableCopy().key,documentPath:e,documentExists:!0,createdTime:r.createTime.toTimestamp(),readTime:r.readTime.toTimestamp(),versionTime:r.version.toTimestamp()}}class mK{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class mW extends mh{constructor(e,t,r,n,i,s){super(e,t,r,n,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(!this._converter)return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps);{let t=new mH(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}}}get(e,t={}){if(this._document){let r=this._document.data.field(mp("DocumentSnapshot.get",e));if(null!==r)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new P(x.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e=this._document,t={};if(t.type=mW._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument())return t;let r=this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous");return t.bundle=mq(this._firestore,e,r,this.ref.path),t}}mW._jsonSchemaVersion="firestore/documentSnapshot/1.0",mW._jsonSchema={type:ep("string",mW._jsonSchemaVersion),bundleSource:ep("string","DocumentSnapshot"),bundleName:ep("string"),bundle:ep("string")};class mH extends mW{data(e={}){return super.data(e)}}class mQ{constructor(e,t,r,n){this._firestore=e,this._userDataWriter=t,this._snapshot=n,this.metadata=new mK(n.hasPendingWrites,n.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new mH(this._firestore,this._userDataWriter,r.key,r,new mK(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new P(x.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=mY(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new P(x.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e={};e.type=mQ._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=$.newId();let t=this._firestore._databaseId.database,r=this._firestore._databaseId.projectId,n=`projects/${r}/databases/${t}/documents`,i=[],s=[],a=[];return this.docs.forEach(e=>{null!==e._document&&(i.push(e._document),s.push(this._userDataWriter.convertObjectMap(e._document.data.value.mapValue.fields,"previous")),a.push(e.ref.path))}),e.bundle=mG(this._firestore,this.query._query,e.bundleName,n,a,i,s),e}}function mY(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(r=>{let n=new mH(e._firestore,e._userDataWriter,r.doc.key,r.doc,new mK(e._snapshot.mutatedKeys.has(r.doc.key),e._snapshot.fromCache),e.query.converter);return r.doc,{type:"added",doc:n,oldIndex:-1,newIndex:t++}})}{let r=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{let n=new mH(e._firestore,e._userDataWriter,t.doc.key,t.doc,new mK(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),i=-1,s=-1;return 0!==t.type&&(i=r.indexOf(t.doc.key),r=r.delete(t.doc.key)),1!==t.type&&(s=(r=r.add(t.doc)).indexOf(t.doc.key)),{type:mJ(t.type),doc:n,oldIndex:i,newIndex:s}})}}function mJ(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return k(61501,{type:e})}}function mX(e){e=ed(e,fI);let t=ed(e.firestore,fP);return fn(fM(t),e._key).then(r=>m6(t,e,r))}mQ._jsonSchemaVersion="firestore/querySnapshot/1.0",mQ._jsonSchema={type:ep("string",mQ._jsonSchemaVersion),bundleSource:ep("string","QuerySnapshot"),bundleName:ep("string"),bundle:ep("string")};class mZ extends mP{constructor(e){super(),this.firestore=e}convertBytes(e){return new fV(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new fI(this.firestore,null,t)}}function m0(e){e=ed(e,f_);let t=ed(e.firestore,fP),r=fM(t),n=new mZ(t);return mf(e._query),fi(r,e._query).then(r=>new mQ(t,n,e,r))}function m1(e,t,r){e=ed(e,fI);let n=ed(e.firestore,fP),i=mM(e.converter,t,r),s=fX(fJ(n),"setDoc",e._key,i,null!==e.converter,r).toMutation(e._key,sS.none());return m3(n,[s])}function m2(e,t,r,...n){let i;e=ed(e,fI);let s=ed(e.firestore,fP),a=fJ(s);return m3(s,[(i="string"==typeof(t=(0,h.m9)(t))||t instanceof fj?f9(a,"updateDoc",e._key,t,r,n):f6(a,"updateDoc",e._key,t)).toMutation(e._key,sS.exists(!0))])}function m4(e){return m3(ed(e.firestore,fP),[new sB(e._key,sS.none())])}function m3(e,t){return fs(fM(e),t)}function m6(e,t,r){let n=r.docs.get(t._key),i=new mZ(e);return new mW(e,i,t._key,n,new mK(r.hasPendingWrites,r.fromCache),t.converter)}class m9{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=pj.provider,this._offlineComponentProvider={build:t=>new pV(t,e?.cacheSizeBytes,this.forceOwnership)}}}function m5(e,t){if((e=(0,h.m9)(e)).firestore===t)return e;throw new P(x.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.")}new WeakMap,fB("node")},1513:e=>{"use strict";e.exports={i8:"1.9.15"}},6541:e=>{"use strict";e.exports=JSON.parse('{"nested":{"google":{"nested":{"protobuf":{"nested":{"Api":{"fields":{"name":{"type":"string","id":1},"methods":{"rule":"repeated","type":"Method","id":2},"options":{"rule":"repeated","type":"Option","id":3},"version":{"type":"string","id":4},"sourceContext":{"type":"SourceContext","id":5},"mixins":{"rule":"repeated","type":"Mixin","id":6},"syntax":{"type":"Syntax","id":7}}},"Method":{"fields":{"name":{"type":"string","id":1},"requestTypeUrl":{"type":"string","id":2},"requestStreaming":{"type":"bool","id":3},"responseTypeUrl":{"type":"string","id":4},"responseStreaming":{"type":"bool","id":5},"options":{"rule":"repeated","type":"Option","id":6},"syntax":{"type":"Syntax","id":7}}},"Mixin":{"fields":{"name":{"type":"string","id":1},"root":{"type":"string","id":2}}},"SourceContext":{"fields":{"fileName":{"type":"string","id":1}}},"Option":{"fields":{"name":{"type":"string","id":1},"value":{"type":"Any","id":2}}},"Syntax":{"values":{"SYNTAX_PROTO2":0,"SYNTAX_PROTO3":1}}}}}}}}')},9987:e=>{"use strict";e.exports=JSON.parse('{"nested":{"google":{"nested":{"protobuf":{"options":{"go_package":"google.golang.org/protobuf/types/descriptorpb","java_package":"com.google.protobuf","java_outer_classname":"DescriptorProtos","csharp_namespace":"Google.Protobuf.Reflection","objc_class_prefix":"GPB","cc_enable_arenas":true,"optimize_for":"SPEED"},"nested":{"FileDescriptorSet":{"edition":"proto2","fields":{"file":{"rule":"repeated","type":"FileDescriptorProto","id":1}},"extensions":[[536000000,536000000]]},"Edition":{"edition":"proto2","values":{"EDITION_UNKNOWN":0,"EDITION_LEGACY":900,"EDITION_PROTO2":998,"EDITION_PROTO3":999,"EDITION_2023":1000,"EDITION_2024":1001,"EDITION_1_TEST_ONLY":1,"EDITION_2_TEST_ONLY":2,"EDITION_99997_TEST_ONLY":99997,"EDITION_99998_TEST_ONLY":99998,"EDITION_99999_TEST_ONLY":99999,"EDITION_MAX":2147483647}},"FileDescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"package":{"type":"string","id":2},"dependency":{"rule":"repeated","type":"string","id":3},"publicDependency":{"rule":"repeated","type":"int32","id":10},"weakDependency":{"rule":"repeated","type":"int32","id":11},"optionDependency":{"rule":"repeated","type":"string","id":15},"messageType":{"rule":"repeated","type":"DescriptorProto","id":4},"enumType":{"rule":"repeated","type":"EnumDescriptorProto","id":5},"service":{"rule":"repeated","type":"ServiceDescriptorProto","id":6},"extension":{"rule":"repeated","type":"FieldDescriptorProto","id":7},"options":{"type":"FileOptions","id":8},"sourceCodeInfo":{"type":"SourceCodeInfo","id":9},"syntax":{"type":"string","id":12},"edition":{"type":"Edition","id":14}}},"DescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"field":{"rule":"repeated","type":"FieldDescriptorProto","id":2},"extension":{"rule":"repeated","type":"FieldDescriptorProto","id":6},"nestedType":{"rule":"repeated","type":"DescriptorProto","id":3},"enumType":{"rule":"repeated","type":"EnumDescriptorProto","id":4},"extensionRange":{"rule":"repeated","type":"ExtensionRange","id":5},"oneofDecl":{"rule":"repeated","type":"OneofDescriptorProto","id":8},"options":{"type":"MessageOptions","id":7},"reservedRange":{"rule":"repeated","type":"ReservedRange","id":9},"reservedName":{"rule":"repeated","type":"string","id":10},"visibility":{"type":"SymbolVisibility","id":11}},"nested":{"ExtensionRange":{"fields":{"start":{"type":"int32","id":1},"end":{"type":"int32","id":2},"options":{"type":"ExtensionRangeOptions","id":3}}},"ReservedRange":{"fields":{"start":{"type":"int32","id":1},"end":{"type":"int32","id":2}}}}},"ExtensionRangeOptions":{"edition":"proto2","fields":{"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999},"declaration":{"rule":"repeated","type":"Declaration","id":2,"options":{"retention":"RETENTION_SOURCE"}},"features":{"type":"FeatureSet","id":50},"verification":{"type":"VerificationState","id":3,"options":{"default":"UNVERIFIED","retention":"RETENTION_SOURCE"}}},"extensions":[[1000,536870911]],"nested":{"Declaration":{"fields":{"number":{"type":"int32","id":1},"fullName":{"type":"string","id":2},"type":{"type":"string","id":3},"reserved":{"type":"bool","id":5},"repeated":{"type":"bool","id":6}},"reserved":[[4,4]]},"VerificationState":{"values":{"DECLARATION":0,"UNVERIFIED":1}}}},"FieldDescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"number":{"type":"int32","id":3},"label":{"type":"Label","id":4},"type":{"type":"Type","id":5},"typeName":{"type":"string","id":6},"extendee":{"type":"string","id":2},"defaultValue":{"type":"string","id":7},"oneofIndex":{"type":"int32","id":9},"jsonName":{"type":"string","id":10},"options":{"type":"FieldOptions","id":8},"proto3Optional":{"type":"bool","id":17}},"nested":{"Type":{"values":{"TYPE_DOUBLE":1,"TYPE_FLOAT":2,"TYPE_INT64":3,"TYPE_UINT64":4,"TYPE_INT32":5,"TYPE_FIXED64":6,"TYPE_FIXED32":7,"TYPE_BOOL":8,"TYPE_STRING":9,"TYPE_GROUP":10,"TYPE_MESSAGE":11,"TYPE_BYTES":12,"TYPE_UINT32":13,"TYPE_ENUM":14,"TYPE_SFIXED32":15,"TYPE_SFIXED64":16,"TYPE_SINT32":17,"TYPE_SINT64":18}},"Label":{"values":{"LABEL_OPTIONAL":1,"LABEL_REPEATED":3,"LABEL_REQUIRED":2}}}},"OneofDescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"options":{"type":"OneofOptions","id":2}}},"EnumDescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"value":{"rule":"repeated","type":"EnumValueDescriptorProto","id":2},"options":{"type":"EnumOptions","id":3},"reservedRange":{"rule":"repeated","type":"EnumReservedRange","id":4},"reservedName":{"rule":"repeated","type":"string","id":5},"visibility":{"type":"SymbolVisibility","id":6}},"nested":{"EnumReservedRange":{"fields":{"start":{"type":"int32","id":1},"end":{"type":"int32","id":2}}}}},"EnumValueDescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"number":{"type":"int32","id":2},"options":{"type":"EnumValueOptions","id":3}}},"ServiceDescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"method":{"rule":"repeated","type":"MethodDescriptorProto","id":2},"options":{"type":"ServiceOptions","id":3}}},"MethodDescriptorProto":{"edition":"proto2","fields":{"name":{"type":"string","id":1},"inputType":{"type":"string","id":2},"outputType":{"type":"string","id":3},"options":{"type":"MethodOptions","id":4},"clientStreaming":{"type":"bool","id":5},"serverStreaming":{"type":"bool","id":6}}},"FileOptions":{"edition":"proto2","fields":{"javaPackage":{"type":"string","id":1},"javaOuterClassname":{"type":"string","id":8},"javaMultipleFiles":{"type":"bool","id":10},"javaGenerateEqualsAndHash":{"type":"bool","id":20,"options":{"deprecated":true}},"javaStringCheckUtf8":{"type":"bool","id":27},"optimizeFor":{"type":"OptimizeMode","id":9,"options":{"default":"SPEED"}},"goPackage":{"type":"string","id":11},"ccGenericServices":{"type":"bool","id":16},"javaGenericServices":{"type":"bool","id":17},"pyGenericServices":{"type":"bool","id":18},"deprecated":{"type":"bool","id":23},"ccEnableArenas":{"type":"bool","id":31,"options":{"default":true}},"objcClassPrefix":{"type":"string","id":36},"csharpNamespace":{"type":"string","id":37},"swiftPrefix":{"type":"string","id":39},"phpClassPrefix":{"type":"string","id":40},"phpNamespace":{"type":"string","id":41},"phpMetadataNamespace":{"type":"string","id":44},"rubyPackage":{"type":"string","id":45},"features":{"type":"FeatureSet","id":50},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]],"reserved":[[42,42],[38,38],"php_generic_services"],"nested":{"OptimizeMode":{"values":{"SPEED":1,"CODE_SIZE":2,"LITE_RUNTIME":3}}}},"MessageOptions":{"edition":"proto2","fields":{"messageSetWireFormat":{"type":"bool","id":1},"noStandardDescriptorAccessor":{"type":"bool","id":2},"deprecated":{"type":"bool","id":3},"mapEntry":{"type":"bool","id":7},"deprecatedLegacyJsonFieldConflicts":{"type":"bool","id":11,"options":{"deprecated":true}},"features":{"type":"FeatureSet","id":12},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]],"reserved":[[4,4],[5,5],[6,6],[8,8],[9,9]]},"FieldOptions":{"edition":"proto2","fields":{"ctype":{"type":"CType","id":1,"options":{"default":"STRING"}},"packed":{"type":"bool","id":2},"jstype":{"type":"JSType","id":6,"options":{"default":"JS_NORMAL"}},"lazy":{"type":"bool","id":5},"unverifiedLazy":{"type":"bool","id":15},"deprecated":{"type":"bool","id":3},"weak":{"type":"bool","id":10,"options":{"deprecated":true}},"debugRedact":{"type":"bool","id":16},"retention":{"type":"OptionRetention","id":17},"targets":{"rule":"repeated","type":"OptionTargetType","id":19},"editionDefaults":{"rule":"repeated","type":"EditionDefault","id":20},"features":{"type":"FeatureSet","id":21},"featureSupport":{"type":"FeatureSupport","id":22},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]],"reserved":[[4,4],[18,18]],"nested":{"CType":{"values":{"STRING":0,"CORD":1,"STRING_PIECE":2}},"JSType":{"values":{"JS_NORMAL":0,"JS_STRING":1,"JS_NUMBER":2}},"OptionRetention":{"values":{"RETENTION_UNKNOWN":0,"RETENTION_RUNTIME":1,"RETENTION_SOURCE":2}},"OptionTargetType":{"values":{"TARGET_TYPE_UNKNOWN":0,"TARGET_TYPE_FILE":1,"TARGET_TYPE_EXTENSION_RANGE":2,"TARGET_TYPE_MESSAGE":3,"TARGET_TYPE_FIELD":4,"TARGET_TYPE_ONEOF":5,"TARGET_TYPE_ENUM":6,"TARGET_TYPE_ENUM_ENTRY":7,"TARGET_TYPE_SERVICE":8,"TARGET_TYPE_METHOD":9}},"EditionDefault":{"fields":{"edition":{"type":"Edition","id":3},"value":{"type":"string","id":2}}},"FeatureSupport":{"fields":{"editionIntroduced":{"type":"Edition","id":1},"editionDeprecated":{"type":"Edition","id":2},"deprecationWarning":{"type":"string","id":3},"editionRemoved":{"type":"Edition","id":4}}}}},"OneofOptions":{"edition":"proto2","fields":{"features":{"type":"FeatureSet","id":1},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]]},"EnumOptions":{"edition":"proto2","fields":{"allowAlias":{"type":"bool","id":2},"deprecated":{"type":"bool","id":3},"deprecatedLegacyJsonFieldConflicts":{"type":"bool","id":6,"options":{"deprecated":true}},"features":{"type":"FeatureSet","id":7},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]],"reserved":[[5,5]]},"EnumValueOptions":{"edition":"proto2","fields":{"deprecated":{"type":"bool","id":1},"features":{"type":"FeatureSet","id":2},"debugRedact":{"type":"bool","id":3},"featureSupport":{"type":"FieldOptions.FeatureSupport","id":4},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]]},"ServiceOptions":{"edition":"proto2","fields":{"features":{"type":"FeatureSet","id":34},"deprecated":{"type":"bool","id":33},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]]},"MethodOptions":{"edition":"proto2","fields":{"deprecated":{"type":"bool","id":33},"idempotencyLevel":{"type":"IdempotencyLevel","id":34,"options":{"default":"IDEMPOTENCY_UNKNOWN"}},"features":{"type":"FeatureSet","id":35},"uninterpretedOption":{"rule":"repeated","type":"UninterpretedOption","id":999}},"extensions":[[1000,536870911]],"nested":{"IdempotencyLevel":{"values":{"IDEMPOTENCY_UNKNOWN":0,"NO_SIDE_EFFECTS":1,"IDEMPOTENT":2}}}},"UninterpretedOption":{"edition":"proto2","fields":{"name":{"rule":"repeated","type":"NamePart","id":2},"identifierValue":{"type":"string","id":3},"positiveIntValue":{"type":"uint64","id":4},"negativeIntValue":{"type":"int64","id":5},"doubleValue":{"type":"double","id":6},"stringValue":{"type":"bytes","id":7},"aggregateValue":{"type":"string","id":8}},"nested":{"NamePart":{"fields":{"namePart":{"rule":"required","type":"string","id":1},"isExtension":{"rule":"required","type":"bool","id":2}}}}},"FeatureSet":{"edition":"proto2","fields":{"fieldPresence":{"type":"FieldPresence","id":1,"options":{"retention":"RETENTION_RUNTIME","targets":"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_2023","edition_defaults.value":"EXPLICIT"}},"enumType":{"type":"EnumType","id":2,"options":{"retention":"RETENTION_RUNTIME","targets":"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_PROTO3","edition_defaults.value":"OPEN"}},"repeatedFieldEncoding":{"type":"RepeatedFieldEncoding","id":3,"options":{"retention":"RETENTION_RUNTIME","targets":"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_PROTO3","edition_defaults.value":"PACKED"}},"utf8Validation":{"type":"Utf8Validation","id":4,"options":{"retention":"RETENTION_RUNTIME","targets":"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_PROTO3","edition_defaults.value":"VERIFY"}},"messageEncoding":{"type":"MessageEncoding","id":5,"options":{"retention":"RETENTION_RUNTIME","targets":"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_LEGACY","edition_defaults.value":"LENGTH_PREFIXED"}},"jsonFormat":{"type":"JsonFormat","id":6,"options":{"retention":"RETENTION_RUNTIME","targets":"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2023","edition_defaults.edition":"EDITION_PROTO3","edition_defaults.value":"ALLOW"}},"enforceNamingStyle":{"type":"EnforceNamingStyle","id":7,"options":{"retention":"RETENTION_SOURCE","targets":"TARGET_TYPE_METHOD","feature_support.edition_introduced":"EDITION_2024","edition_defaults.edition":"EDITION_2024","edition_defaults.value":"STYLE2024"}},"defaultSymbolVisibility":{"type":"VisibilityFeature.DefaultSymbolVisibility","id":8,"options":{"retention":"RETENTION_SOURCE","targets":"TARGET_TYPE_FILE","feature_support.edition_introduced":"EDITION_2024","edition_defaults.edition":"EDITION_2024","edition_defaults.value":"EXPORT_TOP_LEVEL"}}},"extensions":[[1000,9994],[9995,9999],[10000,10000]],"reserved":[[999,999]],"nested":{"FieldPresence":{"values":{"FIELD_PRESENCE_UNKNOWN":0,"EXPLICIT":1,"IMPLICIT":2,"LEGACY_REQUIRED":3}},"EnumType":{"values":{"ENUM_TYPE_UNKNOWN":0,"OPEN":1,"CLOSED":2}},"RepeatedFieldEncoding":{"values":{"REPEATED_FIELD_ENCODING_UNKNOWN":0,"PACKED":1,"EXPANDED":2}},"Utf8Validation":{"values":{"UTF8_VALIDATION_UNKNOWN":0,"VERIFY":2,"NONE":3}},"MessageEncoding":{"values":{"MESSAGE_ENCODING_UNKNOWN":0,"LENGTH_PREFIXED":1,"DELIMITED":2}},"JsonFormat":{"values":{"JSON_FORMAT_UNKNOWN":0,"ALLOW":1,"LEGACY_BEST_EFFORT":2}},"EnforceNamingStyle":{"values":{"ENFORCE_NAMING_STYLE_UNKNOWN":0,"STYLE2024":1,"STYLE_LEGACY":2}},"VisibilityFeature":{"fields":{},"reserved":[[1,536870911]],"nested":{"DefaultSymbolVisibility":{"values":{"DEFAULT_SYMBOL_VISIBILITY_UNKNOWN":0,"EXPORT_ALL":1,"EXPORT_TOP_LEVEL":2,"LOCAL_ALL":3,"STRICT":4}}}}}},"FeatureSetDefaults":{"edition":"proto2","fields":{"defaults":{"rule":"repeated","type":"FeatureSetEditionDefault","id":1},"minimumEdition":{"type":"Edition","id":4},"maximumEdition":{"type":"Edition","id":5}},"nested":{"FeatureSetEditionDefault":{"fields":{"edition":{"type":"Edition","id":3},"overridableFeatures":{"type":"FeatureSet","id":4},"fixedFeatures":{"type":"FeatureSet","id":5}},"reserved":[[1,1],[2,2],"features"]}}},"SourceCodeInfo":{"edition":"proto2","fields":{"location":{"rule":"repeated","type":"Location","id":1}},"extensions":[[536000000,536000000]],"nested":{"Location":{"fields":{"path":{"rule":"repeated","type":"int32","id":1,"options":{"packed":true}},"span":{"rule":"repeated","type":"int32","id":2,"options":{"packed":true}},"leadingComments":{"type":"string","id":3},"trailingComments":{"type":"string","id":4},"leadingDetachedComments":{"rule":"repeated","type":"string","id":6}}}}},"GeneratedCodeInfo":{"edition":"proto2","fields":{"annotation":{"rule":"repeated","type":"Annotation","id":1}},"nested":{"Annotation":{"fields":{"path":{"rule":"repeated","type":"int32","id":1,"options":{"packed":true}},"sourceFile":{"type":"string","id":2},"begin":{"type":"int32","id":3},"end":{"type":"int32","id":4},"semantic":{"type":"Semantic","id":5}},"nested":{"Semantic":{"values":{"NONE":0,"SET":1,"ALIAS":2}}}}}},"SymbolVisibility":{"edition":"proto2","values":{"VISIBILITY_UNSET":0,"VISIBILITY_LOCAL":1,"VISIBILITY_EXPORT":2}}}}}}}}')},7674:e=>{"use strict";e.exports=JSON.parse('{"nested":{"google":{"nested":{"protobuf":{"nested":{"SourceContext":{"fields":{"fileName":{"type":"string","id":1}}}}}}}}}')},3795:e=>{"use strict";e.exports=JSON.parse('{"nested":{"google":{"nested":{"protobuf":{"nested":{"Type":{"fields":{"name":{"type":"string","id":1},"fields":{"rule":"repeated","type":"Field","id":2},"oneofs":{"rule":"repeated","type":"string","id":3},"options":{"rule":"repeated","type":"Option","id":4},"sourceContext":{"type":"SourceContext","id":5},"syntax":{"type":"Syntax","id":6}}},"Field":{"fields":{"kind":{"type":"Kind","id":1},"cardinality":{"type":"Cardinality","id":2},"number":{"type":"int32","id":3},"name":{"type":"string","id":4},"typeUrl":{"type":"string","id":6},"oneofIndex":{"type":"int32","id":7},"packed":{"type":"bool","id":8},"options":{"rule":"repeated","type":"Option","id":9},"jsonName":{"type":"string","id":10},"defaultValue":{"type":"string","id":11}},"nested":{"Kind":{"values":{"TYPE_UNKNOWN":0,"TYPE_DOUBLE":1,"TYPE_FLOAT":2,"TYPE_INT64":3,"TYPE_UINT64":4,"TYPE_INT32":5,"TYPE_FIXED64":6,"TYPE_FIXED32":7,"TYPE_BOOL":8,"TYPE_STRING":9,"TYPE_GROUP":10,"TYPE_MESSAGE":11,"TYPE_BYTES":12,"TYPE_UINT32":13,"TYPE_ENUM":14,"TYPE_SFIXED32":15,"TYPE_SFIXED64":16,"TYPE_SINT32":17,"TYPE_SINT64":18}},"Cardinality":{"values":{"CARDINALITY_UNKNOWN":0,"CARDINALITY_OPTIONAL":1,"CARDINALITY_REQUIRED":2,"CARDINALITY_REPEATED":3}}}},"Enum":{"fields":{"name":{"type":"string","id":1},"enumvalue":{"rule":"repeated","type":"EnumValue","id":2},"options":{"rule":"repeated","type":"Option","id":3},"sourceContext":{"type":"SourceContext","id":4},"syntax":{"type":"Syntax","id":5}}},"EnumValue":{"fields":{"name":{"type":"string","id":1},"number":{"type":"int32","id":2},"options":{"rule":"repeated","type":"Option","id":3}}},"Option":{"fields":{"name":{"type":"string","id":1},"value":{"type":"Any","id":2}}},"Syntax":{"values":{"SYNTAX_PROTO2":0,"SYNTAX_PROTO3":1}},"Any":{"fields":{"type_url":{"type":"string","id":1},"value":{"type":"bytes","id":2}}},"SourceContext":{"fields":{"fileName":{"type":"string","id":1}}}}}}}}}')}};